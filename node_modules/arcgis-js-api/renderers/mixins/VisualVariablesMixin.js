/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../layers/support/fieldUtils","../support/randomRotationExpression","../visualVariables/ColorVariable","../visualVariables/OpacityVariable","../visualVariables/RotationVariable","../visualVariables/SizeVariable","../visualVariables/VisualVariable","../visualVariables/VisualVariableFactory"],(function(e,a,r,i,s,t,l,o,u,n,c,V,p,b,y,v,d,h){"use strict";const f={base:d,key:"type",typeMap:{opacity:b,color:p,rotation:y,size:v}},F=e=>{let s=function(e){function r(){var a;return(a=e.apply(this,arguments)||this)._vvFactory=new h,a}a._inherits(r,e);var i=r.prototype;return i.readVisualVariables=function(e,a,r){return this._vvFactory.readVariables(e,a,r)},i.writeVisualVariables=function(e,a,r,i){a[r]=this._vvFactory.writeVariables(e,i)},i.hasVisualVariables=function(e,a){return e?this.getVisualVariablesForType(e,a).length>0:this.getVisualVariablesForType("size",a).length>0||this.getVisualVariablesForType("color",a).length>0||this.getVisualVariablesForType("opacity",a).length>0||this.getVisualVariablesForType("rotation",a).length>0},i.getVisualVariablesForType=function(e,a){const r=this.visualVariables;return r?r.filter((r=>r.type===e&&("string"==typeof a?r.target===a:!1!==a||!r.target))):[]},i.collectVVRequiredFields=async function(e,a){let r=[];this.visualVariables&&(r=r.concat(this.visualVariables));for(const i of r)i&&(i.field&&c.collectField(e,a,i.field),i.normalizationField&&c.collectField(e,a,i.normalizationField),i.valueExpression&&(g(i.valueExpression,e,a)||await c.collectArcadeFieldNames(e,a,i.valueExpression)))},a._createClass(r,[{key:"visualVariables",set:function(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}},{key:"arcadeRequiredForVisualVariables",get:function(){if(!this.visualVariables)return!1;for(const e of this.visualVariables)if(e.arcadeRequired)return!0;return!1}}]),r}(e);return r.__decorate([i.property({types:[f],value:null,json:{write:!0}})],s.prototype,"visualVariables",null),r.__decorate([o.reader("visualVariables",["visualVariables","rotationType","rotationExpression"])],s.prototype,"readVisualVariables",null),r.__decorate([n.writer("visualVariables")],s.prototype,"writeVisualVariables",null),s=r.__decorate([u.subclass("esri.renderers.mixins.VisualVariablesMixin")],s),s};function g(e,a,r){const i=V.matchRandomRotationExpression(e);return null!=i&&(c.collectField(a,r,i),!0)}e.VisualVariablesMixin=F,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
