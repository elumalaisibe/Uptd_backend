/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","./Analysis","./LineOfSightAnalysisObserver","./LineOfSightAnalysisTarget","../core/Collection","../core/collectionUtils","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","../geometry/projection","../geometry/support/aaBoundingBox","../support/elevationInfoUtils"],(function(e,t,r,o,n,i,s,l,a,p,c,u,y,d,f,h,g){"use strict";const v=i.ofType(n);let _=function(t){function r(e){var r;return(r=t.call(this,e)||this).type="line-of-sight",r.observer=null,r.extent=null,r}e._inherits(r,t);var o=r.prototype;return o.initialize=function(){this.addHandles(a.watch((()=>this._computeExtent()),(e=>{null!=e&&null!=e.pending||this._set("extent",null!=e?e.extent:null)}),a.syncAndInitial))},o.waitComputeExtent=async function(){const e=this._computeExtent();return null!=e?e.pending:Promise.resolve()},o._computeExtent=function(){const e=this.spatialReference;if(null==this.observer||null==this.observer.position||null==e)return null;const t=e=>"absolute-height"===g.getGeometryEffectiveElevationMode(e.position,e.elevationInfo),r=this.observer.position,o=h.fromValues(r.x,r.y,r.z,r.x,r.y,r.z);for(const i of this.targets)if(null!=i.position){const t=f.projectOrLoad(i.position,e);if(null!=t.pending)return{pending:t.pending,extent:null};if(null!=t.geometry){const{x:e,y:r,z:n}=t.geometry;h.expandWithVec3(o,[e,r,n])}}const n=h.toExtent(o,e);return t(this.observer)&&this.targets.every(t)||(n.zmin=void 0,n.zmax=void 0),{pending:null,extent:n}},o.clear=function(){this.observer=null,this.targets.removeAll()},e._createClass(r,[{key:"targets",get:function(){return this._get("targets")||new v},set:function(e){this._set("targets",s.referenceSetter(e,this.targets,v))}},{key:"spatialReference",get:function(){return null!=this.observer&&null!=this.observer.position?this.observer.position.spatialReference:null}},{key:"requiredPropertiesForEditing",get:function(){return[l.applySome(this.observer,(e=>e.position))]}}]),r}(r);t.__decorate([p.property({type:["line-of-sight"]})],_.prototype,"type",void 0),t.__decorate([p.property({type:o,json:{read:!0,write:!0}})],_.prototype,"observer",void 0),t.__decorate([p.property({cast:s.castForReferenceSetter,type:v,nonNullable:!0,json:{read:!0,write:!0}})],_.prototype,"targets",null),t.__decorate([p.property({value:null,readOnly:!0})],_.prototype,"extent",void 0),t.__decorate([p.property({readOnly:!0})],_.prototype,"spatialReference",null),t.__decorate([p.property({readOnly:!0})],_.prototype,"requiredPropertiesForEditing",null),_=t.__decorate([d.subclass("esri.analysis.LineOfSightAnalysis")],_);return _}));
