/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../request","../../core/has","../../core/jsonMap","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../rest/networks/support/TraceResult"],(function(e,t,r,s,o,i,a,c,n,u,l,p){"use strict";const d=o.strict()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let m=function(t){function s(e){var r;return(r=t.call(this,e)||this).statusUrl=null,r.status=null,r.submissionTime=null,r.lastUpdatedTime=null,r._timer=void 0,r}e._inherits(s,t);var o=s.prototype;return o.destroy=function(){clearInterval(this._timer)},o.checkJobStatus=async function(e){const t={...e,query:{f:"json"}},{data:s}=await r(this.statusUrl,t),o=s.traceResults?{...s.traceResults,...s}:s;return this.read(o),this},o.waitForJobCompletion=async function(e={}){const{interval:t=1e3,statusCallback:r}=e;return new Promise(((e,s)=>{this._clearTimer();const o=setInterval((()=>{this._timer||s(i.createAbortError()),this.checkJobStatus().then((t=>{const{status:s}=t;switch(this.status=s,s){case"job-succeeded":this._clearTimer(),e(this);break;case"job-waiting":case"job-executing":r&&r(this)}}),(e=>{this._clearTimer(),s(e)}))}),t);this._timer=o}))},o._clearTimer=function(){clearInterval(this._timer),this._timer=void 0},e._createClass(s)}(p);t.__decorate([a.property({type:String,json:{write:!0}})],m.prototype,"statusUrl",void 0),t.__decorate([u.enumeration(d)],m.prototype,"status",void 0),t.__decorate([a.property({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],m.prototype,"submissionTime",void 0),t.__decorate([a.property({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],m.prototype,"lastUpdatedTime",void 0),m=t.__decorate([l.subclass("esri.networks.support.TraceJobInfo")],m);return m}));
