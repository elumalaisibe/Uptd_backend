/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/events","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","../properties/defaultUnit","../rest/support/Stop","../symbols/SimpleMarkerSymbol","./Search","./Widget","./Directions/DirectionsViewModel","./Directions/components/SaveLayer","./Directions/support/directionsUtils","./Directions/support/resources","./Search/support/locatorUtils","./support/componentsUtils","./support/DatePicker","./support/Heading","./support/TimePicker","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/jsxFactory","./support/widgetUtils","../chunks/sortable.esm","../intl/number","../intl/date"],(function(e,t,s,n,i,o,r,a,l,c,u,d,h,p,S,v,_,m,g,y,C,f,w,b,M,T,x,k,D,I,P,R,H){"use strict";const L={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};function B(e){const t=e.getTimezoneOffset(),s=t>0?"-":"+",n=60,i=Math.abs(Math.floor(t/n)),o=Math.abs(Math.floor(t)%n),r={minimumIntegerDigits:2};return`GMT${s}${R.formatNumber(i,r)}${R.formatNumber(o,r)}`}function A(e){return!!e.composedPath?.().find((e=>e.classList?.contains("esri-search__suggestions-list")))}const O="search-term",E="date-time-picker",U=100,z=500;let $=function(s){function n(e,t){var n;return(n=s.call(this,e,t)||this)._activeStop=null,n._activeManeuver=null,n._autoStopRemovalDelay=U,n._autoStopRemovalTimeoutId=void 0,n._departureTimeOption=C.DepartureTimeOption.NOW,n._datePicker=new b,n._focusedManeuver=null,n._newPlaceholderStop=null,n._pointerDownUpHandle=null,n._pointerPressedSearchSuggestionStop=null,n._renderSavePopoverFunction=null,n._saveAsButtonNode=null,n._saveLayer=new g.SaveLayer,n._sections=null,n._sortable=null,n._stopsToSearches=new Map,n._timePicker=new T,n._viewClickHandle=null,n.headingLevel=2,n.iconClass=C.CSS.widgetIcon,n.icon=null,n.messages=null,n.messagesCommon=null,n.messagesUnits=null,n.searchProperties=null,n.viewModel=new m,n.visibleElements={...L},n._setUpDragAndDropStops=e=>{n._sortable=P.Sortable.create(e,{draggable:`.${C.CSS.validStopRow}`,ghostClass:C.CSS.stopRowGhost,handle:`.${C.CSS.stopHandle}`,onEnd:n._handleStopInputDragEnd})},n._handleDragHandlePointerDown=()=>n.viewModel.layer?.stops.forEach((e=>n._acquireSearch(e).activeMenu="none")),n._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t||null==t||null==e)return;const{children:i}=s,o=i[t],r=i[e],a=t-e<0;s.insertBefore(o,a?r.nextElementSibling:r);const{stops:l}=n.viewModel.layer;l.reorder(l.at(e),t);for(const n of l)n.sequence=null;n._getDirections()},n}t._inherits(n,s);var a=n.prototype;return a.initialize=function(){this.addHandles([r.watch((()=>this.viewModel.layer?.routeInfo),(()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()}),r.initial),r.when((()=>this.view),((e,t)=>{if(t&&(this._viewClickHandle=null,null!=t&&this.removeHandles(t)),e){const t=this._prepPointerDownUpClick(),s=this._prepViewClick();t.pause(),s.pause();const n=e.surface;this.addHandles([i.on(n,"mousedown",(()=>this._autoStopRemovalDelay=z)),i.on(n,"mouseup",(()=>this._autoStopRemovalDelay=U)),t,s],e),this._pointerDownUpHandle=t,this._viewClickHandle=s}}),r.initial),r.when((()=>null==this.viewModel.serviceDescription),(()=>{try{this.viewModel.load()}catch{}}),r.initial),r.watch((()=>this._saveLayer.state),(()=>{this.scheduleRender()}))]),this.when((()=>{this.destroyed||this.visibleElements.saveAsButton&&(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))}))},a.loadDependencies=function(){return w.loadCalciteComponents({button:()=>new Promise(((t,s)=>e(["../chunks/calcite-button"],t,s))),link:()=>new Promise(((t,s)=>e(["../chunks/calcite-link"],t,s))),popover:()=>new Promise(((t,s)=>e(["../chunks/calcite-popover"],t,s)))})},a.destroy=function(){this._datePicker.destroy(),this._timePicker.destroy();for(const e of this._stopsToSearches.values())e.destroy();this._sortable?.destroy(),null!=this._renderSavePopoverFunction&&this._projector.detach(this._renderSavePopoverFunction)},a.castVisibleElements=function(e){return{...L,...e}},a.getDirections=function(){return this.viewModel.getDirections()},a.render=function(){return D.tsx("div",{class:this.classes(C.CSS.base,C.CSS.scroller)},this._renderPanelContent())},a.save=function(){return this.viewModel.save()},a.saveAs=function(e,t={}){return this.viewModel.saveAs(e,t)},a.zoomToRoute=function(){return this.viewModel.zoomToRoute()},a._renderPanelContent=function(){const{layer:e,serviceDescription:t,state:s}=this.viewModel,n="initializing"===s,i="error"===s&&!t,o="unauthenticated"===s,r={[C.CSS.panelContentLoading]:n,[C.CSS.panelContentError]:i||!e,[C.CSS.panelContentSignIn]:o},a=n?"presentation":"group",l=e?o?this._renderSignIn():i?this._renderMessage(this._getErrorMessage()):n?this._renderLoader():this._renderReadyContent():this._renderMessage(this.messages.missingLayer);return D.tsx("div",{class:this.classes(C.CSS.panelContent,r),role:a},l)},a._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]},a._renderSignIn=function(){return D.tsx("div",{key:"sign-in",class:C.CSS.signInContent},D.tsx(M.Heading,{class:C.CSS.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),D.tsx(M.Heading,{level:M.incrementHeadingLevel(this.headingLevel)},this.messages.signInRequired),D.tsx("button",{class:this.classes(C.CSS.button,C.CSS.buttonSecondary,C.CSS.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))},a._handleSignInClick=function(){this.viewModel.load().catch((()=>{}))},a._renderTravelModeOptions=function(){if(!this.visibleElements.traveMode)return null;const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(0===t.length)return null;const s=null!=e?e.name:this.messages.travelMode;return D.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(C.CSS.travelMode,this._saveLayer.opened&&C.CSS.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},D.tsx("select",{"aria-label":s,bind:this,class:this.classes(C.CSS.travelModeSelect,C.CSS.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},t.map(((t,s)=>{const n=e===t;return D.tsx("option",{key:`esri-directions__travel-mode-${s}`,"data-mode":t,selected:n,value:`${s}`},t.name)}))))},a._handleTravelModeChange=function(e){const t=e.currentTarget;this.viewModel.selectedTravelMode=N(t.item(t.selectedIndex)),this._getDirections()},a._renderStopsContainer=function(){return this.visibleElements.stops?D.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(C.CSS.section,this._saveLayer.opened&&C.CSS.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null},a._renderDepartureTimeControls=function(){if(!this.visibleElements.departureTime)return null;const{messages:{departAt:e,departureTime:t,leaveNow:s,timeUnspecified:n}}=this;return D.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(C.CSS.departureTime,this._saveLayer.opened&&C.CSS.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},D.tsx("select",{"aria-label":t,bind:this,class:this.classes(C.CSS.departureTimeSelect,C.CSS.select),onchange:this._handleDepartureOptionChange,title:t},D.tsx("option",{value:C.DepartureTimeOption.NOW,selected:this._departureTimeOption===C.DepartureTimeOption.NOW},s),D.tsx("option",{value:C.DepartureTimeOption.DEPART_AT,selected:this._departureTimeOption===C.DepartureTimeOption.DEPART_AT},e),D.tsx("option",{value:C.DepartureTimeOption.UNSPECIFIED,selected:this._departureTimeOption===C.DepartureTimeOption.UNSPECIFIED},n)),this._departureTimeOption===C.DepartureTimeOption.DEPART_AT?this._renderTimeControls():null)},a._renderStops=function(){const{stops:e}=this.viewModel.layer;let t=0;for(const i of this._stopsToSearches.keys())e.includes(i)||this._disposeSearch(i);for(const i of e){const e=this._acquireSearch(i);"none"!==e.activeMenu&&(t+=1),null!=i.name&&(e.searchTerm=i.name)}const s=e.toArray().map(((s,n)=>{const i=e.length,o=n>1&&null==s.geometry,r={[C.CSS.stopsIcon]:n>=0&&n<i-1,[C.CSS.lastStopIcon]:n===i-1},a={[C.CSS.lastStopIconContainer]:n===i-1},l={[C.CSS.validStopRow]:!o},c=e.at(n+1),u=c&&null!=c.geometry,d=n===i-1,h=n===i-2,p=2===i&&0===n||i>2&&!d&&!h||i>2&&h&&u||i>2&&d&&null==s.geometry,S=i<3,v=this._acquireSearch(s),{messages:_}=this,{removeStop:m,reverseStops:g,unlocated:y}=_,f=null!=s.geometry&&null!=s.name?s.name:y,w=R.formatNumber(n+1),b=`${_.stopLabel} ${w} (${f})`,M=`${this.id}__stop--${n}`,T=!!v.searchTerm&&!!v.selectedResult&&null!=s.geometry&&v.selectedResult.name===s.name,x={zIndex:"none"!==v.activeMenu?""+t--:""};return D.tsx("li",{"aria-label":b,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(C.CSS.stopRow,l),id:M,key:n,"data-stop-index":n,styles:x},D.tsx("div",{class:C.CSS.stopHandle},D.tsx("span",{"aria-hidden":"true",class:this.classes(C.CSS.stopIcon,C.CSS.handleIcon,C.CSS.stopHandleIcon,C.CSS.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),D.tsx("div",{bind:this,"aria-labelledby":M,class:this.classes(C.CSS.stopIconContainer,a),"data-stop-index":n,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},D.tsx("span",{class:this.classes(C.CSS.stopIcon,r),tabindex:T?"0":null}))),D.tsx("div",{class:C.CSS.stopInput},v.render()),D.tsx("div",{class:C.CSS.stopOptions,role:"group"},D.tsx("div",{"aria-label":m,class:C.CSS.removeStopButton,bind:this,"data-stop-index":n,hidden:S,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:m},D.tsx("span",{"aria-hidden":"true",class:this.classes(C.CSS.stopIcon,C.CSS.removeStop,C.CSS.removeStopIcon,C.CSS.interactiveStopIcon)}),D.tsx("span",{class:C.CSS.screenReaderText},"removeStopTitle")),D.tsx("div",{"aria-label":g,class:C.CSS.reverseStops,bind:this,hidden:p,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:g},D.tsx("span",{"aria-hidden":"true",class:this.classes(C.CSS.stopIcon,C.CSS.reverseStopIcon,C.CSS.interactiveStopIcon)}),D.tsx("span",{class:C.CSS.screenReaderText},"removeStopTitle"))))})),n=this._renderAddStop();return D.tsx("div",null,D.tsx("ol",{class:C.CSS.stops,role:"group",afterCreate:this._setUpDragAndDropStops},s),n)},a._renderAddStop=function(){const e=this.viewModel.layer?.stops;if(!e)return null;const t=e.filter((({geometry:e})=>null!=e)),s=e.at(-1);return t.length>1&&t.length<this.maxStops&&null!=s&&null!=s.geometry?D.tsx("div",{class:C.CSS.toolbarSection},D.tsx("div",{class:C.CSS.toolbarButtons},D.tsx("calcite-button",{appearance:"outline",class:C.CSS.addStopButton,kind:"neutral",scale:"s",round:!0,iconStart:"plus",key:C.CSS.addStopButton,onclick:()=>{this._addNewPlaceholder()},label:this.messages.addStop,width:"full"},this.messages.addStop))):null},a._handleStopIconClick=function(e){const t=F(e.currentTarget),s=null!=t?this.viewModel.layer?.stops.at(t):void 0;s?.geometry&&this._centerAtStop(s)},a._handleClearRouteClick=function(){this.viewModel.reset()},a._centerAtStop=function(e){this.viewModel.centerAt(e)},a._handleStopFieldCreation=function(e){const t=this._newPlaceholderStop;if(!t)return;const s=F(e),n=null!=s?this.viewModel.layer?.stops.at(s):void 0;if(t===n){const e=this._acquireSearch(n);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null},a._handleStopInputBlur=function(e,t){if(this._saveLayer.opened)return;this.removeHandles(O);if(!!e.selectedResult&&null!=t.geometry&&null!=e.selectedResult?.feature.geometry&&t.geometry===e.selectedResult?.feature.geometry)return void this._pointerDownUpHandle?.pause();const s=null==t.geometry&&null==e.selectedResult?.feature.geometry,n=null!=t.geometry&&null!=e.selectedResult?.feature.geometry&&t.geometry!==e.selectedResult?.feature.geometry;if((s||n)&&"none"===e.activeMenu&&e.searchTerm)return e.search(),void this._pointerDownUpHandle?.pause();e.searchTerm||(this._viewClickHandle?.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{this.destroyed||(this._viewClickHandle?.pause(),"searching"!==e.viewModel.state?this._pointerPressedSearchSuggestionStop||(null!=t.geometry&&(t.geometry=null,this._getDirections()),this.scheduleRender()):this._pointerDownUpHandle?.pause())}),this._autoStopRemovalDelay))},a._handleStopInputFocus=function(e,t){this._pointerDownUpHandle?.resume();const{view:s}=this;if(this.hasHandles(O)||!s)return;const n=s.cursor;this.addHandles([{remove(){s.cursor=n}},r.watch((()=>e.searchTerm),(t=>{e.destroyed||(s.cursor=t.length?n:"copy")}),r.initial)],O),this._activeStop=t},a._prepViewClick=function(){const{view:e}=this.viewModel;o.assertIsSome(e),o.assertIsSome(e.surface);const t=i.pausable(e,"click",this._handleViewClick.bind(this)),s=i.pausable(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),s.pause()}));return{remove(){s.remove(),t.remove()},pause(){s.pause(),t.pause()},resume(){s.resume(),t.resume()}}},a._prepPointerDownUpClick=function(){const e=i.pausable(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=A(e)?this._activeStop:null})),t=i.pausable(document,"pointerup",(e=>{this._pointerDownUpHandle?.pause();const t=A(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?s:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}},a._handleViewClick=function(e){e.stopPropagation();const t=this._activeStop,s=t?this._stopsToSearches.get(t):null;t&&s&&!s.searchTerm&&(s.search(e.mapPoint).then((e=>{const n=e?.results[0].results;if(!n)return;const{feature:i,name:o}=n[0];t.geometry=i.geometry,t.name=o,s.searchTerm=o})),this.scheduleRender()),this._viewClickHandle?.pause(),clearTimeout(this._autoStopRemovalTimeoutId)},a._addNewPlaceholder=function(){if(this._pointerDownUpHandle?.pause(),this._newPlaceholderStop)return;const e=new p({symbol:new S});this.viewModel.layer?.stops.add(e),this._newPlaceholderStop=e},a._handleReverseStops=function(){this._reverseStops()},a._reverseStops=function(){const e=this.viewModel.layer?.stops??[];e.reverse();for(const t of e)t.sequence=null;this._getDirections()},a._handleRemoveStop=function(e){const{layer:t}=this.viewModel;if(!t)return;const s=F(e.currentTarget);if(null==s)return;const{stops:n,routeInfo:i}=t,o=n.at(s);this._removeStop(o),null==o.geometry&&null!=i||this._getDirections()},a._removeStop=function(e){const{stops:t}=this.viewModel.layer;!e||t.length<=2||(this._disposeSearch(e),t.remove(e))},a._handleDepartureOptionChange=function(e){const t=e.currentTarget,s=t.item(t.selectedIndex);s.value===C.DepartureTimeOption.NOW?(this._departureTimeOption=C.DepartureTimeOption.NOW,this.viewModel.departureTime=C.DepartureTimeOption.NOW,this.removeHandles(E),this._getDirections()):s.value===C.DepartureTimeOption.DEPART_AT?(this._departureTimeOption=C.DepartureTimeOption.DEPART_AT,this.addHandles(r.watch((()=>[this._datePicker.value,this._timePicker.value]),(()=>{this._updateDepartureTime(),this._getDirections()}),r.initial),E)):(this._departureTimeOption=C.DepartureTimeOption.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())},a._updateDepartureTime=function(){const e=this._datePicker.value,t=this._timePicker.value;e&&t&&(this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes()))},a._renderTimeControls=function(){return D.tsx("div",{class:C.CSS.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())},a._renderSectionSplitter=function(){return D.tsx("div",{class:C.CSS.sectionSplitter})},a._renderSaveContainer=function(){const{saveButton:e,saveAsButton:t,printButton:s,layerDetails:n}=this.visibleElements;return e||t||s||n?D.tsx("div",{class:C.CSS.saveSection,key:C.CSS.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null},a._renderSaveButtons=function(){const{saveButton:e,saveAsButton:t,printButton:s}=this.visibleElements;return e||t||s?D.tsx("div",{class:C.CSS.saveButtons,key:C.CSS.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null},a._renderSaveButton=function(){if(!this.visibleElements.saveButton)return null;const{portalItem:e,routeInfo:t}=this.viewModel.layer,s=e?.itemControl,n=null!=t&&("admin"===s||"update"===s);return D.tsx("calcite-button",{appearance:"outline",class:C.CSS.saveButton,disabled:!n,iconStart:"save",key:C.CSS.saveButton,onclick:()=>{this._handleSaveButtonClick()},label:this.messagesCommon.save,width:"full"},this.messagesCommon.save)},a._renderSaveAsButton=function(){if(!this.visibleElements.saveAsButton)return null;const e=null==this.viewModel.layer.routeInfo;return D.tsx("div",{class:C.CSS.saveAsButtonPopover,key:C.CSS.saveAsButtonPopover},D.tsx("calcite-button",{afterCreate:e=>{this._saveAsButtonNode=e},appearance:"outline",class:C.CSS.saveAsButton,disabled:e,iconStart:"duplicate",key:C.CSS.saveAsButton,onclick:()=>this._handleSaveAsButtonClick(),label:this.messagesCommon.saveAs,width:"full"},this.messagesCommon.saveAs))},a._renderSavePopover=function(){return D.tsx("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,overlayPositioning:"fixed",referenceElement:this._saveAsButtonNode},this._saveLayer.render())},a._handleSaveAsButtonClick=function(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)},a._renderPrintButton=function(){return this.visibleElements.printButton?D.tsx("calcite-button",{appearance:"outline",class:C.CSS.printButton,iconStart:"print",key:C.CSS.printButton,label:this.messagesCommon.print}):null},a._renderRouteLayerDetailsLink=function(){if(!this.visibleElements.layerDetails)return null;const{portalItem:e}=this.viewModel.layer;if(!e)return null;const{id:t,portal:{url:s}}=e,n=`${s}/home/item.html?id=${t}`;return D.tsx("calcite-link",{class:C.CSS.layerDetailsLink,href:n,key:C.CSS.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)},a._handleSaveButtonClick=function(){this.viewModel.layer.save()},a._renderDirectionsContainer=function(){return D.tsx("div",{class:this.classes(C.CSS.directionsSection,C.CSS.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())},a._renderLoader=function(){return D.tsx("div",{class:C.CSS.loader,key:"loader"})},a._renderWarningCard=function(){return D.tsx("div",{class:C.CSS.warningCard,role:"alert"},D.tsx("div",{class:C.CSS.warningHeader},D.tsx("span",{class:C.CSS.warningIcon,"aria-hidden":"true"}),D.tsx(M.Heading,{class:C.CSS.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),D.tsx("div",{class:C.CSS.warningMessage},this._getErrorMessage()))},a._renderDirectionsContainerContent=function(){const{layer:e,state:t}=this.viewModel,s="routing"===t;return"error"===t?this._renderWarningCard():s?this._renderLoader():null!=e.directionLines?D.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(C.CSS.summary,this._saveLayer.opened&&C.CSS.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):D.tsx("div",{key:"esri-directions__placeholder",class:C.CSS.emptyContent},this._renderPlaceholder(),D.tsx(M.Heading,{class:C.CSS.message,level:this.headingLevel},this.messages.directionsPlaceholder))},a._renderPlaceholder=function(){return D.tsx("svg",{class:C.CSS.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},D.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))},a._renderMessage=function(e){return D.tsx(M.Heading,{class:C.CSS.messageHeading,level:this.headingLevel},e)},a._renderRouteActions=function(){return D.tsx("div",{class:C.CSS.routeActions},D.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(C.CSS.clearRouteButton,C.CSS.button,C.CSS.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))},a._getSections=function(){const{layer:e}=this.viewModel;if(!e)return null;const{directionPoints:t,directionLines:s,stops:n}=e;if(null==t||null==s)return null;const i=[];let o=null;for(const r of t){const{objectId:e,stopId:t}=r;if(null!=t){const e=n.find((({objectId:e})=>e===t)),s=0===i.length;null!=o&&o.stop===e||(o={stop:e,directions:[],open:s},i.push(o));continue}if(null==o)continue;const a=s.find((({directionPointId:t})=>t===e));null!=a&&o.directions.push({directionPoint:r,directionLine:a})}return i},a._renderManeuverSections=function(){return null==this._sections?null:D.tsx("div",{class:C.CSS.maneuvers,role:"group"},this._sections.map(((e,t)=>{const{open:s}=e;let n;e.directions.length>0&&s&&(n=D.tsx("ol",{class:C.CSS.maneuverList},e.directions.map((e=>this._renderManeuver(e)))));const i=this._sections.length>2,o=t===this._sections.length-1,r={[C.CSS.collapsibleSection]:i},a={[C.CSS.openIcon]:!s,[C.CSS.closeIcon]:s};let l;if(i&&!o){const t=s?this.messagesCommon.close:this.messagesCommon.open;l=D.tsx("header",{class:this.classes(C.CSS.maneuverSectionHeader,C.CSS.maneuverSectionToggle),key:C.CSS.maneuverSectionHeader},D.tsx("div",{"aria-expanded":s.toString(),"aria-label":t,bind:this,class:C.CSS.maneuverSectionHeaderButton,"data-maneuver-section":e,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:t},D.tsx(M.Heading,{class:C.CSS.maneuverSectionTitle,level:this.headingLevel},e.stop.name),D.tsx("span",{"aria-hidden":"true",class:this.classes(a)})))}else l=D.tsx("header",{class:C.CSS.maneuverSectionHeader,key:C.CSS.maneuverSectionHeader},D.tsx(M.Heading,{class:C.CSS.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return D.tsx("section",{class:this.classes(C.CSS.maneuverSection,r),key:t},l,n)})))},a._handleSectionToggle=function(e){const t=q(e.currentTarget);t&&(t.open=!t.open)},a._renderCosts=function(){const e=this._getCostSummary(),{directionPoints:t}=this.viewModel.layer;if(null==t||null==e)return null;const s=t.at(-1).arrivalTime,{distance:n,duration:i}=e,{eta:o,primaryCosts:r,secondaryCosts:a,zoomToRoute:l}=this.messages,c=H.convertDateFormatToIntlOptions("short-time"),u=null!=s?`<strong>${H.formatDate(s,c)}</strong> ${B(s)}`:"";return D.tsx("div",{"aria-label":l,bind:this,class:C.CSS.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:l},D.tsx("div",{class:C.CSS.costsDetails,role:"group"},D.tsx("div",{class:C.CSS.primaryCosts,title:r},i),D.tsx("div",{class:C.CSS.verticalSplitter}),D.tsx("div",{class:C.CSS.secondaryCosts,title:a},n)),D.tsx("div",{innerHTML:u,title:o}))},a._handleSummaryInteraction=function(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()},a._getErrorMessage=function(){switch(this.viewModel.lastError?.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}},a._normalizeSearchSources=function(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)},a._overrideDefaultSources=function(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))},a._applyLocatorSourceOverrides=function({allSources:e}){for(const t of e)"url"in t&&t.url&&(t.locationType??(t.locationType="street"),f.isArcGISWorldGeocoder(t.url)&&this.apiKey&&null==t.apiKey&&(t.apiKey=this.apiKey,t.url=f.meteredArcGISLocatorUrl))},a._acquireSearch=function(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new v({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this.addHandles([r.on((()=>s.allSources),"change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.geometry=s.selectedResult?.feature.geometry,e.name=s.selectedResult?.name,this._getDirections()})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e))),s.on("search-clear",(()=>{e.geometry=null,e.name=null,this._activeStop=e,this.viewModel.layer?.removeResult()})),r.watch((()=>s.searchTerm),(t=>{e.name=t}))],s),this._stopsToSearches.set(e,s),s},a._disposeSearch=function(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)},a._renderManeuver=function(e){const{directionPoint:t,directionLine:s}=e,{distance:n,duration:i}=s,{messages:o,messagesUnits:r,unit:a}=this,l=y.formatDistance(r,n??0,a),c=y.formatDuration(i??0),u=l&&c?`${l}&nbsp;&middot;&nbsp;${c}`:`${l}${c}`,d=this._getFormattedManeuverText(t),{objectId:h,directionPointType:p}=t,S=C.getIconPath(p),v=`esri-directions__maneuver-${h}`,_=`esri-directions__intermediate-costs-${h}`,m={[C.CSS.maneuverActive]:this._activeManeuver===s};return D.tsx("li",{"aria-labelledby":`${v} ${_}`,bind:this,class:this.classes(C.CSS.maneuver,m),"data-maneuver":s,key:s,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},null!=S&&D.tsx("img",{alt:"",class:C.CSS.maneuverIcon,src:S}),D.tsx("div",{class:C.CSS.maneuverCostsContainer},D.tsx("span",{id:v,innerHTML:d??""}),D.tsx("div",{class:C.CSS.maneuverCosts},D.tsx("div",{class:C.CSS.horizontalSplitter}),D.tsx("div",{"aria-hidden":"true",id:_,class:C.CSS.intermediateCost,innerHTML:u,title:o.intermediateCosts}))))},a._handleManeuverClick=function(e){const t=W(e.currentTarget);if(!t)return;if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:s}=t;this.viewModel.centerAt(s),this.viewModel.highlight(t)},a._handleManeuverMouseOver=function(e){if(this._activeManeuver||this._focusedManeuver)return;const t=W(e.currentTarget);t&&this.viewModel.highlight(t)},a._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()},a._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())},a._handleManeuverFocus=function(e){if(this._activeManeuver)return;const t=W(e.currentTarget);t&&(this._focusedManeuver=t,this.viewModel.highlight(t))},a._getFormattedManeuverText=function(e){const{displayText:t,name:s,intersectingName:n}=e;if(null==t)return"";let i=t;return null!=s&&i.includes(s)&&(i=i.replace(s,`<strong>${s}</strong>`)),null!=n&&i.includes(n)&&(i=i.replace(n,`<strong>${n}</strong>`)),i},a._getCostSummary=function(){const{messagesUnits:e,unit:t,viewModel:s}=this,{routeInfo:n}=s.layer;if(null==n)return null;const i=n.totalDistance??0,o=n.totalDuration??0;return{distance:y.formatDistance(e,i,t),duration:y.formatDuration(o)}},a._getDirections=async function(){const e=this.viewModel.layer?.stops.filter((({geometry:e})=>null!=e));if(e&&!(e.length<2))try{await this.viewModel.getDirections()}catch{}},t._createClass(n,[{key:"apiKey",get:function(){return this.viewModel.apiKey},set:function(e){this.viewModel.apiKey=e}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(e){this.viewModel.goToOverride=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"lastRoute",get:function(){return this.viewModel.lastRoute}},{key:"layer",get:function(){return this.viewModel.layer},set:function(e){this.viewModel.layer=e}},{key:"maxStops",get:function(){return this.viewModel.maxStops},set:function(e){this.viewModel.maxStops=e}},{key:"unit",get:function(){return this.defaultUnit},set:function(e){this._overrideIfSome("unit",e)}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"test",get:function(){return{acquireSearch:e=>this._acquireSearch(e)}}}]),n}(_);s.__decorate([a.property()],$.prototype,"apiKey",null),s.__decorate([a.property(h.defaultUnitPropertyMetadata)],$.prototype,"defaultUnit",void 0),s.__decorate([a.property()],$.prototype,"goToOverride",null),s.__decorate([a.property()],$.prototype,"headingLevel",void 0),s.__decorate([a.property()],$.prototype,"iconClass",void 0),s.__decorate([a.property()],$.prototype,"icon",void 0),s.__decorate([a.property()],$.prototype,"label",null),s.__decorate([a.property({readOnly:!0})],$.prototype,"lastRoute",null),s.__decorate([a.property()],$.prototype,"layer",null),s.__decorate([a.property()],$.prototype,"maxStops",null),s.__decorate([a.property(),k.messageBundle("esri/widgets/Directions/t9n/Directions")],$.prototype,"messages",void 0),s.__decorate([a.property(),k.messageBundle("esri/t9n/common")],$.prototype,"messagesCommon",void 0),s.__decorate([a.property(),k.messageBundle("esri/core/t9n/Units")],$.prototype,"messagesUnits",void 0),s.__decorate([a.property()],$.prototype,"searchProperties",void 0),s.__decorate([a.property()],$.prototype,"unit",null),s.__decorate([a.property()],$.prototype,"view",null),s.__decorate([a.property({type:m})],$.prototype,"viewModel",void 0),s.__decorate([a.property()],$.prototype,"visibleElements",void 0),s.__decorate([l.cast("visibleElements")],$.prototype,"castVisibleElements",null),s.__decorate([x.accessibleHandler()],$.prototype,"_handleStopIconClick",null),s.__decorate([x.accessibleHandler()],$.prototype,"_handleClearRouteClick",null),s.__decorate([x.accessibleHandler()],$.prototype,"_handleReverseStops",null),s.__decorate([x.accessibleHandler()],$.prototype,"_handleRemoveStop",null),s.__decorate([x.accessibleHandler()],$.prototype,"_handleSectionToggle",null),s.__decorate([x.accessibleHandler()],$.prototype,"_handleSummaryInteraction",null),s.__decorate([x.accessibleHandler()],$.prototype,"_handleManeuverClick",null),$=s.__decorate([d.subclass("esri.widgets.Directions")],$);function N(e){return e?.["data-mode"]}function F(e){return e?.["data-stop-index"]}function q(e){return e?.["data-maneuver-section"]}function W(e){return e?.["data-maneuver"]}return $}));
