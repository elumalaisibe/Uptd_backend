/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/deprecate","../core/Logger","../core/reactiveUtils","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","../intl/number","../properties/defaultUnit","./Widget","./ScaleBar/css","./ScaleBar/ScaleBarViewModel","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,r,s,i,o,a,n,l,c,d,u,p,S,h,C,v,y,f){"use strict";function m(e,t){return u.formatNumber(e,{style:"unit",unit:t,unitDisplay:"short"})}const _="esri.widgets.ScaleBar",b=s.getLogger(_);let w=function(t){function s(e,r){var s;return(s=t.call(this,e,r)||this).messages=null,s.style="line",s.viewModel=new C,s}e._inherits(s,t);var a=s.prototype;return a.initialize=function(){this.addHandles(i.watch((()=>{const{view:e}=this;return[e?.stationary,e?.center,e?.scale,e?.zoom]}),(([e])=>{e&&this.scheduleRender()})))},a.render=function(){const e="disabled"===this.viewModel.state,t={[h.CSS.disabled]:e};let r,s;if(!e){const{unit:e,style:t}=this,i="metric"===e||"dual"===e,o=100,a="dual"===e?"line":t;if("imperial"===e||"non-metric"===e||"dual"===e){const e=this.viewModel.getScaleBarProperties(o,"imperial");e&&(s="ruler"===a?this._renderRuler(e):this._renderLine(e,"bottom"))}if(i){const e=this.viewModel.getScaleBarProperties(o,"metric");e&&(r="ruler"===a?this._renderRuler(e):this._renderLine(e,"top"))}}return f.tsx("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(h.CSS.base,t)},r,s)},a._renderRuler=function(e){const{length:t,unit:r,value:s}=e,i=Math.round(t),o=m(s,r);return f.tsx("div",{class:this.classes(h.CSS.barContainer,h.CSS.rulerBarContainer),key:h.CSS.rulerBarContainer},f.tsx("div",{class:h.CSS.ruler,styles:{width:`${i}px`}},f.tsx("div",{class:h.CSS.rulerBlock}),f.tsx("div",{class:h.CSS.rulerBlock}),f.tsx("div",{class:h.CSS.rulerBlock}),f.tsx("div",{class:h.CSS.rulerBlock})),f.tsx("div",{class:this.classes(h.CSS.labelContainer,h.CSS.rulerLabelContainer)},f.tsx("div",{class:h.CSS.label},"0"),f.tsx("div",{class:h.CSS.label},o)))},a._renderLine=function(e,t){const{length:r,unit:s,value:i}=e,o=Math.round(r),a=m(i,s),n={[h.CSS.topLabelContainer]:"top"===t,[h.CSS.bottomLabelContainer]:"bottom"===t},l=f.tsx("div",{class:this.classes(h.CSS.labelContainer,h.CSS.lineLabelContainer,n),key:h.CSS.labelContainer},f.tsx("div",{class:h.CSS.label},a)),c={[h.CSS.topLine]:"top"===t,[h.CSS.bottomLine]:"bottom"===t},d=f.tsx("div",{class:this.classes(h.CSS.line,c),key:h.CSS.line,styles:{width:`${o}px`}});return f.tsx("div",{class:this.classes(h.CSS.barContainer,h.CSS.lineBarContainer),key:h.CSS.lineBarContainer},[d,l])},a._handleRootCreateOrUpdate=function(e){if(!this.viewModel)return;const{scaleComputedFrom:t}=this.viewModel,r=e.getBoundingClientRect(),s=r.left+window.pageXOffset,i=r.top+window.pageYOffset,a=o.createScreenPoint(s,i);(a.x!==t.x||a.y!==t.y)&&(this.viewModel.scaleComputedFrom=a)},e._createClass(s,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"unit",get:function(){return this._defaultUnit},set:function(e){"non-metric"===e&&r.deprecatedProperty(b,"unit",{replacement:"Please use 'imperial' instead of 'non-metric'.",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-ScaleBar.html#unit",version:"4.27",warnOnce:!0}),this._overrideIfSome("unit",e)}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),s}(S);t.__decorate([a.property(p.defaultUnitPropertyMetadata)],w.prototype,"_defaultUnit",void 0),t.__decorate([a.property()],w.prototype,"label",null),t.__decorate([a.property(),y.messageBundle("esri/widgets/ScaleBar/t9n/ScaleBar")],w.prototype,"messages",void 0),t.__decorate([a.property({type:["ruler","line"]})],w.prototype,"style",void 0),t.__decorate([a.property({type:["metric","imperial","dual","non-metric"]})],w.prototype,"unit",null),t.__decorate([a.property()],w.prototype,"view",null),t.__decorate([a.property()],w.prototype,"viewModel",void 0),w=t.__decorate([d.subclass(_)],w);return w}));
