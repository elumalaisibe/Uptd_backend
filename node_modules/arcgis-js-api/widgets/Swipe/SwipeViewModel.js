/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Accessor","../../core/Collection","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../views/layers/support/ClipRect"],(function(e,i,t,r,n,o,s,l,a,p,c){"use strict";function y(e,i){const t=10**i;return Math.round(e*t)/t}const d={left:0,right:0,top:0,bottom:0};let _=function(i){function t(e){var t;return(t=i.call(this,e)||this)._leadingClips=new Map,t._trailingClips=new Map,t.direction="horizontal",t.leadingLayers=new r,t.max=100,t.min=0,t.precision=4,t.step=.5,t.stepMultiplier=10,t.trailingLayers=new r,t.view=null,t}e._inherits(t,i);var o=t.prototype;return o.initialize=function(){this.addHandles([n.watch((()=>[this.view,this.view?.ready,this.position,this.direction]),(()=>this._clipLayers()),n.initial),n.on((()=>this.leadingLayers),"change",(()=>this._clipLeadingLayers())),n.on((()=>this.trailingLayers),"change",(()=>this._clipTrailingLayers()))])},o.destroy=function(){this._removeExistingClips()},o._clipLayers=function(){this._clipLeadingLayers(),this._clipTrailingLayers()},o._clipLeadingLayers=function(){this._removeClips("leading");const{leadingLayers:e}=this;e.forEach((e=>this._clipLayer({layer:e,type:"leading"})))},o._clipTrailingLayers=function(){this._removeClips("trailing");const{trailingLayers:e}=this;e.forEach((e=>this._clipLayer({layer:e,type:"trailing"})))},o._getLayerView=async function(e){const{view:i}=this;if(!e||!i)return null;const t=await i.whenLayerView(e);return"clips"in t?t:null},o._getVerticalClipRect=function(e){const{position:i}=this;return"leading"===e?new c({...d,bottom:100-i+"%"}):"trailing"===e?new c({...d,top:`${i}%`}):null},o._getHorizontalClipRect=function(e){const{position:i}=this;return"leading"===e?new c({...d,right:100-i+"%"}):"trailing"===e?new c({...d,left:`${i}%`}):null},o._getClipRect=function(e){const{direction:i}=this;return"vertical"===i?this._getVerticalClipRect(e):"horizontal"===i?this._getHorizontalClipRect(e):null},o._clipLayer=async function(e){const{_leadingClips:i,_trailingClips:t}=this,{layer:r,type:n}=e,o="trailing"===n?t:"leading"===n?i:null,s=await this._getLayerView(r);if(!(s&&"clips"in s&&o&&s.hasOwnProperty("clips")))return;const l=o.get(s);l&&s.clips.remove(l);const a=this._getClipRect(n);a&&(o.set(s,a),s.clips.add(a))},o._removeClips=function(e){const{_leadingClips:i,_trailingClips:t}=this,r="trailing"===e?t:"leading"===e?i:null;r&&(r.forEach(((e,i)=>{i&&i.hasOwnProperty("clips")&&i.clips.remove(e)})),r.clear())},o._removeExistingClips=function(){this._removeClips("leading"),this._removeClips("trailing")},e._createClass(t,[{key:"position",get:function(){return 25},set:function(e){const{precision:i,min:t,max:r}=this;this._set("position",y(Math.max(Math.min(e,r),t),i))}},{key:"state",get:function(){const{view:e}=this;return e&&e.ready?"ready":"disabled"}}]),t}(t);i.__decorate([o.property()],_.prototype,"direction",void 0),i.__decorate([o.property({type:r,nonNullable:!0})],_.prototype,"leadingLayers",void 0),i.__decorate([o.property({readOnly:!0})],_.prototype,"max",void 0),i.__decorate([o.property({readOnly:!0})],_.prototype,"min",void 0),i.__decorate([o.property()],_.prototype,"position",null),i.__decorate([o.property()],_.prototype,"precision",void 0),i.__decorate([o.property({readOnly:!0})],_.prototype,"state",null),i.__decorate([o.property()],_.prototype,"step",void 0),i.__decorate([o.property()],_.prototype,"stepMultiplier",void 0),i.__decorate([o.property({type:r,nonNullable:!0})],_.prototype,"trailingLayers",void 0),i.__decorate([o.property()],_.prototype,"view",void 0),_=i.__decorate([p.subclass("esri.widgets.Swipe.SwipeViewModel")],_);return _}));
