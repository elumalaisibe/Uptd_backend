/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/arrayUtils","../core/HandleOwner","../core/Logger","../core/promiseUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Attachments","./FeatureForm","./FeatureTemplates","./Spinner","./Widget","./Editor/deprecationUtils","./Editor/EditorViewModel","./Editor/modelUploadUtils","./FeatureTemplates/ItemList","./support/componentsUtils","./support/Heading","./support/SnappingControls","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/widgetUtils","./support/SketchTooltipControls/SketchTooltipControls","../intl/substitute"],(function(e,t,n,a,o,s,r,i,l,c,d,p,u,m,h,_,g,f,w,v,y,k,b,C,F,M,A,T,x,E,W,I,L){"use strict";const P="esri-editor",S=`${P}__panel`,U=`${P}__prompt`,D={base:`${P} esri-widget esri-widget--panel`,actions:`${P}__actions`,helpMessage:`${P}__help-message`,panelToolbar:`${S}-toolbar`,panelContent:`${S}-content`,panelContentMessage:`${S}-content__message`,panelContentSection:`${S}-content__section`,panelContentSectionGroup:`${S}-content__section__group`,panelContentScrimContainer:`${S}-content__scrim-container`,settingsContainer:`${P}__settings`,featureTemplatesContainer:`${P}__feature-templates-container`,notice:`${P}__notice`,templateItemContentEnd:`${P}__template-item-content-end`,templateItemContentEndSuccess:`${P}__template-item-content-end--success`,templateItemContentEndError:`${P}__template-item-content-end--error`,templateItemLoader:`${P}__template-item-loader`,promptContainer:U,promptHeader:`${U}__header`,promptHeading:`${U}__header__heading`,promptMessage:`${U}__message`,promptDivider:`${U}__divider`,promptActions:`${U}__actions`,widgetIcon:"esri-icon-edit"},B={undoRedoButtons:!1,snappingControls:!0,snappingControlsElements:{header:!1,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0},sketchTooltipControls:!0};function H(e){requestAnimationFrame((()=>e.setFocus()))}const $="exclamation-mark-triangle",O="esri.widgets.Editor",N=r.getLogger(O);let z=function(n){function a(e,a){var o;return(o=n.call(this,e,a)||this)._featureForm=new _,o._attachments=new h({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),o._featureTemplates=new g({enableListScroll:!1,renderItemContentEnd:e=>o._renderTemplateContentEnd(e),renderItemDescription:e=>o._renderTemplateDescription(e),renderItemLabel:e=>o._renderTemplateLabel(e),renderCustomGroupContent:e=>o._renderCustomTemplateGroupContent(e)}),o._filterText="",o._prompt=null,o._spinner=new f,o.headingLevel=4,o.iconClass=D.widgetIcon,o.messages=null,o.messagesCommon=null,o.messagesTemplates=null,o.supportingWidgetDefaults=null,o.viewModel=new y,o.visibleElements={...B},o._renderSelectIcon=()=>E.tsx("calcite-icon",{icon:"cursor",slot:"content-start"}),o.EditorPanel=({handleBack:e,heading:n,headingLevel:a,key:s},...r)=>{const{messagesCommon:i,viewModel:l,visibleElements:c}=t._assertThisInitialized(o),d=l.sketchViewModel,p=l.syncing||o._attachments.submitting;return E.tsx("calcite-flow-item",{closable:!1,heading:n,headingLevel:a,key:s,loading:p,onCalciteFlowItemBack:e??void 0},E.tsx("div",{key:"panel-toolbar",class:D.panelToolbar},o._renderSettings(),c.undoRedoButtons&&[E.tsx("calcite-button",{key:"undo-button",label:i.undo,appearance:"transparent",kind:"neutral",alignment:"center",iconStart:"undo",scale:"l",disabled:!d.canUndo(),onclick:d.undo.bind(d)},i.undo),E.tsx("calcite-button",{key:"redo-button",label:i.redo,appearance:"transparent",kind:"neutral",alignment:"center",iconStart:"redo",scale:"l",disabled:!d.canRedo(),onclick:d.redo.bind(d)},i.redo)]),...r)},o._showDiscardEditsPrompt=()=>{const{messages:e,activeWorkflow:n}=t._assertThisInitialized(o);if("create-features"===n?.type&&k.isModelUpload(n.data.creationInfo))return o._showPrompt({title:e.cancelUploadTitle,message:e.cancelUploadWarningMessage,yesLabel:e.discardUpload,noLabel:e.continueUpload});const a="create"===n?.type;return o._showPrompt({title:e[a?"cancelAddTitle":"cancelEditTitle"],message:e[a?"cancelAddWarningMessage":"cancelEditWarningMessage"],yesLabel:e[a?"discardFeature":"discardEdits"],noLabel:e[a?"continueAdding":"continueEditing"]})},o._showGenericCancelPrompt=()=>{const{messages:e,messagesCommon:n}=t._assertThisInitialized(o);return o._showPrompt({title:e.cancelRequestTitle,message:e.cancelRequestWarningMessage,yesLabel:n.form.yes,noLabel:n.form.no})},o._onToggleUpdateWorkflow=()=>o.viewModel.toggleUpdateWorkflow(),o._onAttachmentDeleteConfirm=async()=>{const e=o._attachments,{activeWorkflow:t}=o.viewModel;t&&("create-features"===t.type?e.deleteFile():(await e.deleteAttachment(e.viewModel.activeAttachmentInfo),o._clearPrompt()),await t.back(),o._clearPrompt())},o._onAttachmentsError=e=>{o._prompt={title:o.messages.errorWarningTitle,message:e.message,context:"warning",actions:{primary:{label:o.messagesCommon.form.ok,action:o._clearPrompt}}}},o._clearPrompt=()=>{o._prompt=null},o._onBack=o._onBack.bind(t._assertThisInitialized(o)),o._onSave=o._onSave.bind(t._assertThisInitialized(o)),o._onDelete=o._onDelete.bind(t._assertThisInitialized(o)),o._onToggleUpdateWorkflow=o._onToggleUpdateWorkflow.bind(t._assertThisInitialized(o)),o._onAttachmentAdd=o._onAttachmentAdd.bind(t._assertThisInitialized(o)),o._onAttachmentUpdate=o._onAttachmentUpdate.bind(t._assertThisInitialized(o)),o._onAttachmentDelete=o._onAttachmentDelete.bind(t._assertThisInitialized(o)),o}t._inherits(a,n);var s=a.prototype;return s.initialize=function(){this.addHandles([l.watch((()=>F.incrementHeadingLevel(this.headingLevel)),(e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e}),l.initial),l.watch((()=>this.viewModel.selectedTemplateItem),(e=>this._featureTemplates.select(e,{emit:!1}))),l.on((()=>this.viewModel.activeWorkflow),"cancel-request",(({controller:e})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then((t=>t?e.allow():e.deny()))})),l.watch((()=>this.viewModel),(e=>{this._featureForm.viewModel=e?.featureFormViewModel??null,this._attachments.viewModel=e?.attachmentsViewModel??null,this._featureTemplates.viewModel=e?.featureTemplatesViewModel??null,this._spinner.viewModel=e?.spinnerViewModel??null,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt}),l.initial),l.watch((()=>this.view),((e,t)=>{const n=`editor-${this.id}-spinner`;t?.ui.remove(this._spinner,n),e?.ui.add(this._spinner,{key:n,position:"manual"})}),l.initial),l.when((()=>this.supportingWidgetDefaults),(e=>{this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),this.viewModel.sketchViewModel.set(e.sketch)}),l.initial),l.when((()=>this._attachments?.error),(e=>this._onAttachmentsError(e))),l.when((()=>this.viewModel?.failures),(e=>{const{messages:t}=this,[{error:n,retry:a,cancel:o}]=e;this._prompt={title:t.errorWarningTitle,message:L.substitute(t.errorWarningMessageTemplate,{errorMessage:n.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{a(),this._clearPrompt()}},secondary:{label:t.ignore,action:()=>{o(),this._clearPrompt()}}}}})),l.watch((()=>this.viewModel?.state),(e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}})),l.watch((()=>this.viewModel.featureFormDisabled),(e=>this._featureForm.disabled=e))])},s.destroy=function(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()},s.loadDependencies=function(){return C.loadCalciteComponents({accordion:()=>new Promise(((t,n)=>e(["../chunks/calcite-accordion"],t,n))),"accordion-item":()=>new Promise(((t,n)=>e(["../chunks/calcite-accordion-item"],t,n))),button:()=>new Promise(((t,n)=>e(["../chunks/calcite-button"],t,n))),"flow-item":()=>new Promise(((t,n)=>e(["../chunks/calcite-flow-item"],t,n))),flow:()=>new Promise(((t,n)=>e(["../chunks/calcite-flow"],t,n))),icon:()=>new Promise(((t,n)=>e(["../chunks/calcite-icon"],t,n))),list:()=>new Promise(((t,n)=>e(["../chunks/calcite-list"],t,n))),loader:()=>new Promise(((t,n)=>e(["../chunks/calcite-loader"],t,n))),notice:()=>new Promise(((t,n)=>e(["../chunks/calcite-notice"],t,n))),scrim:()=>new Promise(((t,n)=>e(["../chunks/calcite-scrim"],t,n)))})},s.castVisibleElements=function(e){return{...B,...e,snappingControlsElements:{...B.snappingControlsElements,...e?.snappingControlsElements}}},s.startCreateWorkflowAtFeatureTypeSelection=function(){return v.workflowDeprecation(N,"startCreateWorkflowAtFeatureTypeSelection","startCreateFeaturesWorkflowAtFeatureTypeSelection"),this.viewModel.startCreateWorkflowAtFeatureTypeSelection()},s.startCreateFeaturesWorkflowAtFeatureTypeSelection=function(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()},s.startCreateWorkflowAtFeatureCreation=function(e){return v.workflowDeprecation(N,"startCreateWorkflowAtFeatureCreation","startCreateFeaturesWorkflowAtFeatureCreation"),this.viewModel.startCreateWorkflowAtFeatureCreation(e)},s.startCreateFeaturesWorkflowAtFeatureCreation=function(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)},s.startCreateWorkflowAtFeatureEdit=function(e){return v.workflowDeprecation(N,"startCreateWorkflowAtFeatureEdit"),this.viewModel.startCreateWorkflowAtFeatureEdit(e)},s.startUpdateWorkflowAtFeatureSelection=function(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()},s.startUpdateWorkflowAtMultipleFeatureSelection=function(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)},s.startUpdateWorkflowAtFeatureEdit=function(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)},s.deleteFeatureFromWorkflow=function(){return this.viewModel.deleteFeatureFromWorkflow()},s.cancelWorkflow=function(e){return this.viewModel.cancelWorkflow(e)},s.render=function(){const{viewModel:e}=this;if(!e)return E.tsx("div",{key:"empty",class:D.base});const{state:t}=e;return E.tsx("div",{key:"base",class:D.base},E.tsx("calcite-flow",{key:"flow"},e.pageStack.map((e=>this._renderPage(e,t))),this._renderPage(e.page,t)),this._renderPrompt())},s._renderPage=function(e,t){switch(e){case"disabled":break;case"ready":return this._renderLanding(t);case"awaiting-feature-creation-info":return this._renderTemplates(t);case"creating-features":case"editing-new-feature":case"editing-existing-feature":return this._renderAttributeEditing(t);case"awaiting-update-feature-candidate":return this._renderFeatureList(t);case"adding-attachment":return this._renderAttachmentAdding(t);case"editing-attachment":return this._renderAttachmentEditing(t)}return E.tsx("div",null)},s._renderTemplates=function(e){const{EditorPanel:t,headingLevel:n,messages:a,_onBack:o}=this;return E.tsx(t,{active:this._isPanelActive(e),key:"templates-panel",handleBack:o,heading:a.selectTemplate,headingLevel:n},E.tsx("div",{key:"feature-templates",class:D.panelContent},this._featureTemplates.render()))},s._renderAttributeEditing=function(e){const{activeWorkflow:t,EditorPanel:n,messages:a,messagesCommon:o,headingLevel:s,_onBack:r,viewModel:i}=this;if(!t)return null;const l=t.type,c="activeWorkflow"in t&&t.activeWorkflow,d=c?c.type:null,p=i.featureFormViewModel,u=c&&!c.hasPendingEdits||"update"===l&&!t.hasPendingEdits||i.syncing||p.updating,m="update"===l?a.editFeature:a.createFeatures,h="update"===l&&"create-features"!==d?o.update:o.create,_="create-features"===l&&"create-new"===t.createFeatureState,g="create-features"===l?t.numPendingFeatures:0,f=g>1?L.substitute(a.createFeaturesTemplate,{numFeatures:g}):h,w=t.shouldShowAttachments&&!i.featureFormViewModel.activeRelationshipInput,v=p.inputs.every((e=>!e.visible))&&!w?this._renderMessage(L.substitute(a.clickToFinishTemplate,{button:h})):E.tsx("div",{key:"panel-content-section",class:D.panelContentSection},this._renderNotices(t),E.tsx("div",{class:D.panelContentSectionGroup},this._featureForm.render(),w&&E.tsx("div",{key:"attachments"},E.tsx(F.Heading,{level:F.incrementHeadingLevel(s)},a.attachments),this._attachments.render())));return E.tsx(n,{active:this._isPanelActive(e),key:"attribute-editing-panel",heading:m,headingLevel:s,handleBack:r},E.tsx("div",{key:"panel-content",class:this.classes(D.panelContent,{[D.panelContentScrimContainer]:_})},v,_&&E.tsx("calcite-scrim",null)),this._renderFooterActions([{clickHandler:this._onSave,disabled:u,label:f,type:"primary"},i.shouldShowDeleteButton?{...this._deleteButtonCommonInfo,clickHandler:this._onDelete,disabled:i.syncing,label:o.delete}:null]))},s._renderNotices=function(e){return[this._renderOwnerAdminNotice(e),this._renderInvalidFormTemplateNotice(e),this._renderInvalidDateFieldNotice(e)]},s._renderOwnerAdminNotice=function(e){return e?.reliesOnOwnerAdminPrivileges&&this._renderNotice(this.messages.ownerAdminNotice)},s._renderInvalidFormTemplateNotice=function(e){return e?.hasInvalidFormTemplate&&this._renderNotice(this.messages.formFieldUpdateError,{icon:$})},s._renderInvalidDateFieldNotice=function(e){return e?.hasUnsupportedFields&&this._renderNotice(this.messages.formFieldUnsupportedUpdateError,{icon:$})},s._renderNotice=function(e,t){return E.tsx("calcite-notice",{open:!0,scale:"s",class:D.notice,...t},E.tsx("div",{slot:"message"},e))},s._renderCustomTemplateGroupContent=function(e){const{messages:t,viewModel:n}=this;let a=null;return e.group.items.some((e=>(n.itemHasUnsupportedFields(e)?a=t.formFieldUnsupportedCreateError:n.itemHasInvalidFormTemplate(e)&&(a=t.formFieldCreateError),a))),a?this._renderNotice(a,{icon:$}):null},s._renderAttachmentAdding=function(e){const{_attachments:t,EditorPanel:n,_onBack:a,headingLevel:o,messages:s,messagesCommon:r}=this;return E.tsx(n,{active:this._isPanelActive(e),key:"attachment-adding-panel",heading:s.addAttachment,headingLevel:o,handleBack:a},E.tsx("div",{key:"attachments",class:D.panelContent},t.render()),this._renderFooterActions([{label:t.submitting?r.cancel:r.add,disabled:t.submitting||!t.selectedFile,type:"primary",clickHandler:this._onAttachmentAdd}]))},s._renderAttachmentEditing=function(e){const{_attachments:t,EditorPanel:n,_onBack:a,activeWorkflow:o,headingLevel:s,messages:r,messagesCommon:i}=this;return o?E.tsx(n,{active:this._isPanelActive(e),key:"attachment-editing-panel",heading:r.editAttachment,headingLevel:s,handleBack:a},E.tsx("div",{key:"attachments",class:D.panelContent},t.render()),o.shouldAllowAttachmentEditing?this._renderFooterActions([{label:i.update,disabled:t.submitting||!t.selectedFile,type:"primary",clickHandler:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,clickHandler:this._onAttachmentDelete,disabled:t.submitting,label:i.delete}]):void 0):null},s._renderMessage=function(e){return E.tsx("div",{key:"panel-content-message",class:D.panelContentMessage},e)},s._renderFooterActions=function(e){return E.tsx("div",{key:"footer-actions",slot:"footer",class:D.actions},e.filter(o.isSome).map((({type:e,disabled:t,class:n,clickHandler:a,label:o,...s},r)=>E.tsx("calcite-button",{key:`action-${r}`,slot:"footer-actions",class:n,disabled:t??!1,onclick:a,width:"full",...s},o))))},s._renderPrompt=function(){const e=this._prompt;if(!e)return null;const{title:t,message:n,context:a,actions:o}=e,s=o.secondary;let r;switch(a){case"danger":r="danger";break;case"info":r="brand";break;default:r="neutral"}const i=E.tsx("calcite-button",{afterCreate:H,appearance:"solid",key:"prompt-primary-button",kind:r,onclick:o.primary.action,scale:"m",width:s?"half":"full"},o.primary.label),l=s&&E.tsx("calcite-button",{appearance:"outline",key:"prompt-secondary-button",kind:r,onclick:s.action,scale:"m",width:"half"},s.label);return E.tsx("calcite-scrim",{key:"prompt"},E.tsx("div",{class:`${D.promptContainer}--${a}`},E.tsx("div",{class:D.promptHeader},E.tsx("calcite-icon",{icon:$}),E.tsx(F.Heading,{class:D.promptHeading,level:this.headingLevel},t)),E.tsx("div",{class:D.promptMessage},n),E.tsx("div",{class:D.promptDivider}),E.tsx("div",{class:D.promptActions},l,i)))},s._renderLanding=function(e){const{EditorPanel:t,headingLevel:n,messages:a,viewModel:o}=this,{canUpdate:s}=o,r=this._featureTemplates.viewModel.numberOfFeatureTemplates,i=!s&&0===r;return E.tsx(t,{active:this._isPanelActive(e),key:"landing-panel",heading:a.widgetLabel,headingLevel:n},E.tsx("div",{key:"landing-content",class:D.panelContent},s&&E.tsx("div",{key:"edit-actions",class:D.panelContentSection},this._renderUpdateActions(e)),r>0&&E.tsx("div",{key:"create-actions",class:D.panelContentSection},this._renderCreateActions()),i&&E.tsx("div",{key:"no-content",class:D.panelContentMessage},a.noEditableLayers)),this._renderFooterHelpMessages())},s._renderFooterHelpMessages=function(){const{activeWorkflow:e,messages:t,view:n}=this,a=e?.helpMessage,o=a?t["3d"===n?.type?"helpMessages3d":"helpMessages2d"]?.[a]:null;return o?E.tsx("div",{key:"footer-actions",slot:"footer",class:D.helpMessage},o):null},s._renderUpdateActions=function(e){const{messages:t,messagesCommon:n}=this,a={id:"select",label:n.select};return E.tsx("div",{key:"update-actions"},E.tsx(F.Heading,{level:F.incrementHeadingLevel(this.headingLevel)},t.editFeatures),E.tsx("calcite-list",{selectionMode:"single",selectionAppearance:"border"},b.renderItem({grouped:!1,item:a,selectedItem:"awaiting-feature-to-update"===e?a:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))},s._renderCreateActions=function(){const{_featureTemplates:e,headingLevel:t,messages:n}=this;return E.tsx("div",{key:"create-actions"},E.tsx(F.Heading,{level:F.incrementHeadingLevel(t)},n.createFeatures),E.tsx("div",{key:"templates",class:D.featureTemplatesContainer},e.render()))},s._renderTemplateLabel=function(e){return e.label},s._renderTemplateDescription=function(e){const t=this._getUploadForTemplateItem(e);if(!t)return null;const{messages:n}=this;switch(t.state){case"pending":return n?.uploadPending;case"error":return n?.uploadError;default:return null}},s._renderTemplateContentEnd=function(e){const t=this._getUploadForTemplateItem(e),n=E.tsx("calcite-icon",{key:"upload-icon",class:D.templateItemContentEnd,icon:"upload-to"});if(!t)return e.supportsUpload?n:null;switch(t.state){case"success":return E.tsx("calcite-icon",{key:"success-icon",class:this.classes(D.templateItemContentEnd,D.templateItemContentEndSuccess),icon:"check"});case"error":return E.tsx("calcite-icon",{key:"error-icon",class:this.classes(D.templateItemContentEnd,D.templateItemContentEndError),icon:"exclamation-mark-circle-f"});case"pending":return E.tsx("calcite-loader",{class:D.templateItemLoader,inline:!0,key:"loader",label:"",scale:"s",type:"indeterminate"});case"canceled":case"default":return n}},s._getUploadForTemplateItem=function(e){const t=this.activeWorkflow;if("create-features"!==t?.type)return null;const{data:n}=t,{creationInfo:a,upload:o}=n;return a?.template===e.template&&a?.layer===e.layer?o:null},s._renderFeatureList=function(e){const{EditorPanel:t,_onBack:n,headingLevel:a,messages:s,messagesTemplates:r,viewModel:{activeWorkflow:i,editableItems:l}}=this;if("update"!==i?.type)return null;const c=i.data.candidates,d=L.substitute(s.multipleFeaturesTemplate,{total:c.length}),p=new Map;let u=0;c.map((e=>({label:this._getLabel(e),id:e.attributes[e.layer.objectIdField],data:e}))).filter((e=>{const{label:t,data:n}=e,a=this._filterText.toLowerCase(),{title:o}=n.layer,s=l.find((e=>e.layer===n.layer));if(!s)return null;const{attachmentsOnUpdateEnabled:r,supports:i}=s;return(i.includes("update")||i.includes("delete")||r)&&(!a||t?.toLowerCase().includes(a)||o?.toLowerCase().includes(a))})).filter(o.isSome).forEach((e=>{u++;const t=e.data.layer;p.has(t)?p.get(t)?.items.push(e):p.set(t,{id:`${t.id}`,label:t.title??"",items:[e]})}));const m=l.toArray().map((({layer:e})=>p.get(e))).filter(o.isSome),h=u>10||this._filterText.length>0;return E.tsx(t,{active:this._isPanelActive(e),key:"feature-list",heading:d,headingLevel:a,handleBack:n},E.tsx("div",{key:"feature-list",class:D.panelContent},E.tsx("div",{class:D.panelContentSection},b.ItemList({enableListScroll:!1,filterEnabled:h,filterText:this._filterText,id:this.id,items:m,messages:{filterPlaceholder:r.filterPlaceholder,noItems:r.noItems,noMatches:r.noMatches},onFilterChange:e=>this._filterText=e,onItemMouseEnter:e=>this.viewModel.selectFeature(e.data),onItemMouseLeave:()=>this.viewModel.selectFeature(null),onItemSelect:e=>this.viewModel.selectFeature(e.data,!0)}))))},s._isPanelActive=function(e){return this.viewModel.state===e},s._renderSettings=function(){const e=this.visibleElements,t=e.snappingControls,n=e.sketchTooltipControls;return t||n?E.tsx("calcite-accordion",{key:"settings",class:D.settingsContainer,appearance:"transparent"},E.tsx("calcite-accordion-item",{heading:this.messagesCommon?.settings,iconStart:"gear"},n&&E.tsx(I.SketchTooltipControls,{tooltipOptions:this.tooltipOptions}),t&&E.tsx(M,{snappingOptions:this.snappingOptions,view:this.view,visibleElements:e.snappingControlsElements,afterCreate:e=>e.layerListOpen=!1}))):null},s._getLabel=function(e){const t=e.layer;if(!t)return null;const n=t.fieldsIndex.get(t.objectIdField),a=n.alias||n.name,{attributes:o}=e,s=m.getDisplayFieldName(t);return s&&o[s]&&`${o[s]}`||`${a}: ${o[n.name]}`},s._showPrompt=function({title:e,message:t,yesLabel:n,noLabel:a}){const o=i.createResolver(),{view:s}=this,r=s?.focused;return this._prompt={title:e,message:t,context:"danger",actions:{primary:{label:n,action:()=>o.resolve(!0)},secondary:{label:a,action:()=>o.resolve(!1)}}},o.promise.finally((()=>{this._clearPrompt(),r&&s?.focus()}))},s._onSave=function(){this.viewModel.saveWorkflow()},s._onDelete=function(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteWarningTitle,message:e.deleteWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:e.keepFeature,action:this._clearPrompt}}}},s._onBack=async function(e){return e?.stopPropagation(),this.viewModel.back()},s._onAttachmentAdd=function(){const{activeWorkflow:e}=this.viewModel;e&&("create-features"===e.type?(this._attachments.addFile(),e.back()):this._attachments.addAttachment().then((()=>e.back())))},s._onAttachmentUpdate=function(){const{activeWorkflow:e}=this.viewModel;e&&("create-features"===e.type?(this._attachments.updateFile(),e.back()):this._attachments.updateAttachment().then((()=>e.back())))},s._onAttachmentDelete=function(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteAttachmentWarningTitle,message:e.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:e.keepAttachment,action:this._clearPrompt}}}},t._createClass(a,[{key:"_deleteButtonCommonInfo",get:function(){return{appearance:"outline",kind:"danger",type:"primary"}}},{key:"activeWorkflow",get:function(){return this.viewModel.activeWorkflow}},{key:"allowedWorkflows",get:function(){return this.viewModel.allowedWorkflows},set:function(e){this.viewModel.allowedWorkflows=e}},{key:"useDeprecatedCreateWorkflow",get:function(){return this.viewModel.useDeprecatedCreateWorkflow},set:function(e){this.viewModel.useDeprecatedCreateWorkflow=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"labelOptions",get:function(){return this.viewModel.labelOptions},set:function(e){this.viewModel.labelOptions=e}},{key:"layerInfos",get:function(){return this.viewModel.layerInfos},set:function(e){this.viewModel.layerInfos=e}},{key:"snappingOptions",get:function(){return this.viewModel.snappingOptions},set:function(e){this.viewModel.snappingOptions=e}},{key:"tooltipOptions",get:function(){return this.viewModel.tooltipOptions},set:function(e){this.viewModel.tooltipOptions=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),a}(s.HandleOwnerMixin(w));n.__decorate([c.property()],z.prototype,"_featureForm",void 0),n.__decorate([c.property()],z.prototype,"_attachments",void 0),n.__decorate([c.property()],z.prototype,"_featureTemplates",void 0),n.__decorate([c.property()],z.prototype,"_filterText",void 0),n.__decorate([c.property()],z.prototype,"_prompt",void 0),n.__decorate([c.property()],z.prototype,"_spinner",void 0),n.__decorate([c.property()],z.prototype,"_deleteButtonCommonInfo",null),n.__decorate([c.property({readOnly:!0})],z.prototype,"activeWorkflow",null),n.__decorate([c.property()],z.prototype,"allowedWorkflows",null),n.__decorate([c.property()],z.prototype,"useDeprecatedCreateWorkflow",null),n.__decorate([c.property()],z.prototype,"headingLevel",void 0),n.__decorate([c.property()],z.prototype,"iconClass",void 0),n.__decorate([c.property()],z.prototype,"label",null),n.__decorate([c.property()],z.prototype,"labelOptions",null),n.__decorate([c.property()],z.prototype,"layerInfos",null),n.__decorate([c.property(),T.messageBundle("esri/widgets/Editor/t9n/Editor")],z.prototype,"messages",void 0),n.__decorate([c.property(),T.messageBundle("esri/t9n/common")],z.prototype,"messagesCommon",void 0),n.__decorate([c.property(),T.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],z.prototype,"messagesTemplates",void 0),n.__decorate([c.property()],z.prototype,"snappingOptions",null),n.__decorate([c.property()],z.prototype,"tooltipOptions",null),n.__decorate([c.property()],z.prototype,"supportingWidgetDefaults",void 0),n.__decorate([c.property()],z.prototype,"view",null),n.__decorate([c.property(),x.vmEvent(["workflow-cancel","workflow-commit"])],z.prototype,"viewModel",void 0),n.__decorate([c.property()],z.prototype,"visibleElements",void 0),n.__decorate([d.cast("visibleElements")],z.prototype,"castVisibleElements",null),n.__decorate([A.accessibleHandler()],z.prototype,"_onSave",null),n.__decorate([A.accessibleHandler()],z.prototype,"_onDelete",null),n.__decorate([A.accessibleHandler()],z.prototype,"_onBack",null),n.__decorate([A.accessibleHandler()],z.prototype,"_onAttachmentAdd",null),n.__decorate([A.accessibleHandler()],z.prototype,"_onAttachmentUpdate",null),n.__decorate([A.accessibleHandler()],z.prototype,"_onAttachmentDelete",null),z=n.__decorate([u.subclass(O)],z);return z}));
