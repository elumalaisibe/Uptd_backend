/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../intl","../../core/arrayUtils","../../core/string","../../intl/date","../../layers/support/domainUtils","../../layers/support/fieldUtils","../../intl/substitute"],(function(e,t,n,i,r,a,o,l){"use strict";const s=e=>"field"===e?.type,p=e=>"group"===e?.type,u=e=>"relationship"===e?.type,d=e=>!p(e)&&null!=e.group,m=e=>"field"===e.type,y=e=>"group"===e.type,c=e=>"relationship"===e.type,f=e=>e.reduce(((e,t)=>p(t)?[...e,...t.inputs]:[...e,t]),[]),T=e=>f(e).filter(s),E=e=>f(e).filter(u),g=(e,t)=>null!=e&&e.input?.type===t,F=e=>null!=e&&(g(e,"text-box")||g(e,"text-area")),I=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type),b=e=>"items"in e,h={typeFieldName:null,types:[]};function O(e,t,r){const a=Object.keys(t).filter((t=>i.templateHasKey(e,t))),o=a.map((e=>t[e])),l=a.map((e=>r.get(e))).filter(n.isSome);return N(e,v(o,l))}function v(e,t){const n=t.map(((t,n)=>{let i=e[n];if(t.domain&&"coded-value"===t.domain.type){const e=t.domain.codedValues.find((e=>e.code===i));e?.name&&(i=e.name)}return o.isDateField(t)&&(i=D(t,i)),[t.name,i]}));return Object.fromEntries(n)}function D(e,t){if(!e||null==t)return null;switch(e.type){case"date":return r.formatDate(t);case"date-only":return r.formatDateOnly(t);case"time-only":return r.formatTimeOnly(t);case"timestamp-offset":return r.formatTimestamp(t);default:return null}}const V=new Set(["date-only","time-only","timestamp-offset"]);function N(e,t){return i.replace(i.replace(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t]))))}const x=e=>e?"subtype-sublayer"===e.type?{typeFieldName:e.parent?.subtypeField,types:e.parent?.subtypes??[]}:"types"in e&&e.types?{typeFieldName:e.typeIdField,types:e.types.map((({id:e,name:t,domains:n})=>({code:e,name:t,domains:n})))}:h:h,L=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};e.LengthValidationError=void 0,(e.LengthValidationError||(e.LengthValidationError={})).TOO_SHORT="length-validation-error::too-short";const R={type:"number"},A={type:"number",intlOptions:{notation:"scientific"}},S={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};function _(e){return e>=1e7||e<=-1e7}const U=(t,n)=>{const{dataType:i,domain:r,error:s,field:p,minLength:u,value:d,required:m}=t;if(!n||!s)return null;if(m&&null===d)return n.validationErrors.cannotBeNull;if(s===a.DomainValidationError.VALUE_OUT_OF_RANGE||s===o.NumericRangeValidationError.OUT_OF_RANGE){const e=a.getDomainRange(r)||o.getFieldRange(p);return l.substitute(n.validationErrors.outsideRange,e,{format:{max:"date"===i?S:_(e.max)?A:R,min:"date"===i?S:_(e.min)?A:R}})}return s===a.DomainValidationError.INVALID_CODED_VALUE?n.validationErrors.invalidCodedValue:s===o.TypeValidationError.INVALID_TYPE?n.validationErrors.invalidType:s===e.LengthValidationError.TOO_SHORT?l.substitute(n.validationErrors.tooShort,{min:u}):null},w=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,i=e.geometry?.type;return"polyline"===i||"polyline"===n?"line":i||n||"table"},G=e=>{const t=[];if(e.formTemplate){const{description:n,title:r}=e.formTemplate;e.fields?.forEach((e=>{const a=r&&i.templateHasKey(r,e.name),o=n&&i.templateHasKey(n,e.name);(a||o)&&t.push(e.name)}))}return t};function H(e){if("formTemplate"in e&&e.formTemplate){return(e.formTemplate.elements?.filter(m)??[]).some((({fieldName:t})=>!e.fieldsIndex.get(t)))}return!1}e.capabilitiesAllowEditType=L,e.flattenFieldInputs=T,e.flattenInputs=f,e.flattenRelationshipInputs=E,e.formTemplateHasInvalidFields=H,e.formatDateFieldValue=D,e.getComputedAttributes=v,e.getErrorMessageForFieldInput=U,e.getFieldsInTitleAndDesc=G,e.getIconForFeature=w,e.getNormalizedFeatureTypeInfo=x,e.isFieldElement=m,e.isFieldElementWithInputType=g,e.isFieldElementWithTextInput=F,e.isFieldInput=s,e.isGroupElement=y,e.isGroupInput=p,e.isInputInGroupInput=d,e.isNumberFieldInput=I,e.isRelationshipElement=c,e.isRelationshipInput=u,e.isTemplateItemGroup=b,e.parseFormTemplateString=O,e.substituteFieldTemplatesInString=N,e.unsupportedDateFieldTypes=V,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
