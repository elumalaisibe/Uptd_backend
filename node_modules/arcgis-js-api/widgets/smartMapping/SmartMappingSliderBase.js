/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Color","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../Histogram","../Slider","../Widget","./support/utils","../support/widgetUtils","../support/jsxFactory"],(function(e,t,i,n,o,a,s,r,l,p,m,c,d,u,g,h){"use strict";const M="zoom-cap",y={zoomCap:M,maxZoomCap:`${M}--max`,minZoomCap:`${M}--min`,zoomCapLine:`${M}--line`,zoomCapMask:`${M}--mask`,zoomCapUnderline:`${M}--underline`},v={interactiveTrack:!1};e.SmartMappingSliderBase=function(e){function i(i,n){var a;(a=e.call(this,i,n)||this).histogram=new m({layout:"vertical"}),a.histogramConfig=null,a.slider=new c({syncedSegmentsEnabled:!0,thumbsConstrained:!1,layout:"vertical",visibleElements:{labels:!0,rangeLabels:!0},labelInputsEnabled:!0,rangeLabelInputsEnabled:!0}),a.viewModel=null,a.visibleElements={...v};const s=a.slider;return!i?.hasTimeData||i?.inputParseFunction||i?.inputFormatFunction||s.set({labelInputsEnabled:!1,rangeLabelInputsEnabled:!1}),s.draggableSegmentsEnabled=!!i?.visibleElements?.interactiveTrack,a.addHandles([s.on("max-change",(e=>a.emit("max-change",e))),s.on("max-click",(e=>a.emit("max-click",e))),s.on("min-change",(e=>a.emit("min-change",e))),s.on("min-click",(e=>a.emit("min-click",e))),s.on("segment-click",(e=>a.emit("segment-click",e))),s.on("segment-drag",(e=>a.emit("segment-drag",e))),s.on("thumb-change",(e=>a.emit("thumb-change",e))),s.on("thumb-click",(e=>a.emit("thumb-click",e))),s.on("thumb-drag",(e=>a.emit("thumb-drag",e))),s.on("track-click",(e=>a.emit("track-click",e))),o.watch((()=>[a.histogramConfig,a.max,a.min,a.zoomOptions]),(()=>{const{histogram:e,histogramConfig:i,viewModel:{max:n,min:o}}=t._assertThisInitialized(a),s=a.getParamsFromHistogramConfig(i);e.set({...s,max:n,min:o})})),o.watch((()=>a.labelFormatFunction),(()=>{const{histogram:e,labelFormatFunction:i}=t._assertThisInitialized(a);e.set({labelFormatFunction:i})})),o.watch((()=>a.hasTimeData),(e=>{const{labelInputsEnabled:t,rangeLabelInputsEnabled:i}=a.slider,n=!e||a.inputFormatFunction&&a.inputParseFunction;s.set({labelInputsEnabled:t&&n,rangeLabelInputsEnabled:i&&n})})),o.watch((()=>a.visibleElements?.interactiveTrack),(e=>{s.draggableSegmentsEnabled=!!e}))]),a._onMaxZoomCapPointerDown=a._onMaxZoomCapPointerDown.bind(t._assertThisInitialized(a)),a._onMinZoomCapPointerDown=a._onMinZoomCapPointerDown.bind(t._assertThisInitialized(a)),a}t._inherits(i,e);var a=i.prototype;return a.initialize=function(){const{histogramConfig:e={},viewModel:t}=this,{labelFormatFunction:i,max:n,min:o}=t,a=this.getParamsFromHistogramConfig(e);this.histogram.set({labelFormatFunction:i,...a,max:n,min:o}),this.slider.set({viewModel:t})},a.castVisibleElements=function(e){return{...v,...e}},a.renderContent=function(e,t,i){return this.slider.extraNodes=[e,this.renderHistogram(i)],h.tsx("div",{class:t},this.slider.render())},a.renderHistogram=function(e){return this.histogramConfig?h.tsx("div",{key:"histogram",class:e??void 0},this.histogram.render()):null},a.renderBackgroundFillDefinition=function(e){return h.tsx("pattern",{id:e,patternUnits:"userSpaceOnUse",x:"0",y:"0",width:"15",height:"15"},h.tsx("image",{x:"0",y:"0",width:"15",height:"15",href:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNjY2MiIC8+PHBhdGggZD0iTTAgMCBMOCAwIEw4IDggTDAgOCBaIiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDgpIiAvPjxwYXRoIGQ9Ik0wIDAgTDggMCBMOCA4IEwwIDggWiIgZmlsbD0iI2NjYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCw4KSIgLz48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgsMCkiIC8+PC9zdmc+"}))},a.renderRampFillDefinition=function(e,t){return h.tsx("linearGradient",{id:e,x1:"0",x2:"0",y1:"0",y2:"1"},this.renderRampFillStops(t))},a.renderRampFillStops=function(e){return e.reverse().map(((e,t)=>this.renderStop(e,t)))},a.renderStop=function(e,t){const{color:i,offset:n,opacity:o}=this.getPropsForStop(e);return h.tsx("stop",{key:`${t}-stop`,offset:n,"stop-color":i,"stop-opacity":o})},a.renderZoomCaps=function(){return[this.renderMaxZoomCap(),this.renderMinZoomCap()]},a.renderMinZoomCap=function(){if(this.zoomOptions&&null!=this.zoomOptions.min)return h.tsx("svg",{key:"bottom",class:this.classes(y.zoomCap,y.minZoomCap),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMinZoomCapPointerDown},h.tsx("polygon",{class:y.zoomCapMask,key:"mask",fill:"#1B8617",points:"0 11.3846154 30 11.3846154 30 1 25 5.38461538 20 1 15 5.38461538 10 1 5 5.38461538 0 1"}),h.tsx("polygon",{class:y.zoomCapUnderline,key:"underline",fill:"#69DCFF",points:"0 0 5 4.38461538 10 0 15 4.38461538 20 0 25 4.38461538 30 0 30 4.61538462 25 9 20 4.61538462 15 9 10 4.61538462 5 9 0 4.61538462"}),h.tsx("polygon",{class:y.zoomCapLine,key:"line",fill:"#DA5656",points:"0 1 5 5.38461538 10 1 15 5.38461538 20 1 25 5.38461538 30 1 30 5.61538462 25 10 20 5.61538462 15 10 10 5.61538462 5 10 0 5.61538462"}))},a.renderMaxZoomCap=function(){if(this.zoomOptions&&null!=this.zoomOptions.max)return h.tsx("svg",{key:"top",class:this.classes(y.zoomCap,y.maxZoomCap),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMaxZoomCapPointerDown},h.tsx("polygon",{class:y.zoomCapMask,key:"mask",points:"0 -1.81994377e-12 30 -1.81994377e-12 30 8.23076923 25 3.61538462 20 8.23076923 15 3.61538462 10 8.23076923 5 3.61538462 0 8.23076923"}),h.tsx("polygon",{class:y.zoomCapUnderline,key:"underline",points:"0 5.61538462 5 1 10 5.61538462 15 1 20 5.61538462 25 1 30 5.61538462 30 10.2307692 25 5.61538462 20 10.2307692 15 5.61538462 10 10.2307692 5 5.61538462 0 10.2307692"}),h.tsx("polygon",{class:y.zoomCapLine,key:"line",points:"0 4.61538462 5 -1.87329639e-12 10 4.61538462 15 -1.87329639e-12 20 4.61538462 25 -1.87329639e-12 30 4.61538462 30 9.23076923 25 4.61538462 20 9.23076923 15 4.61538462 10 9.23076923 5 4.61538462 0 9.23076923"}))},a.getPropsForStop=function(e){const{color:t,offset:i}=e;return{color:t instanceof n?t.toCss(!0):n.fromString(t).toCss(!0),offset:(100*i).toFixed(2)+"%",opacity:t instanceof n?t.toRgba()[3]:null}},a.getParamsFromHistogramConfig=function(e){if(!e)return null;const{average:t,barCreatedFunction:i,bins:n,dataLineCreatedFunction:o,dataLineUpdatedFunction:a}=e;return{average:t,barCreatedFunction:i,bins:n,dataLineCreatedFunction:o,dataLineUpdatedFunction:a,dataLines:this._getDataLines(e)}},a._onMaxZoomCapPointerDown=function(){const{zoomOptions:e}=this;if(e&&null!=e.max){const{min:t}=e;this.zoomOptions=null!=t?{min:t}:null}},a._onMinZoomCapPointerDown=function(){const{zoomOptions:e}=this;if(e&&null!=e.min){const{max:t}=e;this.zoomOptions=null!=t?{max:t}:null}},a._getDataLines=function(e){const{average:t,standardDeviation:i,standardDeviationCount:n}=e,{max:o,min:a}=this.viewModel.getBounds();return[...this._getStandardDeviationDataLines(i,t,n||1),...e.dataLines||[]].filter((({value:e})=>e<=o&&e>=a))},a._getStandardDeviationDataLines=function(e,t,i){const{max:n,min:o}=this.viewModel,a=.06*(n-o);return u.getDeviationValues(e,t,i).filter((e=>Math.abs(t-e)>a)).map(((e,i,n)=>{const o=this.labelFormatFunction?this.labelFormatFunction(e):e,a=n.length/2,s=i>=a?i-a+1:a-i;return{value:e,label:`${e>t?"+":"-"}${1===s?"":s}Ïƒ ${o}`}}))},t._createClass(i,[{key:"hasTimeData",get:function(){return this.viewModel?.hasTimeData??!1},set:function(e){this.viewModel&&(this.viewModel.hasTimeData=e)}},{key:"inputFormatFunction",get:function(){return this.viewModel?.inputFormatFunction},set:function(e){this.viewModel&&(this.viewModel.inputFormatFunction=e)}},{key:"inputParseFunction",get:function(){return this.viewModel?.inputParseFunction},set:function(e){this.viewModel&&(this.viewModel.inputParseFunction=e)}},{key:"labelFormatFunction",get:function(){return this.viewModel?.labelFormatFunction},set:function(e){this.viewModel&&(this.viewModel.labelFormatFunction=e)}},{key:"max",get:function(){return this.viewModel?.getUnzoomedMax()??this._get("max")??null},set:function(e){this.viewModel?this.viewModel.max=e:this._set("max",e)}},{key:"min",get:function(){return this.viewModel?.getUnzoomedMin()??this._get("min")??null},set:function(e){this.viewModel?this.viewModel.min=e:this._set("min",e)}},{key:"precision",get:function(){return this.viewModel?.precision??4},set:function(e){this.viewModel&&(this.viewModel.precision=e)}},{key:"state",get:function(){return this.viewModel?.state??"disabled"}},{key:"syncedSegmentsEnabled",get:function(){return this.slider?.syncedSegmentsEnabled},set:function(e){this.slider&&(this.slider.syncedSegmentsEnabled=e)}},{key:"values",get:function(){return this.viewModel?.values??[]}},{key:"zoomOptions",get:function(){return this.viewModel?.zoomOptions},set:function(e){this.viewModel&&(this.viewModel.zoomOptions=e)}}]),i}(d),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"hasTimeData",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"histogram",void 0),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"histogramConfig",void 0),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"inputFormatFunction",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"inputParseFunction",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"labelFormatFunction",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"max",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"min",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"precision",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"slider",void 0),i.__decorate([a.property({readOnly:!0})],e.SmartMappingSliderBase.prototype,"state",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"syncedSegmentsEnabled",null),i.__decorate([a.property({readOnly:!0})],e.SmartMappingSliderBase.prototype,"values",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"viewModel",void 0),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"visibleElements",void 0),i.__decorate([s.cast("visibleElements")],e.SmartMappingSliderBase.prototype,"castVisibleElements",null),i.__decorate([a.property()],e.SmartMappingSliderBase.prototype,"zoomOptions",null),e.SmartMappingSliderBase=i.__decorate([p.subclass("esri.widgets.smartMapping.SmartMappingSliderBase")],e.SmartMappingSliderBase),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
