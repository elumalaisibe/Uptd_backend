/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Color","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/SizeVariable","../../renderers/visualVariables/support/SizeStop","./SmartMappingSliderBase","./SizeSlider/SizeSliderViewModel","./support/utils","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],(function(e,t,i,a,r,s,o,n,l,d,p,u,c,m,h,g){"use strict";var y;const v="esri-size-slider",z={base:v,rampElement:`${v}__ramp`,sliderContainer:`${v}__slider-container`,histogramContainer:`${v}__histogram-container`,zoomCapTop:`${v}__zoom-cap-top`,zoomCapBottom:`${v}__zoom-cap-bottom`,zoomCapLine:`${v}__zoom-cap-line`,zoomCapMask:`${v}__zoom-cap-mask`,zoomCapUnderline:`${v}__zoom-cap-underline`,primaryHandle:`${v}--primary-handle`,track:`${v}--interactive-track`,esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},_={trackFillColor:new i([149,149,149]),trackBackgroundColor:new i([224,224,224])};let b=y=function(t){function i(e,i){var a;return(a=t.call(this,e,i)||this)._maxRampFillWidth=1,a._minRampFillWidth=.2,a._rampNode=null,a.messages=null,a.style={..._},a.viewModel=new u,a}e._inherits(i,t);var a=i.prototype;return a.castStyle=function(e){return{..._,...e}},i.fromRendererResult=function(e,t){const{visualVariables:i,statistics:a}=e,{avg:r,stddev:s}=a,o=i[0],[n,l]=c.getSizesFromVariable(o),d=e.renderer.authoringInfo.visualVariables[0],p=d.minSliderValue,u=d.maxSliderValue;return new y({max:u,min:p,stops:[{value:o.minDataValue,size:l},{value:o.maxDataValue,size:n}],histogramConfig:{average:r,standardDeviation:s,bins:t?t.bins:[]}})},a.updateFromRendererResult=function(e,t){const{visualVariables:i,statistics:a}=e,{avg:r,stddev:s}=a,o=i[0],[n,l]=c.getSizesFromVariable(o),d=e.renderer.authoringInfo.visualVariables[0],p=d.minSliderValue,u=d.maxSliderValue;this.set({max:u,min:p,stops:[{value:o.minDataValue,size:l},{value:o.maxDataValue,size:n}],histogramConfig:{average:r,standardDeviation:s,bins:t?t.bins:[]}})},a.updateVisualVariable=function(e){const t=e.clone(),{stops:i}=this;if(!e||!i)return null;if(t.stops)return t.stops=i,t;const a=i[0],r=i[i.length-1];let s=t.maxSize,o=t.minSize;if(s instanceof l){const e=s.stops,t=r.size/e[0].size,i=e.map((e=>(e.size*=t,e)));s.stops=i}else s=r.size;if(o instanceof l){const e=o.stops,t=a.size/e[0].size,i=e.map((e=>(e.size*=t,e)));o.stops=i}else o=a.size;return t.set({maxDataValue:r.value,minDataValue:a.value,maxSize:s,minSize:o}),t},a.updateFromVisualVariable=function(e){if(!e)return;const{maxDataValue:t,minDataValue:i,stops:a}=e;if(a)this.stops=a;else{const[a,r]=c.getSizesFromVariable(e);this.stops=[new d({value:i,size:r}),new d({value:t,size:a})]}},a.render=function(){const{label:e,primaryHandleEnabled:t,state:i,visibleElements:a}=this,r="disabled"===i,s=this.classes(z.base,z.esriWidget,z.esriWidgetPanel,{[z.disabled]:r,[z.primaryHandle]:t,[z.track]:!!a.interactiveTrack});return g.tsx("div",{"aria-label":e,class:s},r?null:this.renderContent(this.renderRamp(),z.sliderContainer,z.histogramContainer))},a.renderRamp=function(){const{style:{trackBackgroundColor:e},zoomOptions:t}=this;return g.tsx("div",{afterCreate:m.storeNode,bind:this,class:z.rampElement,"data-node-ref":"_rampNode"},g.tsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},g.tsx("rect",{x:"0",y:"0",fill:c.getFillFromColor(e),height:"100%",width:"100%"}),this.renderPath()),t?this.renderZoomCaps():null)},a.renderPath=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:t=0}=this._rampNode;if(null==e||null==t)return;const{primaryHandleEnabled:i,stops:a,style:{trackFillColor:r},values:s,viewModel:{max:o,min:n},_maxRampFillWidth:l,_minRampFillWidth:d}=this,p=[l,d];a[0].size<a[a.length-1].size&&p.reverse();const u=s.slice().sort(((e,t)=>e>t?1:-1)),[m,h]=p,[y,v]=u,z=i?c.getDynamicPathForSizeStops({max:o,min:n,pathHeight:e,pathWidth:t,stops:a,padding:h}):c.getPathForSizeStops({bottomValue:y,bottomWidth:m,max:o,min:n,pathHeight:e,pathWidth:t,topValue:v,topWidth:h});return g.tsx("path",{d:z,fill:c.getFillFromColor(r)})},e._createClass(i,[{key:"handlesSyncedToPrimary",get:function(){return this.viewModel.handlesSyncedToPrimary},set:function(e){this.viewModel.handlesSyncedToPrimary=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"persistSizeRangeEnabled",get:function(){return this.viewModel.persistSizeRangeEnabled},set:function(e){this.viewModel.persistSizeRangeEnabled=e}},{key:"primaryHandleEnabled",get:function(){return this.viewModel.primaryHandleEnabled},set:function(e){this.viewModel.primaryHandleEnabled=e}},{key:"stops",get:function(){return this.viewModel.stops},set:function(e){this.viewModel.stops=e}}]),i}(p.SmartMappingSliderBase);t.__decorate([a.property()],b.prototype,"handlesSyncedToPrimary",null),t.__decorate([a.property()],b.prototype,"label",null),t.__decorate([a.property(),h.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],b.prototype,"messages",void 0),t.__decorate([a.property()],b.prototype,"persistSizeRangeEnabled",null),t.__decorate([a.property()],b.prototype,"primaryHandleEnabled",null),t.__decorate([a.property()],b.prototype,"stops",null),t.__decorate([a.property()],b.prototype,"style",void 0),t.__decorate([r.cast("style")],b.prototype,"castStyle",null),t.__decorate([a.property()],b.prototype,"viewModel",void 0),b=y=t.__decorate([n.subclass("esri.widgets.smartMapping.SizeSlider")],b);return b}));
