/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../Slider/SliderViewModel","./support/utils"],(function(t,e,n,o,s,i,a,r,l){"use strict";let u=function(e){function n(n){var o;return(o=e.call(this,n)||this)._initialStopValues=[],o._max=null,o._min=null,o.hasTimeData=!1,o.inputFormatFunction=(t,e)=>"max"===e?o.getUnzoomedMax().toString():"min"===e?o.getUnzoomedMin().toString():t.toString(),o.inputParseFunction=null,o.labelFormatFunction=e=>{if(o.hasTimeData)return l.formatDateLabel(e);const{max:n,min:s,precision:i}=t._assertThisInitialized(o),a=n-s>10?2:i;return l.formatNumberLabel(parseFloat(e.toFixed(a)))},o.thumbsConstrained=!1,o.zoomingEnabled=!0,o}t._inherits(n,e);var o=n.prototype;return o.getStopIndexFromValueIndex=function(t){const{stops:e}=this,n=this.values[t];if(0===t){return n<=this.values[1]?0:e.length-1}if(1===t){return this.values[0]>=n?0:e.length-1}return null},o.getStopChanges=function(t,e){const n=this.stops,o=this.getStopIndexFromValueIndex(t),s=this.getValuesFromStops();s[o]=e;const[i,a]=[s[0],s[s.length-1]].sort(((t,e)=>t>e?1:-1)),r=a-i,l=n.length-1;return s.map(((t,e)=>({index:e,value:this.toPrecision(i+e*r/l)})))},o.setValue=function(t,e){const{max:n,min:o,values:s}=this,i=s[t];if(isNaN(e)||i===e||e>n||e<o)return;s[t]=this.toPrecision(e),this._set("values",[...s]);const a=s.slice().sort(((t,e)=>t>e?1:-1)),r=a[0],u=a[a.length-1],h=l.getStopChanges(r,u,this._initialStopValues??[]);this.updateStops(h),this.updateBreaks(),this.notifyChange("labels")},o.getValuesFromStops=function(t){const e=t||this.stops;return e?.map((t=>t.hasOwnProperty("ratio")?t.ratio:t.value))},o.updateBreaks=function(){const{breaks:t,values:e}=this;t?.length&&e.slice().sort(((t,e)=>t>e?1:-1)).forEach(((e,n)=>{t[n].max=e,null!=t[n+1]&&(t[n+1].min=e)}))},o.updateBreakMax=function(t){const{breaks:e,max:n,min:o}=this;!isNaN(t)&&n!==t&&null!=o&&t>o&&e?.length&&(e[e.length-1].max=t)},o.updateBreakMin=function(t){const{breaks:e,max:n,min:o}=this;!isNaN(t)&&o!==t&&null!=n&&t<n&&e?.length&&(e[0].min=t)},o.updateStops=function(t){const{stops:e}=this,n=this.getValuesFromStops();if(n?.length){for(const e of t)n[e.index]=e.value;e.forEach(((t,e)=>{t.hasOwnProperty("ratio")?t.ratio=n[e]:t.value=n[e]}))}},o.getUnzoomedMax=function(){return this.zoomOptions&&null!=this._max?this._max:this.max},o.getUnzoomedMin=function(){return this.zoomOptions&&null!=this._min?this._min:this.min},o._storeZoomMax=function(t,e){this._max=e,this.setMax(t)},o._storeZoomMin=function(t,e){this._min=e,this.setMin(t)},t._createClass(n,[{key:"breaks",set:function(t){this._set("breaks",t),this.notifyChange("max"),this.notifyChange("min")}},{key:"stops",set:function(t){if(t?.length){const{max:e,min:n}=this,o=this.getValuesFromStops(t),s={};null!=n&&o.some((t=>t<n))&&(s.min=Math.min(...o)),null!=e&&o.some((t=>t>e))&&(s.max=Math.max(...o)),this.set({...s}),this._initialStopValues=o}else this._initialStopValues=null;this._set("stops",t||null),this.notifyChange("values")}},{key:"labels",get:function(){const{values:t}=this,e=t&&t.length?t.map(((t,e)=>this.getLabelForValue(t,"value",e))):[],n=this.getUnzoomedMax(),o=this.getUnzoomedMin();return{max:this.getLabelForValue(n,"max"),min:this.getLabelForValue(o,"min"),values:e}}},{key:"max",get:function(){const{breaks:t}=this;return t?.length?t[t.length-1].max:this.max},set:function(t){const{zoomOptions:e}=this;if(e&&null!=e.max){const n=this.values;let o=e.max;if(t<o&&(o=t,e.max=t),n&&n.length)for(let e=0;e<n.length;e++)t<n[e]&&this.setValue(e,t);this._storeZoomMax(o,t)}else this.updateBreakMax(t),this.setMax(t);this.notifyChange("labels")}},{key:"min",get:function(){const{breaks:t}=this;return t?.length?t[0].min:this.min},set:function(t){const{zoomOptions:e}=this;if(e&&null!=e.min){const n=this.values;let o=e.min;if(t>o&&(o=t,e.min=t),n&&n.length)for(let e=0;e<n.length;e++)t>n[e]&&this.setValue(e,t);this._storeZoomMin(o,t)}else this.updateBreakMin(t),this.setMin(t);this.notifyChange("labels")}},{key:"state",get:function(){const{max:t,min:e,values:n}=this;return null!=t&&null!=e&&n.length>0?"ready":"disabled"}},{key:"values",get:function(){const{breaks:t,stops:e}=this;if(!t&&!e)return[];if(t?.length){const e=t.map((t=>t.max));return e.pop(),e}if(e?.length<2)return[];const n=this.getValuesFromStops();return[n[0],n[n.length-1]]}},{key:"zoomOptions",set:function(t){const{zoomingEnabled:e,zoomOptions:n}=this;if(e){if(n){const e=null!=this._max?this._max:this.max,n=null!=this._min?this._min:this.min;if(t){const{max:o,min:s}=t,i=null!=o,a=null!=s,r=a?t.min:n,l=a?n:null,u=i?t.max:e,h=i?e:null;this._storeZoomMin(r,l),this._storeZoomMax(u,h)}else this.setMax(e),this.setMin(n),this._min=null,this._max=null}else if(t){const{max:e,min:n}=t;null!=n&&this._storeZoomMin(t.min,this.min),null!=e&&this._storeZoomMax(t.max,this.max)}this._set("zoomOptions",t),this.notifyChange("max"),this.notifyChange("min")}}}]),n}(r);e.__decorate([n.property()],u.prototype,"breaks",null),e.__decorate([n.property()],u.prototype,"stops",null),e.__decorate([n.property()],u.prototype,"hasTimeData",void 0),e.__decorate([n.property()],u.prototype,"inputFormatFunction",void 0),e.__decorate([n.property()],u.prototype,"inputParseFunction",void 0),e.__decorate([n.property()],u.prototype,"labelFormatFunction",void 0),e.__decorate([n.property({readOnly:!0})],u.prototype,"labels",null),e.__decorate([n.property()],u.prototype,"max",null),e.__decorate([n.property()],u.prototype,"min",null),e.__decorate([n.property({readOnly:!0})],u.prototype,"state",null),e.__decorate([n.property()],u.prototype,"thumbsConstrained",void 0),e.__decorate([n.property({readOnly:!0})],u.prototype,"values",null),e.__decorate([n.property()],u.prototype,"zoomingEnabled",void 0),e.__decorate([n.property()],u.prototype,"zoomOptions",null),u=e.__decorate([a.subclass("esri.widgets.smartMapping.SmartMappingSliderViewModel")],u);return u}));
