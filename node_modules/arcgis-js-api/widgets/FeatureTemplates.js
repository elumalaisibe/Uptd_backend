/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/HandleOwner","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./Widget","./FeatureForm/featureFormUtils","./FeatureTemplates/FeatureTemplatesViewModel","./FeatureTemplates/ItemList","./FeatureTemplates/TemplateItem","./support/componentsUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory"],(function(e,t,r,o,n,i,s,l,a,c,d,p,u,m,f,h,y,v,_,I){"use strict";const b="esri-feature-templates",g={base:b,loader:`${b}__loader`,widget:"esri-widget"};function w(e){return e.length>0&&p.isTemplateItemGroup(e[0])}function C(e){return e.id}const F={filter:!0};let L=function(r){function o(e,t){var o;return(o=r.call(this,e,t)||this).enableListScroll=!0,o.filterText="",o.headingLevel=4,o.messages=null,o.viewModel=new u,o.visibleElements={...F},o.renderCustomItem=e=>null,o.renderCustomGroupContent=e=>null,o.renderItemLabel=()=>null,o.renderItemDescription=()=>null,o.renderItemContent=e=>null,o.renderItemContentEnd=e=>null,o._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const r=e.target;if(T(r))return void t.unobserve(r);const o=M(r),{layer:n,template:i}=o;E(r,!0);const s=await f.fetchThumbnail(n,i).catch((()=>(E(r,!1),null)));if(null==s)return;r.appendChild(s)}}))})),o.renderItemIcon=e=>I.tsx("span",{key:"icon",afterCreate:o._afterItemCreateOrUpdate,afterUpdate:o._afterItemCreateOrUpdate,afterRemoved:o._afterItemRemoved,"data-item":e,"data-has-icon":!1}),o._afterItemCreateOrUpdate=e=>{o._iconIntersectionObserver?.observe(e)},o._afterItemRemoved=e=>{o._iconIntersectionObserver?.unobserve(e)},o}t._inherits(o,r);var i=o.prototype;return i.initialize=function(){const e=({label:e})=>!this.filterText||!!e?.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(n.watch((()=>this.viewModel),((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)}),n.initial))},i.destroy=function(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null},i.loadDependencies=function(){return h.loadCalciteComponents({input:()=>new Promise(((t,r)=>e(["../chunks/calcite-input"],t,r))),"list-item":()=>new Promise(((t,r)=>e(["../chunks/calcite-list-item"],t,r))),notice:()=>new Promise(((t,r)=>e(["../chunks/calcite-notice"],t,r)))})},i.castVisibleElements=function(e){return{...F,...e}},i.select=function(e,t){return this.viewModel.select(e,t)},i.render=function(){const{enableListScroll:e,filterText:t,headingLevel:r,messages:o,viewModel:{items:n,numberOfFeatureTemplates:i,selectedItem:s,state:l}}=this,a=this.visibleElements.filter&&i>1;if(w(n)){const e=n.find((e=>e.label===u.nullGroupBy.label));e&&(e.label=o.other)}return I.tsx("div",{class:this.classes(g.base,g.widget),"aria-label":o.widgetLabel},"loading"===l?this.renderLoader():"ready"===l?I.tsx(m.ItemList,{enableListScroll:e,filterEnabled:a,filterText:t,headingLevel:r,id:this.id,identify:C,items:n,messages:{filterPlaceholder:o.filterPlaceholder,noItems:o.noItems,noMatches:o.noMatches},renderIcon:this.renderItemIcon,renderCustomItem:this.renderCustomItem,renderCustomGroupContent:this.renderCustomGroupContent,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:s??void 0,selectionMode:"single",onItemSelect:e=>!p.isTemplateItemGroup(e)&&this.viewModel.select(e),onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()}}):null)},i.renderLoader=function(){return I.tsx("div",{class:g.loader,key:"loader"})},t._createClass(o,[{key:"filterFunction",get:function(){return this.viewModel.filterFunction},set:function(e){this.viewModel.filterFunction=e}},{key:"groupBy",get:function(){return this.viewModel.groupBy},set:function(e){this.viewModel.groupBy=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"layers",get:function(){return this.viewModel.layers},set:function(e){this.viewModel.layers=e}},{key:"selectedItem",get:function(){return this.viewModel.selectedItem}}]),o}(o.HandleOwnerMixin(d));function M(e){return e?.["data-item"]}function T(e){return!!e?.["data-has-icon"]}function E(e,t){e&&(e["data-has-icon"]=t)}r.__decorate([i.property()],L.prototype,"enableListScroll",void 0),r.__decorate([i.property()],L.prototype,"filterFunction",null),r.__decorate([i.property()],L.prototype,"filterText",void 0),r.__decorate([i.property()],L.prototype,"groupBy",null),r.__decorate([i.property()],L.prototype,"headingLevel",void 0),r.__decorate([i.property()],L.prototype,"label",null),r.__decorate([i.property()],L.prototype,"layers",null),r.__decorate([i.property(),v.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],L.prototype,"messages",void 0),r.__decorate([i.property({readOnly:!0})],L.prototype,"selectedItem",null),r.__decorate([i.property(),_.vmEvent("select")],L.prototype,"viewModel",void 0),r.__decorate([i.property()],L.prototype,"visibleElements",void 0),r.__decorate([s.cast("visibleElements")],L.prototype,"castVisibleElements",null),r.__decorate([i.property()],L.prototype,"renderCustomItem",void 0),r.__decorate([i.property()],L.prototype,"renderCustomGroupContent",void 0),r.__decorate([i.property()],L.prototype,"renderItemLabel",void 0),r.__decorate([i.property()],L.prototype,"renderItemDescription",void 0),r.__decorate([i.property()],L.prototype,"renderItemContent",void 0),r.__decorate([i.property()],L.prototype,"renderItemContentEnd",void 0),L=r.__decorate([c.subclass("esri.widgets.FeatureTemplates")],L);return L}));
