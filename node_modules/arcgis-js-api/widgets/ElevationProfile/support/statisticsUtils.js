/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/arrayUtils","../../../core/unitUtils","./constants"],(function(t,e,n,l,i){"use strict";function a(t,e){const n=t.length;if(0===n)return null;const a=t[0],o=a.sampledZ;let s=o,c=o,m=0,p=0,g=null,f=null,h=null!=o?o:0,E=0,S=0,_=null!=o?1:0,x=0,d=0;const P=l.getMetersPerUnitForSR(e),C=l.getMetersPerVerticalUnitForSR(e),y=i.getConfig().minSlopeSampleDistance/P,M=2*y,D=new v,U=new v,H=()=>{R(),D.copy(U),U.reset()},N=(t,e)=>{H(),t>0&&t-D.start<=M&&(t=D.start+y),U.restart(t,e)},R=()=>{if(D.isHole||U.isHole)return;const t=U.avgElevation-D.avgElevation,e=U.start-D.start,n=t*C,i=e*P,a=l.convertUnit(Math.atan2(n,i),"radians","degrees");a>0?(E+=a,g=u(g,a),x++):a<0&&(S-=a,f=u(f,-a),d++)};null!=a.sampledZ&&N(a.distance,a.sampledZ);for(let l=1;l<n;++l){const e=t[l-1],n=t[l],i=n.sampledZ;if(null==i){U.isHole||H();continue}_++,h+=i,s=r(s,i),c=u(c,i),U.isHole||n.distance-U.start>=y?N(n.distance,i):U.insert(i);const a=e.sampledZ;if(null!=a){const t=i-a;t>0?m+=t:t<0&&(p-=t)}}return H(),0===_?null:{maxDistance:t[n-1].distance,minElevation:s,maxElevation:c,avgElevation:0===_?null:h/_,elevationGain:m,elevationLoss:p,maxPositiveSlope:g,maxNegativeSlope:f,avgPositiveSlope:0===x?null:E/x,avgNegativeSlope:0===d?null:S/d}}function o(t){const e=t.filter(n.isSome),l=e.length;if(0===l)return null;const i=e[0];if(1===l)return i;let a=i.maxDistance,o=i.minElevation,s=i.maxElevation,c=i.maxPositiveSlope,v=i.maxNegativeSlope;for(let n=1;n<e.length;++n){const t=e[n];a=u(a,t.maxDistance),o=r(o,t.minElevation),s=u(s,t.maxElevation),c=u(c,t.maxPositiveSlope),v=u(v,t.maxNegativeSlope)}return{maxDistance:a,minElevation:o,maxElevation:s,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:c,maxNegativeSlope:v,avgPositiveSlope:null,avgNegativeSlope:null}}function s(t){let e=null,n=null,i=null;for(const a of t){if(null==a)continue;const{statistics:t,spatialReference:o}=a;if(null==t)continue;const s=l.getMetersPerUnitForSR(o);e=u(e,c(t.maxDistance,s));const v=l.getMetersPerVerticalUnitForSR(o);i=r(i,c(t.minElevation,v)),n=u(n,c(t.maxElevation,v))}return{minDistance:0,maxDistance:e??0,minElevation:i??0,maxElevation:n??0}}function r(t,e){return null==e?t:null!=t?Math.min(t,e):e}function u(t,e){return null==e?t:null!=t?Math.max(t,e):e}function c(t,e){return null!=t&&null!=e?t*e:null}let v=function(){function t(){this._start=0,this._totalElevation=0,this._sampleCount=0}var n=t.prototype;return n.copy=function(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation},n.reset=function(){this._start=0,this._sampleCount=0,this._totalElevation=0},n.restart=function(t,e){this._start=t,this._sampleCount=1,this._totalElevation=e},n.insert=function(t){++this._sampleCount,this._totalElevation+=t},e._createClass(t,[{key:"avgElevation",get:function(){return this._totalElevation/this._sampleCount}},{key:"isHole",get:function(){return 0===this._sampleCount}},{key:"start",get:function(){return this._start}}]),t}();t.getBoundsInMeters=s,t.getStatistics=a,t.mergeStatistics=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
