/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../Color","../../../core/Accessor","../../../core/Handles","../../../core/reactiveUtils","../../../core/throttle","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../../chunks/vec4f64","../../../geometry/Polyline","../../../views/3d/interactive/visualElements/OutlineVisualElement","./constants"],(function(e,t,o,r,s,i,n,l,a,c,u,h,f,d,p,_,y){"use strict";const v=100;e.ProfileLines3D=function(e){function o(t){var o;return(o=e.call(this,t)||this)._chartData=null,o._visualElements=[],o._handles=new i,o}t._inherits(o,e);var s=o.prototype;return s.initialize=function(){const e=l.throttle((e=>{this._update(e)}),v);this._handles.add([n.watch((()=>({spatialReference:this.view.spatialReference,chartData:this._chartData})),e,n.syncAndInitial),e])},s.destroy=function(){this._handles.destroy(),this._destroyVisualElements()},s.remove=function(){this._destroyVisualElements()},s.update=function(e){this._chartData=e},s._update=function(e){const{chartData:t}=e;if(null==t)return this.remove();if(!t.refined)return;const o=this._visualElements,s=t.lines.filter((e=>e.viewVisualizationEnabled)),i=s.length;for(;o.length>i;)o.pop().destroy();const n=y.getConfig().profileLinesStyle3D;for(;o.length<i;){const e=new _.OutlineVisualElement({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:n.width-n.outlineSize,width:n.width,falloff:n.falloff,color:n.outlineColor,renderOccluded:n.renderOccluded});o.push(e)}const l=e.spatialReference;for(let a=0;a<i;++a){const e=o[a],t=s[i-1-a];e.geometry=this._createLineGeometry(t,l),e.innerColor=d.fromArray(r.toUnitRGBA(t.color))}},s._createLineGeometry=function(e,t){const o=e.samples??[],r=o.length-1,s=[];let i=[];for(let n=0;n<=r;n++){const{x:e,y:t,z:l}=o[n];null!=l&&i.push([e,t,l]),n!==r&&null!=l||!i.length||(s.push(i),i=[])}return new p({paths:s,hasZ:!0,spatialReference:t})},s._destroyVisualElements=function(){this._visualElements.forEach((e=>e.destroy())),this._visualElements.length=0},t._createClass(o)}(s),o.__decorate([a.property()],e.ProfileLines3D.prototype,"view",void 0),o.__decorate([a.property()],e.ProfileLines3D.prototype,"_chartData",void 0),e.ProfileLines3D=o.__decorate([f.subclass("esri.widgets.ElevationProfile.support.ProfileLines3D")],e.ProfileLines3D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
