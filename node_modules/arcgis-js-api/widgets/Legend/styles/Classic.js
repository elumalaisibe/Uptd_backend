/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../intl","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../Widget","./ClassicCSS","./support/relationshipUtils","./support/univariateUtils","../support/styleUtils","../../support/Heading","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory","../../../intl/number"],(function(e,t,a,s,r,i,l,n,o,p,c,d,y,m,v,S,h,g){"use strict";const u=`${p.LEGEND}__`,C=24,b={display:"flex",alignItems:"flex-start"},f={marginLeft:"3px"},x={display:"table-cell",verticalAlign:"middle"};let L=function(t){function a(e,a){var s;return(s=t.call(this,e,a)||this).activeLayerInfos=null,s.headingLevel=3,s.messages=null,s.type="classic",s}e._inherits(a,t);var s=a.prototype;return s.render=function(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return h.tsx("div",null,t&&t.length?t:h.tsx("div",{class:p.CSS.message},this.messages.noLegend))},s._renderLegendForLayer=function(e){if(!e.ready)return null;const t=!!e.children.length,a=`${u}${e.layer.uid}-version-${e.version}`,s=e.title?m.Heading({level:this.headingLevel,class:this.classes(p.CSS.header,p.CSS.label)},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return h.tsx("div",{key:a,class:this.classes(p.CSS.service,p.CSS.groupLayer)},s,t)}{const t=e.legendElements;if(t&&!t.length)return null;const r=t.map((t=>this._renderLegendForElement(t,e.layer,e.effectList))).filter((e=>!!e));if(!r.length)return null;const i={[p.CSS.groupLayerChild]:!!e.parent};return h.tsx("div",{key:a,class:this.classes(p.CSS.service,i),tabIndex:0},s,h.tsx("div",{class:p.CSS.layer},r))}},s._renderLegendForElement=function(e,t,a,s){const r="color-ramp"===e.type,i="opacity-ramp"===e.type,l="size-ramp"===e.type;let n=null;if("symbol-table"===e.type||l){const s=e.infos.map((s=>this._renderLegendForElementInfo(s,t,a,l,e.legendType))).filter((e=>!!e));s.length&&(n=h.tsx("div",{class:p.CSS.layerBody},s))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?n=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?n=c.renderRelationshipRamp(e,this.id,{opacity:t.opacity,effectList:a,ariaLabel:this.messages.previewRelationshipRampAriaLabel}):"pie-chart-ramp"===e.type?n=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?n=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,a):"univariate-color-size-ramp"===e.type&&(n=this._renderUnivariateColorSizeRamp(e,t.opacity,a));if(!n)return null;const o=e.title;let d=null;if("string"==typeof o)d=o;else if(o){const e=y.getTitle(this.messages,o,r||i);d=y.isRendererTitle(o,r||i)&&o.title?`${o.title} (${e})`:e}const m=s?p.CSS.layerChildTable:p.CSS.layerTable,v=d?h.tsx("div",{class:p.CSS.layerCaption},d):null,S={[p.CSS.layerTableSizeRamp]:l||!s};return h.tsx("div",{class:this.classes(m,S)},v,n)},s._renderPieChartRamp=function(e){return h.tsx("div",{bind:e.preview,afterCreate:y.attachToNode})},s._renderUnivariateAboveAndBelowRamp=function(e,t,a){const{sizeRampElement:s,colorRampElement:r}=d.getUnivariateAboveAndBelowRampElements(e,t);if(!s)return null;const i=this.messages?.previewColorRampAriaLabel,l=d.getUnivariateColorRampSize(s,"above",!0),n=d.getUnivariateColorRampSize(s,"below",!0),o=12,c=d.getUnivariateColorRampPreview(r,{width:o,height:l,rampAlignment:"vertical",opacity:t,type:"above",effectList:a,ariaLabel:i}),m=d.getUnivariateColorRampPreview(r,{width:o,height:n,rampAlignment:"vertical",opacity:t,type:"below",effectList:a,ariaLabel:i}),v=d.getUnivariateColorRampMargin(s),S=s.infos.map((e=>e.label)),g=S.map(((e,t)=>{const a=2===t;return 0===t?h.tsx("div",{key:t,class:e?c?p.CSS.univariateAboveAndBelowLabel:p.CSS.rampLabel:void 0},e):a?h.tsx("div",null):null})),u=S.length-1,C=Math.floor(S.length/2),L=S.map(((e,t)=>t===C||t===u?h.tsx("div",{key:t,class:e?c?p.CSS.univariateAboveAndBelowLabel:p.CSS.rampLabel:void 0},e):null)),w={display:"table-cell",verticalAlign:"middle"},R={marginTop:`${v}px`},_={height:`${l}px`},A={height:`${n}px`};return h.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:b},h.tsx("div",{class:p.CSS.layerBody},s.infos.map(((e,t)=>h.tsx("div",{class:this.classes(p.CSS.layerRow,p.CSS.sizeRamp)},h.tsx("div",{class:p.CSS.symbol,styles:w,bind:e.preview,afterCreate:y.attachToNode}),c||t%2!=0?null:h.tsx("div",{class:p.CSS.layerInfo},S[t]))))),c?h.tsx("div",{styles:R,key:"color-ramp-preview"},h.tsx("div",{styles:f},h.tsx("div",{styles:x},h.tsx("div",{class:p.CSS.rampContainer,bind:c,afterCreate:y.attachToNode})),h.tsx("div",{styles:x},h.tsx("div",{class:p.CSS.rampLabelsContainer,styles:_},g))),h.tsx("div",{styles:f},h.tsx("div",{styles:x},h.tsx("div",{class:p.CSS.rampContainer,bind:m,afterCreate:y.attachToNode})),h.tsx("div",{styles:x},h.tsx("div",{class:p.CSS.rampLabelsContainer,styles:A},L)))):null)},s._renderUnivariateColorSizeRamp=function(e,t,a){const{sizeRampElement:s,colorRampElement:r}=d.getUnivariateColorSizeRampElements(e);if(!s)return null;const i=d.getUnivariateColorRampMargin(s),l=12,n=d.getUnivariateColorRampSize(s,"full",!1),o=d.getUnivariateColorRampPreview(r,{width:l,height:n,rampAlignment:"vertical",opacity:t,type:"full",effectList:a,ariaLabel:this.messages?.previewColorRampAriaLabel}),c=s.infos.length-1,m=s.infos.map(((e,t)=>0===t||t===c?h.tsx("div",{key:t,class:e.label?r?p.CSS.univariateAboveAndBelowLabel:p.CSS.rampLabel:void 0},e.label):null)),v={display:"table-cell",verticalAlign:"middle"},S={marginTop:`${i}px`},g={height:`${n}px`};return h.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:b},h.tsx("div",{class:p.CSS.layerBody},s.infos.map((e=>h.tsx("div",{class:this.classes(p.CSS.layerRow,p.CSS.sizeRamp)},h.tsx("div",{class:p.CSS.symbol,styles:v,bind:e.preview,afterCreate:y.attachToNode}))))),h.tsx("div",{styles:S,key:"color-ramp-preview"},h.tsx("div",{styles:f},h.tsx("div",{styles:x},h.tsx("div",{class:p.CSS.rampContainer,bind:o,afterCreate:y.attachToNode})),h.tsx("div",{styles:x},h.tsx("div",{class:p.CSS.rampLabelsContainer,styles:g},m)))))},s._renderLegendForRamp=function(e,t){const a=e.infos,s="opacity-ramp"===e.type,r="heatmap-ramp"===e.type,i="stretch-ramp"===e.type,l=e.preview,n=s?p.CSS.opacityRamp:"";l.className=`${p.CSS.colorRamp} ${n}`,null!=t&&(l.style.opacity=t.toString());const o=a.map((e=>h.tsx("div",{class:e.label?p.CSS.rampLabel:void 0},r?this.messages[e.label]||e.label:i?this._getStretchStopLabel(e):e.label))),c={width:`${C}px`},d={height:l.style.height};return h.tsx("div",{class:p.CSS.layerRow},h.tsx("div",{class:p.CSS.symbolContainer,styles:c},h.tsx("div",{class:p.CSS.rampContainer,bind:l,afterCreate:y.attachToNode})),h.tsx("div",{class:p.CSS.layerInfo},h.tsx("div",{class:p.CSS.rampLabelsContainer,styles:d},o)))},s._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:g.formatNumber(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""},s._renderLegendForElementInfo=function(e,t,a,s,r){if(e.type)return this._renderLegendForElement(e,t,a,!0);let i=null;const l=y.isImageryStretchedLegend(t,r);if(e.preview?i=h.tsx("div",{class:p.CSS.symbol,bind:e.preview,afterCreate:y.attachToNode}):e.src&&(i=this._renderImage(e,t,l)),!i)return null;const n={[p.CSS.imageryLayerInfoStretched]:l},o={[p.CSS.imageryLayerInfoStretched]:l,[p.CSS.sizeRamp]:!l&&s};return h.tsx("div",{class:p.CSS.layerRow},h.tsx("div",{class:this.classes(p.CSS.symbolContainer,o)},i),h.tsx("div",{class:this.classes(p.CSS.layerInfo,n)},y.getTitle(this.messages,e.label,!1)||""))},s._renderImage=function(e,t,a){const{label:s,src:r,opacity:i}=e,l={[p.CSS.imageryLayerStretchedImage]:a,[p.CSS.symbol]:!a},n={opacity:`${null!=i?i:t.opacity}`};return h.tsx("img",{alt:y.getTitle(this.messages,s,!1),"aria-label":y.getTitle(this.messages,s,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(l),styles:n})},e._createClass(a)}(o);t.__decorate([s.property()],L.prototype,"activeLayerInfos",void 0),t.__decorate([s.property()],L.prototype,"headingLevel",void 0),t.__decorate([s.property(),S.messageBundle("esri/widgets/Legend/t9n/Legend")],L.prototype,"messages",void 0),t.__decorate([s.property({readOnly:!0})],L.prototype,"type",void 0),L=t.__decorate([n.subclass("esri.widgets.Legend.styles.Classic")],L);return L}));
