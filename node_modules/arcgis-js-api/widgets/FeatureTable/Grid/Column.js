/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Evented","../../../core/HandleOwner","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","./support/ButtonMenu","../../support/widgetUtils"],(function(e,t,o,r,n,i,s,a,d,c,l,p){"use strict";const u="esri-column",h={sortAscIcon:"esri-icon-arrow-up",sortDescIcon:"esri-icon-arrow-down",menuContainer:`${u}__menu-container`,menuIcon:"esri-icon-handle-horizontal",sorter:`${u}__sorter`,headerContent:`${u}__header-content`,headerLabel:`${u}__header-label`},y={keyboardSort1:"Enter",keyboardSort2:"Spacebar"};let _=function(t){function o(o){var r;return(r=t.call(this,o)||this)._menuContainer=document.createElement("div"),r.activeRowIndex=null,r.autoWidth=!1,r.cellValueFormatFunction=({value:e})=>p.renderingSanitizer.sanitize(e),r.flexGrow=1,r.footerRenderFunction=null,r.frozen=!1,r.grid=null,r.header=null,r.headerRenderFunction=e=>{const{root:t}=e;if(r.removeCellContent(t),t.classList.add(h.headerContent),r.sortable)r.headerSorterRenderFunction(e);else{const e=document.createElement("div");e.classList.add(h.headerLabel),e.textContent=r.label,t.appendChild(e)}r.headerMenuEnabled&&r.headerMenuRenderFunction(e)},r.headerMenuRenderFunction=({root:e})=>{r.menu?.items?.length&&e.appendChild(r._menuContainer)},r.headerSorterRenderFunction=({root:t})=>{const{label:o,sortElement:n}=e._assertThisInitialized(r);if(!n)return void(t.textContent=o);n.textContent!==o&&n.setAttribute("textContent",o),t.appendChild(n);const i=r.grid?.getSlotElementByName(t.slot),s=i?.parentElement;s&&!s.onkeydown&&(s.onkeydown=({key:e})=>{e!==y.keyboardSort1&&e!==y.keyboardSort2||n.click()})},r.hidden=!1,r.headerMenuEnabled=!0,r.initialSortPriority=null,r.menu=null,r.menuConfig=null,r.messages=null,r.messagesCommon=null,r.messagesURIUtils=null,r.path=null,r.renderFunction=({root:e,column:t,rowData:o})=>{const n=r.getCellValue(t,o),i=r.cellValueFormatFunction({column:t,rowData:o,value:n});e.innerHTML!==i&&(e.innerHTML=i)},r.resizable=!0,r.sortable=!0,r.textAlign="start",r.width=200,r}e._inherits(o,t);var r=o.prototype;return r.initialize=function(){const{messages:e,path:t}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",t??""),this._menuContainer.classList.add(h.menuContainer),this.menu=new l({label:e?.options,iconClass:h.menuIcon,...this.menuConfig}),this.menu.container=this._menuContainer,this.menu.set("items",this.getMenuItems()),this.handles.add(n.watch((()=>this.hidden),(()=>this.menu?.set("open",!1))),n.watch((()=>this.path),(e=>{this.sortElement&&this.sortElement.path!==e&&this.sortElement.setAttribute("path",e??"")})))},r.destroy=function(){this.menu?.destroy()},r.getMenuItems=function(){const{menuConfig:e,sortable:t}=this,o=e?.items,r=this.getSortMenuItems(),n=[];return t&&n.push(...r),o?.length&&n.push(...o),n.length?n:null},r.getSortMenuItems=function(){const{messages:e}=this;return[{selected:"asc"===this.direction,iconClass:h.sortAscIcon,label:e?.sortAsc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","asc"!==this.direction?"asc":null)},{selected:"desc"===this.direction,iconClass:h.sortDescIcon,label:e?.sortDesc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","desc"!==this.direction?"desc":null)}]},r.getCellValue=function(e,t){return t?.item[e?.path]??""},r.createSortElement=function(){const{direction:e,label:t,path:o,initialSortPriority:r}=this,n=document.createElement("vaadin-grid-sorter");return n.classList.add(h.sorter),n.setAttribute("path",o??""),n.setAttribute("title",t),n.textContent=t,e&&n.setAttribute("direction",e),null!=r&&(n._initialOrder=r),n.addEventListener("direction-changed",(()=>{this.direction!==n.direction&&this._set("direction",n.direction)})),n},r.removeCellContent=function(e){if(e)for(;e.firstChild;)try{e.removeChild(e.firstChild)}catch(t){}},e._createClass(o,[{key:"direction",get:function(){return this._get("direction")||null},set:function(e){this.sortable&&(this.sortElement&&(e?this.sortElement.direction!==e&&this.sortElement.setAttribute("direction",e):this.sortElement.removeAttribute("direction")),this._set("direction",e))}},{key:"label",get:function(){return p.renderingSanitizer.sanitize(this.header??this.path??"")}}]),o}(r.HandleOwnerMixin(o.EventedAccessor));t.__decorate([i.property()],_.prototype,"activeRowIndex",void 0),t.__decorate([i.property()],_.prototype,"autoWidth",void 0),t.__decorate([i.property()],_.prototype,"cellValueFormatFunction",void 0),t.__decorate([i.property()],_.prototype,"direction",null),t.__decorate([i.property()],_.prototype,"flexGrow",void 0),t.__decorate([i.property()],_.prototype,"footerRenderFunction",void 0),t.__decorate([i.property()],_.prototype,"frozen",void 0),t.__decorate([i.property()],_.prototype,"grid",void 0),t.__decorate([i.property()],_.prototype,"header",void 0),t.__decorate([i.property()],_.prototype,"headerRenderFunction",void 0),t.__decorate([i.property()],_.prototype,"headerMenuRenderFunction",void 0),t.__decorate([i.property()],_.prototype,"headerSorterRenderFunction",void 0),t.__decorate([i.property()],_.prototype,"hidden",void 0),t.__decorate([i.property()],_.prototype,"headerMenuEnabled",void 0),t.__decorate([i.property({constructOnly:!0})],_.prototype,"initialSortPriority",void 0),t.__decorate([i.property({readOnly:!0})],_.prototype,"label",null),t.__decorate([i.property()],_.prototype,"menu",void 0),t.__decorate([i.property()],_.prototype,"menuConfig",void 0),t.__decorate([i.property()],_.prototype,"messages",void 0),t.__decorate([i.property()],_.prototype,"messagesCommon",void 0),t.__decorate([i.property()],_.prototype,"messagesURIUtils",void 0),t.__decorate([i.property()],_.prototype,"path",void 0),t.__decorate([i.property()],_.prototype,"renderFunction",void 0),t.__decorate([i.property()],_.prototype,"resizable",void 0),t.__decorate([i.property()],_.prototype,"sortable",void 0),t.__decorate([i.property({readOnly:!0})],_.prototype,"sortElement",void 0),t.__decorate([i.property()],_.prototype,"textAlign",void 0),t.__decorate([i.property()],_.prototype,"width",void 0),_=t.__decorate([c.subclass("esri.widgets.FeatureTable.Grid.Column")],_);return _}));
