/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","./Column","../../support/uriUtils"],(function(t,e,o,n,i,r,a,u,l,c){"use strict";const s="esri-editor-column__cell-input",p={input:s,inputContainer:`${s}--container`},d={showInput:"Enter",hideInput:"Escape"};let m=function(e){function n(n){var i;return(i=e.call(this,n)||this).activeEditInfo=null,i.cellValueValidatorFunction=({oldValue:t,value:e})=>t!==e,i.editable=!1,i.inputRenderFunction=({root:t,column:e,rowData:o})=>{if(i.activeEditInfo?.updating)return;if(!i.editable)return;const n=i.getCellValue(e,o),r=i.createInputElement({root:t,column:e,rowData:o,value:n});i._set("activeEditInfo",{column:e,input:r,root:t,rowData:o,updating:!0,oldValue:n});const a=i.createInputContainer();a.appendChild(r),i.removeCellContent(t),t.appendChild(a),r.focus(),r instanceof HTMLInputElement&&r.select(),i.grid?.notifyResize()},i.loadingMessage="",i.inputType="text",i.maxLength=null,i.parseInputValueFunction=({input:t})=>t.value,i.renderFunction=e=>{const{root:o,column:n,rowData:r}=e,{activeEditInfo:a}=t._assertThisInitialized(i);if(a&&a.updating)return;const u=i.getCellValue(n,r),l=i.cellValueFormatFunction({column:n,rowData:r,value:u});o.onclick=()=>o.focus(),o.ondblclick=()=>i.inputRenderFunction(e),o.ontouchend=()=>i.inputRenderFunction(e);const s=i.grid?.getSlotElementByName(o.slot),p=s?.parentElement;p&&!p.onkeydown&&(p.onkeydown=t=>{t.key!==d.showInput||i.activeEditInfo||i.inputRenderFunction(e),t.key===d.hideInput&&i.activeEditInfo&&i.cancel()}),null!=u&&null!=l?o.title=l.toString():o.title&&o.removeAttribute("title");const m=c.autoLink(i.messagesURIUtils,l);l?.toString()!==o.innerHTML&&m!==o.innerHTML&&(o.innerHTML=m)},i.required=!1,i.store=null,i.updateRowItemFunction=({rowData:t,column:e,value:n})=>{o.assertIsSome(t),t.item[e.path]=n},i.updateStoreItemFunction=async({rowData:t,column:e,value:n})=>{o.assertIsSome(t),await(i.store?.updateItem({index:t.index,name:e.path,value:n}))},i}t._inherits(n,e);var i=n.prototype;return i.cancel=function(){const{activeEditInfo:t}=this;if(!t)return;const{column:e,root:o,rowData:n,oldValue:i}=t;this._set("activeEditInfo",null);const r=this.cellValueFormatFunction({column:e,rowData:n,value:i}),a=c.autoLink(this.messagesURIUtils,r);o.innerHTML=a,this.grid?.notifyResize()},i.createInputContainer=function(){const t=document.createElement("div");return t.classList.add(p.inputContainer),t},i.createInputElement=function({value:t}){const e=document.createElement("input");return e.classList.add(p.input),null!=this.maxLength&&(e.maxLength=this.maxLength),e.type=this.inputType,e.value=t,e.onblur=()=>{e.onblur=null,this.submit()},e},i.submit=async function(){const{activeEditInfo:t}=this;if(!t)return;const{column:e,input:o,root:n,rowData:i,oldValue:r}=t,a=this.parseInputValueFunction({input:o,column:e,rowData:i});if(!this.cellValueValidatorFunction({value:a,oldValue:r,column:e,rowData:i}))this.cancel();else{n.innerHTML=this.loadingMessage,this.grid?.notifyResize();try{await this.updateStoreItemFunction({rowData:i,column:e,value:a}),this.updateRowItemFunction({rowData:i,column:e,value:a});const t=this.getCellValue(e,i),o=this.cellValueFormatFunction({column:e,rowData:i,value:t});null!=t&&null!=o?n.title=o.toString():n.title&&n.removeAttribute("title");const r=c.autoLink(this.messagesURIUtils,o);n.innerHTML=r,this.emit("value-change",{column:e,rowData:i,value:t}),this._set("activeEditInfo",null),this.grid?.notifyResize()}catch(u){this.cancel()}}},t._createClass(n)}(l);e.__decorate([n.property({readOnly:!0})],m.prototype,"activeEditInfo",void 0),e.__decorate([n.property()],m.prototype,"cellValueValidatorFunction",void 0),e.__decorate([n.property()],m.prototype,"editable",void 0),e.__decorate([n.property()],m.prototype,"inputRenderFunction",void 0),e.__decorate([n.property({constructOnly:!0})],m.prototype,"loadingMessage",void 0),e.__decorate([n.property()],m.prototype,"inputType",void 0),e.__decorate([n.property()],m.prototype,"maxLength",void 0),e.__decorate([n.property()],m.prototype,"parseInputValueFunction",void 0),e.__decorate([n.property()],m.prototype,"renderFunction",void 0),e.__decorate([n.property()],m.prototype,"required",void 0),e.__decorate([n.property()],m.prototype,"store",void 0),e.__decorate([n.property()],m.prototype,"updateRowItemFunction",void 0),e.__decorate([n.property()],m.prototype,"updateStoreItemFunction",void 0),m=e.__decorate([u.subclass("esri.widgets.FeatureTable.Grid.EditorColumn")],m);return m}));
