/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["require","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/arrayUtils","../../core/maybe","../../core/uid","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/accessorSupport/decorators/subclass","../Widget","./componentsUtils","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SnappingControls/SnappingControlsViewModel"],(function(e,t,i,l,n,s,a,r,o,c,d,p,u,g,h,y){"use strict";const _={header:!0,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0,layerListToggleLayersButton:!0},b="esri-snapping-controls",w={base:b,container:`${b}__container`,panel:`${b}__panel`,item:`${b}__item`,toggleBlock:`${b}__toggle-block`,layerListBlock:`${b}__layer-list-block`,layerList:`${b}__layer-list`,layerListFilter:`${b}__layer-list__filter`,layerListButton:`${b}__layer-list__button`,layerListItem:`${b}__layer-list__item`,layerListGroup:`${b}__layer-list__group`,nestedContainer:`${b}__nested-container`,disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"},m={checked:"check-square-f",unchecked:"square",indeterminate:"minus-square"};let L=function(i){function a(e,t){var l;return(l=i.call(this,(()=>{const{view:t,viewModel:i,snappingOptions:l,...n}=e;return n})(),t)||this)._defaultViewModel=null,l._layerListFilter=null,l.iconClass=w.widgetIcon,l.icon=null,l.layerListOpen=!0,l.messages=null,l.visibleElements={..._},l._onToggleLayersButtonClick=e=>{l.viewModel.toggleSnappingForAllLayers(!l.viewModel.allLayersEnabled),requestAnimationFrame((()=>e.target.setFocus()))},e?.viewModel?l.viewModel=e.viewModel:(l._defaultViewModel=new y({snappingOptions:e.snappingOptions,view:e.view}),l.viewModel=l._defaultViewModel),l}t._inherits(a,i);var r=a.prototype;return r.destroy=function(){this._defaultViewModel=n.destroyMaybe(this._defaultViewModel)},r.loadDependencies=function(){return p.loadCalciteComponents({accordion:()=>new Promise(((t,i)=>e(["../../chunks/calcite-accordion"],t,i))),"accordion-item":()=>new Promise(((t,i)=>e(["../../chunks/calcite-accordion-item"],t,i))),action:()=>new Promise(((t,i)=>e(["../../chunks/calcite-action"],t,i))),block:()=>new Promise(((t,i)=>e(["../../chunks/calcite-block"],t,i))),button:()=>new Promise(((t,i)=>e(["../../chunks/calcite-button"],t,i))),icon:()=>new Promise(((t,i)=>e(["../../chunks/calcite-icon"],t,i))),input:()=>new Promise(((t,i)=>e(["../../chunks/calcite-input"],t,i))),label:()=>new Promise(((t,i)=>e(["../../chunks/calcite-label"],t,i))),list:()=>new Promise(((t,i)=>e(["../../chunks/calcite-list"],t,i))),"list-item":()=>new Promise(((t,i)=>e(["../../chunks/calcite-list-item"],t,i))),panel:()=>new Promise(((t,i)=>e(["../../chunks/calcite-panel"],t,i))),switch:()=>new Promise(((t,i)=>e(["../../chunks/calcite-switch"],t,i)))})},r.castVisibleElements=function(e){return{..._,...e}},r.render=function(){const{label:e,visibleElements:{header:t}}=this;return h.tsx("div",{"aria-label":e,class:this.classes(w.base,w.esriWidget)},h.tsx("div",{class:w.container},t?this._renderHeaderView():this._renderContent()))},r._renderHeaderView=function(){return h.tsx("calcite-panel",{heading:this.label,class:w.panel},this._renderContent())},r._renderContent=function(){return[this._renderToggles(),this._renderLayerList()]},r._renderToggles=function(){const{visibleElements:{enabledToggle:e,selfEnabledToggle:t,featureEnabledToggle:i}}=this;return e||t||i?h.tsx("calcite-block",{class:w.toggleBlock,key:"toggle-block",heading:"",open:!0},this._renderEnabledToggle(),h.tsx("div",{class:w.nestedContainer},this._renderSelfEnabledToggle(),this._renderFeatureEnabledToggle())):null},r._renderEnabledToggle=function(){if(!this.visibleElements.enabledToggle)return null;const{messages:{enableSnapping:e},viewModel:{snappingOptions:{enabled:t,enabledToggled:i}}}=this;return h.tsx("calcite-label",{layout:"inline-space-between"},e,h.tsx("calcite-switch",{checked:t,disabled:i,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))},r._renderSelfEnabledToggle=function(){if(!this.visibleElements.selfEnabledToggle)return null;const{messages:{geometryGuides:e},viewModel:{snappingOptions:{enabled:t,selfEnabled:i,enabledToggled:l}}}=this;return h.tsx("calcite-label",{layout:"inline-space-between",key:"self-enabled-toggle"},e,h.tsx("calcite-switch",{checked:i,disabled:l||!t,bind:this,onCalciteSwitchChange:this._selfEnabledSwitchChange}))},r._renderFeatureEnabledToggle=function(){if(!this.visibleElements.featureEnabledToggle)return null;const{messages:{featureToFeature:e},viewModel:{snappingOptions:{enabled:t,featureEnabled:i,enabledToggled:l}}}=this;return h.tsx("calcite-label",{layout:"inline-space-between",key:"feature-enabled-toggle"},e,h.tsx("calcite-switch",{checked:i,disabled:l||!t,bind:this,onCalciteSwitchChange:this._featureEnabledSwitchChange}))},r._renderLayerList=function(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,{snappingOptions:{enabled:i,enabledToggled:l}}=t,n=({target:{value:e}})=>this._layerListFilter=""===e?null:new RegExp(e,"i"),s=t.layerListViewModel.operationalItems.length>9?h.tsx("calcite-input",{class:w.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:n}):null,a=l||!i,r=this.layerListOpen&&!a;return h.tsx("calcite-block",{key:"list-block",heading:e.snappingLayers,disabled:a,class:w.layerListBlock,collapsible:!0,open:r,onCalciteBlockToggle:e=>this.layerListOpen=e.target.open},s,this._renderToggleLayersButton(),h.tsx("calcite-list",{class:w.layerList},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems,this._layerListFilter)))},r._renderLayerListItemCollection=function(e,t){return e.map((e=>{if(!t||this._itemTitleMatchesFilter(e,t))return e.children.length>0?this._renderLayerListItemGroup(e):this._renderLayerListItem(e);const i=e.children.filter((e=>this._itemTitleMatchesFilter(e,t)));return i.length>0?this._renderLayerListItemGroup(e,i):null})).toArray().filter(l.isSome)},r._renderToggleLayersButton=function(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return h.tsx("calcite-button",{appearance:"transparent",class:w.layerListButton,label:i,name:"layer-toggle",scale:"m",onclick:this._onToggleLayersButtonClick},i)},r._renderLayerListItem=function(e){const{messages:{untitledLayer:t}}=this,i=e.title||t,l=e.enabled,n=()=>{this._handleLayerListItemChange({checked:!l,value:e.layer.id})};return h.tsx("calcite-list-item",{class:w.layerListItem,label:i,key:`${this.id}-list-item-${e.uid}`,onCalciteListItemSelect:n},h.tsx("calcite-icon",{icon:l?m.checked:m.unchecked,slot:"content-start",scale:"s"}))},r._renderLayerListItemGroup=function(e,t){const{allChildrenEnabled:i,children:l,hasChildrenEnabled:n,title:a}=e,r=this.messages,o=a||r.untitledLayer,c=a&&""!==a?a:s.generateUID(),d=!!t,p=t??l,u=i?m.checked:n?m.indeterminate:m.unchecked,g=i?r.disableAllLayers:r.enableAllLayers,y=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,!i)};return h.tsx("calcite-list-item",{class:w.layerListItem,key:c},h.tsx("calcite-accordion",{class:w.layerListGroup,appearance:"transparent"},h.tsx("calcite-accordion-item",{expanded:d,heading:o,key:e.uid},h.tsx("calcite-action",{scale:"m",slot:"actions-start",text:g,textEnabled:!1,onclick:y},h.tsx("calcite-icon",{icon:u,scale:"s"})),h.tsx("calcite-list",null,[...this._renderLayerListItemCollection(p)]))))},r._enableSnappingSwitchChange=function(e){this.snappingOptions.enabled=e.target.checked},r._featureEnabledSwitchChange=function(e){this.snappingOptions.featureEnabled=e.target.checked},r._itemTitleMatchesFilter=function(e,t){return null!=t&&t.test(e.title)},r._selfEnabledSwitchChange=function(e){this.snappingOptions.selfEnabled=e.target.checked},r._handleLayerListItemChange=async function(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)},t._createClass(a,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"snappingOptions",get:function(){return this.viewModel.snappingOptions},set:function(e){this.viewModel.snappingOptions=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"viewModel",set:function(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=n.destroyMaybe(this._defaultViewModel)),this._set("viewModel",e))}}]),a}(d);i.__decorate([a.property()],L.prototype,"_defaultViewModel",void 0),i.__decorate([a.property()],L.prototype,"_layerListFilter",void 0),i.__decorate([a.property()],L.prototype,"iconClass",void 0),i.__decorate([a.property()],L.prototype,"icon",void 0),i.__decorate([a.property()],L.prototype,"label",null),i.__decorate([a.property()],L.prototype,"layerListOpen",void 0),i.__decorate([a.property(),g.messageBundle("esri/widgets/support/SnappingControls/t9n/SnappingControls")],L.prototype,"messages",void 0),i.__decorate([a.property()],L.prototype,"snappingOptions",null),i.__decorate([a.property()],L.prototype,"view",null),i.__decorate([a.property()],L.prototype,"viewModel",null),i.__decorate([a.property()],L.prototype,"visibleElements",void 0),i.__decorate([r.cast("visibleElements")],L.prototype,"castVisibleElements",null),L=i.__decorate([c.subclass("esri.widgets.support.SnappingControls")],L);return L}));
