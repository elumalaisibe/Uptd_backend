/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../symbols","../../../core/Collection","../../../core/Evented","../../../core/Handles","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../../layers/GraphicsLayer","../../Sketch/SketchViewModel","./selectorUtils","../../../symbols/SimpleFillSymbol","../../../symbols/SimpleLineSymbol","../../../symbols/SimpleMarkerSymbol"],(function(e,t,o,i,s,n,l,r,c,a,d,p,y,h,_,m,u,v){"use strict";let S=function(t){function o({candidates:o,options:s,view:l}){var r;(r=t.call(this)||this)._activeOptions=null,r._dashedFillSymbol=new m({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),r._dashedLineSymbol=new u({style:"dash",color:[12,207,255],width:2}),r._defaultOptions={createTool:"rectangle",createOptions:void 0,selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},r._completed=!1,r._handles=new n,r._sketchViewModel=new h,r._sketchGraphicsLayer=new y({listMode:"hide",internal:!0}),r._transparentPointSymbol=new v({color:[0,0,0,0],outline:{style:"none",width:0}}),r.candidates=null,r.geometry=null,r.options=null,r.selection=new i,r.view=null,r.candidates=o,r.options=s,r.view=l;const{_dashedFillSymbol:c,_dashedLineSymbol:a,_sketchViewModel:d,_sketchGraphicsLayer:p,_transparentPointSymbol:_}=e._assertThisInitialized(r);return d.set({layer:p,view:r.view,activePointSymbol:_,activeLineSymbol:a,activeVertexSymbol:_,activeFillSymbol:c,pointSymbol:_,polygonSymbol:c,polylineSymbol:a,vertexSymbol:_}),r._handles.add([d.on("create",(e=>r._onSketchEvent(e))),d.on(["undo","redo"],(e=>r._onSketchEvent(e)))]),r}e._inherits(o,t);var s=o.prototype;return s.initialize=function(){this._load()},s.destroy=function(){this._handles=l.destroyMaybe(this._handles)},s.cancel=function(){return this._sketchViewModel.cancel()},s._load=async function(){await(this.view?.whenReady());const{options:e}=this,{createTool:t,createOptions:o}=this._activeOptions={...this._defaultOptions,...e};this._sketchViewModel.create(t,o)},s._onSketchEvent=function(e){const t="create"===e.type?e.graphic:e.graphics[0],o=t?.geometry||null,i="create"===e.type&&"cancel"===e.state,s="create"===e.type&&"complete"===e.state;this._processSelectionGeometry(o,s,i)},s._processSelectionGeometry=function(e,t,o){if(this._set("geometry",e),(t||o)&&(this._completed=!0),o)return void this._onComplete([],!0);const{_activeOptions:i,candidates:s,selection:n,view:l}=this;_.updateSelection({selector:e,candidates:s,currentSelection:n,options:i.selectionOptions,view:l}).then((({added:e,removed:o})=>{t?this._onComplete(this.selection.toArray(),!1):(e.length||o.length)&&this.emit("selection-change",{added:e,removed:o,type:"selection-change"})}))},s._onComplete=function(e,t){this._handles.removeAll(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})},e._createClass(o,[{key:"state",get:function(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":"active"===t?"active":"disabled"}}]),o}(s.EventedAccessor);t.__decorate([r.property()],S.prototype,"_completed",void 0),t.__decorate([r.property()],S.prototype,"candidates",void 0),t.__decorate([r.property({readOnly:!0})],S.prototype,"geometry",void 0),t.__decorate([r.property()],S.prototype,"options",void 0),t.__decorate([r.property({readOnly:!0})],S.prototype,"selection",void 0),t.__decorate([r.property({readOnly:!0})],S.prototype,"state",null),t.__decorate([r.property({value:null})],S.prototype,"view",void 0),S=t.__decorate([p.subclass("esri.widgets.support.Selector2D.SelectionOperation2D")],S);return S}));
