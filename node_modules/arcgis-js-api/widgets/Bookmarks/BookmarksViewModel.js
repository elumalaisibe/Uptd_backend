/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Viewpoint","../../core/Collection","../../core/deprecate","../../core/Error","../../core/Evented","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../webdoc/support/SlideThumbnail","../../webmap/Bookmark","../support/GoTo"],(function(t,e,o,i,a,r,n,c,s,p,l,u,d,k,m,w){"use strict";const h=i.ofType(m),b={width:128,height:128,format:"png"},v={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0,captureTimeExtent:!0},y={time:!0},f="esri.widgets.Bookmarks.BookmarksViewModel",_=c.getLogger(f);let g=function(e){function i(t){var o;return(o=e.call(this,t)||this).capabilities={...y},o.activeBookmark=null,o.view=null,o}t._inherits(i,e);var n=i.prototype;return n.destroy=function(){this.view=null,this._set("activeBookmark",null)},n.castAbilities=function(t){return{...y,...t}},n.castCapabilities=function(t){return{...y,...t}},n.createBookmark=async function(t){const{view:e,defaultCreateOptions:o,capabilities:i}=this;if(!e)throw new r("create-bookmark:invalid-view","Cannot create a bookmark without a view.");const{takeScreenshot:a,screenshotSettings:n,captureViewpoint:c,captureRotation:s,captureScale:p,captureTimeExtent:l}={...o,...t},u=a?await this._createThumbnail(n):void 0,d=i.time&&l&&null!=e.timeExtent?e.timeExtent.clone():void 0;return new m({...u&&{thumbnail:u},...l&&{timeExtent:d},...c&&{viewpoint:this._createViewpoint({view:e,captureScale:p,captureRotation:s})}})},n.editBookmark=async function(t,e){if(!t)return t;const{view:o,defaultEditOptions:i}=this;if(!o)throw new r("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");const{takeScreenshot:a,screenshotSettings:n,captureViewpoint:c,captureRotation:s,captureScale:p,captureTimeExtent:l}={...i,...e},u=a?await this._createThumbnail(n):void 0;return u&&(t.thumbnail=u),c&&(t.viewpoint=this._createViewpoint({view:o,captureScale:p,captureRotation:s})),l&&null!=o.timeExtent&&(t.timeExtent=o.timeExtent.clone()),this.emit("bookmark-edit",{bookmark:t}),t},n.goTo=function(t){const{capabilities:e,view:o}=this;if(!o)throw new r("go-to:invalid-view","Cannot go to a bookmark without a view");const i=t?.viewpoint;if(!i)throw new r("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:t});this._set("activeBookmark",t);const a={target:i},n=this.callGoTo(a),c=t?.timeExtent;return e.time&&c&&(o.timeExtent=c),this.emit("bookmark-select",{bookmark:t}),n.catch((()=>{})).then((()=>this._set("activeBookmark",null))),n},n._createThumbnail=async function(t){const{view:e}=this;if(!e)throw new r("bookmark:invalid-view","Cannot create slide thumbnail without a view");const o=await e.takeScreenshot({...b,...t});return new k.SlideThumbnail({url:o.dataUrl})},n._createViewpoint=function({view:t,captureRotation:e,captureScale:i}){const a=t.viewpoint?.clone();return new o({targetGeometry:t.extent?.clone(),rotation:(e?a?.rotation:null)??0,scale:(i?a?.scale:null)??0})},t._createClass(i,[{key:"abilities",get:function(){return a.deprecatedProperty(_,"abilities",{replacement:"capabilities",version:"4.27"}),this.capabilities},set:function(t){a.deprecatedProperty(_,"abilities",{replacement:"capabilities",version:"4.27"}),this.capabilities=t}},{key:"bookmarks",get:function(){return this.view?.map?.bookmarks??new h},set:function(t){this._overrideIfSome("bookmarks",t)}},{key:"defaultCreateOptions",get:function(){return v},set:function(t){this._set("defaultCreateOptions",{...v,...t})}},{key:"defaultEditOptions",get:function(){return v},set:function(t){this._set("defaultEditOptions",{...v,...t})}},{key:"state",get:function(){const t=this.get("view");return t&&!t.ready?"loading":"ready"}}]),i}(w.GoToMixin(n.EventedAccessor));e.__decorate([s.property()],g.prototype,"abilities",null),e.__decorate([p.cast("abilities")],g.prototype,"castAbilities",null),e.__decorate([s.property()],g.prototype,"capabilities",void 0),e.__decorate([p.cast("capabilities")],g.prototype,"castCapabilities",null),e.__decorate([s.property({readOnly:!0})],g.prototype,"activeBookmark",void 0),e.__decorate([s.property({type:h})],g.prototype,"bookmarks",null),e.__decorate([s.property()],g.prototype,"defaultCreateOptions",null),e.__decorate([s.property()],g.prototype,"defaultEditOptions",null),e.__decorate([s.property({readOnly:!0})],g.prototype,"state",null),e.__decorate([s.property()],g.prototype,"view",void 0),g=e.__decorate([d.subclass(f)],g);return g}));
