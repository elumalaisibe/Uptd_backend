/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Accessor","../../core/asyncUtils","../../core/Handles","../../core/handleUtils","../../core/maybe","../../core/reactiveUtils","../../core/screenUtils","../../core/throttle","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass"],(function(e,t,o,a,i,r,n,d,s,c,l,h,u,p,w,_){"use strict";var T;!function(e){e.PointerMove="pointer-move",e.Main="main"}(T||(T={}));const m=300;e.ShadowTooltipViewModel=function(e){function o(t){var o;return(o=e.call(this,t)||this)._handles=new r,o._screenPoint=null,o._accumulatedShadowTime=null,o._shadowTimeTask=null,o._updateAccumulatedShadowTime=(e,t)=>{o._shadowTimeTask=d.abortMaybe(o._shadowTimeTask),o._shadowTimeTask=i.createTask((async a=>{const{results:i,ground:r}=await e.hitTest(t);if(0===i.length&&!r.mapPoint)return void(o._accumulatedShadowTime=null);const n=await o.getDuration(t,a);o._accumulatedShadowTime=n}))},o._throttledUpdateAccumulatedShadowTime=l.throttle(o._updateAccumulatedShadowTime,m),o}t._inherits(o,e);var a=o.prototype;return a.initialize=function(){this._handles.add(s.watch((()=>({enabled:this.enabled,view:this.view})),(({enabled:e,view:t})=>{e&&null!=t?this._startTracking(t):this._stopTracking()}),s.syncAndInitial))},a.destroy=function(){this._handles=d.destroyMaybe(this._handles)},a._startTracking=function(e){const t=this._handles;if(t.has(T.Main))return;const o=()=>{t.has(T.PointerMove)||t.add(e.on("pointer-move",(t=>{const o=c.createScreenPoint(t.x,t.y);this._screenPoint=o,this._throttledUpdateAccumulatedShadowTime(e,o)})),T.PointerMove)},a=()=>{t.remove(T.PointerMove),this._screenPoint=null,this._accumulatedShadowTime=null};t.add([this._throttledUpdateAccumulatedShadowTime,e.on("pointer-enter",o),e.on("pointer-leave",a),e.on("pointer-down",a),e.on("pointer-drag",a),e.on("pointer-up",o),e.on("click",(t=>{const o=c.createScreenPoint(t.x,t.y);this._screenPoint=o,this._updateAccumulatedShadowTime(e,o)})),n.makeHandle((()=>{this._shadowTimeTask=d.abortMaybe(this._shadowTimeTask)}))],T.Main),o()},a._stopTracking=function(){this._handles.remove(T.Main)},t._createClass(o,[{key:"screenPoint",get:function(){return this.enabled?this._screenPoint:null}},{key:"accumulatedShadowTime",get:function(){return this.enabled?this._accumulatedShadowTime:null}},{key:"testData",get:function(){return{setThrottleDelay:e=>{this._throttledUpdateAccumulatedShadowTime.remove(),this._throttledUpdateAccumulatedShadowTime=l.throttle(this._updateAccumulatedShadowTime,e)}}}}]),o}(a),o.__decorate([h.property()],e.ShadowTooltipViewModel.prototype,"getDuration",void 0),o.__decorate([h.property()],e.ShadowTooltipViewModel.prototype,"view",void 0),o.__decorate([h.property()],e.ShadowTooltipViewModel.prototype,"enabled",void 0),o.__decorate([h.property()],e.ShadowTooltipViewModel.prototype,"screenPoint",null),o.__decorate([h.property()],e.ShadowTooltipViewModel.prototype,"accumulatedShadowTime",null),o.__decorate([h.property()],e.ShadowTooltipViewModel.prototype,"_screenPoint",void 0),o.__decorate([h.property()],e.ShadowTooltipViewModel.prototype,"_accumulatedShadowTime",void 0),o.__decorate([h.property()],e.ShadowTooltipViewModel.prototype,"_shadowTimeTask",void 0),e.ShadowTooltipViewModel=o.__decorate([_.subclass("esri.widgets.ShadowCast.ShadowTooltipViewModel")],e.ShadowTooltipViewModel),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
