/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./Widget","./Histogram/HistogramViewModel","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/substitute"],(function(e,t,n,i,r,a,s,o,l,d,u,c,h,p){"use strict";var g;const _="esri-histogram",b={base:_,horizontalLayout:`${_}--horizontal`,verticalLayout:`${_}--vertical`,content:`${_}__content`,svg:`${_}__svg`,bar:`${_}__bar`,bars:`${_}__bars`,label:`${_}__label`,dataLines:`${_}__data-lines`,dataLinesSubgroup:`${_}__data-lines-subgroup`,dataLine:`${_}__data-line`,averageLabel:`${_}__average-label`,averageDataLine:`${_}__average-data-line`,averageSymbol:`${_}__average-symbol`,esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let f=g=function(t){function n(e,n){var i;return(i=t.call(this,e,n)||this)._bgFillId=`${i.id}-bg-fill`,i._containerNode=null,i._containerDimensions={width:0,height:0},i._defaultBarColor="#d8d8d8",i.barCreatedFunction=null,i.dataLines=null,i.dataLineCreatedFunction=null,i.dataLineUpdatedFunction=null,i.messages=null,i.viewModel=new d,i}e._inherits(n,t),n.fromHistogramResult=function(e){const{bins:t,maxValue:n,minValue:i}=e;return new g({bins:t,max:n,min:i})};var i=n.prototype;return i.render=function(){const{label:e,layout:t,state:n}=this,i=this.classes(b.base,b.esriWidget,"horizontal"===t?b.horizontalLayout:b.verticalLayout,"disabled"===n?b.disabled:null);return h.tsx("div",{"aria-label":e,class:i,bind:this,afterCreate:this._afterContainerNodeCreate},"ready"===n?this.renderContent():null)},i.renderContent=function(){if(!this._containerNode)return;const e=this._bgFillId,t=`clip-path: url(#${e})`;return h.tsx("div",{class:b.content},h.tsx("svg",{class:b.svg,xmlns:"http://www.w3.org/2000/svg"},h.tsx("defs",null,this.renderFillDefinition(e)),h.tsx("g",{style:t},this.renderBarsGroup()),this.renderLinesGroup()))},i.renderBarsGroup=function(){return h.tsx("g",{class:this.classes(b.bars)},this.renderBars())},i.renderBars=function(){const{layout:e,viewModel:{binRange:t,range:n}}=this;if(!t||!n)return;const i=t/n,{width:r,height:a}=this._containerDimensions;if(0===a&&0===r)return;if(0===a&&0!==r)return void this.scheduleRender();const[s,o]="vertical"===e?[a*i,r]:[a,r*i];return this._getBarDimensions(s,o).map((([e,t],n)=>this.renderBar(n,e,t)))},i.renderBar=function(e,t,n){const{bins:i,layout:r,max:a,messages:s,viewModel:{range:o}}=this;if(!i||null==a)return;const{width:l,height:d}=this._containerDimensions,u=i.slice()[e],{count:c,maxValue:g,minValue:_}=u,f=a-g,[y,m]="vertical"===r?[0,f*(d/o)]:[l-n-f*(l/o),d-t],v=p.substitute(s.barLabel,{count:c,maxValue:g,minValue:_});return h.tsx("rect",{"aria-label":v,afterCreate:this._afterBarCreate,bind:this,class:b.bar,"data-index":e,fill:this._defaultBarColor,height:t,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:n,x:y,y:m})},i.renderLinesGroup=function(){return h.tsx("g",{class:this.classes(b.dataLines)},this.renderAverageLine(),this.renderCustomLines())},i.renderAverageLine=function(){const{average:e}=this;if(null==e)return;const t=[h.tsx("tspan",{class:this.classes(b.averageSymbol)},"xÌ„ "),h.tsx("tspan",{class:this.classes(b.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return h.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(b.dataLinesSubgroup)},h.tsx("title",{key:"title"},e),this.renderLine(e,this.classes(b.averageDataLine)),this.renderLabel({label:t,value:e}))},i.renderCustomLines=function(){if(this.dataLines&&this.dataLines.length)return this.dataLines.map(((e,t)=>this.renderLineSubgroup(e,t)))},i.renderLineSubgroup=function(e,t){const{value:n}=e;return h.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(b.dataLinesSubgroup),"data-index":t},h.tsx("title",{key:"title"},n),this.renderLine(n),this.renderLabel(e))},i.renderLine=function(e,t){const[n,i,r,a]=this._getLinePosition(e);return h.tsx("line",{class:this.classes(b.dataLine,t),x1:n,x2:i,y1:r,y2:a,"shape-rendering":"crispEdges"})},i.renderLabel=function(e,t){const{label:n,value:i}=e,[r,a]=this._getLabelPosition(i),s=2;return h.tsx("text",{class:this.classes(b.label,t),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:r,y:a-s},n??"")},i.renderFillDefinition=function(e){const{width:t,height:n}=this._containerDimensions;return h.tsx("clipPath",{id:e},h.tsx("rect",{x:"0",y:"0",width:t,height:n}))},i._afterContainerNodeCreate=function(e){this._containerNode=e,this.addHandles(u.onResize(e,(e=>{const{width:t,height:n}=e.contentRect;this._containerDimensions={width:t,height:n}})))},i._getIndexFromElement=function(e){const t=e.dataset?.index,n=e.getAttribute("data-index");return null!=t?parseInt(t,10):null!=n?parseInt(n,10):null},i._afterBarCreate=function(e){if(this.barCreatedFunction){const t=this._getIndexFromElement(e)??-1;this.barCreatedFunction(t,e)}},i._afterLinesSubgroupCreate=function(e){if(this.dataLineCreatedFunction){const t=this._getIndexFromElement(e),n=e.childNodes[1],i=e.childNodes[2]?e.childNodes[2]:null;this.dataLineCreatedFunction(n,i,t)}},i._afterLinesSubgroupUpdate=function(e){if(this.dataLineUpdatedFunction){const t=this._getIndexFromElement(e),n=e.childNodes[1],i=e.childNodes[2]?e.childNodes[2]:null;this.dataLineUpdatedFunction(n,i,t)}},i._getBarDimensions=function(e,t){const{bins:n,layout:i}=this,r=n?n.map((e=>e.count)):[],a=Math.max.apply(Math,r);return r.map((n=>"vertical"===i?[e/r.length,0!==a?n/a*t:0]:[0!==a?n/a*e:0,t/r.length]))},i._getLinePosition=function(e){const{layout:t,min:n,viewModel:{range:i}}=this;if(null==n)return[0,0,0,0];const r=Math.round((e-n)/i*100)/100,{width:a,height:s}=this._containerDimensions,[o,l]=[r*a||1,s-r*s||1];return"vertical"===t?[0,"100%",l,l]:[o,o,"100%",0]},i._getLabelPosition=function(e){const{layout:t,min:n,viewModel:{range:i}}=this;if(null==n)return[0,0];const r=Math.round((e-n)/i*100)/100,{width:a,height:s}=this._containerDimensions;return"vertical"===t?[a,s-r*s]:[0,r*a]},e._createClass(n,[{key:"average",get:function(){return this.viewModel.average},set:function(e){this.viewModel.average=e}},{key:"bins",get:function(){return this.viewModel.bins},set:function(e){this.viewModel.bins=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"labelFormatFunction",get:function(){return this.viewModel.labelFormatFunction},set:function(e){this.viewModel.labelFormatFunction=e}},{key:"layout",set:function(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}},{key:"max",get:function(){return this.viewModel.max},set:function(e){this.viewModel.max=e}},{key:"min",get:function(){return this.viewModel.min},set:function(e){this.viewModel.min=e}},{key:"state",get:function(){return this.viewModel.state}}]),n}(l);t.__decorate([i.property()],f.prototype,"_bgFillId",void 0),t.__decorate([i.property()],f.prototype,"_containerNode",void 0),t.__decorate([i.property()],f.prototype,"_containerDimensions",void 0),t.__decorate([i.property()],f.prototype,"_defaultBarColor",void 0),t.__decorate([i.property()],f.prototype,"average",null),t.__decorate([i.property()],f.prototype,"barCreatedFunction",void 0),t.__decorate([i.property()],f.prototype,"dataLines",void 0),t.__decorate([i.property()],f.prototype,"dataLineCreatedFunction",void 0),t.__decorate([i.property()],f.prototype,"dataLineUpdatedFunction",void 0),t.__decorate([i.property()],f.prototype,"label",null),t.__decorate([i.property()],f.prototype,"labelFormatFunction",null),t.__decorate([i.property({value:"horizontal"})],f.prototype,"layout",null),t.__decorate([i.property()],f.prototype,"max",null),t.__decorate([i.property(),c.messageBundle("esri/widgets/Histogram/t9n/Histogram")],f.prototype,"messages",void 0),t.__decorate([i.property()],f.prototype,"min",null),t.__decorate([i.property({readOnly:!0})],f.prototype,"state",null),t.__decorate([i.property()],f.prototype,"viewModel",void 0),f=g=t.__decorate([o.subclass("esri.widgets.Histogram")],f);return f}));
