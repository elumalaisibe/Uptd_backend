/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/arrayUtils","../../../geometry/projection","../../../geometry/geometryAdapters/json","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils"],(function(e,t,n,s,r,i,o){"use strict";const a=[0,0];function u(e,t){if(!t)return null;if("x"in t){const n={x:0,y:0};return[n.x,n.y]=e(t.x,t.y,a),null!=t.z&&(n.z=t.z),null!=t.m&&(n.m=t.m),n}if("xmin"in t){const n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=e(t.xmin,t.ymin,a),[n.xmax,n.ymax]=e(t.xmax,t.ymax,a),t.hasZ&&(n.zmin=t.zmin,n.zmax=t.zmax,n.hasZ=!0),t.hasM&&(n.mmin=t.mmin,n.mmax=t.mmax,n.hasM=!0),n}return"rings"in t?{rings:l(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:l(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:c(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function l(e,t){const n=[];for(const s of e)n.push(c(s,t));return n}function c(e,t){const n=[];for(const s of e){const e=t(s[0],s[1],[0,0]);n.push(e),s.length>2&&e.push(s[2]),s.length>3&&e.push(s[3])}return n}async function m(e,t){if(!e||!t)return;const r=Array.isArray(e)?e.map((e=>null!=e.geometry?e.geometry.spatialReference:null)).filter(n.isSome):[e];await s.initializeProjection(r.map((e=>({source:e,dest:t}))))}const p=u.bind(null,o.lngLatToXY),h=u.bind(null,o.xyToLngLat);function f(e,t,n,a){if(!e)return e;if(n||(n=t,t=e.spatialReference),!i.isValid(t)||!i.isValid(n)||i.equals(t,n))return e;if(o.canProject(t,n)){const t=i.isWebMercator(n)?p(e):h(e);return t.spatialReference=n,t}return s.projectMany(r.jsonAdapter,[e],t,n,null,a)[0]}const y=new(function(){function e(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}var n=e.prototype;return n.push=async function(e,t,n){if(!e||!e.length||!t||!n||i.equals(t,n))return e;const s={geometries:e,inSpatialReference:t,outSpatialReference:n,resolve:null};return this._jobs.push(s),new Promise((e=>{s.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))},n._process=function(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:n,outSpatialReference:a,resolve:u}=e;o.canProject(n,a)?i.isWebMercator(a)?u(t.map(p)):u(t.map(h)):u(s.projectMany(r.jsonAdapter,t,n,a,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))},t._createClass(e)}());function x(e,t,n){return y.push(e,t,n)}e.checkProjectionSupport=m,e.project=f,e.projectMany=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
