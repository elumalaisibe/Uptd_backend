/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Evented","../../core/lang","../../core/promiseUtils","../../core/Logger","../../core/accessorSupport/ensureType","../../core/Error","../../core/has","../../core/accessorSupport/decorators/subclass"],(function(e,t,d,r,l,s,a,i,n,c,o){"use strict";const u=new r.EventEmitter;function p(e,t,d=!1){const r=s.createResolver();return d=null==t||d,u.emit("apply-edits",{serviceUrl:e,layerId:t,mayReceiveServiceEdits:d,result:r.promise}),r}const b="esri.layers.mixins.EditBusLayer",m=Symbol(b);function F(e){return null!=e&&"object"==typeof e&&m in e}const h=e=>{var r;let s=function(e){function d(...t){var d;return(d=e.call(this,...t)||this)[r]=!0,d.when().then((()=>{d.own([u.on("apply-edits",(e=>{const{serviceUrl:t,layerId:r,mayReceiveServiceEdits:s,result:a}=e,i=t===d.url,n=null!=r&&null!=d.layerId&&r===d.layerId;if(!i||!n&&!s)return;const c=a.then((e=>{if(n&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return d.emit("edits",l.clone(e)),e;const t=e.editedFeatures?.find((({layerId:e})=>e===d.layerId));if(t){const{adds:r,updates:s,deletes:a}=t.editedFeatures,i={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:r?r.map((({attributes:e})=>({objectId:d.objectIdField&&e[d.objectIdField],globalId:d.globalIdField&&e[d.globalIdField]}))):[],deletedFeatures:a?a.map((({attributes:e})=>({objectId:d.objectIdField&&e[d.objectIdField],globalId:d.globalIdField&&e[d.globalIdField]}))):[],updatedFeatures:s?s.map((({current:{attributes:e}})=>({objectId:d.objectIdField&&e[d.objectIdField],globalId:d.globalIdField&&e[d.globalIdField]}))):[],editedFeatures:l.clone(e.editedFeatures),exceededTransferLimit:!1};return d.emit("edits",i),i}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:l.clone(e.editedFeatures),exceededTransferLimit:!1}}));d.emit("apply-edits",{result:c})}))])}),(()=>{})),d}return t._inherits(d,e),t._createClass(d)}(e);return r=m,s=d.__decorate([o.subclass(b)],s),s};e.EditBusLayer=h,e.emitApplyEditsEvent=p,e.isEditBusLayer=F,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
