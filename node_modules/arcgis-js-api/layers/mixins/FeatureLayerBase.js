/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Collection","../../core/lang","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../geometry/Extent","../../geometry/HeightModelInfo","../../geometry/SpatialReference","../support/arcgisLayerUrl","../support/commonProperties","../support/EditFieldsInfo","../support/FeatureIndex","../support/featureLayerUtils","../support/GeometryFieldsInfo","../support/LayerFloorInfo","../support/Relationship","../support/serviceCapabilitiesUtils","../../time/TimeReference"],(function(e,r,t,o,i,p,s,n,a,d,l,c,u,y,_,v,f,g,m,I,h,S,F,b){"use strict";const x=e=>{let n=function(e){function t(){var r;return(r=e.apply(this,arguments)||this).capabilities=null,r.copyright=null,r.dateFieldsTimeReference=null,r.datesInUnknownTimezone=!1,r.displayField=null,r.definitionExpression=null,r.editFieldsInfo=null,r.editingInfo=null,r.elevationInfo=null,r.floorInfo=null,r.fullExtent=null,r.gdbVersion=null,r.geometryFieldsInfo=null,r.geometryType=null,r.hasM=void 0,r.hasZ=void 0,r.heightModelInfo=null,r.historicMoment=null,r.isTable=!1,r.layerId=void 0,r.minScale=0,r.maxScale=0,r.globalIdField=null,r.objectIdField=null,r.preferredTimeReference=null,r.relationships=null,r.sourceJSON=null,r.returnM=void 0,r.returnZ=void 0,r.serviceDefinitionExpression=null,r.serviceItemId=null,r.spatialReference=y.WGS84,r.subtypeField=null,r.trackIdField=null,r.indexes=new(o.ofType(g.FeatureIndex)),r.version=void 0,r}r._inherits(t,e);var s=t.prototype;return s.readCapabilitiesFromService=function(e,r){return F.getFeatureLayerCapabilities(r,this.url)},s.readEditingInfo=function(e,r){const{editingInfo:t}=r;return t?{lastEditDate:null!=t.lastEditDate?new Date(t.lastEditDate):null}:null},s.readIsTableFromService=function(e,r){return"Table"===r.type},s.readMinScale=function(e,r){return r.effectiveMinScale||e||0},s.readMaxScale=function(e,r){return r.effectiveMaxScale||e||0},s.readGlobalIdFieldFromService=function(e,r){return m.readGlobalIdField(r)},s.readObjectIdFieldFromService=function(e,r){return m.readObjectIdField(r)},s.readServiceDefinitionExpression=function(e,r){return r.definitionQuery||r.definitionExpression},s.writeUrl=function(e,r,t,o){_.writeUrlWithLayerId(this,e,null,r,o)},s.readVersion=function(e,r){return m.readVersion(r)},r._createClass(t,[{key:"effectiveCapabilities",get:function(){const e=this.capabilities;if(!e)return null;const r=i.clone(e),{operations:t,editing:o}=r;return this.sourceJSON?.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(t.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(t.supportsAdd=t.supportsDelete=t.supportsEditing=t.supportsQuery=t.supportsUpdate=o.supportsDeleteByOthers=o.supportsGeometryUpdate=o.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&t.supportsEditing&&(t.supportsAdd=t.supportsDelete=t.supportsUpdate=o.supportsGeometryUpdate=!0),r)}},{key:"hasFullEditingRestrictions",get:function(){const e=this.capabilities;if(!e||this.sourceJSON?.isMultiServicesView)return!1;const{operations:r,editing:t}=e;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&t.supportsGeometryUpdate)}},{key:"hasUpdateItemRestrictions",get:function(){const e=this.capabilities;if(!e)return!1;const{operations:r,editing:t}=e;return this.sourceJSON?.isMultiServicesView?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&t.supportsDeleteByOthers&&t.supportsGeometryUpdate&&t.supportsUpdateByOthers)}},{key:"url",set:function(e){const r=_.sanitizeUrlWithLayerId({layer:this,url:e,nonStandardUrlAllowed:!0,logger:p.getLogger(this)});this._set("url",r.url),null!=r.layerId&&this._set("layerId",r.layerId)}}]),t}(e);return t.__decorate([s.property({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],n.prototype,"capabilities",void 0),t.__decorate([a.reader("service","capabilities")],n.prototype,"readCapabilitiesFromService",null),t.__decorate([s.property({readOnly:!0})],n.prototype,"effectiveCapabilities",null),t.__decorate([s.property({readOnly:!0})],n.prototype,"hasFullEditingRestrictions",null),t.__decorate([s.property({readOnly:!0})],n.prototype,"hasUpdateItemRestrictions",null),t.__decorate([s.property({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],n.prototype,"copyright",void 0),t.__decorate([s.property({type:b})],n.prototype,"dateFieldsTimeReference",void 0),t.__decorate([s.property({type:Boolean})],n.prototype,"datesInUnknownTimezone",void 0),t.__decorate([s.property({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],n.prototype,"displayField",void 0),t.__decorate([s.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],n.prototype,"definitionExpression",void 0),t.__decorate([s.property({readOnly:!0,type:f})],n.prototype,"editFieldsInfo",void 0),t.__decorate([s.property({readOnly:!0})],n.prototype,"editingInfo",void 0),t.__decorate([a.reader("editingInfo")],n.prototype,"readEditingInfo",null),t.__decorate([s.property((()=>{const e=i.clone(v.elevationInfo),r=e.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},e})())],n.prototype,"elevationInfo",void 0),t.__decorate([s.property({type:h,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],n.prototype,"floorInfo",void 0),t.__decorate([s.property({type:c,json:{origins:{service:{read:{source:"extent"}}}}})],n.prototype,"fullExtent",void 0),t.__decorate([s.property()],n.prototype,"gdbVersion",void 0),t.__decorate([s.property({readOnly:!0,type:I,json:{read:{source:"geometryProperties"}}})],n.prototype,"geometryFieldsInfo",void 0),t.__decorate([s.property({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:m.geometryTypeKebabDict.read}}}})],n.prototype,"geometryType",void 0),t.__decorate([s.property({type:Boolean,json:{origins:{service:{read:!0}}}})],n.prototype,"hasM",void 0),t.__decorate([s.property({type:Boolean,json:{origins:{service:{read:!0}}}})],n.prototype,"hasZ",void 0),t.__decorate([s.property({readOnly:!0,type:u})],n.prototype,"heightModelInfo",void 0),t.__decorate([s.property({type:Date})],n.prototype,"historicMoment",void 0),t.__decorate([s.property({readOnly:!0})],n.prototype,"isTable",void 0),t.__decorate([a.reader("service","isTable",["type"])],n.prototype,"readIsTableFromService",null),t.__decorate([s.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],n.prototype,"layerId",void 0),t.__decorate([s.property(v.minScale)],n.prototype,"minScale",void 0),t.__decorate([a.reader("service","minScale",["minScale","effectiveMinScale"])],n.prototype,"readMinScale",null),t.__decorate([s.property(v.maxScale)],n.prototype,"maxScale",void 0),t.__decorate([a.reader("service","maxScale",["maxScale","effectiveMaxScale"])],n.prototype,"readMaxScale",null),t.__decorate([s.property({type:String})],n.prototype,"globalIdField",void 0),t.__decorate([a.reader("service","globalIdField",["globalIdField","fields"])],n.prototype,"readGlobalIdFieldFromService",null),t.__decorate([s.property({type:String})],n.prototype,"objectIdField",void 0),t.__decorate([a.reader("service","objectIdField",["objectIdField","fields"])],n.prototype,"readObjectIdFieldFromService",null),t.__decorate([s.property({type:b})],n.prototype,"preferredTimeReference",void 0),t.__decorate([s.property({type:[S],readOnly:!0})],n.prototype,"relationships",void 0),t.__decorate([s.property()],n.prototype,"sourceJSON",void 0),t.__decorate([s.property({type:Boolean})],n.prototype,"returnM",void 0),t.__decorate([s.property({type:Boolean})],n.prototype,"returnZ",void 0),t.__decorate([s.property({readOnly:!0})],n.prototype,"serviceDefinitionExpression",void 0),t.__decorate([a.reader("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],n.prototype,"readServiceDefinitionExpression",null),t.__decorate([s.property({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],n.prototype,"serviceItemId",void 0),t.__decorate([s.property({type:y,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],n.prototype,"spatialReference",void 0),t.__decorate([s.property({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],n.prototype,"subtypeField",void 0),t.__decorate([s.property({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],n.prototype,"trackIdField",void 0),t.__decorate([s.property({readOnly:!0,json:{write:!1}})],n.prototype,"serverGens",void 0),t.__decorate([s.property({type:o.ofType(g.FeatureIndex),readOnly:!0})],n.prototype,"indexes",void 0),t.__decorate([s.property(v.url)],n.prototype,"url",null),t.__decorate([l.writer("url")],n.prototype,"writeUrl",null),t.__decorate([s.property({json:{origins:{service:{read:!0}},read:!1}})],n.prototype,"version",void 0),t.__decorate([a.reader("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],n.prototype,"readVersion",null),n=t.__decorate([d.subclass("esri.layers.mixins.FeatureLayerBase")],n),n};e.FeatureLayerBase=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
