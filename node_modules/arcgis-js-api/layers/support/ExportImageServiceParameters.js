/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./imageryRendererUtils","./MosaicRule","./rasterEnums","./RasterFunction"],(function(e,r,t,o,n,i,a,s,p,c,l,u,m,y){"use strict";e.ExportImageServiceParameters=function(e){function t(){var r;return(r=e.apply(this,arguments)||this).layer=null,r.compression=void 0,r.pixelType=void 0,r.lercVersion=2,r}r._inherits(t,e);var o=t.prototype;return o.writeAdjustAspectRatio=function(e,r,t){this.layer.version<10.3||(r[t]=e)},o.writeCompressionQuality=function(e,r,t){this.format&&this.format.toLowerCase().includes("jpg")&&null!=e&&(r[t]=e)},o.writeCompressionTolerance=function(e,r,t){"lerc"===this.format&&null!=e&&(r[t]=e)},o.writeLercVersion=function(e,r,t){"lerc"===this.format&&this.layer.version>=10.5&&(r[t]=e)},o.combineRendererWithRenderingRule=function(e){const r=this.layer,{rasterInfo:t,renderer:o}=r;if(e=e||r.rasterFunction,!o||!l.isSupportedRendererType(o))return e;return l.combineRenderingRules(l.convertRendererToRenderingRule(o,{rasterAttributeTable:t.attributeTable,pixelType:t.pixelType,dataType:t.dataType,bandNames:t.bandInfos.map((({name:e})=>e)),convertColorRampToColormap:r.version<10.6,convertToRFT:!!e?.rasterFunctionDefinition,bandCount:t.bandCount}),e)},o._addResampleRasterFunction=function(e){if(!("vector-field"===this.layer.renderer?.type)||"Resample"===e?.functionName)return e;const r="esriImageServiceDataTypeVector-UV"===this.layer.serviceDataType?7:10,t=this.layer.serviceRasterInfo.pixelSize;let o=new y({functionName:"Resample",functionArguments:{ResamplingType:r,InputCellSize:t}});return o=e?.rasterFunctionDefinition?new y({rasterFunctionDefinition:l.convertRenderingRuleToRFT(o)}):o,l.combineRenderingRules(o,e)},o._addClipFunction=function(e,r){const t=new y({functionName:"Clip",functionArguments:{ClippingGeometry:r.toJSON(),ClippingType:1}});return l.combineRenderingRules(t,e)},r._createClass(t,[{key:"adjustAspectRatio",get:function(){return this.layer.adjustAspectRatio}},{key:"bandIds",get:function(){return this.layer.bandIds}},{key:"compressionQuality",get:function(){return this.layer.compressionQuality}},{key:"compressionTolerance",get:function(){return this.layer.compressionTolerance}},{key:"format",get:function(){return"vector-field"===this.layer.renderer?.type?"lerc":this.layer.format}},{key:"interpolation",get:function(){return this.layer.interpolation}},{key:"noData",get:function(){return this.layer.noData}},{key:"noDataInterpretation",get:function(){return this.layer.noDataInterpretation}},{key:"version",get:function(){const e=this.layer;return e.commitProperty("bandIds"),e.commitProperty("format"),e.commitProperty("compressionQuality"),e.commitProperty("compressionTolerance"),e.commitProperty("interpolation"),e.commitProperty("noData"),e.commitProperty("noDataInterpretation"),e.commitProperty("mosaicRule"),e.commitProperty("rasterFunction"),e.commitProperty("adjustAspectRatio"),e.commitProperty("pixelFilter"),e.commitProperty("definitionExpression"),e.commitProperty("multidimensionalSubset"),(this._get("version")||0)+1},set:function(e){this._set("version",e)}},{key:"mosaicRule",get:function(){const e=this.layer;let r=e.mosaicRule;const t=e.definitionExpression;return r?t&&t!==r.where&&(r=r.clone(),r.where=t):t&&(r=new u({where:t})),r}},{key:"rasterFunction",get:function(){const e=this.layer;let{rasterFunction:r}=e;const t=e.pixelFilter,o=!e.format||e.format.includes("jpg")||e.format.includes("png");r=this._addResampleRasterFunction(r);const n=e.multidimensionalSubset?.areaOfInterest;return n&&(r=this._addClipFunction(r,n)),o&&!t&&"vector-field"!==e.renderer?.type&&(r=this.combineRendererWithRenderingRule(r)),r}}]),t}(o.JSONSupport),t.__decorate([n.property()],e.ExportImageServiceParameters.prototype,"layer",void 0),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"adjustAspectRatio",null),t.__decorate([c.writer("adjustAspectRatio")],e.ExportImageServiceParameters.prototype,"writeAdjustAspectRatio",null),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"bandIds",null),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"compression",void 0),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"compressionQuality",null),t.__decorate([c.writer("compressionQuality")],e.ExportImageServiceParameters.prototype,"writeCompressionQuality",null),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"compressionTolerance",null),t.__decorate([c.writer("compressionTolerance")],e.ExportImageServiceParameters.prototype,"writeCompressionTolerance",null),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"format",null),t.__decorate([n.property({type:String,json:{read:{reader:m.interpolationKebab.read},write:{writer:m.interpolationKebab.write}}})],e.ExportImageServiceParameters.prototype,"interpolation",null),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"noData",null),t.__decorate([n.property({type:String,json:{read:{reader:m.noDataInterpretationKebab.read},write:{writer:m.noDataInterpretationKebab.write}}})],e.ExportImageServiceParameters.prototype,"noDataInterpretation",null),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"pixelType",void 0),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"lercVersion",void 0),t.__decorate([c.writer("lercVersion")],e.ExportImageServiceParameters.prototype,"writeLercVersion",null),t.__decorate([n.property({type:Number})],e.ExportImageServiceParameters.prototype,"version",null),t.__decorate([n.property({json:{write:!0}})],e.ExportImageServiceParameters.prototype,"mosaicRule",null),t.__decorate([n.property({json:{write:!0,name:"renderingRule"}})],e.ExportImageServiceParameters.prototype,"rasterFunction",null),e.ExportImageServiceParameters=t.__decorate([p.subclass("esri.layers.mixins.ExportImageServiceParameters")],e.ExportImageServiceParameters),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
