/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","./bandIndexUtils","./BaseRasterFunction","./NDVIFunctionArguments"],(function(t,e,n,r,s,i,o,u,a,c){"use strict";let p=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).functionName="NDVI",t.functionArguments=null,t.rasterArgumentNames=["raster"],t}t._inherits(n,e);var r=n.prototype;return r._bindSourceRasters=function(){const{scientificOutput:t,visibleBandID:e,infraredBandID:n}=this.functionArguments;this.outputPixelType=this._getOutputPixelType(t?"f32":"u8");const r=this.sourceRasterInfos[0],s=Math.max(e,n);if(r.bandCount<2||s>=r.bandCount)return{success:!1,supportsGPU:!1,error:"ndvi-function: source raster has insufficient amount of raster bands"};const i=r.clone();i.pixelType=this.outputPixelType,i.colormap=null,i.histograms=null,i.bandCount=1,i.keyProperties={...i.keyProperties,BandProperties:void 0};const[o,u,a,c]=t?[-1,1,0,.1]:[0,200,100,10];return i.statistics=[{min:o,max:u,avg:a,stddev:c}],this.rasterInfo=i,{success:!0,supportsGPU:!0}},r._processPixels=function(t){const e=t.pixelBlocks?.[0];if(null==e)return null;const{visibleBandID:n,infraredBandID:r,scientificOutput:s}=this.functionArguments;return u.calculateNDVI(e,n,r,!s)},r._getWebGLParameters=function(){const{visibleBandID:t,infraredBandID:e,scientificOutput:n}=this.functionArguments,r=this.isInputBandIdsSwizzled?[0,1,2]:[e,t,0];return{bandIndexMat3:u.getBandMatrix3(r),scaled:!n}},r._getInputBandIds=function(t){const{visibleBandID:e,infraredBandID:n}=this.functionArguments;return[n,e,0].map((e=>t[e]))},t._createClass(n)}(a);e.__decorate([n.property({json:{write:!0,name:"rasterFunction"}})],p.prototype,"functionName",void 0),e.__decorate([n.property({type:c,json:{write:!0,name:"rasterFunctionArguments"}})],p.prototype,"functionArguments",void 0),e.__decorate([n.property()],p.prototype,"rasterArgumentNames",void 0),p=e.__decorate([o.subclass("esri.layers.support.rasterFunctions.NDVIFunction")],p);return p}));
