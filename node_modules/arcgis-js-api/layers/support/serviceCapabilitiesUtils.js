/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../core/has","./arcgisLayerUrl"],(function(t,s,e){"use strict";const r={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function p(t,s,e){return!!u(t,s,e)}function o(t,s,e){return u(t,s,e)}function u(t,s,e){return t&&t.hasOwnProperty(s)?t[s]:e}function a(t){const s=t?.supportedSpatialAggregationStatistics?.map((t=>t.toLowerCase()));return{envelope:!!s?.includes("envelopeaggregate"),centroid:!!s?.includes("centroidaggregate"),convexHull:!!s?.includes("convexhullaggregate")}}function n(t,s){const e=t?.supportedOperationsWithCacheHint?.map((t=>t.toLowerCase()));return!!e?.includes(s.toLowerCase())}function i(t,s){return{analytics:c(t),attachment:d(t),data:l(t),metadata:y(t),operations:C(t.capabilities,t,s),query:g(t,s),queryRelated:m(t),queryTopFeatures:h(t),editing:S(t)}}function c(t){return{supportsCacheHint:n(t.advancedQueryCapabilities,"queryAnalytics")}}function d(t){const s=t.attachmentProperties,e={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:n(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:p(t,"supportsAttachmentsResizing",!1)};return s&&Array.isArray(s)&&s.forEach((t=>{const s=r[t.name];s&&(e[s]=!!t.isEnabled)})),e}function l(t){return{isVersioned:p(t,"isDataVersioned",!1),supportsAttachment:p(t,"hasAttachments",!1),supportsM:p(t,"hasM",!1),supportsZ:p(t,"hasZ",!1)}}function y(t){return{supportsAdvancedFieldProperties:p(t,"supportsFieldDescriptionProperty",!1)}}function C(t,s,r){const o=t?t.toLowerCase().split(",").map((t=>t.trim())):[],u=r?e.parse(r):null,a=o.includes(null!=u&&"MapServer"===u.serverType?"data":"query"),n=o.includes("editing")&&!s.datesInUnknownTimezone;let i=n&&o.includes("create"),c=n&&o.includes("delete"),d=n&&o.includes("update");const l=o.includes("changetracking"),y=s.advancedQueryCapabilities;return n&&!(i||c||d)&&(i=c=d=!0),{supportsCalculate:p(s,"supportsCalculate",!1),supportsTruncate:p(s,"supportsTruncate",!1),supportsValidateSql:p(s,"supportsValidateSql",!1),supportsAdd:i,supportsDelete:c,supportsEditing:n,supportsChangeTracking:l,supportsQuery:a,supportsQueryAnalytics:p(y,"supportsQueryAnalytic",!1),supportsQueryAttachments:p(y,"supportsQueryAttachments",!1),supportsQueryTopFeatures:p(y,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:p(s,"supportsAttachmentsResizing",!1),supportsSync:o.includes("sync"),supportsUpdate:d,supportsExceedsLimitStatistics:p(s,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:p(s,"supportsAsyncConvert3D",!1)}}function g(t,r){const u=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,c=t.archivingInfo,d=t.currentVersion,l=r?.includes("MapServer"),y=!l||d>=s("mapserver-pbf-version-support"),C=e.isHostedAgolService(r),g=new Set((t.supportedQueryFormats??"").split(",").map((t=>t.toLowerCase().trim())));return{supportsStatistics:p(u,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:p(u,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:p(u,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:a(u),supportsCentroid:p(u,"supportsReturningGeometryCentroid",!1),supportsDistance:p(u,"supportsQueryWithDistance",!1),supportsDistinct:p(u,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:p(u,"supportsReturningQueryExtent",!1),supportsGeometryProperties:p(u,"supportsReturningGeometryProperties",!1),supportsHavingClause:p(u,"supportsHavingClause",!1),supportsOrderBy:p(u,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:p(u,"supportsPagination",!1),supportsQuantization:p(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:p(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:p(t,"supportsReturningQueryGeometry",!1),supportsResultType:p(u,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:p(u,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:p(u,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:p(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:p(u,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:p(i,"allowOthersToQuery",!0),supportsHistoricMoment:p(c,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:y&&g.has("pbf"),supportsDisjointSpatialRelationship:p(u,"supportsDisjointSpatialRel",!1),supportsCacheHint:p(u,"supportsQueryWithCacheHint",!1)||n(u,"query"),supportsDefaultSpatialReference:p(u,"supportsDefaultSR",!1),supportsCompactGeometry:C,supportsFullTextSearch:p(u,"supportsFullTextSearch",!1),maxRecordCountFactor:o(t,"maxRecordCountFactor",void 0),maxRecordCount:o(t,"maxRecordCount",void 0),standardMaxRecordCount:o(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:o(t,"tileMaxRecordCount",void 0)}}function m(t){const s=t.advancedQueryCapabilities,e=p(s,"supportsAdvancedQueryRelated",!1);return{supportsPagination:p(s,"supportsQueryRelatedPagination",!1),supportsCount:e,supportsOrderBy:e,supportsCacheHint:n(s,"queryRelated")}}function h(t){return{supportsCacheHint:n(t.advancedQueryCapabilities,"queryTopFilter")}}function S(t){const s=t.ownershipBasedAccessControlForFeatures,e=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:p(t,"allowGeometryUpdates",!0),supportsGlobalId:p(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:p(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:p(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:p(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:p(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:p(s,"allowAnonymousToDelete",!0),supportsDeleteByOthers:p(s,"allowOthersToDelete",!0),supportsUpdateByAnonymous:p(s,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:p(s,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:p(e,"supportsAsyncApplyEdits",!1)}}function A(t){return{operations:{supportsExportClip:p(t,"supportsExportClip",!1),supportsMensuration:p(t,"supportsMensuration",!1)},query:{supportsCoverageQuery:p(t,"supportsCoverageQuery",!1)}}}t.getFeatureLayerCapabilities=i,t.getVideoLayerCapabilities=A,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
