/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../geometry","../../../core/Clonable","../../../core/Error","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/cast","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/reader","../../../core/accessorSupport/decorators/subclass","./cameraOrientationFactory","../enums/CameraOrientationType","../../../geometry/Point"],(function(e,t,r,o,a,i,n,c,p,u,s,d,l,y,m){"use strict";function _(e,t){switch(e){case"O":return t&&t<10?"nadir":"oblique";case"B":case"S":case"D":return"360";default:return"horizontal"}}function f(e){throw new a("exposure-point:missing-default-value",`a value for ${e} is missing in default properties`)}function b(e,t){throw new a("exposure-point:missing-attribute-value",`a value for ${e} is missing in attribute table`,{exposurePoint:t})}let g=function(t){function r(e){var r;return(r=t.call(this,e)||this).cameraOrientation=null,r.elevation=null,r.elevationSource=null,r.name=null,r}e._inherits(r,t);var o=r.prototype;return o.read=function(t,o){const a={},{attributes:i}=t;for(const e in i)a[e.toLowerCase()]=i[e];e._get(e._getPrototypeOf(r.prototype),"read",this).call(this,{...t,attributes:a},o)},o.readCameraHeading=function(e,t){const{attributes:r,layer:o}=t;return r.cameraheading??r.camheading??o.cameraHeading},o.readCameraHeight=function(e,t){const{attributes:r,layer:o}=t;return r.cameraheight??r.avghtag??o.cameraHeight},o.readCamOffset=function(e,t){const{attributes:r}=t;return r.cameraoffset?.split(";").map(Number)??r.camoffset?.split(";").map(Number)??null},o.readCameraOrientation=function(e,t){const{attributes:r}=t;return r.cameraorientation??r.camori},o.readCameraPitch=function(e,t){const{attributes:r,layer:o}=t;return r.camerapitch??r.campitch??o.cameraPitch},o.readCameraRoll=function(e,t){const{attributes:r,layer:o}=t;return r.cameraroll??r.camroll??o.cameraRoll},o.readDepthImage=function(e,t){const{attributes:r,layer:o}=t;let a=r.depthimage??r.depthimg??null;if(!a)return null;const{depthImagePathPrefix:i,depthImagePathSuffix:n}=o,c=i?.trim();c&&(a=`${c}/${a}`);const p=n?.trim();return p&&(a=`${a}/${p}`),a},o.readElevationSource=function(e,t){const{attributes:r,layer:o}=t;if(r.elevationSource){const e=r.elevationSource;let{url:t}=e;if(t){const{demPathSuffix:r,demPathPrefix:a}=o;return a?.trim()&&(t=a?.trim()+"/"+t),r?.trim()&&(t=t+"/"+r?.trim()),{...e,url:t}}return e}if(r.dem){let e=r.dem.trim();if(e){const{demPathSuffix:r,demPathPrefix:o}=t.layer;return o?.trim()&&(e=o?.trim()+"/"+e),r?.trim()&&(e=e+"/"+r?.trim()),{url:e}}}return o.effectiveElevationSource},o.readFarDistance=function(e,t){const{attributes:r,layer:o}=t;return r.fardistance??r.fardist??o.farDistance},o.readHFOV=function(e,t){const{attributes:r,layer:o}=t;return r.horizontalfieldofview??r.hfov??o.horizontalFieldOfView},o.readImageURL=function(e,t){const{attributes:r,layer:o}=t,{image:a}=r;a||b("image",this);const{imagePathPrefix:i,imagePathSuffix:n}=o;let c=a;const p=i?.trim();p&&(c=`${p.trim()}/${c}`);const u=n?.trim();return u&&(c=`${c}/${u.trim()}`),c},o.readImageRotation=function(e,t){const{attributes:r,layer:o}=t;return r.imagerotation??r.imgrot??o.imageRotation},o.readName=function(e,t){const{attributes:r}=t;return r.name},o.readNearDistance=function(e,t){const{attributes:r,layer:o}=t;return r.neardistance??r.neardist??o.nearDistance},o.readOrientationAccuracy=function(e,t){return t.attributes.orientationaccuracy?.split(";").map(Number)??t.attributes.accuracy?.split(";").map(Number)??null},o.readOIType=function(e,t){const{attributes:r,layer:o}=t;if(r.orientedimagerytype)return r.orientedimagerytype.toLowerCase();if(r.oitype){const e=r.camerapitch??r.campitch??o.cameraPitch;return _(r.oitype.toUpperCase(),e)}return o.orientedImageryType},o.readSortOrder=function(e,t){return t.attributes.sortorder},o.readVFOV=function(e,t){const{attributes:r,layer:o}=t;return r.verticalfieldofview??r.vfov??o.verticalFieldOfView},e._createClass(r,[{key:"isHorizontal",get:function(){return"horizontal"===this.orientedImageryType}},{key:"isInspection",get:function(){return"inspection"===this.orientedImageryType}},{key:"isNadir",get:function(){return"nadir"===this.orientedImageryType}},{key:"isOblique",get:function(){return"oblique"===this.orientedImageryType}},{key:"isSpherical",get:function(){return"360"===this.orientedImageryType}},{key:"location",get:function(){const{cameraOrientation:e,geometry:t,cameraHeight:r,elevation:o}=this;if(e){const{type:t,x:r,y:o,z:a,horizontalWKID:i}=e;return new m({x:r,y:o,z:a,spatialReference:{wkid:t===y.CameraOrientationType.LTP?4326:i}})}if(!r)throw f("cameraHeight");return t.z=(o??0)+r,t}}]),r}(o.ClonableMixin(i.JSONSupport));t.__decorate([n.property({type:Date,json:{write:!0,name:"attributes.acquisitiondate"}})],g.prototype,"acquisitionDate",void 0),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"cameraHeading",void 0),t.__decorate([s.reader("cameraHeading",["attributes"])],g.prototype,"readCameraHeading",null),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"cameraHeight",void 0),t.__decorate([s.reader("cameraHeight",["attributes"])],g.prototype,"readCameraHeight",null),t.__decorate([n.property({json:{write:!0}})],g.prototype,"cameraOffset",void 0),t.__decorate([s.reader("cameraOffset",["attributes"])],g.prototype,"readCamOffset",null),t.__decorate([n.property({json:{write:!0}}),c.cast((e=>e?l.getCameraOrientation(e):null))],g.prototype,"cameraOrientation",void 0),t.__decorate([s.reader("cameraOrientation",["attributes"])],g.prototype,"readCameraOrientation",null),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"cameraPitch",void 0),t.__decorate([s.reader("cameraPitch",["attributes"])],g.prototype,"readCameraPitch",null),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"cameraRoll",void 0),t.__decorate([s.reader("cameraRoll",["attributes"])],g.prototype,"readCameraRoll",null),t.__decorate([n.property({json:{write:!0}})],g.prototype,"depthImage",void 0),t.__decorate([s.reader("depthImage",["attributes"])],g.prototype,"readDepthImage",null),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"elevation",void 0),t.__decorate([n.property({json:{write:!0}})],g.prototype,"elevationSource",void 0),t.__decorate([s.reader("elevationSource",["attributes"])],g.prototype,"readElevationSource",null),t.__decorate([n.property({json:{write:!0,name:"attributes.exposurestationid"}})],g.prototype,"exposureStationId",void 0),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"farDistance",void 0),t.__decorate([s.reader("farDistance",["attributes"])],g.prototype,"readFarDistance",null),t.__decorate([n.property({type:m})],g.prototype,"geometry",void 0),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"horizontalFieldOfView",void 0),t.__decorate([s.reader("horizontalFieldOfView",["attributes"])],g.prototype,"readHFOV",null),t.__decorate([n.property({json:{write:!0}})],g.prototype,"image",void 0),t.__decorate([s.reader("image",["attributes"])],g.prototype,"readImageURL",null),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"imageRotation",void 0),t.__decorate([s.reader("imageRotation",["attributes"])],g.prototype,"readImageRotation",null),t.__decorate([n.property()],g.prototype,"isHorizontal",null),t.__decorate([n.property()],g.prototype,"isInspection",null),t.__decorate([n.property()],g.prototype,"isNadir",null),t.__decorate([n.property()],g.prototype,"isOblique",null),t.__decorate([n.property()],g.prototype,"isSpherical",null),t.__decorate([n.property({json:{write:!0}})],g.prototype,"location",null),t.__decorate([n.property({json:{write:!0}})],g.prototype,"name",void 0),t.__decorate([s.reader("name",["attributes"])],g.prototype,"readName",null),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"nearDistance",void 0),t.__decorate([s.reader("nearDistance",["attributes"])],g.prototype,"readNearDistance",null),t.__decorate([n.property({json:{write:!0,name:"attributes.objectid"}})],g.prototype,"objectId",void 0),t.__decorate([n.property({json:{write:!0}})],g.prototype,"orientationAccuracy",void 0),t.__decorate([s.reader("orientationAccuracy",["attributes"])],g.prototype,"readOrientationAccuracy",null),t.__decorate([n.property({json:{write:!0}})],g.prototype,"orientedImageryType",void 0),t.__decorate([s.reader("orientedImageryType",["attributes"])],g.prototype,"readOIType",null),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"sortOrder",void 0),t.__decorate([s.reader("sortOrder",["attributes"])],g.prototype,"readSortOrder",null),t.__decorate([n.property({type:Number,json:{write:!0}})],g.prototype,"verticalFieldOfView",void 0),t.__decorate([s.reader("verticalFieldOfView",["attributes"])],g.prototype,"readVFOV",null),g=t.__decorate([d.subclass("esri.layers.orientedImagery.core.ExposurePoint")],g);return g}));
