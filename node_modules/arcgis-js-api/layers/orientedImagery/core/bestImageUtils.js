/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../geometry/support/Ellipsoid","../../../geometry/support/pointUtils","./ExposurePoint"],(function(t,e,a,i){"use strict";function h(t){const{camera:e,features:a,selectedPoint:i}=t;if(!a.length)return[];const h=s(e,i);return a.map(h)}function s(t,i){return i.z??(i.z=0),i.elevation??(i.elevation=0),h=>{const{hfovWeight:s,vfovWeight:o,distanceWeight:r}=n(h.attributes,t?"3D":"2D"),c=h.attributes,{cameraHeight:l,cameraHeading:M,cameraPitch:g,farDistance:u,horizontalFieldOfView:f,verticalFieldOfView:v}=c,b=c.geometry,d=180*Math.atan2(b.y-i.y,b.x-i.x)/Math.PI,W=a.distance(i,b);let y=f,p=v,m=M,x=g;t&&(m=t.heading,x=t.tilt,y=180,p=180);let P=1;b.spatialReference.isWebMercator&&(P=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*b.y/e.earth.radius))));const D=Math.sqrt((Math.sqrt((i.x-b.x)**2+(i.y-b.y)**2)/P)**2+((i.z??0)-(i.elevation??0)-l)**2),q=90-180*Math.atan2(i.y-b.y,i.x-b.x)/Math.PI;let z=(Math.abs(q-m)>180?Math.abs(360-Math.abs(q-m)):Math.abs(q-m))/y;z=4*z+1;const I=180*Math.acos((c.cameraHeight-(i.z??0)+(i.elevation??0))/D)/Math.PI;let O=Math.abs(I-x)/p;O=4*O+1;let S=D/Math.sqrt(u**2+l**2);S=4*S+1;const w=M>180?M-360:M;return{suitability:s*z+o*O+r*S,trueSuitability:s*(4*(Math.abs(q-w)>180?Math.abs(360-Math.abs(q-w)):Math.abs(q-w)/y)+1)+o*(Math.abs(I-g)/p*4+1)+r*S,feature:h,angle:d,distance:W,vangle:Math.abs(180*Math.atan(W/l)/Math.PI)}}}function n(t,e){const a="isOblique"in t?t:new i(t),{isOblique:h,isSpherical:s,isNadir:n}=a;return s?{hfovWeight:"2D"===e?0:1,vfovWeight:"2D"===e?0:.6,distanceWeight:"2D"===e?1:.5}:n?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:h?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}t.calculateSuitabilities=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
