/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","./clock","./Error","./events","./Logger","./maybe"],(function(t,r,e,n,o,i){"use strict";async function u(t,r){const e=t.slice(),n=await Promise.all(t.map(((t,e)=>r(t,e))));return e.filter(((t,r)=>n[r]))}function c(t="Aborted"){return new e("AbortError",t)}function s(t,r="Aborted"){if(a(t))throw c(r)}function l(t){return null!=t?"aborted"in t?t:t.signal:t}function a(t){const r=l(t);return null!=r&&r.aborted}function f(t){if(y(t))throw t}function m(t){if(!y(t))throw t}function w(t,r){const e=l(t);if(null!=e){if(!e.aborted)return n.once(e,"abort",(()=>r()));r()}}function b(t,r){const e=l(t);if(null!=e)return s(e),n.once(e,"abort",(()=>r(c())))}function h(t,r){return null==l(r)?t:new Promise(((e,n)=>{let o=w(r,(()=>n(c())));const u=()=>o=i.removeMaybe(o);t.then(u,u),t.then(e,n)}))}function d(t,r,n){return Promise.race([t,T(r).then((()=>{throw new e("timeout",`Did not resolve within ${r} milliseconds (${n??"timeout"})`)}))])}function y(t){return"AbortError"===t?.name}async function A(t){try{return await t}catch(r){if(!y(r))throw r;return}}async function p(t,r=o.getLogger("esri")){try{return await t}catch(e){y(e)||r.error(e)}}async function v(t){if(!t)return;if("function"!=typeof t.forEach){const r=Object.keys(t),e=r.map((r=>t[r])),n=await v(e),o={};return r.map(((t,r)=>o[t]=n[r])),o}const r=t;return Promise.allSettled(r).then((t=>Array.from(r,((r,e)=>{const n=t[e];return"fulfilled"===n.status?{promise:r,value:n.value}:{promise:r,error:n.reason}}))))}async function g(t){return(await v(t)).filter((t=>!!t.value)).map((t=>t.value))}function T(t,r=void 0,e){const n=new AbortController;return w(e,(()=>n.abort())),new Promise(((e,o)=>{let i=setTimeout((()=>{i=0,e(r)}),t);w(n,(()=>{i&&(clearTimeout(i),o(c()))}))}))}function E(t,r,n,o){const i=n&&"abort"in n?n:null;null!=o||i||(o=n);let u=setTimeout((()=>{u=0,i&&i.abort()}),r);const c=()=>o||new e("promiseUtils:timeout","The wrapped promise did not resolve within "+r+" ms");return t.then((t=>{if(0===u)throw c();return clearTimeout(u),t}),(t=>{throw clearTimeout(u),0===u?c():t}))}function P(t){return t&&"function"==typeof t.then}function j(t){return P(t)?t:Promise.resolve(t)}function O(t,r=-1){let e,n,o,u,s=null;const l=(...a)=>{if(e){n=a,u&&u.reject(c()),u=k();const t=i.assumeNonNull(u.promise);if(s){const t=s;s=null,t.abort()}return t}if(o=u||k(),u=null,r>0){const n=new AbortController;e=j(t(...a,n.signal));const o=e;T(r).then((()=>{e===o&&(u?n.abort():s=n)}))}else e=1,e=j(t(...a));const f=()=>{const t=n;n=o=e=s=null,null!=t&&l(...t)},m=e,w=o;return m.then(f,f),m.then(w.resolve,w.reject),i.assumeNonNull(w.promise)};return l}function k(){let t,e;const n=new Promise(((r,n)=>{t=r,e=n})),o=r=>{t(r)};return o.resolve=r=>t(r),o.reject=t=>e(t),o.timeout=(t,e)=>r.clock.setTimeout((()=>o.reject(e)),t),o.promise=n,o}function N(t,r){return t.then(r,r)}async function I(t){await Promise.resolve(),s(t)}t.after=T,t.always=N,t.createAbortError=c,t.createResolver=k,t.debounce=O,t.eachAlways=v,t.eachAlwaysValues=g,t.filter=u,t.ignoreAbortErrors=A,t.isAbortError=y,t.isAborted=a,t.isPromiseLike=P,t.logOnError=p,t.onAbort=w,t.onAbortOrThrow=b,t.throwIfAbortError=f,t.throwIfAborted=s,t.throwIfNotAbortError=m,t.timeout=E,t.waitTick=I,t.when=j,t.whenOrAbort=h,t.whenOrTimeout=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
