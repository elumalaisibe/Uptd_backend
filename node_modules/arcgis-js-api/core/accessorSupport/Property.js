/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","./ObservableBase","./PropertyOrigin","./tracking","./tracking/Flags"],(function(t,e,s,n,i,r){"use strict";let a=function(){function t(t,e){this.propertyName=t,this.metadata=e,this.observerObject=new o,this._accessed=null,this._handles=null,this.observerObject.flags=r.Flags.Dirty|(e.nonNullable?r.Flags.NonNullable:0)|(e.hasOwnProperty("value")?r.Flags.HasDefaultValue:0)|(void 0===e.get?r.Flags.DepTrackingInitialized:0)|(void 0===e.dependsOn?r.Flags.AutoTracked:0)}var s=t.prototype;return s.destroy=function(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()},s.getComputed=function(t){const e=this.observerObject;i.trackAccess(e);const s=t.store,a=this.propertyName,o=e.flags,l=s.get(a);if(o&r.Flags.Computing)return l;if(~o&r.Flags.Dirty&&s.has(a))return l;e.flags|=r.Flags.Computing;const c=t.host;let h;o&r.Flags.AutoTracked?h=i.runTracked(this,this.metadata.get,c):(i.trackExplicitDependencies(c,this),h=this.metadata.get.call(c)),s.set(a,h,n.OriginId.COMPUTED);const g=s.get(a);return g===l?e.flags&=~r.Flags.Dirty:i.runUntracked(this.commit,this),e.flags&=~r.Flags.Computing,g},s.onObservableAccessed=function(t){if(t===this.observerObject)return;let e=this._accessed;if(null==e)e=[],this._accessed=e;else if(e.includes(t))return;e.push(t)},s.onTrackingEnd=function(){this._clearObservationHandles();const t=this.observerObject;t.flags|=r.Flags.DepTrackingInitialized;const e=this._accessed;if(null==e||0===e.length)return;let s=this._handles;null==s&&(s=[],this._handles=s);for(let n=0;n<e.length;++n)s.push(e[n].observe(t));e.length=0},s.notifyChange=function(){const t=this.observerObject;t.onInvalidated(),t.onCommitted()},s.invalidate=function(){this.observerObject.onInvalidated()},s.commit=function(){const t=this.observerObject;t.flags&=~r.Flags.Dirty,t.onCommitted()},s._clearObservationHandles=function(){const t=this._handles;if(null!==t){for(let e=0;e<t.length;++e)t[e].remove();t.length=0}},e._createClass(t)}(),o=function(t){function s(){var e;return(e=t.apply(this,arguments)||this).flags=0,e}e._inherits(s,t);var n=s.prototype;return n.onInvalidated=function(){~this.flags&r.Flags.Overriden&&(this.flags|=r.Flags.Dirty);const t=this._observers;if(t&&t.length>0)for(const e of t)e.onInvalidated()},n.onCommitted=function(){const t=this._observers;if(t&&t.length>0){const e=t.slice();for(const t of e)t.onCommitted()}},n.destroy=function(){this.flags&r.Flags.Dirty&&this.onCommitted(),e._get(e._getPrototypeOf(s.prototype),"destroy",this).call(this)},e._createClass(s)}(s.ObservableBase);t.Property=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
