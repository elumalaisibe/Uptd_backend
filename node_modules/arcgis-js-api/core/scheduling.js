/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","./maybe","./nextTick","./PerformanceSampler","./PooledArray","./promiseUtils","./time"],(function(e,t,n,r,s,o,i,a){"use strict";let c=t._createClass((function(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1})),l=function(){function e(e){this.callback=e,this.isActive=!0}return e.prototype.remove=function(){this.isActive=!1},t._createClass(e)}(),u=0,m=0;const p={time:a.Milliseconds(0),deltaTime:a.Milliseconds(0),elapsedFrameTime:a.Milliseconds(0),frameDuration:a.Milliseconds(0)},f=["prepare","preRender","render","postRender","update","finish"],d=[],h=new o;let k=function(){function e(e){this._task=e}var n=e.prototype;return n.remove=function(){this._task.removed=!0},n.pause=function(){this._task.paused=!0},n.resume=function(){this._task.paused=!1},t._createClass(e)}();const w={frameTasks:h,willDispatch:!1,clearFrameTasks:M,dispatch:y,executeFrameTasks:g};function v(e){const t=new l(e);return d.push(t),w.willDispatch||(w.willDispatch=!0,r.nextTick(y)),t}function T(e){const t=new c(e);return h.push(t),null==A&&(u=performance.now(),A=requestAnimationFrame(b)),new k(t)}let A=null;function M(e=!1){h.forAll((e=>{e.removed=!0})),e&&_()}function F(e){m=Math.max(0,e)}function b(){const e=performance.now();A=null,A=h.length>0?requestAnimationFrame(b):null,w.executeFrameTasks(e)}function g(e){const t=a.Milliseconds(e-u);u=e;const n=m>0?m:1e3/60,r=Math.max(0,t-n);p.time=e,p.frameDuration=a.Milliseconds(n-r);for(let s=0;s<f.length;s++){const n=performance.now(),r=f[s];h.forAll((n=>{if(n.paused||n.removed)return;0===s&&n.ticks++;n.phases[r]&&(p.elapsedFrameTime=a.Milliseconds(performance.now()-e),p.deltaTime=0===n.ticks?a.Milliseconds(0):t,n.phases[r]?.call(n,p))})),P[s].record(performance.now()-n)}_(),C.record(performance.now()-e)}const x=new o;function _(){h.forAll((e=>{e.removed&&x.push(e)})),h.removeUnorderedMany(x.data,x.length),x.clear()}function y(){for(;d.length;){const e=n.assumeNonNull(d.shift());e.isActive&&e.callback()}w.willDispatch=!1}function D(e=1,t){const n=i.createResolver(),s=()=>{i.isAborted(t)?n.reject(i.createAbortError()):0===e?n():(--e,r.nextTick((()=>s())))};return s(),n.promise}function R(){const e=i.createResolver(),t=T({postRender:()=>{t.remove(),v(e)}});return e.promise}const P=f.map((e=>new s(e))),C=new s("total");e.FrameTaskHandle=k,e.addFrameTask=T,e.debug=w,e.performanceInfo=P,e.performanceTotal=C,e.schedule=v,e.setFrameDuration=F,e.waitAnimationFrame=R,e.waitTicks=D,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
