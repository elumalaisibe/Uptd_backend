/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","./bidiEngineTables"],(function(t,r){"use strict";let e=function(){function r(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}var e=r.prototype;return e.bidiTransform=function(t,r,e){if(this.sourceToTarget=[],this.targetToSource=[],!t)return"";if(v(this.sourceToTarget,this.targetToSource,t.length),!this.checkParameters(r,e))return t;r=this.inputFormat,e=this.outputFormat;let o=t;const a=y,u=S(r.charAt(1)),s=S(e.charAt(1)),f=("I"===r.charAt(0)?"L":r.charAt(0))+u,c=("I"===e.charAt(0)?"L":e.charAt(0))+s,T=r.charAt(2)+e.charAt(2);a.defInFormat=f,a.defOutFormat=c,a.defSwap=T;const A=n(t,f,c,T,a);let h=!1;return"R"===e.charAt(1)?h=!0:"C"!==e.charAt(1)&&"D"!==e.charAt(1)||(h="rtl"===this.checkContextual(A)),this.sourceToTarget=V,this.targetToSource=O(this.sourceToTarget),I=this.targetToSource,o=r.charAt(3)===e.charAt(3)?A:"S"===e.charAt(3)?i(h,A,!0):l(A,h,!0),this.sourceToTarget=V,this.targetToSource=I,this.levels=k,o},e._inputFormatSetter=function(t){if(!Y.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=t},e._outputFormatSetter=function(t){if(!Y.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=t},e.checkParameters=function(t,r){return t?this._inputFormatSetter(t):t=this.inputFormat,r?this._outputFormatSetter(r):r=this.outputFormat,t!==r},e.checkContextual=function(t){let r=u(t);if("ltr"!==r&&"rtl"!==r){try{r=document.dir.toLowerCase()}catch(e){}"ltr"!==r&&"rtl"!==r&&(r="ltr")}return r},e.hasBidiChar=function(t){return D.test(t)},t._createClass(r)}();function n(t,r,e,i,a){const u=o(t,{inFormat:r,outFormat:e,swap:i},a);if(u.inFormat===u.outFormat)return t;r=u.inFormat,e=u.outFormat,i=u.swap;const s=r.substring(0,1),l=r.substring(1,4),c=e.substring(0,1),T=e.substring(1,4);if(a.inFormat=r,a.outFormat=e,a.swap=i,"L"===s&&"VLTR"===e){if("LTR"===l)return a.dir=j,f(t,a);if("RTL"===l)return a.dir=x,f(t,a)}if("V"===s&&"V"===c)return a.dir="RTL"===l?x:j,B(t,a);if("L"===s&&"VRTL"===e)return"LTR"===l?(a.dir=j,t=f(t,a)):(a.dir=x,t=f(t,a)),B(t);if("VLTR"===r&&"LLTR"===e)return a.dir=j,f(t,a);if("V"===s&&"L"===c&&l!==T)return t=B(t),"RTL"===l?n(t,"LLTR","VLTR",i,a):n(t,"LRTL","VRTL",i,a);if("VRTL"===r&&"LRTL"===e)return n(t,"LRTL","VRTL",i,a);if("L"===s&&"L"===c){const r=a.swap;return a.swap=r.substr(0,1)+"N","RTL"===l?(a.dir=x,t=f(t,a),a.swap="N"+r.substr(1,2),a.dir=j,t=f(t,a)):(a.dir=j,t=f(t,a),a.swap="N"+r.substr(1,2),t=n(t,"VLTR","LRTL",a.swap,a)),t}return t}function o(t,r,e){if(void 0===r.inFormat&&(r.inFormat=e.defInFormat),void 0===r.outFormat&&(r.outFormat=e.defOutFormat),void 0===r.swap&&(r.swap=e.defSwap),r.inFormat===r.outFormat)return r;const n=r.inFormat.substring(0,1),o=r.outFormat.substring(0,1);let i,a=r.inFormat.substring(1,4),l=r.outFormat.substring(1,4);return"C"===a.charAt(0)&&(i=u(t),a="ltr"===i||"rtl"===i?i.toUpperCase():"L"===r.inFormat.charAt(2)?"LTR":"RTL",r.inFormat=n+a),"C"===l.charAt(0)&&(i=u(t),"rtl"===i?l="RTL":"ltr"===i?(i=s(t),l=i.toUpperCase()):l="L"===r.outFormat.charAt(2)?"LTR":"RTL",r.outFormat=o+l),r}function i(t,r,e){if(0===r.length)return"";void 0===t&&(t=!0),void 0===e&&(e=!0);const n=(r=String(r)).split("");let o=0,i=1,u=n.length;t||(o=n.length-1,i=-1,u=1);const s=a(n,o,i,u,e);let l="";for(let a=0;a<n.length;a++)e&&U(s,s.length,a)>-1?(C(I,a,!t,-1),V.splice(a,1)):l+=n[a];return l}function a(t,e,n,o,i){let a=0;const u=[];let s=0;for(let l=e;l*n<o;l+=n)if(L(t[l])||R(t[l])){if("ل"===t[l]&&b(t,l+n,n,o)){t[l]=w(t[l+n],0===a?r.LamAlefInialTableFE:r.LamAlefMedialTableFE),l+=n,E(t,l,n,o),i&&(u[s]=l,s++),a=0;continue}const e=t[l];1===a?t[l]=_(t,l+n,n,o)?p(t[l]):N(t[l],r.FinalForm):!0===_(t,l+n,n,o)?t[l]=N(t[l],r.InitialForm):t[l]=N(t[l],r.IsolatedForm),R(e)||(a=1),!0===F(e)&&(a=0)}else a=0;return u}function u(t){const r=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return r?r[0]<="z"?"ltr":"rtl":""}function s(t){const r=t.split("");return r.reverse(),u(r.join(""))}function l(t,e,n){if(0===t.length)return"";void 0===n&&(n=!0),void 0===e&&(e=!0);let o="";const i=(t=String(t)).split("");for(let a=0;a<t.length;a++){let u=!1;if(i[a]>="ﹰ"&&i[a]<"\ufeff"){const s=t.charCodeAt(a);i[a]>="ﻵ"&&i[a]<="ﻼ"?(e?(a>0&&n&&" "===i[a-1]?o=o.substring(0,o.length-1)+"ل":(o+="ل",u=!0),o+=r.AlefTable[(s-65269)/2]):(o+=r.AlefTable[(s-65269)/2],o+="ل",a+1<t.length&&n&&" "===i[a+1]?a++:u=!0),u&&(C(I,a,!0,1),V.splice(a,0,V[a]))):o+=r.FETo06Table[s-65136]}else o+=i[a]}return o}function f(t,r){const e=t.split(""),n=[];return c(e,n,r),A(e,n,r),g(2,e,n,r),g(1,e,n,r),k=n,e.join("")}function c(t,e,n){const o=t.length,i=n.dir?r.impTabRtl:r.impTabLtr;let a=0,u=-1;const s=[],l=[];n.hiLevel=n.dir,n.lastArabic=!1,n.hasUbatAl=!1,n.hasUbatB=!1,n.hasUbatS=!1;for(let r=0;r<o;r++)s[r]=h(t[r]);for(let f=0;f<o;f++){const o=a,c=m(t,s,l,f,n);l[f]=c,a=i[o][c];const T=240&a;a&=15;const A=i[a][M];if(e[f]=A,T>0)if(16===T){for(let t=u;t<f;t++)e[t]=1;u=-1}else u=-1;if(i[a][P])-1===u&&(u=f);else if(u>-1){for(let t=u;t<f;t++)e[t]=A;u=-1}s[f]===r.UBAT_B&&(e[f]=0),n.hiLevel|=A}n.hasUbatS&&T(s,e,o,n)}function T(t,e,n,o){for(let i=0;i<n;i++)if(t[i]===r.UBAT_S){e[i]=o.dir;for(let n=i-1;n>=0&&t[n]===r.UBAT_WS;n--)e[n]=o.dir}}function A(t,r,e){if(0!==e.hiLevel&&e.swap.substr(0,1)!==e.swap.substr(1,2))for(let n=0;n<t.length;n++)1===r[n]&&(t[n]=d(t[n]))}function h(t){const e=t.charCodeAt(0),n=r.PrimaryTable[e>>8];return n<r.TBBASE?n:r.UnicodeTable[n-r.TBBASE][255&e]}function B(t,r){const e=t.split("");if(r){const t=[];c(e,t,r),k=t}return e.reverse(),V.reverse(),e.join("")}function U(t,r,e){for(let n=0;n<r;n++)if(t[n]===e)return n;return-1}function L(t){for(let e=0;e<r.ArabicAlefBetIntervalsBegine.length;e++)if(t>=r.ArabicAlefBetIntervalsBegine[e]&&t<=r.ArabicAlefBetIntervalsEnd[e])return!0;return!1}function _(t,r,e,n){for(;r*e<n&&R(t[r]);)r+=e;return!!(r*e<n&&L(t[r]))}function b(t,e,n,o){for(;e*n<o&&R(t[e]);)e+=n;let i=" ";if(!(e*n<o))return!1;i=t[e];for(let a=0;a<r.AlefTable.length;a++)if(r.AlefTable[a]===i)return!0;return!1}function g(t,r,e,n){if(n.hiLevel<t)return;if(1===t&&n.dir===x&&!n.hasUbatB)return r.reverse(),void V.reverse();const o=r.length;let i,a,u,s,l,f=0;for(;f<o;){if(e[f]>=t){for(i=f+1;i<o&&e[i]>=t;)i++;for(a=f,u=i-1;a<u;a++,u--)s=r[a],r[a]=r[u],r[u]=s,l=V[a],V[a]=V[u],V[u]=l;f=i}f++}}function m(t,e,n,o,i){const a=e[o];return{UBAT_L:()=>(i.lastArabic=!1,r.UBAT_L),UBAT_R:()=>(i.lastArabic=!1,r.UBAT_R),UBAT_ON:()=>r.UBAT_ON,UBAT_AN:()=>r.UBAT_AN,UBAT_EN:()=>i.lastArabic?r.UBAT_AN:r.UBAT_EN,UBAT_AL:()=>(i.lastArabic=!0,i.hasUbatAl=!0,r.UBAT_R),UBAT_WS:()=>r.UBAT_ON,UBAT_CS:()=>{let t,a;return o<1||o+1>=e.length||(t=n[o-1])!==r.UBAT_EN&&t!==r.UBAT_AN||(a=e[o+1])!==r.UBAT_EN&&a!==r.UBAT_AN?r.UBAT_ON:(i.lastArabic&&(a=r.UBAT_AN),a===t?a:r.UBAT_ON)},UBAT_ES:()=>(o>0?n[o-1]:r.UBAT_B)===r.UBAT_EN&&o+1<e.length&&e[o+1]===r.UBAT_EN?r.UBAT_EN:r.UBAT_ON,UBAT_ET:()=>{if(o>0&&n[o-1]===r.UBAT_EN)return r.UBAT_EN;if(i.lastArabic)return r.UBAT_ON;let t=o+1;const a=e.length;for(;t<a&&e[t]===r.UBAT_ET;)t++;return t<a&&e[t]===r.UBAT_EN?r.UBAT_EN:r.UBAT_ON},UBAT_NSM:()=>{if("VLTR"===i.inFormat){const n=e.length;let i=o+1;for(;i<n&&e[i]===r.UBAT_NSM;)i++;if(i<n){const n=t[o].charCodeAt(0),a=n>=1425&&n<=2303||64286===n,u=e[i];if(a&&(u===r.UBAT_R||u===r.UBAT_AL))return r.UBAT_R}}return o<1||e[o-1]===r.UBAT_B?r.UBAT_ON:n[o-1]},UBAT_B:()=>(i.lastArabic=!0,i.hasUbatB=!0,i.dir),UBAT_S:()=>(i.hasUbatS=!0,r.UBAT_ON),UBAT_LRE:()=>(i.lastArabic=!1,r.UBAT_ON),UBAT_RLE:()=>(i.lastArabic=!1,r.UBAT_ON),UBAT_LRO:()=>(i.lastArabic=!1,r.UBAT_ON),UBAT_RLO:()=>(i.lastArabic=!1,r.UBAT_ON),UBAT_PDF:()=>(i.lastArabic=!1,r.UBAT_ON),UBAT_BN:()=>r.UBAT_ON}[r.TYPES_NAMES[a]]()}function d(t){let e,n=0,o=r.SwapTable.length-1;for(;n<=o;)if(e=Math.floor((n+o)/2),t<r.SwapTable[e][0])o=e-1;else{if(!(t>r.SwapTable[e][0]))return r.SwapTable[e][1];n=e+1}return t}function F(t){for(let e=0;e<r.StandAlonForm.length;e++)if(r.StandAlonForm[e]===t)return!0;return!1}function p(t){for(let e=0;e<r.BaseForm.length;e++)if(t===r.BaseForm[e])return r.MedialForm[e];return t}function N(t,e){for(let n=0;n<r.BaseForm.length;n++)if(t===r.BaseForm[n])return e[n];return t}function R(t){return t>="ً"&&t<="ٕ"}function S(t){return"L"===t?"LTR":"R"===t?"RTL":"C"===t?"CLR":"D"===t?"CRL":""}function E(t,r,e,n){for(;r*e<n&&R(t[r]);)r+=e;return r*e<n&&(t[r]=" ",!0)}function w(t,e){for(let n=0;n<r.AlefTable.length;n++)if(t===r.AlefTable[n])return e[n];return t}function v(t,r,e){V=[],k=[];for(let n=0;n<e;n++)t[n]=n,r[n]=n,V[n]=n}function O(t){const r=new Array(t.length);for(let e=0;e<t.length;e++)r[t[e]]=e;return r}function C(t,r,e,n){for(let o=0;o<t.length;o++)(t[o]>r||!e&&t[o]===r)&&(t[o]+=n)}let V=[],I=[],k=[];const y={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},M=5,P=6,j=0,x=1,Y=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,D=/[\u0591-\u06ff\ufb1d-\ufefc]/;return e}));
