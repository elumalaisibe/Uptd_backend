/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","./has","./ObjectPool"],(function(t,i,e){"use strict";var n;!function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"}(n||(n={}));const s=4294967296,r=new TextDecoder("utf-8"),o=i("safari")||i("ios")?6:i("ff")?12:32;let a=function(){function i(t,i,e=0,s=(t?t.byteLength:0)){this._tag=0,this._dataType=n.unknown,this._init(t,i,e,s)}var e=i.prototype;return e._init=function(t,i,e,n){this._data=t,this._dataView=i,this._pos=e,this._end=n},e.asUnsafe=function(){return this},e.clone=function(){return new i(this._data,this._dataView,this._pos,this._end)},e.pos=function(){return this._pos},e.move=function(t){this._pos=t},e.nextTag=function(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0},e.next=function(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0},e.empty=function(){return this._pos>=this._end},e.tag=function(){return this._tag},e.getInt32=function(){return this._decodeVarint()},e.getInt64=function(){return this._decodeVarint()},e.getUInt32=function(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))},e.getUInt64=function(){return this._decodeVarint()},e.getSInt32=function(){const t=this.getUInt32();if(void 0!==t)return t>>>1^-(1&t)|0},e.getSInt64=function(){return this._decodeSVarint()},e.getBool=function(){const t=0!==this._data[this._pos];return this._skip(1),t},e.getEnum=function(){return this._decodeVarint()},e.getFixed64=function(){const t=this._dataView,i=this._pos,e=t.getUint32(i,!0)+t.getUint32(i+4,!0)*s;return this._skip(8),e},e.getSFixed64=function(){const t=this._dataView,i=this._pos,e=t.getUint32(i,!0)+t.getInt32(i+4,!0)*s;return this._skip(8),e},e.getDouble=function(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t},e.getFixed32=function(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t},e.getSFixed32=function(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t},e.getFloat=function(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t},e.getString=function(){const t=this._getLength(),i=this._pos,e=this._toString(this._data,i,i+t);return this._skip(t),e},e.getBytes=function(){const t=this._getLength(),i=this._pos,e=this._toBytes(this._data,i,i+t);return this._skip(t),e},e.getLength=function(){return this._getLengthUnsafe()},e.processMessageWithArgs=function(t,i,e,n){const s=this.getMessage(),r=t(s,i,e,n);return s.release(),r},e.processMessage=function(t){const i=this.getMessage(),e=t(i);return i.release(),e},e.getMessage=function(){const t=this._getLength(),e=i.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),e},e.release=function(){i.pool.release(this)},e.dataType=function(){return this._dataType},e.skip=function(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.skipLen=function(t){this._skip(t)},e._skip=function(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t},e._decodeVarint=function(){const t=this._data;let i=this._pos,e=0,n=0;if(this._end-i>=10)do{if(n=t[i++],e|=127&n,0==(128&n))break;if(n=t[i++],e|=(127&n)<<7,0==(128&n))break;if(n=t[i++],e|=(127&n)<<14,0==(128&n))break;if(n=t[i++],e|=(127&n)<<21,0==(128&n))break;if(n=t[i++],e+=268435456*(127&n),0==(128&n))break;if(n=t[i++],e+=34359738368*(127&n),0==(128&n))break;if(n=t[i++],e+=4398046511104*(127&n),0==(128&n))break;if(n=t[i++],e+=562949953421312*(127&n),0==(128&n))break;if(n=t[i++],e+=72057594037927940*(127&n),0==(128&n))break;if(n=t[i++],e+=0x8000000000000000*(127&n),0==(128&n))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;i!==this._end&&(n=t[i],0!=(128&n));)++i,e+=(127&n)*s,s*=128;if(i===this._end)throw new Error("Varint overrun!");++i,e+=n*s}return this._pos=i,e},e._decodeSVarint=function(){const t=this._data;let i=this._pos,e=0,n=0;const s=1&t[i];if(this._end-i>=10)do{if(n=t[i++],e|=127&n,0==(128&n))break;if(n=t[i++],e|=(127&n)<<7,0==(128&n))break;if(n=t[i++],e|=(127&n)<<14,0==(128&n))break;if(n=t[i++],e|=(127&n)<<21,0==(128&n))break;if(n=t[i++],e+=268435456*(127&n),0==(128&n))break;if(n=t[i++],e+=34359738368*(127&n),0==(128&n))break;if(n=t[i++],e+=4398046511104*(127&n),0==(128&n))break;if(n=t[i++],e+=562949953421312*(127&n),0==(128&n))break;if(n=t[i++],e+=72057594037927940*(127&n),0==(128&n))break;if(n=t[i++],e+=0x8000000000000000*(127&n),0==(128&n))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;i!==this._end&&(n=t[i],0!=(128&n));)++i,e+=(127&n)*s,s*=128;if(i===this._end)throw new Error("Varint overrun!");++i,e+=n*s}return this._pos=i,s?-(e+1)/2:e/2},e._getLength=function(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()},e._getLengthUnsafe=function(){return this.getUInt32()},e._toString=function(t,i,e){if((e=Math.min(this._end,e))-i>o){const n=t.subarray(i,e);return r.decode(n)}let n="",s="";for(let r=i;r<e;++r){const i=t[r];128&i?s+="%"+i.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(i),s="")}return s.length&&(n+=decodeURIComponent(s)),n},e._toBytes=function(t,i,e){return e=Math.min(this._end,e),new Uint8Array(t.buffer,i,e-i)},t._createClass(i)}();return a.pool=new e(a,void 0,(t=>{t._data=null,t._dataView=null})),a}));
