/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../request","../renderers/support/jsonUtils","./query/executeQuery","./utils","../kernel","../core/urlUtils","./query/support/AttachmentInfo","./support/AttachmentQuery","../geometry/Extent","../geometry/Geometry","../geometry/Multipoint","../geometry/Point","../geometry/Polygon","../geometry/Polyline","../geometry/support/normalizeUtils","../core/Error","../core/pbf","../core/unitUtils","../geometry/support/spatialReferenceUtils","./support/Query","../geometry","./support/FeatureSet","../layers/graphics/featureConversionUtils","./support/RelationshipQuery","./support/TopFeaturesQuery","./support/StatisticDefinition"],(function(e,t,n,r,i,o,l,s,a,u,c,f,p,y,m,g,d,h,S,V,b,k,x,v,O,R,U){"use strict";async function q(e,n,r,o){const l=i.parseUrl(e),{source:s,checkValueRange:a}=n,{classificationDefinition:u}=r,c={...r.toJSON(),f:"json"};let f=null;if(f="class-breaks-definition"===u?.type?u.classificationField:u?.attributeField,s){const e={source:s?.toJSON()};c.layer=JSON.stringify(e)}c.classificationDef&&(c.classificationDef=JSON.stringify(c.classificationDef));let p={query:c};o&&(p={...o,...p});const y={url:l.path,field:f,checkValueRange:a},m=l.path+"/generateRenderer";return t(m,p).then((e=>F(y,e)))}function F(e,t){const{field:n,checkValueRange:i,url:o}=e,l=t&&t.data;if(!l)return;if(!i){const e=Q(l);return Promise.resolve(e)}const s=new U({statisticType:"min",onStatisticField:n}),a=new U({statisticType:"max",onStatisticField:n}),u=new b({outStatistics:[s,a]});return r.executeQuery(o,u).then((e=>{const t=e.features[0].attributes;let n=null,r=null;for(const i in t)0===i.toLowerCase().indexOf("min")?n=t[i]:r=t[i];return Q(l,n,r)}))}function Q(e,t,r){if("classBreaks"===e.type){const i=n.fromJSON(e);return{classBreaks:i.classBreakInfos.map(((e,n)=>(0===n&&null!=t&&(e.minValue=t),n===i.classBreakInfos.length-1&&null!=r&&(e.maxValue=r),{minValue:e.minValue,maxValue:e.maxValue,label:e.label}))),normalizationTotal:i.normalizationTotal}}const{uniqueValueInfos:i}=e;return{uniqueValues:i?.map(((e,n)=>(0===n&&null!=t&&(e.value=t),n===i.length-1&&null!=r&&(e.value=r),{count:e.count,value:e.value,label:e.label})))??[]}}e.generateRenderer=q,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
