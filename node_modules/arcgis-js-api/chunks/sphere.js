/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../core/has","../core/Logger","../core/mathUtils","./mat4","./vec3","./vec3f64","./vec4","./vec4f64","../geometry/support/Axis","../geometry/support/ray","../geometry/support/vector","../geometry/support/vectorStacks"],(function(t,e,n,r,o,s,c,i,u,a,l,f,d){"use strict";const g=p();function p(){return u.create()}function h(t,e=p()){return i.copy(e,t)}function m(t,e){return u.fromValues(t[0],t[1],t[2],e)}function y(t){return t}function S(t){t[0]=t[1]=t[2]=t[3]=0}function v(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function A(t){return t[3]}function R(t){return t}function M(t,e,n,r){return u.fromValues(t,e,n,r)}function x(t,e,n){return t!==n&&s.copy(n,t),n[3]=t[3]+e,n}function b(t,e,r){return n.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:h(t,r)}function P(t,e,n){if(null==e)return!1;const{origin:r,direction:o}=e,s=C;s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2];const c=o[0]*o[0]+o[1]*o[1]+o[2]*o[2];if(0===c)return!1;const i=2*(o[0]*s[0]+o[1]*s[1]+o[2]*s[2]),u=i*i-4*c*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(u<0)return!1;const a=Math.sqrt(u);let l=(-i-a)/(2*c);const f=(-i+a)/(2*c);return(l<0||f<l&&f>0)&&(l=f),!(l<0)&&(n&&(n[0]=r[0]+o[0]*l,n[1]=r[1]+o[1]*l,n[2]=r[2]+o[2]*l),!0)}const C=c.create();function T(t,e){return P(t,e,null)}function j(t,e,n){if(P(t,e,n))return n;const r=q(t,e,d.sv3d.get());return s.add(n,e.origin,s.scale(d.sv3d.get(),e.direction,s.distance(e.origin,r)/s.length(e.direction))),n}function q(t,e,n){const r=d.sv3d.get(),c=d.sm4d.get();s.cross(r,e.origin,e.direction);const i=A(t);s.cross(n,r,e.origin),s.scale(n,n,1/s.length(n)*i);const u=w(t,e.origin),a=f.angle(e.origin,n);return o.fromRotation(c,a+u,r),s.transformMat4(n,n,c),n}function O(t,e,n){return P(t,e,n)?n:(l.closestPoint(e,R(t),n),V(t,n,n))}function V(t,e,n){const r=s.subtract(d.sv3d.get(),e,R(t)),o=s.scale(d.sv3d.get(),r,t[3]/s.length(r));return s.add(n,o,R(t))}function _(t,e){const n=s.subtract(d.sv3d.get(),e,R(t)),r=s.squaredLength(n),o=t[3]*t[3];return Math.sqrt(Math.abs(r-o))}function w(t,e){const n=s.subtract(d.sv3d.get(),e,R(t)),o=s.length(n),c=A(t),i=c+Math.abs(c-o);return r.acosClamped(c/i)}const E=c.create();function L(t,e,n,o){const c=s.subtract(E,e,R(t));switch(n){case a.Axis.X:{const t=r.cartesianToSpherical(c,E)[2];return s.set(o,-Math.sin(t),Math.cos(t),0)}case a.Axis.Y:{const t=r.cartesianToSpherical(c,E),e=t[1],n=t[2],i=Math.sin(e);return s.set(o,-i*Math.cos(n),-i*Math.sin(n),Math.cos(e))}case a.Axis.Z:return s.normalize(o,c);default:return}}function z(t,e){const n=s.subtract(D,e,R(t));return s.length(n)-t[3]}function N(t,e,n,r){const o=z(t,e),c=L(t,e,a.Axis.Z,D),i=s.scale(D,c,n-o);return s.add(r,e,i)}function Z(t,e){const n=s.squaredDistance(R(t),e),r=A(t);return n<=r*r}function k(t,e,n=p()){const r=s.distance(t,e),o=t[3],c=e[3];return r+c<o?(i.copy(n,t),n):r+o<c?(i.copy(n,e),n):(s.lerp(n,t,e,(r+c-o)/(2*r)),n[3]=(r+o+c)/2,n)}const D=c.create(),U=p(),X=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:g,altitudeAt:z,angleToSilhouette:w,axisAt:L,clear:S,closestPoint:O,closestPointOnSilhouette:q,containsPoint:Z,copy:h,create:p,distanceToSilhouette:_,elevate:x,fromCenterAndRadius:m,fromRadius:v,fromValues:M,getCenter:R,getRadius:A,intersectRay:P,intersectRayClosestSilhouette:j,intersectsRay:T,projectPoint:V,setAltitudeAt:N,setExtent:b,tmpSphere:U,union:k,wrap:y},Symbol.toStringTag,{value:"Module"}));t.NullSphere=g,t.altitudeAt=z,t.angleToSilhouette=w,t.axisAt=L,t.clear=S,t.closestPoint=O,t.closestPointOnSilhouette=q,t.containsPoint=Z,t.copy=h,t.create=p,t.distanceToSilhouette=_,t.elevate=x,t.fromCenterAndRadius=m,t.fromRadius=v,t.fromValues=M,t.getCenter=R,t.getRadius=A,t.intersectRay=P,t.intersectRayClosestSilhouette=j,t.intersectsRay=T,t.projectPoint=V,t.setAltitudeAt=N,t.setExtent=b,t.sphere=X,t.tmpSphere=U,t.union=k,t.wrap=y}));
