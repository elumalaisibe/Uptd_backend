/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../core/urlUtils"],(function(e,r){"use strict";function t(e,t){const o=t&&t.url&&t.url.path;if(e&&o&&(e=r.makeAbsolute(e,o,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const o=r.makeRelative(e,t.portalItem.itemUrl);null!=o&&a.test(o)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(o).path)}return m(e,t&&t.portal)}function o(t,o,l=e.MarkKeep.YES){if(null==t)return t;!r.isAbsolute(t)&&o&&o.blockedRelativeUrls&&o.blockedRelativeUrls.push(t);let n=r.makeAbsolute(t);if(o){const e=o.verifyItemRelativeUrls&&o.verifyItemRelativeUrls.rootPath||o.url&&o.url.path;if(e){const l=m(e,o.portal),s=m(n,o.portal);n=r.makeRelative(s,l,l);null!=n&&n!==s&&n!==t&&o.verifyItemRelativeUrls&&o.verifyItemRelativeUrls.writtenUrls.push(n)}}return n=c(n,o?.portal),r.isAbsolute(n)&&(n=r.normalize(n)),o?.resources&&o?.portalItem&&!r.isAbsolute(n)&&!r.isDataProtocol(n)&&l===e.MarkKeep.YES&&o.resources.toKeep.push({resource:o.portalItem.resourceFromPath(n),compress:!1}),n}function l(e,r,o){return t(e,o)}function n(e,r,t,l){const n=o(e,l);void 0!==n&&(r[t]=n)}const s=/\/items\/([^\/]+)\/resources\/(.*)/,a=/^\.\/resources\//;function i(e){const r=e?.match(s)??null;return r?.[1]??null}function u(e){const t=e?.match(s)??null;if(null==t)return null;const o=t[2],l=o.lastIndexOf("/");if(-1===l){const{path:e,extension:t}=r.splitPathExtension(o);return{prefix:null,filename:e,extension:t}}const{path:n,extension:a}=r.splitPathExtension(o.slice(l+1));return{prefix:o.slice(0,l),filename:n,extension:a}}function c(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?r.changeDomain(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function m(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const o=`${t.urlKey}.${t.customBaseUrl}`,l=r.getAppUrl();return r.hasSameOrigin(l,`${l.scheme}://${o}`)?r.changeDomain(e,t.portalHostname,o):r.changeDomain(e,o,t.portalHostname)}var p;e.MarkKeep=void 0,(p=e.MarkKeep||(e.MarkKeep={}))[p.YES=0]="YES",p[p.NO=1]="NO";const f=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return e.MarkKeep},ensureMainOnlineDomain:c,fromJSON:t,itemIdFromResourceUrl:i,prefixAndFilenameFromResourceUrl:u,read:l,toJSON:o,write:n},Symbol.toStringTag,{value:"Module"}));e.ensureMainOnlineDomain=c,e.fromJSON=t,e.itemIdFromResourceUrl=i,e.persistableUrlUtils=f,e.prefixAndFilenameFromResourceUrl=u,e.read=l,e.toJSON=o,e.write=n}));
