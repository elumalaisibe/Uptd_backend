/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","./index","./color-picker-swatch","./dom","./loadable","./icon","./input","./input-number","./progress","./interactive","./key","./locale","./math","./t9n","./button2","./loader","./tab","./tab-nav","./tab-title","./tabs","./debounce"],(function(e,t,i,a,n,o,l,s,r,c,h,d,p,u,m,C,f,g,v,y,x){"use strict";
/*!
   * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
   * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
   * v1.4.2
   */const b={channel:"channel",channels:"channels",colorField:"color-field",colorFieldScope:"scope--color-field",colorMode:"color-mode",colorModeContainer:"color-mode-container",container:"container",control:"control",controlAndScope:"control-and-scope",controlSection:"control-section",deleteColor:"delete-color",header:"header",hexAndChannelsGroup:"hex-and-channels-group",hexOptions:"color-hex-options",hueScope:"scope--hue",hueSlider:"hue-slider",opacityScope:"scope--opacity",opacitySlider:"opacity-slider",preview:"preview",previewAndSliders:"preview-and-sliders",saveColor:"save-color",savedColor:"saved-color",savedColors:"saved-colors",savedColorsButtons:"saved-colors-buttons",savedColorsSection:"saved-colors-section",scope:"scope",section:"section",slider:"slider",sliders:"sliders",splitSection:"section--split"},S=i.color("#007AC2"),w="calcite-color-",k={r:255,g:255,b:255},I={h:360,s:100,v:100},D={min:0,max:100},E={s:{slider:{height:12,width:104},colorField:{height:80,width:160},thumb:{radius:10}},m:{slider:{height:12,width:204},colorField:{height:150,width:272},thumb:{radius:10}},l:{slider:{height:12,width:384},colorField:{height:200,width:464},thumb:{radius:10}}},F={container:"container",hexInput:"hex-input",opacityInput:"opacity-input"},H="@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-right{0%{opacity:0;transform:translate3D(-5px, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-left{0%{opacity:0;transform:translate3D(5px, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-right{animation-name:in-right}.calcite-animate__in-left{animation-name:in-left}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0.01}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:var(--calcite-app-z-index-dropdown)}:host([hidden]){display:none}:host{display:block}.container{display:flex;inline-size:100%;flex-wrap:nowrap;align-items:center}.hex-input{flex-grow:1;text-transform:uppercase}.opacity-input{inline-size:68px;margin-inline-start:-1px}:host([scale=s]) .container{flex-wrap:wrap;row-gap:0.125rem}:host([scale=s]) .opacity-input{inline-size:unset;margin-inline-start:unset}:host([scale=l]) .opacity-input{inline-size:88px}",P=i.color(),A=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteColorPickerHexInputChange=t.createEvent(this,"calciteColorPickerHexInputChange",6),this.onHexInputBlur=()=>{const e=this.hexInputNode,t=e.value,a=`#${t}`,{allowEmpty:n,internalColor:o}=this,l=n&&!t,s=i.isLonghandHex(a);this.onHexInputChange(),l||i.isValidHex(a)&&s||(e.value=n&&!o?"":this.formatHexForInternalInput(i.rgbToHex(o.object())))},this.onOpacityInputBlur=()=>{const e=this.opacityInputNode,t=e.value,{allowEmpty:i,internalColor:a}=this;i&&!t||(e.value=i&&!a?"":this.formatOpacityForInternalInput(a))},this.onHexInputChange=()=>{let e=this.hexInputNode.value;if(e){const t=i.normalizeHex(e,!1);if(i.isValidHex(t)&&this.alphaChannel&&this.internalColor){e=`${t+i.normalizeHex(this.internalColor.hexa(),!0).slice(-2)}`}}this.internalSetValue(e,this.value)},this.onOpacityInputChange=()=>{const e=this.opacityInputNode;let t;if(e.value){const a=i.opacityToAlpha(Number(e.value));t=this.internalColor?.alpha(a).hexa()}else t=e.value;this.internalSetValue(t,this.value)},this.onInputKeyDown=e=>{const{altKey:t,ctrlKey:a,metaKey:n,shiftKey:o}=e,{alphaChannel:l,hexInputNode:s,internalColor:r,value:c}=this,{key:h}=e,d=e.composedPath();if("Tab"===h||"Enter"===h)return d.includes(s)?this.onHexInputChange():this.onOpacityInputChange(),void("Enter"===h&&e.preventDefault());const p="ArrowDown"===h||"ArrowUp"===h,u=this.value;if(p){if(!c)return this.internalSetValue(this.previousNonNullValue,u),void e.preventDefault();const t="ArrowUp"===h?1:-1,a=o?10:1;return this.internalSetValue(i.hexify(this.nudgeRGBChannels(r,a*t,d.includes(s)?"rgb":"a"),l),u),void e.preventDefault()}const m=t||a||n,C=1===h.length,f=i.hexChar.test(h);!C||m||f||e.preventDefault()},this.onHexInputPaste=e=>{const t=e.clipboardData.getData("text");i.isValidHex(t)&&(e.preventDefault(),this.hexInputNode.value=t.slice(1),this.hexInputNode.internalSyncChildElValue())},this.previousNonNullValue=this.value,this.storeHexInputRef=e=>{this.hexInputNode=e},this.storeOpacityInputRef=e=>{this.opacityInputNode=e},this.allowEmpty=!1,this.alphaChannel=!1,this.hexLabel="Hex",this.messages=void 0,this.numberingSystem=void 0,this.scale="m",this.value=i.normalizeHex(i.hexify(P,this.alphaChannel),this.alphaChannel,!0),this.internalColor=P}connectedCallback(){const{allowEmpty:e,alphaChannel:t,value:a}=this;if(a){const e=i.normalizeHex(a,t);i.isValidHex(e,t)&&this.internalSetValue(e,e,!1)}else e&&this.internalSetValue(null,null,!1)}componentWillLoad(){n.setUpLoadableComponent(this)}componentDidLoad(){n.setComponentLoaded(this)}handleValueChange(e,t){this.internalSetValue(e,t,!1)}render(){const{alphaChannel:e,hexLabel:i,internalColor:a,messages:n,scale:o,value:l}=this,s=this.formatHexForInternalInput(l),r=this.formatOpacityForInternalInput(a),c="l"===o?"m":"s";return t.h("div",{class:F.container},t.h("calcite-input",{class:F.hexInput,label:n?.hex||i,maxLength:6,numberingSystem:this.numberingSystem,onCalciteInputChange:this.onHexInputChange,onCalciteInternalInputBlur:this.onHexInputBlur,onKeyDown:this.onInputKeyDown,onPaste:this.onHexInputPaste,prefixText:"#",scale:c,value:s,ref:this.storeHexInputRef}),e?t.h("calcite-input-number",{class:F.opacityInput,key:"opacity-input",label:n?.opacity,max:D.max,maxLength:3,min:D.min,numberButtonType:"none",numberingSystem:this.numberingSystem,onCalciteInputNumberChange:this.onOpacityInputChange,onCalciteInternalInputNumberBlur:this.onOpacityInputBlur,onKeyDown:this.onInputKeyDown,scale:c,suffixText:"%",value:r,ref:this.storeOpacityInputRef}):null)}async setFocus(){await n.componentLoaded(this),a.focusElement(this.hexInputNode)}internalSetValue(e,t,a=!0){if(e){const{alphaChannel:t}=this,n=i.normalizeHex(e,t,t);if(i.isValidHex(n,t)){const{internalColor:e}=this,o=i.color(n),l=i.normalizeHex(i.hexify(o,t),t),s=!e||l!==i.normalizeHex(i.hexify(e,t),t);return this.internalColor=o,this.previousNonNullValue=l,this.value=l,void(s&&a&&this.calciteColorPickerHexInputChange.emit())}}else if(this.allowEmpty)return this.internalColor=null,this.value=null,void(a&&this.calciteColorPickerHexInputChange.emit());this.value=t}formatHexForInternalInput(e){return e?e.replace("#","").slice(0,6):""}formatOpacityForInternalInput(e){return e?`${i.alphaToOpacity(e.alpha())}`:""}nudgeRGBChannels(e,t,a){let n;const o=e.array(),l=o.slice(0,3);if("rgb"===a){n=[...l.map((e=>e+t)),this.alphaChannel?o[3]:void 0]}else{const a=i.opacityToAlpha(i.alphaToOpacity(e.alpha())+t);n=[...l,a]}return i.color(n)}get el(){return this}static get watchers(){return{value:["handleValueChange"]}}static get style(){return H}},[1,"calcite-color-picker-hex-input",{allowEmpty:[4,"allow-empty"],alphaChannel:[4,"alpha-channel"],hexLabel:[1,"hex-label"],messages:[16],numberingSystem:[1,"numbering-system"],scale:[513],value:[1537],internalColor:[32],setFocus:[64]}]);function L(){if("undefined"==typeof customElements)return;["calcite-color-picker-hex-input","calcite-icon","calcite-input","calcite-input-number","calcite-progress"].forEach((e=>{switch(e){case"calcite-color-picker-hex-input":customElements.get(e)||customElements.define(e,A);break;case"calcite-icon":customElements.get(e)||o.defineCustomElement();break;case"calcite-input":customElements.get(e)||l.defineCustomElement();break;case"calcite-input-number":customElements.get(e)||s.defineCustomElement();break;case"calcite-progress":customElements.get(e)||r.defineCustomElement()}}))}L();
/*!
   * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
   * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
   * v1.4.2
   */
var T="Expected a function";function O(e,t,i){var a=!0,n=!0;if("function"!=typeof e)throw new TypeError(T);return x.isObject(i)&&(a="leading"in i?!!i.leading:a,n="trailing"in i?!!i.trailing:n),x.debounce(e,t,{leading:a,maxWait:t,trailing:n})}
/*!
   * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
   * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
   * v1.4.2
   */const z='@keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-right{0%{opacity:0;transform:translate3D(-5px, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-left{0%{opacity:0;transform:translate3D(5px, 0, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;animation-fill-mode:both;animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{animation-name:in}.calcite-animate__in-down{animation-name:in-down}.calcite-animate__in-up{animation-name:in-up}.calcite-animate__in-right{animation-name:in-right}.calcite-animate__in-left{animation-name:in-left}.calcite-animate__in-scale{animation-name:in-scale}@media (prefers-reduced-motion: reduce){:root{--calcite-internal-duration-factor:0.01}}:root{--calcite-floating-ui-transition:var(--calcite-animation-timing);--calcite-floating-ui-z-index:var(--calcite-app-z-index-dropdown)}:host([hidden]){display:none}:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([scale=s]){--calcite-color-picker-spacing:8px}:host([scale=s]) .container{inline-size:160px}:host([scale=s]) .saved-colors{gap:0.25rem;grid-template-columns:repeat(auto-fill, 20px)}:host([scale=m]){--calcite-color-picker-spacing:12px}:host([scale=m]) .container{inline-size:272px}:host([scale=l]){--calcite-color-picker-spacing:16px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=l]) .container{inline-size:464px}:host([scale=l]) .section:first-of-type{padding-block-start:var(--calcite-color-picker-spacing)}:host([scale=l]) .saved-colors{grid-template-columns:repeat(auto-fill, 32px)}:host([scale=l]) .control-section{flex-wrap:nowrap;align-items:baseline;flex-wrap:wrap}:host([scale=l]) .color-hex-options{display:flex;flex-shrink:1;flex-direction:column;justify-content:space-around}:host([scale=l]) .color-mode-container{flex-shrink:3}.container{background-color:var(--calcite-ui-foreground-1);display:inline-block;border:1px solid var(--calcite-ui-border-1)}.control-and-scope{position:relative;display:flex;cursor:pointer;touch-action:none}.scope{position:absolute;z-index:var(--calcite-app-z-index);font-size:var(--calcite-font-size--1);outline-color:transparent}.scope:focus{outline:2px solid var(--calcite-ui-focus-color, var(--calcite-ui-brand));outline-offset:calc(\n            2px *\n            calc(\n              1 -\n              2 * clamp(\n                0,\n                var(--calcite-ui-focus-offset-invert),\n                1\n              )\n            )\n          );outline-offset:16px}.hex-and-channels-group{inline-size:100%}.hex-and-channels-group,.control-section{display:flex;flex-direction:row;flex-wrap:wrap}.section{padding-block:0 var(--calcite-color-picker-spacing);padding-inline:var(--calcite-color-picker-spacing)}.section:first-of-type{padding-block-start:var(--calcite-color-picker-spacing)}.sliders{display:flex;flex-direction:column;justify-content:space-between;margin-inline-start:var(--calcite-color-picker-spacing)}.preview-and-sliders{display:flex;align-items:center;padding:var(--calcite-color-picker-spacing)}.color-hex-options,.section--split{flex-grow:1}.header{display:flex;align-items:center;justify-content:space-between;color:var(--calcite-ui-text-1)}.color-mode-container{padding-block-start:var(--calcite-color-picker-spacing)}.channels{display:flex;row-gap:0.125rem}.channel[data-channel-index="3"]{inline-size:159px}:host([scale=s]) .channels{flex-wrap:wrap}:host([scale=s]) .channel{flex-basis:30%;flex-grow:1}:host([scale=s]) .channel[data-channel-index="3"]{inline-size:unset;margin-inline-start:unset}:host([scale=l]) .channel[data-channel-index="3"]{inline-size:131px}.saved-colors{display:grid;gap:0.5rem;padding-block-start:var(--calcite-color-picker-spacing);grid-template-columns:repeat(auto-fill, 24px)}.saved-colors-buttons{display:flex}.saved-color{outline-offset:0;outline-color:transparent;cursor:pointer}.saved-color:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px}.saved-color:hover{transition:outline-color var(--calcite-internal-animation-timing-fast) ease-in-out;outline:2px solid var(--calcite-ui-border-2);outline-offset:2px}',R=16,M=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteColorPickerChange=t.createEvent(this,"calciteColorPickerChange",6),this.calciteColorPickerInput=t.createEvent(this,"calciteColorPickerInput",6),this.internalColorUpdateContext=null,this.mode=i.CSSColorMode.HEX,this.shiftKeyChannelAdjustment=0,this.handleTabActivate=e=>{this.channelMode=e.currentTarget.getAttribute("data-color-mode"),this.updateChannelsFromColor(this.color)},this.handleColorFieldScopeKeyDown=e=>{const{key:t}=e,i={ArrowUp:{x:0,y:-10},ArrowRight:{x:10,y:0},ArrowDown:{x:0,y:10},ArrowLeft:{x:-10,y:0}};i[t]&&(e.preventDefault(),this.scopeOrientation="ArrowDown"===t||"ArrowUp"===t?"vertical":"horizontal",this.captureColorFieldColor(this.colorFieldScopeLeft+i[t].x||0,this.colorFieldScopeTop+i[t].y||0,!1))},this.handleHueScopeKeyDown=e=>{const t=e.shiftKey?10:1,{key:i}=e,a={ArrowUp:1,ArrowRight:1,ArrowDown:-1,ArrowLeft:-1};if(a[i]){e.preventDefault();const n=a[i]*t,o=this.baseColorFieldColor.hue(),l=this.baseColorFieldColor.hue(o+n);this.internalColorSet(l,!1)}},this.handleHexInputChange=e=>{e.stopPropagation();const{allowEmpty:t,color:a}=this,n=e.target.value;if(t&&!n)return void this.internalColorSet(null);n!==(a&&i.normalizeHex(i.hexify(a,i.alphaCompatible(this.mode))))&&this.internalColorSet(i.color(n))},this.handleSavedColorSelect=e=>{const t=e.currentTarget;this.internalColorSet(i.color(t.color))},this.handleChannelInput=e=>{const t=e.currentTarget,i=Number(t.getAttribute("data-channel-index")),a=3===i?D.max:"rgb"===this.channelMode?k[Object.keys(k)[i]]:I[Object.keys(I)[i]];let n;if(this.allowEmpty&&!t.value)n="";else{const e=Number(t.value)+this.shiftKeyChannelAdjustment;n=p.clamp(e,0,a).toString()}t.value=n,t.internalSyncChildElValue()},this.handleChannelChange=e=>{const t=e.currentTarget,a=Number(t.getAttribute("data-channel-index")),n=[...this.channels];if(this.allowEmpty&&!t.value)return this.channels=[null,null,null,null],void this.internalColorSet(null);const o=3===a,l=Number(t.value);n[a]=o?i.opacityToAlpha(l):l,this.updateColorFromChannels(n)},this.handleSavedColorKeyDown=e=>{h.isActivationKey(e.key)&&(e.preventDefault(),this.handleSavedColorSelect(e))},this.handleColorFieldPointerDown=e=>{if(!a.isPrimaryPointerButton(e))return;const{offsetX:t,offsetY:i}=e;document.addEventListener("pointermove",this.globalPointerMoveHandler),document.addEventListener("pointerup",this.globalPointerUpHandler,{once:!0}),this.activeCanvasInfo={context:this.colorFieldRenderingContext,bounds:this.colorFieldRenderingContext.canvas.getBoundingClientRect()},this.captureColorFieldColor(t,i),this.colorFieldScopeNode.focus()},this.handleHueSliderPointerDown=e=>{if(!a.isPrimaryPointerButton(e))return;const{offsetX:t}=e;document.addEventListener("pointermove",this.globalPointerMoveHandler),document.addEventListener("pointerup",this.globalPointerUpHandler,{once:!0}),this.activeCanvasInfo={context:this.hueSliderRenderingContext,bounds:this.hueSliderRenderingContext.canvas.getBoundingClientRect()},this.captureHueSliderColor(t),this.hueScopeNode.focus()},this.handleOpacitySliderPointerDown=e=>{if(!a.isPrimaryPointerButton(e))return;const{offsetX:t}=e;document.addEventListener("pointermove",this.globalPointerMoveHandler),document.addEventListener("pointerup",this.globalPointerUpHandler,{once:!0}),this.activeCanvasInfo={context:this.opacitySliderRenderingContext,bounds:this.opacitySliderRenderingContext.canvas.getBoundingClientRect()},this.captureOpacitySliderValue(t),this.opacityScopeNode.focus()},this.globalPointerUpHandler=e=>{if(!a.isPrimaryPointerButton(e))return;const t=this.activeCanvasInfo;this.activeCanvasInfo=null,this.drawColorControls(),t&&this.calciteColorPickerChange.emit()},this.globalPointerMoveHandler=e=>{const{activeCanvasInfo:t,el:i}=this;if(!i.isConnected||!t)return;const{context:a,bounds:n}=t;let o,l;const{clientX:s,clientY:r}=e;a.canvas.matches(":hover")?(o=s-n.x,l=r-n.y):(o=s<n.x+n.width&&s>n.x?s-n.x:s<n.x?0:n.width-1,l=r<n.y+n.height&&r>n.y?r-n.y:r<n.y?0:n.height),a===this.colorFieldRenderingContext?this.captureColorFieldColor(o,l,!1):a===this.hueSliderRenderingContext?this.captureHueSliderColor(o):a===this.opacitySliderRenderingContext&&this.captureOpacitySliderValue(o)},this.storeColorFieldScope=e=>{this.colorFieldScopeNode=e},this.storeHueScope=e=>{this.hueScopeNode=e},this.renderChannelsTabTitle=e=>{const{channelMode:i,messages:a}=this,n=e===i,o="rgb"===e?a.rgb:a.hsv;return t.h("calcite-tab-title",{class:b.colorMode,"data-color-mode":e,key:e,onCalciteTabsActivate:this.handleTabActivate,selected:n},o)},this.renderChannelsTab=e=>{const{allowEmpty:n,channelMode:o,channels:l,messages:s,alphaChannel:r}=this,c=e===o,h="rgb"===e?[s.red,s.green,s.blue]:[s.hue,s.saturation,s.value],d=a.getElementDir(this.el),p=r?l:l.slice(0,3);return t.h("calcite-tab",{class:b.control,key:e,selected:c},t.h("div",{class:b.channels,dir:"ltr"},p.map(((e,t)=>{const a=3===t;return a&&(e=n&&!e?e:i.alphaToOpacity(e)),this.renderChannel(e,t,h[t],d,a?"%":"")}))))},this.renderChannel=(e,i,a,n,o)=>t.h("calcite-input",{class:b.channel,"data-channel-index":i,dir:n,key:i,label:a,lang:this.effectiveLocale,numberButtonType:"none",numberingSystem:this.numberingSystem,onCalciteInputChange:this.handleChannelChange,onCalciteInputInput:this.handleChannelInput,onKeyDown:this.handleKeyDown,scale:"l"===this.scale?"m":"s",style:{marginLeft:i>0&&("s"!==this.scale||!this.alphaChannel||3!==i)?"-1px":""},suffixText:o,type:"number",value:e?.toString()}),this.deleteColor=()=>{const e=i.hexify(this.color,this.alphaChannel);if(!(this.savedColors.indexOf(e)>-1))return;const t=this.savedColors.filter((t=>t!==e));this.savedColors=t;const a=`${w}${this.storageId}`;this.storageId&&localStorage.setItem(a,JSON.stringify(t))},this.saveColor=()=>{const e=i.hexify(this.color,this.alphaChannel);if(this.savedColors.indexOf(e)>-1)return;const t=[...this.savedColors,e];this.savedColors=t;const a=`${w}${this.storageId}`;this.storageId&&localStorage.setItem(a,JSON.stringify(t))},this.drawColorControls=O(((e="all")=>{"all"!==e&&"color-field"!==e||!this.colorFieldRenderingContext||this.drawColorField(),"all"!==e&&"hue-slider"!==e||!this.hueSliderRenderingContext||this.drawHueSlider(),this.alphaChannel&&("all"===e||"opacity-slider"===e)&&this.opacitySliderRenderingContext&&this.drawOpacitySlider()}),R),this.captureColorFieldColor=(e,t,i=!0)=>{const{dimensions:{colorField:{height:a,width:n}}}=this,o=Math.round(I.s/n*e),l=Math.round(I.v/a*(a-t));this.internalColorSet(this.baseColorFieldColor.hsv().saturationv(o).value(l),i)},this.initColorField=e=>{this.colorFieldRenderingContext=e.getContext("2d"),this.updateCanvasSize("color-field"),this.drawColorControls()},this.initHueSlider=e=>{this.hueSliderRenderingContext=e.getContext("2d"),this.updateCanvasSize("hue-slider"),this.drawHueSlider()},this.initOpacitySlider=e=>{this.opacitySliderRenderingContext=e.getContext("2d"),this.updateCanvasSize("opacity-slider"),this.drawOpacitySlider()},this.storeOpacityScope=e=>{this.opacityScopeNode=e},this.handleOpacityScopeKeyDown=e=>{const t=e.shiftKey?10:1,{key:a}=e,n={ArrowUp:1,ArrowRight:1,ArrowDown:-1,ArrowLeft:-1};if(n[a]){e.preventDefault();const o=i.opacityToAlpha(n[a]*t);this.captureHueSliderColor(this.opacityScopeLeft+o)}},this.allowEmpty=!1,this.alphaChannel=!1,this.channelsDisabled=!1,this.color=S,this.disabled=!1,this.format="auto",this.hideChannels=!1,this.hexDisabled=!1,this.hideHex=!1,this.hideSaved=!1,this.savedDisabled=!1,this.scale="m",this.storageId=void 0,this.messageOverrides=void 0,this.numberingSystem=void 0,this.value=i.normalizeHex(i.hexify(S,this.alphaChannel)),this.defaultMessages=void 0,this.channelMode="rgb",this.channels=this.toChannels(S),this.dimensions=E.m,this.effectiveLocale="",this.messages=void 0,this.savedColors=[],this.colorFieldScopeTop=void 0,this.colorFieldScopeLeft=void 0,this.hueScopeLeft=void 0,this.opacityScopeLeft=void 0,this.scopeOrientation=void 0}handleAlphaChannelChange(e){const{format:t}=this;e&&"auto"!==t&&!i.alphaCompatible(t)&&(console.warn(`ignoring alphaChannel as the current format (${t}) does not support alpha`),this.alphaChannel=!1)}handleColorChange(e,t){this.drawColorControls(),this.updateChannelsFromColor(e),this.previousColor=t}handleFormatChange(e){this.setMode(e),this.internalColorSet(this.color,!1,"internal")}handleScaleChange(e="m"){this.updateDimensions(e),this.updateCanvasSize("all"),this.drawColorControls()}onMessagesChange(){}handleValueChange(e,t){const{allowEmpty:a,format:n}=this;let o=!1;if(!a||e){const a=i.parseMode(e);if(!a||"auto"!==n&&a!==n)return this.showIncompatibleColorWarning(e,n),void(this.value=t);o=this.mode!==a,this.setMode(a,null===this.internalColorUpdateContext)}const l=this.activeCanvasInfo;if("initial"===this.internalColorUpdateContext)return;if("user-interaction"===this.internalColorUpdateContext)return this.calciteColorPickerInput.emit(),void(l||this.calciteColorPickerChange.emit());const s=a&&!e?null:i.color(null!=e&&"object"==typeof e&&i.alphaCompatible(this.mode)?i.normalizeColor(e):e),r=!i.colorEqual(s,this.color);(o||r)&&this.internalColorSet(s,this.alphaChannel&&!(this.mode.endsWith("a")||this.mode.endsWith("a-css")),"internal")}get baseColorFieldColor(){return this.color||this.previousColor||S}effectiveLocaleChange(){u.updateMessages(this,this.effectiveLocale)}handleChannelKeyUpOrDown(e){this.shiftKeyChannelAdjustment=0;const{key:t}=e;if("ArrowUp"!==t&&"ArrowDown"!==t||!e.composedPath().some((e=>e.classList?.contains(b.channel))))return;const{shiftKey:i}=e;if(e.preventDefault(),!this.color)return this.internalColorSet(this.previousColor),void e.stopPropagation();const a=9;this.shiftKeyChannelAdjustment="ArrowUp"===t&&i?a:"ArrowDown"===t&&i?-a:0}async setFocus(){await n.componentLoaded(this),this.el.focus()}async componentWillLoad(){n.setUpLoadableComponent(this);const{allowEmpty:e,color:t,format:a,value:o}=this,l=e&&!o,s=i.parseMode(o),r=l||"auto"===a&&s||a===s,c=l?null:r?i.color(o):t;r||this.showIncompatibleColorWarning(o,a),this.setMode(a,!1),this.internalColorSet(c,!1,"initial"),this.updateDimensions(this.scale);const h=`${w}${this.storageId}`;this.storageId&&localStorage.getItem(h)&&(this.savedColors=JSON.parse(localStorage.getItem(h))),await u.setUpMessages(this)}connectedCallback(){d.connectLocalized(this),u.connectMessages(this)}componentDidLoad(){n.setComponentLoaded(this)}disconnectedCallback(){document.removeEventListener("pointermove",this.globalPointerMoveHandler),document.removeEventListener("pointerup",this.globalPointerUpHandler),d.disconnectLocalized(this),u.disconnectMessages(this)}componentDidRender(){c.updateHostInteraction(this)}render(){const{allowEmpty:e,channelsDisabled:a,color:n,colorFieldScopeLeft:o,colorFieldScopeTop:l,dimensions:{colorField:{width:s},slider:{width:r},thumb:{radius:c}},hexDisabled:h,hideChannels:d,hideHex:p,hideSaved:u,hueScopeLeft:m,messages:C,alphaChannel:f,opacityScopeLeft:g,savedColors:v,savedDisabled:y,scale:x,scopeOrientation:w}=this,k=n?i.hexify(n,f):null,E=c,F=m??r*S.hue()/I.h,H=c,P=g??s*i.alphaToOpacity(S.alpha())/D.max,A=null===n,L="vertical"===w,T=h||p,O=a||d,z=y||u;return t.h("div",{class:b.container},t.h("div",{class:b.controlAndScope},t.h("canvas",{class:b.colorField,onPointerDown:this.handleColorFieldPointerDown,ref:this.initColorField}),t.h("div",{"aria-label":L?C.value:C.saturation,"aria-valuemax":L?I.v:I.s,"aria-valuemin":"0","aria-valuenow":(L?n?.saturationv():n?.value())||"0",class:{[b.scope]:!0,[b.colorFieldScope]:!0},onKeyDown:this.handleColorFieldScopeKeyDown,role:"slider",style:{top:`${l||0}px`,left:`${o||0}px`},tabindex:"0",ref:this.storeColorFieldScope})),t.h("div",{class:b.previewAndSliders},t.h("calcite-color-picker-swatch",{class:b.preview,color:k,scale:"l"}),t.h("div",{class:b.sliders},t.h("div",{class:b.controlAndScope},t.h("canvas",{class:{[b.slider]:!0,[b.hueSlider]:!0},onPointerDown:this.handleHueSliderPointerDown,ref:this.initHueSlider}),t.h("div",{"aria-label":C.hue,"aria-valuemax":I.h,"aria-valuemin":"0","aria-valuenow":n?.round().hue()||S.round().hue(),class:{[b.scope]:!0,[b.hueScope]:!0},onKeyDown:this.handleHueScopeKeyDown,role:"slider",style:{top:`${E}px`,left:`${F}px`},tabindex:"0",ref:this.storeHueScope})),f?t.h("div",{class:b.controlAndScope},t.h("canvas",{class:{[b.slider]:!0,[b.opacitySlider]:!0},onPointerDown:this.handleOpacitySliderPointerDown,ref:this.initOpacitySlider}),t.h("div",{"aria-label":C.opacity,"aria-valuemax":D.max,"aria-valuemin":D.min,"aria-valuenow":(n||S).round().alpha(),class:{[b.scope]:!0,[b.opacityScope]:!0},onKeyDown:this.handleOpacityScopeKeyDown,role:"slider",style:{top:`${H}px`,left:`${P}px`},tabindex:"0",ref:this.storeOpacityScope})):null)),T&&O?null:t.h("div",{class:{[b.controlSection]:!0,[b.section]:!0}},t.h("div",{class:b.hexAndChannelsGroup},T?null:t.h("div",{class:b.hexOptions},t.h("calcite-color-picker-hex-input",{allowEmpty:e,alphaChannel:f,class:b.control,messages:C,numberingSystem:this.numberingSystem,onCalciteColorPickerHexInputChange:this.handleHexInputChange,scale:x,value:k})),O?null:t.h("calcite-tabs",{class:{[b.colorModeContainer]:!0,[b.splitSection]:!0},scale:"l"===x?"m":"s"},t.h("calcite-tab-nav",{slot:"title-group"},this.renderChannelsTabTitle("rgb"),this.renderChannelsTabTitle("hsv")),this.renderChannelsTab("rgb"),this.renderChannelsTab("hsv")))),z?null:t.h("div",{class:{[b.savedColorsSection]:!0,[b.section]:!0}},t.h("div",{class:b.header},t.h("label",null,C.saved),t.h("div",{class:b.savedColorsButtons},t.h("calcite-button",{appearance:"transparent",class:b.deleteColor,disabled:A,iconStart:"minus",kind:"neutral",label:C.deleteColor,onClick:this.deleteColor,scale:x,type:"button"}),t.h("calcite-button",{appearance:"transparent",class:b.saveColor,disabled:A,iconStart:"plus",kind:"neutral",label:C.saveColor,onClick:this.saveColor,scale:x,type:"button"}))),v.length>0?t.h("div",{class:b.savedColors},[...v.map((e=>t.h("calcite-color-picker-swatch",{class:b.savedColor,color:e,key:e,onClick:this.handleSavedColorSelect,onKeyDown:this.handleSavedColorKeyDown,scale:x,tabIndex:0})))]):null))}handleKeyDown(e){"Enter"===e.key&&e.preventDefault()}showIncompatibleColorWarning(e,t){console.warn(`ignoring color value (${e}) as it is not compatible with the current format (${t})`)}setMode(e,t=!0){const i="auto"===e?this.mode:e;this.mode=this.ensureCompatibleMode(i,t)}ensureCompatibleMode(e,t){const{alphaChannel:a}=this,n=i.alphaCompatible(e);if(a&&!n){const a=i.toAlphaMode(e);return t&&console.warn(`setting format to (${a}) as the provided one (${e}) does not support alpha`),a}if(!a&&n){const a=i.toNonAlphaMode(e);return t&&console.warn(`setting format to (${a}) as the provided one (${e}) does not support alpha`),a}return e}captureHueSliderColor(e){const{dimensions:{slider:{width:t}}}=this,i=360/t*e;this.internalColorSet(this.baseColorFieldColor.hue(i),!1)}captureOpacitySliderValue(e){const{dimensions:{slider:{width:t}}}=this,a=i.opacityToAlpha(D.max/t*e);this.internalColorSet(this.baseColorFieldColor.alpha(a),!1)}internalColorSet(e,t=!0,a="user-interaction"){t&&i.colorEqual(e,this.color)||(this.internalColorUpdateContext=a,this.color=e,this.value=this.toValue(e),this.internalColorUpdateContext=null)}toValue(e,t=this.mode){if(!e)return null;const a="hex";if(t.includes(a)){const a=t===i.CSSColorMode.HEXA;return i.normalizeHex(i.hexify(e.round(),a),a)}if(t.includes("-css")){const i=e[t.replace("-css","").replace("a","")]().round().string();if((t.endsWith("a")||t.endsWith("a-css"))&&1===e.alpha()){return`${i.slice(0,3)}a(${i.slice(4,-1)}, ${e.alpha()})`}return i}const n=e[i.toNonAlphaMode(t)]().round().object();return t.endsWith("a")?i.normalizeAlpha(n):n}getSliderCapSpacing(){const{dimensions:{slider:{height:e},thumb:{radius:t}}}=this;return 2*t-e}updateDimensions(e="m"){this.dimensions=E[e]}drawColorField(){const e=this.colorFieldRenderingContext,{dimensions:{colorField:{height:t,width:i}}}=this;e.fillStyle=this.baseColorFieldColor.hsv().saturationv(100).value(100).alpha(1).string(),e.fillRect(0,0,i,t);const a=e.createLinearGradient(0,0,i,0);a.addColorStop(0,"rgba(255,255,255,1)"),a.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=a,e.fillRect(0,0,i,t);const n=e.createLinearGradient(0,0,0,t);n.addColorStop(0,"rgba(0,0,0,0)"),n.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=n,e.fillRect(0,0,i,t),this.drawActiveColorFieldColor()}setCanvasContextSize(e,{height:t,width:i}){if(!e)return;const a=window.devicePixelRatio||1;e.width=i*a,e.height=t*a,e.style.height=`${t}px`,e.style.width=`${i}px`;e.getContext("2d").scale(a,a)}updateCanvasSize(e="all"){const{dimensions:t}=this;"all"!==e&&"color-field"!==e||this.setCanvasContextSize(this.colorFieldRenderingContext?.canvas,t.colorField);const i={width:t.slider.width,height:t.slider.height+2*(t.thumb.radius-t.slider.height/2)};"all"!==e&&"hue-slider"!==e||this.setCanvasContextSize(this.hueSliderRenderingContext?.canvas,i),"all"!==e&&"opacity-slider"!==e||this.setCanvasContextSize(this.opacitySliderRenderingContext?.canvas,i)}drawActiveColorFieldColor(){const{color:e}=this;if(!e)return;const t=e.hsv(),{dimensions:{colorField:{height:i,width:a},thumb:{radius:n}}}=this,o=t.saturationv()/(I.s/a),l=i-t.value()/(I.v/i);requestAnimationFrame((()=>{this.colorFieldScopeLeft=o,this.colorFieldScopeTop=l})),this.drawThumb(this.colorFieldRenderingContext,n,o,l,t)}drawThumb(e,t,i,a,n){const o=0,l=2*Math.PI,s=1;t-=s,e.beginPath(),e.arc(i,a,t,o,l),e.fillStyle="#fff",e.fill(),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=s,e.stroke(),e.beginPath(),e.arc(i,a,t-3,o,l),e.fillStyle=n.rgb().alpha(1).string(),e.fill()}drawActiveHueSliderColor(){const{color:e}=this;if(!e)return;const t=e.hsv().saturationv(100).value(100),{dimensions:{slider:{height:i,width:a},thumb:{radius:n}}}=this,o=t.hue()/(360/a),l=n-i/2+i/2;requestAnimationFrame((()=>{this.hueScopeLeft=o})),this.drawThumb(this.hueSliderRenderingContext,n,o,l,t)}drawHueSlider(){const e=this.hueSliderRenderingContext,{dimensions:{slider:{height:t,width:a},thumb:{radius:n}}}=this,o=0,l=n-t/2,s=e.createLinearGradient(0,0,a,0),r=["red","yellow","lime","cyan","blue","magenta","red"],c=1/(r.length-1);let h=0;r.forEach((e=>{s.addColorStop(h,i.color(e).string()),h+=c})),e.clearRect(0,0,a,t+2*this.getSliderCapSpacing()),this.drawSliderPath(e,t,a,o,l),e.fillStyle=s,e.fill(),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1,e.stroke(),this.drawActiveHueSliderColor()}drawOpacitySlider(){const e=this.opacitySliderRenderingContext,{baseColorFieldColor:t,dimensions:{slider:{height:i,width:a},thumb:{radius:n}}}=this,o=0,l=n-i/2;e.clearRect(0,0,a,i+2*this.getSliderCapSpacing());const s=e.createLinearGradient(0,l,a,0),r=t.rgb().alpha(0),c=t.rgb().alpha(.5),h=t.rgb().alpha(1);s.addColorStop(0,r.string()),s.addColorStop(.5,c.string()),s.addColorStop(1,h.string()),this.drawSliderPath(e,i,a,o,l);const d=e.createPattern(this.getCheckeredBackgroundPattern(),"repeat");e.fillStyle=d,e.fill(),e.fillStyle=s,e.fill(),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1,e.stroke(),this.drawActiveOpacitySliderColor()}drawSliderPath(e,t,i,a,n){const o=t/2+1;e.beginPath(),e.moveTo(a+o,n),e.lineTo(a+i-o,n),e.quadraticCurveTo(a+i,n,a+i,n+o),e.lineTo(a+i,n+t-o),e.quadraticCurveTo(a+i,n+t,a+i-o,n+t),e.lineTo(a+o,n+t),e.quadraticCurveTo(a,n+t,a,n+t-o),e.lineTo(a,n+o),e.quadraticCurveTo(a,n,a+o,n),e.closePath()}getCheckeredBackgroundPattern(){if(this.checkerPattern)return this.checkerPattern;const e=document.createElement("canvas");e.width=10,e.height=10;const t=e.getContext("2d");return t.fillStyle="#ccc",t.fillRect(0,0,10,10),t.fillStyle="#fff",t.fillRect(0,0,5,5),t.fillRect(5,5,5,5),this.checkerPattern=e,e}drawActiveOpacitySliderColor(){const{color:e}=this;if(!e)return;const t=e,{dimensions:{slider:{width:a},thumb:{radius:n}}}=this,o=i.alphaToOpacity(t.alpha())/(D.max/a),l=n;requestAnimationFrame((()=>{this.opacityScopeLeft=o})),this.drawThumb(this.opacitySliderRenderingContext,n,o,l,t)}updateColorFromChannels(e){this.internalColorSet(i.color(e,this.channelMode))}updateChannelsFromColor(e){this.channels=e?this.toChannels(e):[null,null,null,null]}toChannels(e){const{channelMode:t}=this,i=e[t]().array().map(((e,t)=>3===t?e:Math.floor(e)));return 3===i.length&&i.push(1),i}static get delegatesFocus(){return!0}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{alphaChannel:["handleAlphaChannelChange"],color:["handleColorChange"],format:["handleFormatChange"],scale:["handleScaleChange"],messageOverrides:["onMessagesChange"],value:["handleValueChange"],effectiveLocale:["effectiveLocaleChange"]}}static get style(){return z}},[17,"calcite-color-picker",{allowEmpty:[516,"allow-empty"],alphaChannel:[4,"alpha-channel"],channelsDisabled:[4,"channels-disabled"],color:[1040],disabled:[516],format:[513],hideChannels:[516,"hide-channels"],hexDisabled:[4,"hex-disabled"],hideHex:[516,"hide-hex"],hideSaved:[516,"hide-saved"],savedDisabled:[516,"saved-disabled"],scale:[513],storageId:[513,"storage-id"],messageOverrides:[1040],numberingSystem:[513,"numbering-system"],value:[1025],messages:[1040],defaultMessages:[32],channelMode:[32],channels:[32],dimensions:[32],effectiveLocale:[32],savedColors:[32],colorFieldScopeTop:[32],colorFieldScopeLeft:[32],hueScopeLeft:[32],opacityScopeLeft:[32],scopeOrientation:[32],setFocus:[64]},[[2,"keydown","handleChannelKeyUpOrDown"],[2,"keyup","handleChannelKeyUpOrDown"]]]);function K(){if("undefined"==typeof customElements)return;["calcite-color-picker","calcite-button","calcite-color-picker-hex-input","calcite-color-picker-swatch","calcite-icon","calcite-input","calcite-input-number","calcite-loader","calcite-progress","calcite-tab","calcite-tab-nav","calcite-tab-title","calcite-tabs"].forEach((e=>{switch(e){case"calcite-color-picker":customElements.get(e)||customElements.define(e,M);break;case"calcite-button":customElements.get(e)||m.defineCustomElement();break;case"calcite-color-picker-hex-input":customElements.get(e)||L();break;case"calcite-color-picker-swatch":customElements.get(e)||i.defineCustomElement();break;case"calcite-icon":customElements.get(e)||o.defineCustomElement();break;case"calcite-input":customElements.get(e)||l.defineCustomElement();break;case"calcite-input-number":customElements.get(e)||s.defineCustomElement();break;case"calcite-loader":customElements.get(e)||C.defineCustomElement();break;case"calcite-progress":customElements.get(e)||r.defineCustomElement();break;case"calcite-tab":customElements.get(e)||f.defineCustomElement();break;case"calcite-tab-nav":customElements.get(e)||g.defineCustomElement();break;case"calcite-tab-title":customElements.get(e)||v.defineCustomElement();break;case"calcite-tabs":customElements.get(e)||y.defineCustomElement()}}))}K();const N=M,_=K;e.CalciteColorPicker=N,e.defineCustomElement=_,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
