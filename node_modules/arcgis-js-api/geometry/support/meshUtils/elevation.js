/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../geometry","../../../Ground","../../../core/Logger","../../../core/promiseUtils","../../../core/unitUtils","../../Mesh","../../projection","../Indices","../MeshComponent","../MeshVertexAttributes","../../Point"],(function(e,t,n,o,i,a,r,s,l,c,u,m){"use strict";async function p(e,t,i){let a;if(y(e)||e instanceof n){const n=await f(e);return a=await n.createElevationSampler(t,{demResolution:i?.demResolution??"finest-contiguous"}),d(a,t,{material:i?.material})}return"string"==typeof i?.demResolution?(o.getLogger("esri.geometry.support.meshUtils.elevation").error("create()","demResolution must be a number when used directly with a sampler"),null):d(e,t,{material:i?.material,demResolution:i?.demResolution})}function d(e,t,n){const o=a.getMetersPerUnitForSR(t.spatialReference),i=(n?.demResolution??e.demResolution.min)/o,m=Math.round(t.width/i),p=Math.round(t.height/i),d=m+1,f=p+1,y=new Float64Array(d*f*3),R=new Float32Array(d*f*2);let w=0,g=0;const v=new Uint32Array(m*p*2*3);let A=0,b=0;const M=!e.spatialReference.equals(t.spatialReference);h.spatialReference=t.spatialReference;const{xmin:x,ymin:U,height:S,width:j}=t;for(let a=0;a<f;a++){const t=U+S*(a/p);for(let n=0;n<d;n++){const o=x+j*(n/m);if(y[w++]=o,y[w++]=t,M){h.x=o,h.y=t;const n=s.project(h,e.spatialReference);y[w++]=e.elevationAt(n.x,n.y)??0}else y[w++]=e.elevationAt(o,t)??0;const i=n/m,r=a/p;R[g++]=i,R[g++]=r,a!==p&&n!==m&&(v[b++]=A+1,v[b++]=A+d+1,v[b++]=A+d,v[b++]=A,v[b++]=A+1,v[b++]=A+d),A++}}return new r({vertexAttributes:new u.MeshVertexAttributes({position:y,uv:R}),components:[new c({faces:l.compactIndices(v),shading:"smooth",material:n?.material??null})],spatialReference:t.spatialReference})}async function f(e){return y(e)?e.load():(await e.load(),await i.eachAlways(e.layers.map((e=>e.load()))),e)}function y(e){return"type"in e&&("elevation"===e.type||"base-elevation"===e.type)}const h=new m;e.create=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
