/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/mat3","../../../chunks/mat3f64","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec3","../../../chunks/vec3f64","../../projection","../../spatialReferenceEllipsoidUtils","../axisAngleDegrees","../MeshTransform","./geographicUtils","./projection"],(function(t,e,r,o,n,i,a,s,l,c,u,p,g,f){"use strict";const m="esri.geometry.support.meshUtils.rotate";function h(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position||0===e[3])return;const{spatialReference:o,vertexSpace:n}=t;if(n.isRelative){g.validateGeographicFlag(n,m,r);const o=r?.origin??t.origin;t.transform??(t.transform=new p),P(t.transform,n,e,o)}else{const n=r?.origin??t.origin;g.isGeographicMesh(o,r)?d(t,e,n):v(t,e,n)}}function P(t,e,r,o){const n=e.origin,i=a.set(b,o.x,o.y,o.z??0),l=a.subtract(b,i,n);t.applyLocalInverse(l,j),t.rotation=u.compose(t.rotation,r,u.create()),t.applyLocalInverse(l,l),a.subtract(l,l,j),t.translation=a.add(s.create(),t.translation,l)}function d(t,e,o){const n=t.spatialReference,i=c.getSphericalPCPF(n),s=y;l.projectPointToVector(o,s,i)||l.projectPointToVector(t.origin,s,i);const p=t.vertexAttributes.position,g=t.vertexAttributes.normal,m=t.vertexAttributes.tangent,h=new Float64Array(p.length),P=null!=g?new Float32Array(g.length):null,d=null!=m?new Float32Array(m.length):null;l.computeTranslationToOriginAndRotation(i,s,F,i),r.fromMat4(T,F);const v=A;a.transformMat3(u.axis(A),u.axis(e),T),v[3]=e[3],f.projectToPCPF(p,n,h),null!=g&&null!=P&&f.projectNormalToPCPF(g,p,h,n,P),null!=m&&null!=d&&f.projectTangentToPCPF(m,p,h,n,d),x(h,v,3,s),f.projectFromPCPF(h,p,n),null!=g&&null!=P&&(x(P,v,3),f.projectNormalFromPCPF(P,p,h,n,g)),null!=m&&null!=d&&(x(d,v,4),f.projectTangentFromPCPF(d,p,h,n,m)),t.vertexAttributesChanged()}function v(t,r,o){const n=y;if(!l.projectPointToVector(o,n,t.spatialReference)){const r=t.origin;n[0]=r.x,n[1]=r.y,n[2]=r.z,e.getLogger(m).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}x(t.vertexAttributes.position,r,3,n),x(t.vertexAttributes.normal,r,3),x(t.vertexAttributes.tangent,r,4),t.vertexAttributesChanged()}function x(t,e,r,o=s.ZEROS){if(null!=t){n.fromRotation(F,u.angleRad(e),u.axis(e));for(let e=0;e<t.length;e+=r){for(let r=0;r<3;r++)b[r]=t[e+r]-o[r];a.transformMat4(b,b,F);for(let r=0;r<3;r++)t[e+r]=b[r]+o[r]}}}const b=s.create(),j=s.create(),A=u.create(),F=i.create(),T=o.create(),y=s.create();t.rotate=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
