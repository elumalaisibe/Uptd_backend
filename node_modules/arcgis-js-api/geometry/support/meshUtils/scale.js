/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/vec3","../../../chunks/vec3f64","../../projection","../../spatialReferenceEllipsoidUtils","../MeshTransform","./geographicUtils","./projection"],(function(e,t,r,o,n,i,l,a,c){"use strict";const s="esri.geometry.support.meshUtils.scale";function p(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const{spatialReference:o,vertexSpace:n}=e;if(n.isRelative){a.validateGeographicFlag(n,s,r);const o=r?.origin??e.origin;e.transform??(e.transform=new l),u(e.transform,n,t,o)}else{const n=a.isGeographicMesh(o,r),i=r?.origin??e.origin;n?g(e,t,i):f(e,t,i)}}function u(e,t,n,i){const l=t.origin,a=r.set(d,i.x,i.y,i.z),c=r.subtract(d,a,l);e.applyLocalInverse(c,h);const s=r.scale(o.create(),e.scale,n);e.scale=s,e.applyLocalInverse(c,c),r.subtract(c,c,h),e.translation=r.add(o.create(),e.translation,c)}function g(e,t,r){const o=e.spatialReference,l=i.getSphericalPCPF(o),a=v;n.projectPointToVector(r,a,l)||n.projectPointToVector(e.origin,a,l);const s=e.vertexAttributes.position,p=e.vertexAttributes.normal,u=e.vertexAttributes.tangent,g=new Float64Array(s.length),f=null!=p?new Float32Array(p.length):null,d=null!=u?new Float32Array(u.length):null;c.projectToPCPF(s,o,g),null!=p&&null!=f&&c.projectNormalToPCPF(p,s,g,o,f),null!=u&&null!=d&&c.projectTangentToPCPF(u,s,g,o,d),P(g,t,a),c.projectFromPCPF(g,s,o),null!=p&&null!=f&&c.projectNormalFromPCPF(f,s,g,o,p),null!=u&&null!=d&&c.projectTangentFromPCPF(d,s,g,o,u),e.vertexAttributesChanged()}function f(e,r,o){const i=v;if(!n.projectPointToVector(o,i,e.spatialReference)){const r=e.origin;i[0]=r.x,i[1]=r.y,i[2]=r.z,t.getLogger(s).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}P(e.vertexAttributes.position,r,i),e.vertexAttributesChanged()}function P(e,t,n=o.ZEROS){if(e)for(let o=0;o<e.length;o+=3){for(let t=0;t<3;t++)d[t]=e[o+t]-n[t];r.scale(d,d,t);for(let t=0;t<3;t++)e[o+t]=d[t]+n[t]}}const d=o.create(),h=o.create(),v=o.create();e.scale=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
