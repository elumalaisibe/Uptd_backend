/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/PriorityQueue","../geometryCursorCollectUtils","./aaBoundingRect","./boundsUtils","./centroid","./coordsUtils","./intersectsBase"],(function(e,t,n,i,o,r,s,a,l){"use strict";const c=100*222045e-21;function u(e){return N({rings:i.collectMultipath(e)})}function N(e){const{rings:t}=e;if(!t||0===t.length)return null;const n=r.getBoundsXY(o.create(),e);if(!n)return null;const i=4*(Math.abs(n[0])+Math.abs(n[2])+Math.abs(n[1])+Math.abs(n[3])+1)*c;let l=0,u=0;for(let o=0;o<t.length;o++){const e=a.getRingArea(t[o]);e>u&&(u=e,l=o)}if(Math.abs(u)<=2*i*i){const e=r.getPointsBounds(o.create(),t[l]);return[(e[0]+e[2])/2,(e[1]+e[3])/2]}const N=s.ringCentroid(t[l],!1,o.create());if(null===N)return null;if(1===t.length&&t[0].length<4)return N;const d=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],m=[NaN,NaN,NaN,NaN],P=[NaN,NaN,NaN,NaN];let b=!1,y=h(N,e,!0);0===y.distance&&(b=!0,d[0][0]=N[0],d[0][1]=N[1],y=h(N,e,!1)),m[0]=y.distance,P[0]=0;const C=[NaN,NaN];let M=!1,p=.25,q=-1;const B=r.getPointsBounds(o.create(),t[l]);let T=NaN;do{if(T=NaN,d[1]=g(e,x(B[0],B[2],p),i,n),isNaN(d[1][0])||isNaN(d[1][1])||(y=h(d[1],e,!1),T=y.distance),!isNaN(T)&&T>i&&f(d[1],e))M=!0,m[1]=T,P[1]=w(d[1],N);else if(!isNaN(T)&&T>q&&(q=T,C[0]=d[1][0],C[1]=d[1][1]),p-=.01,p<.1){if(!(q>=0))break;M=!0,m[1]=q,d[1][0]=C[0],d[1][1]=C[1],P[1]=w(d[1],N)}}while(!M);M=!1,p=.5,q=-1;let S=.01,z=1;do{if(T=NaN,d[2]=g(e,x(B[0],B[2],p),i,n),isNaN(d[2][0])||isNaN(d[2][1])||(y=h(d[2],e,!1),T=y.distance),!isNaN(T)&&T>i&&f(d[2],e))M=!0,m[2]=T,P[2]=w(d[2],N);else if(!isNaN(T)&&T>q)q=T,C[0]=d[2][0],C[1]=d[2][1];else if(T>q&&(q=T,C[0]=d[2][0],C[1]=d[2][1]),p=.5+S*z,S+=.01,z*=-1,p<.3||p>.7){if(!(q>=0))break;M=!0,m[2]=q,d[2][0]=C[0],d[2][1]=C[1],P[2]=w(d[2],N)}}while(!M);M=!1,p=.75,q=-1;do{if(T=NaN,d[3]=g(e,x(B[0],B[2],p),i,n),isNaN(d[3][0])||isNaN(d[3][1])||(y=h(d[3],e,!1),T=y.distance),!isNaN(T)&&T>i&&f(d[3],e))M=!0,m[3]=T,P[3]=w(d[3],N);else if(T>q&&(q=T,C[0]=d[3][0],C[1]=d[3][1]),p+=.01,p>.9){if(!(q>=0))break;M=!0,m[3]=q,d[3][0]=C[0],d[3][1]=C[1],P[3]=w(d[3],N)}}while(!M);const D=[0,1,2,3],R=b?0:1;let U;for(let o=R;o<4;o++)for(let e=R;e<3;e++){const t=P[e],n=P[e+1];k(t,n)>0&&(U=D[e],D[e]=D[e+1],D[e+1]=U,P[e]=n,P[e+1]=t)}let j=R,A=0,L=0;for(let o=R;o<4;o++){switch(o){case 0:L=2*m[D[o]];break;case 1:L=1.66666666*m[D[o]];break;case 2:L=1.33333333*m[D[o]];break;case 3:L=m[D[o]]}L>A&&(A=L,j=D[o])}return d[j]}function f(e,t){const{rings:n}=t;let i=0;for(const o of n){const t=o.length;for(let n=1;n<t;++n){const t=o[n-1],r=o[n];if(t[1]>e[1]==r[1]>e[1])continue;(r[0]-t[0])*(e[1]-t[1])-(r[1]-t[1])*(e[0]-t[0])>0?i++:i--}}return 0!==i}function h(e,t,n){if(n&&f(e,t))return{coord:e,distance:0};let i=1/0,o=0,r=0;const s=[0,0],{rings:l}=t;for(const c of l)if(!(c.length<2))for(let t=0;t<c.length-1;t++){a.projectPointOnLine(s,e,c,t);const n=w(e,s);n<i&&(i=n,o=s[0],r=s[1])}return{coord:[o,r],distance:Math.sqrt(i)}}function g(e,t,n,i){const r=[t,0];let s=1/0,a=1/0,c=!1,u=!1;const N=[[t,i[1]-1],[t,i[3]+1]],f=[0,0],h=[0,0],g=[0,0],m=[[0,0],[0,0]],P=o.create(),{rings:b}=e;for(const o of b)if(!(o.length<2))for(let e=1;e<o.length;e++){if(m[0][0]=o[e-1][0],m[0][1]=o[e-1][1],m[1][0]=o[e][0],m[1][1]=o[e][1],null===d(P,m))continue;if(h[0]=N[0][0],h[1]=N[0][1],g[0]=N[1][0],g[1]=N[1][1],0===C(P,h,g))continue;if(!l.segmentIntersects(N[0],N[1],m[0],m[1],f))continue;const t=f[1];s>a?t<s&&(s=t,c=!0):t<a&&(a=t,u=!0)}return c&&u?r[1]=(s+a)/2:r[0]=r[1]=NaN,r}function d(e,t){if(t.length<2)return null;e||(e=o.create());const[n,i]=t[0],[r,s]=t[1];return e[0]=Math.min(n,r),e[1]=Math.min(i,s),e[2]=Math.max(n,r),e[3]=Math.max(i,s),e}const m=1,P=4,b=3,y=12;function C(e,t,n){let i=M(t,e),o=M(n,e);const r=e[0],s=e[1],a=e[2],l=e[3];if(i&o)return 0;if(!(i|o))return 4;const c=(i?1:0)|(o?2:0);do{const c=n[0]-t[0],u=n[1]-t[1];if(c>u)i&b?(i&m?(t[1]+=u*(r-t[0])/c,t[0]=r):(t[1]+=u*(a-t[0])/c,t[0]=a),i=M(t,e)):o&b?(o&m?(n[1]+=u*(r-n[0])/c,n[0]=r):(n[1]+=u*(a-n[0])/c,n[0]=a),o=M(n,e)):i?(i&P?(t[0]+=c*(s-t[1])/u,t[1]=s):(t[0]+=c*(l-t[1])/u,t[1]=l),i=M(t,e)):(o&P?(n[0]+=c*(s-n[1])/u,n[1]=s):(n[0]+=c*(l-n[1])/u,n[1]=l),o=M(n,e));else if(i&y?(i&P?(t[0]+=c*(s-t[1])/u,t[1]=s):(t[0]+=c*(l-t[1])/u,t[1]=l),i=M(t,e)):o&y?(o&P?(n[0]+=c*(s-n[1])/u,n[1]=s):(n[0]+=c*(l-n[1])/u,n[1]=l),o=M(n,e)):i?(i&m?(t[1]+=u*(r-t[0])/c,t[0]=r):(t[1]+=u*(a-t[0])/c,t[0]=a),i=M(t,e)):(o&m?(n[1]+=u*(r-n[0])/c,n[0]=r):(n[1]+=u*(a-n[0])/c,n[0]=a),o=M(n,e)),i&o)return 0}while(i|o);return c}function M(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function x(e,t,n){return e+(t-e)*n}function w(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function k(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const n=isNaN(e),i=isNaN(t);return n<i?-1:n>i?1:0}let p=t._createClass((function(e,t,n,i){this.x=e,this.y=t,this.cellSize=n,this.distancefromCellCenter=a.distanceFromPointToPolygon(e,t,i),this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}));const q=1,B=100;function T(e){if(!e.nextPath()||!e.numPoints)return null;const t=r.currPathBounds(e),i=t[2]-t[0],o=t[3]-t[1];if(0===i||0===o)return[t[0]+i/2,t[1]+o/2];const a=Math.max(Math.min(i,o)/B,q),l=new n(((e,t)=>t.maxDistanceToPolygon-e.maxDistanceToPolygon)),c=Math.min(i,o);let u=c/2,N=0,f=0;for(N=t[0];N<t[2];N+=c)for(f=t[1];f<t[3];f+=c)l.enqueue(new p(N+u,f+u,u,e));const h=s.ringsCentroidCursor(e);if(null===h)return null;let g,d=new p(h[0],h[1],0,e);for(;l.size>0;)g=l.dequeue(),g.distancefromCellCenter>d.distancefromCellCenter&&(d=g),g.maxDistanceToPolygon-d.distancefromCellCenter<=a||(u=g.cellSize/2,l.enqueue(new p(g.x-u,g.y-u,u,e)),l.enqueue(new p(g.x+u,g.y-u,u,e)),l.enqueue(new p(g.x-u,g.y+u,u,e)),l.enqueue(new p(g.x+u,g.y+u,u,e)));return[d.x,d.y]}e.getLabelPoint=N,e.getPolylabelPoint=T,e.labelPointAdapter=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
