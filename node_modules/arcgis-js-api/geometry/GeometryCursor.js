/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],(function(t,i,n,e,s,o){"use strict";let h=function(){function t(){}t.fromOptimized=function(t,i,n=!1,e=!1){return(new r).initialize(t,i,n,e,1)},t.fromJSON=function(t,i=!1,n=!1){const[e,s]=c(t);return(new a).initialize(e,s,i,n,1)},t.fromOptimizedCIM=function(t,i,n=!1,e=!1){return(new _).initialize(t,i,n,e,1)},t.fromJSONCIM=function(t,i=!1,n=!1){const[e,s]=c(t);return(new y).initialize(e,s,i,n,1)},t.fromFeatureSetReader=function(t){const i=t.readGeometryForDisplay(),n=t.geometryType;return i&&n?this.fromOptimized(i,n):null},t.fromFeatureSetReaderCIM=function(t){const i=t.readGeometryForDisplay(),n=t.geometryType;return i&&n?this.fromOptimizedCIM(i,n):null},t.createEmptyOptimized=function(t,i=!1,n=!1){return(new r).initialize(new o,t,i,n,1)},t.createEmptyJSON=function(t,i=!1,n=!1){return(new a).initialize([],t,i,n,1)},t.createEmptyOptimizedCIM=function(t,i=!1,n=!1){return(new _).initialize(new o,t,i,n,1)},t.createEmptyJSONCIM=function(t,i=!1,n=!1){return(new y).initialize([],t,i,n,1)};var n=t.prototype;return n.asJSON=function(){const t=e.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:t[0][0][0],ymin:t[0][0][1],xmax:t[0][2][0],ymax:t[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:t.flat()}:"esriGeometryPoint"===this.geometryType?{x:t[0][0][0],y:t[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:t}:{paths:t}},n.invertY=function(){this.yFactor*=-1},i._createClass(t)}(),r=function(t){function n(){var i;return(i=t.apply(this,arguments)||this)._end=-1,i}i._inherits(n,t);var e=n.prototype;return e.initialize=function(t,i,n,e,s){return this.hasZ=n,this.hasM=e,this.geometryType=i,this._stride=2+Number(n)+Number(e),this._geometry=t,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=s,this},e.reset=function(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)},e.seekPathStart=function(){this._pointOffset=this._pathOffset-this._stride},e.seekPathEnd=function(){this._pointOffset=this._end},e.seekInPath=function(t){const i=this._pathOffset+t*this._stride;return i>=0&&i<this._end&&(this._pointOffset=i,!0)},e.nextPoint=function(){return(this._pointOffset+=this._stride)<this._end},e.prevPoint=function(){return(this._pointOffset-=this._stride)>=this._pathOffset},e.nextPath=function(){if(this._pathIndex>=0){const t=this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex];this._pathOffset+=this._stride*t}this._pointOffset=this._pathOffset-this._stride;const t=this._geometry.isPoint?1:this._geometry.lengths[this._pathIndex+1];return this._end=this._pointOffset+this._stride+this._stride*t,++this._pathIndex<this.numPaths},e.pathLength=function(){const t=this._end,i=this._stride,n=this._geometry.coords;let e=0;for(let s=this._pathOffset+i;s<t;s+=i){const t=n[s-i],o=n[s-i+1],h=n[s]-t,r=n[s+1]-o;e+=Math.sqrt(h*h+r*r)}return e},e.startPath=function(){this._geometry.lengths.push(0)},e.pushPath=function(t){this.startPath(),this.pushPoints(t)},e.pushPoint=function(t){for(let i=0;i<this._stride;++i)this._geometry.coords.push(t[i]);this._geometry.lengths[this.numPaths-1]++},e.pushXY=function(t,i){this._geometry.coords.push(t,i),this._geometry.lengths[this.numPaths-1]++},e.pushPoints=function(t){for(const i of t)for(let t=0;t<this._stride;++t)this._geometry.coords.push(i[t]);this._geometry.lengths[this.numPaths-1]+=t.length},e.asOptimized=function(){const t=this._geometry.clone();if(1!==this.yFactor)for(let i=1;i<t.coords.length;i+=this._stride)t.coords[i]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(t.lengths.length=0),t},e.isClosed=function(){const t=this._geometry.coords,i=this._pathOffset,n=this._end-this._stride;for(let e=0;e<this._stride;e++)if(t[i+e]!==t[n+e])return!1;return!0},e.clone=function(){return(new n).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)},i._createClass(n,[{key:"numPoints",get:function(){const{lengths:t}=this._geometry;return this._pathIndex<0||this._pathIndex>t.length-1?0:t[this._pathIndex]}},{key:"numPaths",get:function(){return this._geometry.lengths.length}},{key:"x",get:function(){return this._geometry.coords[this._pointOffset]},set:function(t){this._geometry.coords[this._pointOffset]=t}},{key:"y",get:function(){return this.yFactor*this._geometry.coords[this._pointOffset+1]},set:function(t){this._geometry.coords[this._pointOffset+1]=this.yFactor*t}},{key:"z",get:function(){return this._geometry.coords[this._pointOffset+2]},set:function(t){this._geometry.coords[this._pointOffset+2]=t}},{key:"m",get:function(){const t=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+t]},set:function(t){this._geometry.coords[this._pointOffset+3]=t}},{key:"pathIndex",get:function(){return this._pathIndex}},{key:"pointIndex",get:function(){return this._pointOffset/this._stride}}]),n}(h);function u(t){const i=[t.x,t.y];return t.z&&i.push(t.z),t.m&&i.push(t.m),i}function c(t){return s.isPolygon(t)?[t.rings,"esriGeometryPolygon"]:s.isPolyline(t)?[t.paths,"esriGeometryPolyline"]:s.isMultipoint(t)?[[t.points],"esriGeometryMultipoint"]:s.isExtent(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:s.isPoint(t)?[[[u(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let a=function(t){function e(){return t.apply(this,arguments)||this}i._inherits(e,t);var s=e.prototype;return s.initialize=function(t,i,n,e,s){return this._paths=t,this.geometryType=i,this.hasZ=n,this.hasM=e,this._pathIndex=this._pointIndex=-1,this.yFactor=s,this._mIdx=this.hasZ?3:2,this},s.reset=function(){this._pathIndex=this._pointIndex=-1},s.seekPathStart=function(){this._pointIndex=-1},s.seekPathEnd=function(){this._pointIndex=this._currentPath.length},s.seekInPath=function(t){return t>=0&&t<this._currentPath.length&&(this._pointIndex=t,this._currentPoint=this._currentPath[this._pointIndex],!0)},s.nextPoint=function(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length},s.prevPoint=function(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0},s.nextPath=function(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.numPaths},s.pathLength=function(){const t=this._currentPath.length,i=this._currentPath;let n=0;for(let e=1;e<t;e++){const t=i[e-1],s=i[e],o=t[0],h=t[1],r=s[0]-o,u=s[1]-h;n+=Math.sqrt(r*r+u*u)}return n},s.startPath=function(){this._paths.push([])},s.pushPath=function(t){this._paths.push(t)},s.pushPoint=function(t){this._paths[this.pathIndex].push(t)},s.pushXY=function(t,i){this._paths[this.pathIndex].push([t,i])},s.pushPoints=function(t){this._paths[this.pathIndex].push(...t)},s.asOptimized=function(){const t=new o;if("esriGeometryPoint"===this.geometryType)t.coords.push(...this._paths[0][0]),t.lengths.length=0;else for(const i of this._paths){for(const n of i)t.coords.push(n[0]),t.coords.push(n[1]*this.yFactor),this.hasZ&&t.coords.push(n[2]),this.hasM&&t.coords.push(n[this._mIdx]);t.lengths.push(i.length)}return t},s.isClosed=function(){const t=this._currentPath[0],i=this._currentPath[this._currentPath.length-1];for(let n=0;n<t.length;n++)if(t[n]!==i[n])return!1;return!0},s.clone=function(){return(new e).initialize(n.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)},i._createClass(e,[{key:"numPoints",get:function(){return this._pathIndex<0||this._pathIndex>this.numPaths-1?-1:this._paths[this._pathIndex].length}},{key:"numPaths",get:function(){return this._paths.length}},{key:"x",get:function(){return this._currentPoint[0]},set:function(t){this._currentPoint[0]=t}},{key:"y",get:function(){return this.yFactor*this._currentPoint[1]},set:function(t){this._currentPoint[1]=this.yFactor*t}},{key:"z",get:function(){return this._currentPoint[2]},set:function(t){this._currentPoint[2]=t}},{key:"m",get:function(){return this._currentPoint[this._mIdx]},set:function(t){this._currentPoint[this._mIdx]=t}},{key:"pathIndex",get:function(){return this._pathIndex}},{key:"pointIndex",get:function(){return this._pointIndex}}]),e}(h);const p=4,f=1;let _=function(t){function n(){return t.apply(this,arguments)||this}i._inherits(n,t);var e=n.prototype;return e.initialize=function(t,e,s,o,h){return i._get(i._getPrototypeOf(n.prototype),"initialize",this).call(this,t,e,s,o,h),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.numPaths).fill(void 0).map((t=>new Set))),this},e.startPath=function(){i._get(i._getPrototypeOf(n.prototype),"startPath",this).call(this),this._controlPoints.push(new Set)},e.clone=function(){const t=(new n).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return t._controlPoints=this._controlPoints,t},e.setControlPoint=function(){this._controlPoints[this.pathIndex].add(this.pointIndex)},e.getControlPoint=function(){return this._controlPoints[this.pathIndex].has(this.pointIndex)},e.setControlPointAt=function(t){this._controlPoints[this.pathIndex].add(t)},e.getControlPointAt=function(t){return this._controlPoints[this.pathIndex].has(t)},i._createClass(n)}(r),y=function(t){function e(){return t.apply(this,arguments)||this}i._inherits(e,t);var s=e.prototype;return s.initialize=function(t,n,s,o,h){return i._get(i._getPrototypeOf(e.prototype),"initialize",this).call(this,t,n,s,o,h)},s.clone=function(){return(new e).initialize(n.clone(this._paths),this.geometryType,this.hasZ,this.hasM,1)},s.setControlPoint=function(){this._paths[this.pathIndex][this.pointIndex][p]=f},s.getControlPoint=function(){return this._paths[this.pathIndex][this.pointIndex][p]===f},s.setControlPointAt=function(t){this._paths[this.pathIndex][t][p]=f},s.getControlPointAt=function(t){return this._paths[this.pathIndex][t][p]===f},i._createClass(e)}(a);t.GeometryCursor=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
