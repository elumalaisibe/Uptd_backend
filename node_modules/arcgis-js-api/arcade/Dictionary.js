/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","./ArcadeDate","./deepClone","./executionError","./ImmutableArray","../chunks/languageUtils","../geometry/Geometry"],(function(t,e,n,i,r,s,o){"use strict";function a(t,e,n=!1,i=!1){if(null==t)return null;if(s.isNumber(t))return s.toNumber(t);if(s.isBoolean(t))return s.toBoolean(t);if(s.isString(t))return s.toString(t);if(s.isDate(t))return s.toDate(t,e);if(s.isArray(t)){const r=[];for(const s of t)r.push(a(s,e,n,i));return r}if(i&&s.isGeometry(t))return t;const r=new u;r.immutable=!1;for(const s of Object.keys(t)){const o=t[s];void 0!==o&&r.setField(s,a(o,e,n,i))}return r.immutable=n,r}let u=function(){function u(t){this.declaredClass="esri.arcade.Dictionary",this.attributes=null,this.plain=!1,this.immutable=!0,this.attributes=t instanceof u?t.attributes:t??{}}var c=u.prototype;return c.field=function(t){const e=t.toLowerCase(),n=this.attributes[t];if(void 0!==n)return n;for(const i in this.attributes)if(i.toLowerCase()===e)return this.attributes[i];throw new i.ArcadeExecutionError(null,i.ExecutionErrorCodes.FieldNotFound,null,{key:t})},c.setField=function(t,n){if(this.immutable)throw new i.ArcadeExecutionError(null,i.ExecutionErrorCodes.Immutable,null);if(s.isFunctionParameter(n))throw new i.ArcadeExecutionError(null,i.ExecutionErrorCodes.NoFunctionInDictionary,null);const r=t.toLowerCase();n instanceof Date&&(n=e.ArcadeDate.dateJSToArcadeDate(n));if(void 0===this.attributes[t]){for(const t in this.attributes)if(t.toLowerCase()===r)return void(this.attributes[t]=n);this.attributes[t]=n}else this.attributes[t]=n},c.hasField=function(t){const e=t.toLowerCase();if(void 0!==this.attributes[t])return!0;for(const n in this.attributes)if(n.toLowerCase()===e)return!0;return!1},c.keys=function(){let t=[];for(const e in this.attributes)t.push(e);return t=t.sort(),t},c.castToText=function(t=!1){let n="";for(const i in this.attributes){""!==n&&(n+=",");const a=this.attributes[i];null==a?n+=JSON.stringify(i)+":null":s.isBoolean(a)||s.isNumber(a)||s.isString(a)?n+=JSON.stringify(i)+":"+JSON.stringify(a):a instanceof o?n+=JSON.stringify(i)+":"+s.toStringExplicit(a):a instanceof r||a instanceof Array?n+=JSON.stringify(i)+":"+s.toStringExplicit(a,null,t):a instanceof e.ArcadeDate?n+=t?JSON.stringify(i)+":"+JSON.stringify(a.getTime()):JSON.stringify(i)+":"+a.stringify():null!==a&&"object"==typeof a&&void 0!==a.castToText&&(n+=JSON.stringify(i)+":"+a.castToText(t))}return"{"+n+"}"},u.convertObjectToArcadeDictionary=function(t,e,n=!0,i=!1){const r=new u;r.immutable=!1;for(const s in t){const o=t[s];void 0!==o&&r.setField(s.toString(),a(o,e,n,i))}return r.immutable=n,r},u.convertJsonToArcade=function(t,e,n=!1){return a(t,e,n)},c.castAsJson=function(t=null){const e={};for(let n in this.attributes){const i=this.attributes[n];void 0!==i&&(t?.keyTranslate&&(n=t.keyTranslate(n)),e[n]=s.castAsJson(i,t))}return e},c.castDictionaryValueAsJsonAsync=async function(t,e,n,i=null,r){const o=await s.castAsJsonAsync(n,i,r);return t[e]=o,o},c.castAsJsonAsync=async function(t=null,n=null){const i={},r=[];for(let a in this.attributes){const u=this.attributes[a];n?.keyTranslate&&(a=n.keyTranslate(a)),void 0!==u&&(s.isSimpleType(u)||u instanceof o||u instanceof e.ArcadeDate?i[a]=s.castAsJson(u,n):r.push(this.castDictionaryValueAsJsonAsync(i,a,u,t,n)))}return r.length>0&&await Promise.all(r),i},c.deepClone=function(){const t=new u;t.immutable=!1;for(const e of this.keys())t.setField(e,n.deepClone(this.field(e)));return t},t._createClass(u)}();return u}));
