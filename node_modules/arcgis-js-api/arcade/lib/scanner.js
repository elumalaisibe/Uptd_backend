/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","./assert","./character","./types"],(function(e,t,i,s,r){"use strict";function n(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function h(e){return"01234567".indexOf(e)}const a=[[],[],[]];r.UpdateOperators.forEach((e=>a[e.length-1].push(e))),r.UnaryOperators.forEach((e=>a[e.length-1].push(e))),r.LogicalOperators.forEach((e=>a[e.length-1].push(e))),r.AssignmentOperators.forEach((e=>a[e.length-1].push(e))),r.BinaryOperators.forEach((e=>a[e.length-1].push(e)));let c=function(){function e(e,t){this.source=e,this.errorHandler=t,this._length=e.length,this.index=0,this.lineNumber=1,this.lineStart=0,this.curlyStack=[]}var c=e.prototype;return c.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart,curlyStack:this.curlyStack.slice()}},c.restoreState=function(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart,this.curlyStack=e.curlyStack},c.eof=function(){return this.index>=this._length},c.throwUnexpectedToken=function(e=r.ParsingErrorCodes.UnexpectedToken){this.errorHandler.throwError({code:e,index:this.index,line:this.lineNumber,column:this.index-this.lineStart+1})},c.tolerateUnexpectedToken=function(e=r.ParsingErrorCodes.UnexpectedToken){this.errorHandler.tolerateError({code:e,index:this.index,line:this.lineNumber,column:this.index-this.lineStart+1})},c.skipSingleLineComment=function(e){const t=[],i=this.index-e,r={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{line:0,column:0}};for(;!this.eof();){const n=this.source.charCodeAt(this.index);if(++this.index,s.Character.isLineTerminator(n)){if(r){r.end={line:this.lineNumber,column:this.index-this.lineStart-1};const s={multiLine:!1,start:i+e,end:this.index-1,range:[i,this.index-1],loc:r};t.push(s)}return 13===n&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t}}if(r){r.end={line:this.lineNumber,column:this.index-this.lineStart};const s={multiLine:!1,start:i+e,end:this.index,range:[i,this.index],loc:r};t.push(s)}return t},c.skipMultiLineComment=function(){const e=[],t=this.index-2,i={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{line:0,column:0}};for(;!this.eof();){const r=this.source.charCodeAt(this.index);if(s.Character.isLineTerminator(r))13===r&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===r){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,i){i.end={line:this.lineNumber,column:this.index-this.lineStart};const s={multiLine:!0,start:t+2,end:this.index-2,range:[t,this.index],loc:i};e.push(s)}return e}++this.index}else++this.index}if(i){i.end={line:this.lineNumber,column:this.index-this.lineStart};const s={multiLine:!0,start:t+2,end:this.index,range:[t,this.index],loc:i};e.push(s)}return this.tolerateUnexpectedToken(),e},c.scanComments=function(){let e=[];for(;!this.eof();){let t=this.source.charCodeAt(this.index);if(s.Character.isWhiteSpace(t))++this.index;else if(s.Character.isLineTerminator(t))++this.index,13===t&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index;else{if(47!==t)break;if(t=this.source.charCodeAt(this.index+1),47===t){this.index+=2;const t=this.skipSingleLineComment(2);e=[...e,...t]}else{if(42!==t)break;{this.index+=2;const t=this.skipMultiLineComment();e=[...e,...t]}}}}return e},c.isKeyword=function(e){switch((e=e.toLowerCase()).length){case 2:return e===r.Keywords.If||e===r.Keywords.In;case 3:return e===r.Keywords.Var||e===r.Keywords.For;case 4:return e===r.Keywords.Else;case 5:return e===r.Keywords.Break||e===r.Keywords.While;case 6:return e===r.Keywords.Return||e===r.Keywords.Import||e===r.Keywords.Export;case 8:return e===r.Keywords.Function||e===r.Keywords.Continue;default:return!1}},c.codePointAt=function(e){let t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){const i=this.source.charCodeAt(e+1);if(i>=56320&&i<=57343){t=1024*(t-55296)+i-56320+65536}}return t},c.scanHexEscape=function(e){const t="u"===e?4:2;let i=0;for(let r=0;r<t;++r){if(this.eof()||!s.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;i=16*i+n(this.source[this.index++])}return String.fromCharCode(i)},c.scanUnicodeCodePointEscape=function(){let e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],s.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+n(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),s.Character.fromCodePoint(t)},c.getIdentifier=function(){const e=this.index++;for(;!this.eof();){const t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier();if(!s.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},c.getComplexIdentifier=function(){let e,t=this.codePointAt(this.index),i=s.Character.fromCodePoint(t);for(this.index+=i.length,92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):(e=this.scanHexEscape("u"),null!==e&&"\\"!==e&&s.Character.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken()),i=e);!this.eof()&&(t=this.codePointAt(this.index),s.Character.isIdentifierPart(t));)e=s.Character.fromCodePoint(t),i+=e,this.index+=e.length,92===t&&(i=i.substring(0,i.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this.scanUnicodeCodePointEscape()):(e=this.scanHexEscape("u"),null!==e&&"\\"!==e&&s.Character.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken()),i+=e);return i},c.octalToDecimal=function(e){let t="0"!==e,i=h(e);return!this.eof()&&s.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,i=8*i+h(this.source[this.index++]),"0123".includes(e)&&!this.eof()&&s.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(i=8*i+h(this.source[this.index++]))),{code:i,octal:t}},c.scanIdentifier=function(){let e;const t=this.index,i=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(e=1===i.length?r.TokenType.Identifier:this.isKeyword(i)?r.TokenType.Keyword:i.toLowerCase()===r.Keywords.Null?r.TokenType.NullLiteral:i.toLowerCase()===r.Keywords.True||i.toLowerCase()===r.Keywords.False?r.TokenType.BooleanLiteral:r.TokenType.Identifier,e!==r.TokenType.Identifier&&t+i.length!==this.index){const e=this.index;this.index=t,this.tolerateUnexpectedToken(r.ParsingErrorCodes.InvalidEscapedReservedWord),this.index=e}return{type:e,value:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},c.scanPunctuator=function(){const e=this.index;let t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;case"}":++this.index,this.curlyStack.pop();break;default:for(let e=a.length;e>0;e--)if(t=this.source.substring(this.index,this.index+e),a[e-1].includes(t)){this.index+=e;break}}return this.index===e&&this.throwUnexpectedToken(),{type:r.TokenType.Punctuator,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},c.scanHexLiteral=function(e){let t="";for(;!this.eof()&&s.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),s.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:r.TokenType.NumericLiteral,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},c.scanBinaryLiteral=function(e){let t="";for(;!this.eof();){const e=this.source[this.index];if("0"!==e&&"1"!==e)break;t+=this.source[this.index++]}if(0===t.length&&this.throwUnexpectedToken(),!this.eof()){const e=this.source.charCodeAt(this.index);(s.Character.isIdentifierStart(e)||s.Character.isDecimalDigit(e))&&this.throwUnexpectedToken()}return{type:r.TokenType.NumericLiteral,value:parseInt(t,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},c.scanOctalLiteral=function(e,t){let i="",n=!1;for(s.Character.isOctalDigit(e.charCodeAt(0))?(n=!0,i="0"+this.source[this.index++]):++this.index;!this.eof()&&s.Character.isOctalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];return n||0!==i.length||this.throwUnexpectedToken(),(s.Character.isIdentifierStart(this.source.charCodeAt(this.index))||s.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:r.TokenType.NumericLiteral,value:parseInt(i,8),lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},c.scanNumericLiteral=function(){const e=this.index;let t=this.source[e];i.assert(s.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");let n="";if("."!==t){if(n=this.source[this.index++],t=this.source[this.index],"0"===n){if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e)}for(;s.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(n+=this.source[this.index++];s.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(n+=this.source[this.index++],t=this.source[this.index],"+"!==t&&"-"!==t||(n+=this.source[this.index++]),s.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;s.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];else this.throwUnexpectedToken();return s.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:r.TokenType.NumericLiteral,value:parseFloat(n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},c.scanStringLiteral=function(){const e=this.index;let t=this.source[e];i.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;let n=!1,h="";for(;!this.eof();){let e=this.source[this.index++];if(e===t){t="";break}if("\\"===e)if(e=this.source[this.index++],e&&s.Character.isLineTerminator(e.charCodeAt(0)))++this.lineNumber,"\r"===e&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(e){case"u":if("{"===this.source[this.index])++this.index,h+=this.scanUnicodeCodePointEscape();else{const t=this.scanHexEscape(e);null===t&&this.throwUnexpectedToken(),h+=t}break;case"x":{const t=this.scanHexEscape(e);null===t&&this.throwUnexpectedToken(r.ParsingErrorCodes.InvalidHexEscapeSequence),h+=t;break}case"n":h+="\n";break;case"r":h+="\r";break;case"t":h+="\t";break;case"b":h+="\b";break;case"f":h+="\f";break;case"v":h+="\v";break;case"8":case"9":h+=e,this.tolerateUnexpectedToken();break;default:if(e&&s.Character.isOctalDigit(e.charCodeAt(0))){const t=this.octalToDecimal(e);n=t.octal||n,h+=String.fromCharCode(t.code)}else h+=e}else{if(s.Character.isLineTerminator(e.charCodeAt(0)))break;h+=e}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:r.TokenType.StringLiteral,value:h,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},c.scanTemplate=function(){let e="",t=!1;const i=this.index,n="`"===this.source[i];let h=!1,a=2;for(++this.index;!this.eof();){let i=this.source[this.index++];if("`"===i){a=1,h=!0,t=!0;break}if("$"!==i)if("\\"!==i)s.Character.isLineTerminator(i.charCodeAt(0))?(++this.lineNumber,"\r"===i&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=i;else if(i=this.source[this.index++],s.Character.isLineTerminator(i.charCodeAt(0)))++this.lineNumber,"\r"===i&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(i){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{const t=this.index,s=this.scanHexEscape(i);null!==s?e+=s:(this.index=t,e+=i)}break;case"x":{const t=this.scanHexEscape(i);null===t&&this.throwUnexpectedToken(r.ParsingErrorCodes.InvalidHexEscapeSequence),e+=t;break}case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===i?(s.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(r.ParsingErrorCodes.TemplateOctalLiteral),e+="\0"):s.Character.isOctalDigit(i.charCodeAt(0))?this.throwUnexpectedToken(r.ParsingErrorCodes.TemplateOctalLiteral):e+=i}else{if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=i}}return t||this.throwUnexpectedToken(),n||this.curlyStack.pop(),{type:r.TokenType.Template,value:this.source.slice(i+1,this.index-a),cooked:e,head:n,tail:h,lineNumber:this.lineNumber,lineStart:this.lineStart,start:i,end:this.index}},c.lex=function(){if(this.eof())return{type:r.TokenType.EOF,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};const e=this.source.charCodeAt(this.index);return s.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?s.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():s.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&s.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},t._createClass(e)}();e.Scanner=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
