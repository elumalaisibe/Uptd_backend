/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","./comment-handler","./error-handler","./scanner","./types"],(function(t,e,r,n,i,s){"use strict";var a,o;function c(t,e=0){let r=t.start-t.lineStart,n=t.lineNumber;return r<0&&(r+=e,n--),{index:t.start,line:n,column:r}}function h(t){return[{index:t.range[0],...t.loc.start},{index:t.range[1],...t.loc.end}]}function p(t){return s.OperatorPrecedence[t]??0}!function(t){t[t.None=0]="None",t[t.Function=1]="Function",t[t.IfClause=2]="IfClause",t[t.ForLoop=4]="ForLoop",t[t.WhileLoop=8]="WhileLoop"}(a||(a={})),function(t){t[t.AsObject=0]="AsObject",t[t.Automatic=1]="Automatic"}(o||(o={}));let u=function(){function t(t,e={},c){this.delegate=c,this.hasLineTerminator=!1,this.options={tokens:"boolean"==typeof e.tokens&&e.tokens,comments:"boolean"==typeof e.comments&&e.comments,tolerant:"boolean"==typeof e.tolerant&&e.tolerant},this.options.comments&&(this.commentHandler=new r.CommentHandler),this.errorHandler=new n.ErrorHandler(this.options.tolerant),this.scanner=new i.Scanner(t,this.errorHandler),this.context={isAssignmentTarget:!1,blockContext:a.None,curlyParsingType:o.AsObject},this.rawToken={type:s.TokenType.EOF,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.endMarker={index:0,line:this.scanner.lineNumber,column:0},this.readNextRawToken(),this.endMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}var u=t.prototype;return u.throwIfInvalidType=function(t,e,{validTypes:r,invalidTypes:n}){r?.some((e=>t.type===e))||n?.some((e=>t.type===e))&&this.throwError(s.ParsingErrorCodes.InvalidExpression,e)},u.throwError=function(t,e,r=this.endMarker){const{index:n,line:i,column:s}=e,a=r.index-n-1;this.errorHandler.throwError({code:t,index:n,line:i,column:s+1,len:a})},u.tolerateError=function(t,e){throw new Error("######################################### !!!")},u.unexpectedTokenError=function(t={}){const{rawToken:e}=t;let r,{code:i,data:a}=t;if(e){if(!i)switch(e.type){case s.TokenType.EOF:i=s.ParsingErrorCodes.UnexpectedEndOfScript;break;case s.TokenType.Identifier:i=s.ParsingErrorCodes.UnexpectedIdentifier;break;case s.TokenType.NumericLiteral:i=s.ParsingErrorCodes.UnexpectedNumber;break;case s.TokenType.StringLiteral:i=s.ParsingErrorCodes.UnexpectedString;break;case s.TokenType.Template:i=s.ParsingErrorCodes.UnexpectedTemplate}r=e.value.toString()}else r="ILLEGAL";i=i??s.ParsingErrorCodes.UnexpectedToken,a||(a={value:r});const o=n.formatErrorDescription(i,a);if(e){const t=e.start,r=e.lineNumber,n=e.start-e.lineStart+1;return new s.ParsingError({code:i,index:t,line:r,column:n,len:e.end-e.start-1,data:a,description:o})}const{index:c,line:h}=this.endMarker;return new s.ParsingError({code:i,index:c,line:h,column:this.endMarker.column+1,data:a,description:o})},u.throwUnexpectedToken=function(t={}){throw t.rawToken=t.rawToken??this.rawToken,this.unexpectedTokenError(t)},u.collectComments=function(t){const{commentHandler:e}=this;e&&t.length&&t.forEach((t=>{const r={type:t.multiLine?s.Syntax.BlockComment:s.Syntax.LineComment,value:this.getSourceValue(t),range:t.range,loc:t.loc};e.collectComment(r)}))},u.peekAhead=function(t){const e=()=>(this.scanner.scanComments(),this.scanner.lex()),r=this.scanner.saveState(),n=t.call(this,e);return this.scanner.restoreState(r),n},u.getSourceValue=function(t){return this.scanner.source.slice(t.start,t.end)},u.convertToToken=function(t){return{type:s.TokenNames[t.type],value:this.getSourceValue(t),range:[t.start,t.end],loc:{start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}}},u.readNextRawToken=function(){this.endMarker.index=this.scanner.index,this.endMarker.line=this.scanner.lineNumber,this.endMarker.column=this.scanner.index-this.scanner.lineStart;const t=this.rawToken;this.collectComments(this.scanner.scanComments()),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart),this.rawToken=this.scanner.lex(),this.hasLineTerminator=t.lineNumber!==this.rawToken.lineNumber,this.options.tokens&&this.rawToken.type!==s.TokenType.EOF&&this.tokens.push(this.convertToToken(this.rawToken))},u.captureStartMarker=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},u.getItemLocation=function(t){return{range:[t.index,this.endMarker.index],loc:{start:{line:t.line,column:t.column},end:{line:this.endMarker.line,column:this.endMarker.column}}}},u.finalize=function(t){return(this.delegate||this.commentHandler)&&(this.commentHandler?.attachComments(t),this.delegate?.(t)),t},u.expectPunctuator=function(t){const e=this.rawToken;this.matchPunctuator(t)?this.readNextRawToken():this.throwUnexpectedToken({rawToken:e,code:s.ParsingErrorCodes.PunctuatorExpected,data:{value:t}})},u.expectKeyword=function(t){this.rawToken.type!==s.TokenType.Keyword||this.rawToken.value.toLowerCase()!==t?this.throwUnexpectedToken({rawToken:this.rawToken}):this.readNextRawToken()},u.expectContextualKeyword=function(t){this.rawToken.type!==s.TokenType.Identifier||this.rawToken.value.toLowerCase()!==t?this.throwUnexpectedToken({rawToken:this.rawToken}):this.readNextRawToken()},u.matchKeyword=function(t){return this.rawToken.type===s.TokenType.Keyword&&this.rawToken.value.toLowerCase()===t},u.matchContextualKeyword=function(t){return this.rawToken.type===s.TokenType.Identifier&&this.rawToken.value===t},u.matchPunctuator=function(t){return this.rawToken.type===s.TokenType.Punctuator&&this.rawToken.value===t},u.getMatchingPunctuator=function(t){if("string"==typeof t&&(t=t.split("")),this.rawToken.type===s.TokenType.Punctuator&&t?.length)return t.find(this.matchPunctuator,this)},u.isolateCoverGrammar=function(t){const e=this.context.isAssignmentTarget;this.context.isAssignmentTarget=!0;const r=t.call(this);return this.context.isAssignmentTarget=e,r},u.inheritCoverGrammar=function(t){const e=this.context.isAssignmentTarget;this.context.isAssignmentTarget=!0;const r=t.call(this);return this.context.isAssignmentTarget=this.context.isAssignmentTarget&&e,r},u.withBlockContext=function(t,e){const r=this.context.blockContext;this.context.blockContext=this.context.blockContext|t;const n=this.context.curlyParsingType;this.context.curlyParsingType=o.Automatic;const i=e.call(this);return this.context.blockContext=r,this.context.curlyParsingType=n,i},u.consumeSemicolon=function(){if(this.matchPunctuator(";"))this.readNextRawToken();else if(!this.hasLineTerminator)return this.rawToken.type===s.TokenType.EOF||this.matchPunctuator("}")?(this.endMarker.index=this.startMarker.index,this.endMarker.line=this.startMarker.line,void(this.endMarker.column=this.startMarker.column)):void this.throwUnexpectedToken({rawToken:this.rawToken})},u.parsePrimaryExpression=function(){const t=this.captureStartMarker(),e=this.rawToken;switch(e.type){case s.TokenType.Identifier:return this.readNextRawToken(),this.finalize({type:s.Syntax.Identifier,name:e.value,...this.getItemLocation(t)});case s.TokenType.NumericLiteral:case s.TokenType.StringLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:s.Syntax.Literal,value:e.value,raw:this.getSourceValue(e),isString:"string"==typeof e.value,...this.getItemLocation(t)});case s.TokenType.BooleanLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:s.Syntax.Literal,value:e.value.toLowerCase()===s.Keywords.True,raw:this.getSourceValue(e),isString:!1,...this.getItemLocation(t)});case s.TokenType.NullLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:s.Syntax.Literal,value:null,raw:this.getSourceValue(e),isString:!1,...this.getItemLocation(t)});case s.TokenType.Template:return this.parseTemplateLiteral();case s.TokenType.Punctuator:switch(e.value){case"(":return this.inheritCoverGrammar(this.parseGroupExpression);case"[":return this.inheritCoverGrammar(this.parseArrayInitializer);case"{":return this.inheritCoverGrammar(this.parseObjectExpression);default:return this.throwUnexpectedToken({rawToken:this.rawToken})}case s.TokenType.Keyword:return this.context.isAssignmentTarget=!1,this.throwUnexpectedToken({rawToken:this.rawToken});default:return this.throwUnexpectedToken({rawToken:this.rawToken})}},u.parseArrayInitializer=function(){const t=this.captureStartMarker();this.expectPunctuator("[");const e=[];for(;!this.matchPunctuator("]");){const t=this.captureStartMarker();this.matchPunctuator(",")?(this.readNextRawToken(),this.throwError(s.ParsingErrorCodes.InvalidExpression,t)):(e.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.matchPunctuator("]")||this.expectPunctuator(","))}return this.expectPunctuator("]"),this.finalize({type:s.Syntax.ArrayExpression,elements:e,...this.getItemLocation(t)})},u.parseObjectPropertyKey=function(){const t=this.captureStartMarker(),e=this.rawToken;switch(e.type){case s.TokenType.StringLiteral:return this.readNextRawToken(),this.finalize({type:s.Syntax.Literal,value:e.value,raw:this.getSourceValue(e),isString:!0,...this.getItemLocation(t)});case s.TokenType.Identifier:case s.TokenType.BooleanLiteral:case s.TokenType.NullLiteral:case s.TokenType.Keyword:return this.readNextRawToken(),this.finalize({type:s.Syntax.Identifier,name:e.value,...this.getItemLocation(t)});default:this.throwError(s.ParsingErrorCodes.KeyMustBeString,t)}},u.parseObjectProperty=function(){const t=this.rawToken,e=this.captureStartMarker(),r=this.parseObjectPropertyKey();let n=!1,i=null;return this.matchPunctuator(":")?(this.readNextRawToken(),i=this.inheritCoverGrammar(this.parseAssignmentExpression)):t.type===s.TokenType.Identifier?(n=!0,i=this.finalize({type:s.Syntax.Identifier,name:t.value,...this.getItemLocation(e)})):this.throwUnexpectedToken({rawToken:this.rawToken}),this.finalize({type:s.Syntax.Property,kind:"init",key:r,value:i,shorthand:n,...this.getItemLocation(e)})},u.parseObjectExpression=function(){const t=this.captureStartMarker();this.expectPunctuator("{");const e=[];for(;!this.matchPunctuator("}");)e.push(this.parseObjectProperty()),this.matchPunctuator("}")||this.expectPunctuator(",");return this.expectPunctuator("}"),this.finalize({type:s.Syntax.ObjectExpression,properties:e,...this.getItemLocation(t)})},u.parseTemplateElement=function(t=!1){const e=this.rawToken;e.type!==s.TokenType.Template&&this.throwUnexpectedToken({rawToken:e}),t&&!e.head&&this.throwUnexpectedToken({code:s.ParsingErrorCodes.InvalidTemplateHead,rawToken:e});const r=this.captureStartMarker();this.readNextRawToken();const{value:n,cooked:i,tail:a}=e,o=this.finalize({type:s.Syntax.TemplateElement,value:{raw:n,cooked:i},tail:a,...this.getItemLocation(r)});return o.loc.start.column++,o.loc.end.column=o.loc.end.column-(a?1:2),o},u.parseTemplateLiteral=function(){const t=this.captureStartMarker(),e=[],r=[];let n=this.parseTemplateElement(!0);for(r.push(n);!n.tail;)e.push(this.parseExpression()),n=this.parseTemplateElement(),r.push(n);return this.finalize({type:s.Syntax.TemplateLiteral,quasis:r,expressions:e,...this.getItemLocation(t)})},u.parseGroupExpression=function(){this.expectPunctuator("(");const t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.expectPunctuator(")"),t},u.parseArguments=function(){this.expectPunctuator("(");const t=[];if(!this.matchPunctuator(")"))for(;;){const e=this.isolateCoverGrammar(this.parseAssignmentExpression);if(t.push(e),this.matchPunctuator(")"))break;if(this.expectPunctuator(","),this.matchPunctuator(")"))break}return this.expectPunctuator(")"),t},u.parseMemberName=function(){const t=this.rawToken,e=this.captureStartMarker();return this.readNextRawToken(),t.type!==s.TokenType.NullLiteral&&t.type!==s.TokenType.Identifier&&t.type!==s.TokenType.Keyword&&t.type!==s.TokenType.BooleanLiteral&&this.throwUnexpectedToken({rawToken:t}),this.finalize({type:s.Syntax.Identifier,name:t.value,...this.getItemLocation(e)})},u.parseLeftHandSideExpression=function(){const t=this.captureStartMarker();let e=this.inheritCoverGrammar(this.parsePrimaryExpression);const r=this.captureStartMarker();let n;for(;n=this.getMatchingPunctuator("([.");)switch(n){case"(":{this.context.isAssignmentTarget=!1,e.type!==s.Syntax.Identifier&&e.type!==s.Syntax.MemberExpression&&this.throwError(s.ParsingErrorCodes.IdentiferExpected,t,r);const n=this.parseArguments();e=this.finalize({type:s.Syntax.CallExpression,callee:e,arguments:n,...this.getItemLocation(t)});continue}case"[":{this.context.isAssignmentTarget=!0,this.expectPunctuator("[");const r=this.isolateCoverGrammar(this.parseExpression);this.expectPunctuator("]"),e=this.finalize({type:s.Syntax.MemberExpression,computed:!0,object:e,property:r,...this.getItemLocation(t)});continue}case".":{this.context.isAssignmentTarget=!0,this.expectPunctuator(".");const r=this.parseMemberName();e=this.finalize({type:s.Syntax.MemberExpression,computed:!1,object:e,property:r,...this.getItemLocation(t)});continue}}return e},u.parseUpdateExpression=function(){const t=this.captureStartMarker();let e=this.getMatchingPunctuator(s.UpdateOperators);if(e){this.readNextRawToken();const r=this.captureStartMarker(),n=this.inheritCoverGrammar(this.parseUnaryExpression);return n.type!==s.Syntax.Identifier&&n.type!==s.Syntax.MemberExpression&&n.type!==s.Syntax.CallExpression&&this.throwError(s.ParsingErrorCodes.InvalidExpression,r),this.context.isAssignmentTarget||this.tolerateError(s.ParsingErrorCodes.InvalidLeftHandSideInAssignment,t),this.context.isAssignmentTarget=!1,this.finalize({type:s.Syntax.UpdateExpression,operator:e,argument:n,prefix:!0,...this.getItemLocation(t)})}const r=this.captureStartMarker(),n=this.inheritCoverGrammar(this.parseLeftHandSideExpression),i=this.captureStartMarker();return this.hasLineTerminator?n:(e=this.getMatchingPunctuator(s.UpdateOperators),e?(n.type!==s.Syntax.Identifier&&n.type!==s.Syntax.MemberExpression&&this.throwError(s.ParsingErrorCodes.InvalidExpression,r,i),this.context.isAssignmentTarget||this.tolerateError(s.ParsingErrorCodes.InvalidLeftHandSideInAssignment,t),this.readNextRawToken(),this.context.isAssignmentTarget=!1,this.finalize({type:s.Syntax.UpdateExpression,operator:e,argument:n,prefix:!1,...this.getItemLocation(t)})):n)},u.parseUnaryExpression=function(){const t=this.getMatchingPunctuator(s.UnaryOperators);if(t){const e=this.captureStartMarker();this.readNextRawToken();const r=this.inheritCoverGrammar(this.parseUnaryExpression);return this.context.isAssignmentTarget=!1,this.finalize({type:s.Syntax.UnaryExpression,operator:t,argument:r,prefix:!0,...this.getItemLocation(e)})}return this.parseUpdateExpression()},u.parseBinaryExpression=function(){const t=this.rawToken;let e=this.inheritCoverGrammar(this.parseUnaryExpression);if(this.rawToken.type!==s.TokenType.Punctuator)return e;const r=this.rawToken.value;let n=p(r);if(0===n)return e;this.readNextRawToken(),this.context.isAssignmentTarget=!1;const i=[t,this.rawToken];let a=e,o=this.inheritCoverGrammar(this.parseUnaryExpression);const h=[a,r,o],u=[n];for(;this.rawToken.type===s.TokenType.Punctuator&&(n=p(this.rawToken.value))>0;){for(;h.length>2&&n<=u[u.length-1];){o=h.pop();const t=h.pop();u.pop(),a=h.pop(),i.pop();const e=i[i.length-1],r=c(e,e.lineStart);h.push(this.finalize(this.createBinaryOrLogicalExpression(r,t,a,o)))}h.push(this.rawToken.value),u.push(n),i.push(this.rawToken),this.readNextRawToken(),h.push(this.inheritCoverGrammar(this.parseUnaryExpression))}let l=h.length-1;e=h[l];let m=i.pop();for(;l>1;){const t=i.pop();if(!t)break;const r=m?.lineStart,n=c(t,r),s=h[l-1];e=this.finalize(this.createBinaryOrLogicalExpression(n,s,h[l-2],e)),l-=2,m=t}return e},u.createBinaryOrLogicalExpression=function(t,e,r,n){const i=s.LogicalOperators.includes(e)?s.Syntax.LogicalExpression:s.Syntax.BinaryExpression;return i===s.Syntax.BinaryExpression||(r.type!==s.Syntax.AssignmentExpression&&r.type!==s.Syntax.UpdateExpression||this.throwError(s.ParsingErrorCodes.InvalidExpression,...h(r)),n.type!==s.Syntax.AssignmentExpression&&n.type!==s.Syntax.UpdateExpression||this.throwError(s.ParsingErrorCodes.InvalidExpression,...h(r))),{type:i,operator:e,left:r,right:n,...this.getItemLocation(t)}},u.parseAssignmentExpression=function(){const t=this.captureStartMarker(),e=this.inheritCoverGrammar(this.parseBinaryExpression),r=this.captureStartMarker(),n=this.getMatchingPunctuator(s.AssignmentOperators);if(!n)return e;e.type!==s.Syntax.Identifier&&e.type!==s.Syntax.MemberExpression&&this.throwError(s.ParsingErrorCodes.InvalidExpression,t,r),this.context.isAssignmentTarget||this.tolerateError(s.ParsingErrorCodes.InvalidLeftHandSideInAssignment,t),this.matchPunctuator("=")||(this.context.isAssignmentTarget=!1),this.readNextRawToken();const i=this.isolateCoverGrammar(this.parseAssignmentExpression);return this.finalize({type:s.Syntax.AssignmentExpression,left:e,operator:n,right:i,...this.getItemLocation(t)})},u.parseExpression=function(){return this.isolateCoverGrammar(this.parseAssignmentExpression)},u.parseStatements=function(t){const e=[];for(;this.rawToken.type!==s.TokenType.EOF&&!this.matchPunctuator(t);){const t=this.parseStatementListItem();s.isEmptyStatement(t)||e.push(t)}return e},u.parseStatementListItem=function(){return this.context.isAssignmentTarget=!0,this.matchKeyword(s.Keywords.Function)?this.parseFunctionDeclaration():this.matchKeyword(s.Keywords.Export)?this.parseExportDeclaration():this.matchKeyword(s.Keywords.Import)?this.parseImportDeclaration():this.parseStatement()},u.parseBlock=function(){const t=this.captureStartMarker();this.expectPunctuator("{");const e=this.parseStatements("}");return this.expectPunctuator("}"),this.finalize({type:s.Syntax.BlockStatement,body:e,...this.getItemLocation(t)})},u.parseObjectStatement=function(){const t=this.captureStartMarker(),e=this.parseObjectExpression();return this.finalize({type:s.Syntax.ExpressionStatement,expression:e,...this.getItemLocation(t)})},u.parseBlockOrObjectStatement=function(){if(this.context.curlyParsingType===o.AsObject)return this.parseObjectStatement();return this.peekAhead((t=>{let e=t();return(e.type===s.TokenType.Identifier||e.type===s.TokenType.StringLiteral)&&(e=t(),e.type===s.TokenType.Punctuator&&":"===e.value)}))?this.parseObjectStatement():this.parseBlock()},u.parseIdentifier=function(){const t=this.rawToken;if(t.type!==s.TokenType.Identifier)return null;const e=this.captureStartMarker();return this.readNextRawToken(),this.finalize({type:s.Syntax.Identifier,name:t.value,...this.getItemLocation(e)})},u.parseVariableDeclarator=function(){const t=this.captureStartMarker(),e=this.parseIdentifier();e||this.throwUnexpectedToken({code:s.ParsingErrorCodes.IdentiferExpected});let r=null;if(this.matchPunctuator("=")){this.readNextRawToken();const t=this.rawToken;try{r=this.isolateCoverGrammar(this.parseAssignmentExpression)}catch(n){this.throwUnexpectedToken({rawToken:t,code:s.ParsingErrorCodes.InvalidVariableAssignment})}}return this.finalize({type:s.Syntax.VariableDeclarator,id:e,init:r,...this.getItemLocation(t)})},u.parseVariableDeclarationList=function(){const t=[this.parseVariableDeclarator()];for(;this.matchPunctuator(",");)this.readNextRawToken(),t.push(this.parseVariableDeclarator());return t},u.parseVariableDeclaration=function(){const t=this.captureStartMarker();this.expectKeyword(s.Keywords.Var);const e=this.parseVariableDeclarationList();return this.consumeSemicolon(),this.finalize({type:s.Syntax.VariableDeclaration,declarations:e,kind:"var",...this.getItemLocation(t)})},u.parseEmptyStatement=function(){const t=this.captureStartMarker();return this.expectPunctuator(";"),this.finalize({type:s.Syntax.EmptyStatement,...this.getItemLocation(t)})},u.parseExpressionStatement=function(){const t=this.captureStartMarker(),e=this.parseExpression();return this.consumeSemicolon(),this.finalize({type:s.Syntax.ExpressionStatement,expression:e,...this.getItemLocation(t)})},u.parseIfClause=function(){return this.withBlockContext(a.IfClause,this.parseStatement)},u.parseIfStatement=function(){const t=this.captureStartMarker();this.expectKeyword(s.Keywords.If),this.expectPunctuator("(");const e=this.captureStartMarker(),r=this.parseExpression(),n=this.captureStartMarker();this.expectPunctuator(")"),r.type!==s.Syntax.AssignmentExpression&&r.type!==s.Syntax.UpdateExpression||this.throwError(s.ParsingErrorCodes.InvalidExpression,e,n);const i=this.parseIfClause();let a=null;return this.matchKeyword(s.Keywords.Else)&&(this.readNextRawToken(),a=this.parseIfClause()),this.finalize({type:s.Syntax.IfStatement,test:r,consequent:i,alternate:a,...this.getItemLocation(t)})},u.parseWhileStatement=function(){const t=this.captureStartMarker();this.expectKeyword(s.Keywords.While),this.expectPunctuator("(");const e=this.captureStartMarker(),r=this.parseExpression(),n=this.captureStartMarker();this.expectPunctuator(")"),r.type!==s.Syntax.AssignmentExpression&&r.type!==s.Syntax.UpdateExpression||this.throwError(s.ParsingErrorCodes.InvalidExpression,e,n);const i=this.withBlockContext(a.WhileLoop,this.parseStatement);return this.finalize({type:s.Syntax.WhileStatement,test:r,body:i,...this.getItemLocation(t)})},u.parseForStatement=function(){let t=null,e=null,r=null,n=null,i=null;const o=this.captureStartMarker();if(this.expectKeyword(s.Keywords.For),this.expectPunctuator("("),this.matchPunctuator(";"))this.readNextRawToken();else if(this.matchKeyword(s.Keywords.Var)){const e=this.captureStartMarker();this.readNextRawToken();const r=this.parseVariableDeclarationList();if(1===r.length&&this.matchKeyword(s.Keywords.In)){r[0].init&&this.throwError(s.ParsingErrorCodes.ForInOfLoopInitializer,e),n=this.finalize({type:s.Syntax.VariableDeclaration,declarations:r,kind:"var",...this.getItemLocation(e)}),this.readNextRawToken(),i=this.parseExpression()}else this.matchKeyword(s.Keywords.In)&&this.throwError(s.ParsingErrorCodes.InvalidLeftHandSideInForIn,e),t=this.finalize({type:s.Syntax.VariableDeclaration,declarations:r,kind:"var",...this.getItemLocation(e)}),this.expectPunctuator(";")}else{const e=this.context.isAssignmentTarget,r=this.captureStartMarker();t=this.inheritCoverGrammar(this.parseAssignmentExpression),this.matchKeyword(s.Keywords.In)?(this.context.isAssignmentTarget||this.tolerateError(s.ParsingErrorCodes.InvalidLeftHandSideInForIn,r),t.type!==s.Syntax.Identifier&&this.throwError(s.ParsingErrorCodes.InvalidLeftHandSideInForIn,r),this.readNextRawToken(),n=t,i=this.parseExpression(),t=null):(this.context.isAssignmentTarget=e,this.expectPunctuator(";"))}n||(this.matchPunctuator(";")||(e=this.isolateCoverGrammar(this.parseExpression)),this.expectPunctuator(";"),this.matchPunctuator(")")||(r=this.isolateCoverGrammar(this.parseExpression))),this.expectPunctuator(")");const c=this.withBlockContext(a.ForLoop,(()=>this.isolateCoverGrammar(this.parseStatement)));return n&&i?this.finalize({type:s.Syntax.ForInStatement,left:n,right:i,body:c,...this.getItemLocation(o)}):this.finalize({type:s.Syntax.ForStatement,init:t,test:e,update:r,body:c,...this.getItemLocation(o)})},u.parseContinueStatement=function(){const t=this.captureStartMarker();return this.expectKeyword(s.Keywords.Continue),this.consumeSemicolon(),this.finalize({type:s.Syntax.ContinueStatement,...this.getItemLocation(t)})},u.parseBreakStatement=function(){const t=this.captureStartMarker();return this.expectKeyword(s.Keywords.Break),this.consumeSemicolon(),this.finalize({type:s.Syntax.BreakStatement,...this.getItemLocation(t)})},u.parseReturnStatement=function(){const t=this.captureStartMarker();this.expectKeyword(s.Keywords.Return);const e=!this.matchPunctuator(";")&&!this.matchPunctuator("}")&&!this.hasLineTerminator&&this.rawToken.type!==s.TokenType.EOF||this.rawToken.type===s.TokenType.StringLiteral||this.rawToken.type===s.TokenType.Template?this.parseExpression():null;return this.consumeSemicolon(),this.finalize({type:s.Syntax.ReturnStatement,argument:e,...this.getItemLocation(t)})},u.parseStatement=function(){switch(this.rawToken.type){case s.TokenType.BooleanLiteral:case s.TokenType.NullLiteral:case s.TokenType.NumericLiteral:case s.TokenType.StringLiteral:case s.TokenType.Template:case s.TokenType.Identifier:return this.parseExpressionStatement();case s.TokenType.Punctuator:return"{"===this.rawToken.value?this.parseBlockOrObjectStatement():"("===this.rawToken.value?this.parseExpressionStatement():";"===this.rawToken.value?this.parseEmptyStatement():this.parseExpressionStatement();case s.TokenType.Keyword:switch(this.rawToken.value.toLowerCase()){case s.Keywords.Break:return this.parseBreakStatement();case s.Keywords.Continue:return this.parseContinueStatement();case s.Keywords.For:return this.parseForStatement();case s.Keywords.Function:return this.parseFunctionDeclaration();case s.Keywords.If:return this.parseIfStatement();case s.Keywords.Return:return this.parseReturnStatement();case s.Keywords.Var:return this.parseVariableDeclaration();case s.Keywords.While:return this.parseWhileStatement();default:return this.parseExpressionStatement()}default:return this.throwUnexpectedToken({rawToken:this.rawToken})}},u.parseFormalParameters=function(){const t=[];if(this.expectPunctuator("("),!this.matchPunctuator(")"))for(;this.rawToken.type!==s.TokenType.EOF;){const e=this.parseIdentifier();if(e||this.throwUnexpectedToken({rawToken:this.rawToken,code:s.ParsingErrorCodes.IdentiferExpected}),t.push(e),this.matchPunctuator(")"))break;if(this.expectPunctuator(","),this.matchPunctuator(")"))break}return this.expectPunctuator(")"),t},u.parseFunctionDeclaration=function(){(this.context.blockContext&a.Function)===a.Function&&this.throwUnexpectedToken({code:s.ParsingErrorCodes.NoFunctionInsideFunction}),(this.context.blockContext&a.WhileLoop)!==a.WhileLoop&&(this.context.blockContext&a.IfClause)!==a.IfClause||this.throwUnexpectedToken({code:s.ParsingErrorCodes.NoFunctionInsideBlock});const t=this.captureStartMarker();this.expectKeyword(s.Keywords.Function);const e=this.parseIdentifier();e||this.throwUnexpectedToken({code:s.ParsingErrorCodes.InvalidFunctionIdentifier});const r=this.parseFormalParameters(),n=this.context.blockContext;this.context.blockContext=this.context.blockContext|a.Function;const i=this.parseBlock();return this.context.blockContext=n,this.finalize({type:s.Syntax.FunctionDeclaration,id:e,params:r,body:i,...this.getItemLocation(t)})},u.parseScript=function(){const t=this.captureStartMarker(),e=this.parseStatements(),r=this.finalize({type:s.Syntax.Program,body:e,...this.getItemLocation(t)});return this.options.tokens&&(r.tokens=this.tokens),this.options.tolerant&&(r.errors=this.errorHandler.errors),r},u.parseExportDeclaration=function(){this.context.blockContext!==a.None&&this.throwUnexpectedToken({code:s.ParsingErrorCodes.ModuleExportRootOnly});let t=null;const e=this.captureStartMarker();return this.expectKeyword(s.Keywords.Export),this.matchKeyword(s.Keywords.Var)?t=this.parseVariableDeclaration():this.matchKeyword("function")?t=this.parseFunctionDeclaration():this.throwUnexpectedToken({code:s.ParsingErrorCodes.InvalidExpression}),this.finalize({type:s.Syntax.ExportNamedDeclaration,declaration:t,specifiers:[],source:null,...this.getItemLocation(e)})},u.parseModuleSpecifier=function(){const t=this.captureStartMarker(),e=this.rawToken;if(e.type===s.TokenType.StringLiteral)return this.readNextRawToken(),this.finalize({type:s.Syntax.Literal,value:e.value,raw:this.getSourceValue(e),isString:!0,...this.getItemLocation(t)});this.throwError(s.ParsingErrorCodes.InvalidModuleUri,t)},u.parseDefaultSpecifier=function(){const t=this.captureStartMarker(),e=this.parseIdentifier();return e||this.throwUnexpectedToken({code:s.ParsingErrorCodes.IdentiferExpected}),this.finalize({type:s.Syntax.ImportDefaultSpecifier,local:e,...this.getItemLocation(t)})},u.parseImportDeclaration=function(){this.context.blockContext!==a.None&&this.throwUnexpectedToken({code:s.ParsingErrorCodes.ModuleImportRootOnly});const t=this.captureStartMarker();this.expectKeyword(s.Keywords.Import);const e=this.parseDefaultSpecifier();this.expectContextualKeyword(s.Keywords.From);const r=this.parseModuleSpecifier();return this.finalize({type:s.Syntax.ImportDeclaration,specifiers:[e],source:r,...this.getItemLocation(t)})},e._createClass(t)}();t.Parser=u,t.binaryOperatorPrecedence=p,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
