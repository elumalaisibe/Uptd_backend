/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","./errorsupport","./shared","./sqlUtils"],(function(t,e,n,r){"use strict";function a(t){return t=+t,isFinite(t)?t-t%1||(t<0?-0:0===t?t:0):t}function c(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}function u(t){const e=c(t);let n=0;for(let r=0;r<t.length;r++)n+=(e-t[r])**2;return n/t.length}function i(t){const e=c(t);let n=0;for(let r=0;r<t.length;r++)n+=(e-t[r])**2;return n/(t.length-1)}function s(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function l(t,e){const r=[],a={},c=[];for(let u=0;u<t.length;u++){if(void 0!==t[u]&&null!==t[u]){const e=t[u];if(n.isNumber(e)||n.isString(e))void 0===a[e]&&(r.push(e),a[e]=1);else{let t=!1;for(let r=0;r<c.length;r++)!0===n.equalityTest(c[r],e)&&(t=!0);!1===t&&(c.push(e),r.push(e))}}if(r.length>=e&&-1!==e)return r}return r}function o(t){switch(t.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function h(t,e,n=1e3){switch(t.toLowerCase()){case"distinct":return l(e,n);case"avg":case"mean":return c(e);case"min":return Math.min.apply(Math,e);case"sum":return s(e);case"max":return Math.max.apply(Math,e);case"stdev":case"stddev":return Math.sqrt(u(e));case"var":case"variance":return u(e);case"count":return e.length}return 0}async function f(t,e,n){const r=await y(t,e,n,!0);return 0===r.length?null:Math.min.apply(Math,r)}async function d(t,e,n){const r=await y(t,e,n,!0);return 0===r.length?null:Math.max.apply(Math,r)}async function g(t,e,n){let u="";e&&!r.isSingleField(e)&&(u=r.predictType(e,t.fields));const i=await y(t,e,n,!0);if(0===i.length)return null;const s=c(i);return null===s?s:"integer"===u?a(s):s}async function m(t,e,n){const r=await y(t,e,n,!0);return 0===r.length?null:i(r)}async function w(t,e,n){const r=await y(t,e,n,!0);return 0===r.length?null:Math.sqrt(i(r))}async function p(t,e,n){const r=await y(t,e,n,!0);return 0===r.length?null:s(r)}async function v(t,e){return t.iterator(e).count()}async function y(t,n,r,a=!1){const c=t.iterator(r),u=[],i={ticker:0};let s=await c.next();for(;null!==s;){if(i.ticker++,r.aborted)throw new e.FeatureSetError(e.FeatureSetErrorCodes.Cancelled);i.ticker%100==0&&(i.ticker=0,await new Promise((t=>{setTimeout(t,0)})));const t=n?.calculateValue(s);null===t?!1===a&&(u[u.length]=t):u[u.length]=t,s=await c.next()}return u}async function x(t,n,r=1e3,a=null){const c=t.iterator(a),u=[],i={},s={ticker:0};let l=await c.next();for(;null!==l;){if(s.ticker++,a&&a.aborted)throw new e.FeatureSetError(e.FeatureSetErrorCodes.Cancelled);s.ticker%100==0&&(s.ticker=0,await new Promise((t=>{setTimeout(t,0)})));const t=n?.calculateValue(l);if(null!=t&&void 0===i[t]&&(u.push(t),i[t]=1),u.length>=r&&-1!==r)return u;l=await c.next()}return u}t.calculateStat=h,t.count=v,t.decodeStatType=o,t.distinct=x,t.max=d,t.mean=g,t.min=f,t.stdev=w,t.sum=p,t.variance=m,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
