/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../kernel","../kernel","../../chunks/languageUtils","./centroid","../../geometry/Extent","../../geometry/Geometry","../../geometry/geometryEngineAsync","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils","../executionError","../Dictionary","../ArcadePortal","../portalUtils","../../core/unitUtils","../../portal/Portal"],(function(e,n,r,t,o,a,i,c,u,s,l,d,f,E,m,y,C,h,x){"use strict";function A(e){return 0===n.version.indexOf("4.")?l.fromExtent(e):new l({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function w(e,n,r){if(t.pcCheck(e,2,2,n,r),e[0]instanceof i&&e[1]instanceof i);else if(e[0]instanceof i&&null===e[1]);else if(e[1]instanceof i&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r)}async function p(e,n){if("polygon"!==e.type&&"polyline"!==e.type&&"extent"!==e.type)return 0;let r=1;if(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid){r=o.getMetersPerVerticalUnitForSR(e.spatialReference)/h.getMetersPerUnitForSR(e.spatialReference)}let a=0;if("polyline"===e.type)for(const t of e.paths)for(let e=1;e<t.length;e++)a+=o.segmentLength3d(t[e],t[e-1],r);else if("polygon"===e.type)for(const t of e.rings){for(let e=1;e<t.length;e++)a+=o.segmentLength3d(t[e],t[e-1],r);(t[0][0]!==t[t.length-1][0]||t[0][1]!==t[t.length-1][1]||void 0!==t[0][2]&&t[0][2]!==t[t.length-1][2])&&(a+=o.segmentLength3d(t[0],t[t.length-1],r))}else"extent"===e.type&&(a+=2*o.segmentLength3d([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],r),a+=2*o.segmentLength3d([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],r),a*=2,a+=4*Math.abs(t.defaultUndefined(e.zmax,0)*r-t.defaultUndefined(e.zmin,0)*r));const i=new d({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:[[0,0],[0,a]]});return c.planarLength(i,n)}function g(e){"async"===e.mode&&(e.functions.disjoint=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(w(a=t.autoCastFeatureToGeometry(a),n,r),null===a[0]||null===a[1]||c.disjoint(a[0],a[1]))))},e.functions.intersects=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(w(a=t.autoCastFeatureToGeometry(a),n,r),null!==a[0]&&null!==a[1]&&c.intersects(a[0],a[1]))))},e.functions.touches=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(w(a=t.autoCastFeatureToGeometry(a),n,r),null!==a[0]&&null!==a[1]&&c.touches(a[0],a[1]))))},e.functions.crosses=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(w(a=t.autoCastFeatureToGeometry(a),n,r),null!==a[0]&&null!==a[1]&&c.crosses(a[0],a[1]))))},e.functions.within=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(w(a=t.autoCastFeatureToGeometry(a),n,r),null!==a[0]&&null!==a[1]&&c.within(a[0],a[1]))))},e.functions.contains=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(w(a=t.autoCastFeatureToGeometry(a),n,r),null!==a[0]&&null!==a[1]&&c.contains(a[0],a[1]))))},e.functions.overlaps=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(w(a=t.autoCastFeatureToGeometry(a),n,r),null!==a[0]&&null!==a[1]&&c.overlaps(a[0],a[1]))))},e.functions.equals=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(t.pcCheck(a,2,2,n,r),a[0]===a[1]||(a[0]instanceof i&&a[1]instanceof i?c.equals(a[0],a[1]):!(!t.isDate(a[0])||!t.isDate(a[1]))&&a[0].equals(a[1])))))},e.functions.relate=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>{if(a=t.autoCastFeatureToGeometry(a),t.pcCheck(a,3,3,n,r),a[0]instanceof i&&a[1]instanceof i)return c.relate(a[0],a[1],t.toString(a[2]));if(a[0]instanceof i&&null===a[1])return!1;if(a[1]instanceof i&&null===a[0])return!1;if(null===a[0]&&null===a[1])return!1;throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r)}))},e.functions.intersection=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>(w(a=t.autoCastFeatureToGeometry(a),n,r),null===a[0]||null===a[1]?null:c.intersect(a[0],a[1]))))},e.functions.union=function(n,o){return e.standardFunctionAsync(n,o,((e,a,u)=>{const s=[];if(0===(u=t.autoCastFeatureToGeometry(u)).length)throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.WrongNumberOfParameters,o);if(1===u.length)if(t.isArray(u[0])){const e=t.autoCastFeatureToGeometry(u[0]);for(let r=0;r<e.length;r++)if(null!==e[r]){if(!(e[r]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);s.push(e[r])}}else{if(!t.isImmutableArray(u[0])){if(u[0]instanceof i)return t.fixSpatialReference(r.cloneGeometry(u[0]),n.spatialReference);if(null===u[0])return null;throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o)}{const e=t.autoCastFeatureToGeometry(u[0].toArray());for(let r=0;r<e.length;r++)if(null!==e[r]){if(!(e[r]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);s.push(e[r])}}}else for(let r=0;r<u.length;r++)if(null!==u[r]){if(!(u[r]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);s.push(u[r])}return 0===s.length?null:c.union(s)}))},e.functions.difference=function(n,o){return e.standardFunctionAsync(n,o,((e,a,i)=>(w(i=t.autoCastFeatureToGeometry(i),n,o),null!==i[0]&&null===i[1]?r.cloneGeometry(i[0]):null===i[0]?null:c.difference(i[0],i[1]))))},e.functions.symmetricdifference=function(n,o){return e.standardFunctionAsync(n,o,((e,a,i)=>(w(i=t.autoCastFeatureToGeometry(i),n,o),null===i[0]&&null===i[1]?null:null===i[0]?r.cloneGeometry(i[1]):null===i[1]?r.cloneGeometry(i[0]):c.symmetricDifference(i[0],i[1]))))},e.functions.clip=function(n,r){return e.standardFunctionAsync(n,r,((e,o,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,2,n,r),!(u[1]instanceof a)&&null!==u[1])throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);if(null===u[0])return null;if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);return null===u[1]?null:c.clip(u[0],u[1])}))},e.functions.cut=function(n,o){return e.standardFunctionAsync(n,o,((e,a,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,2,n,o),!(u[1]instanceof d)&&null!==u[1])throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);if(null===u[0])return[];if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return null===u[1]?[r.cloneGeometry(u[0])]:c.cut(u[0],u[1])}))},e.functions.area=function(n,o){return e.standardFunctionAsync(n,o,(async(e,a,u)=>{if(t.pcCheck(u,1,2,n,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isFeatureSet(u[0])){const e=await u[0].sumArea(r.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)),!1,n.abortSignal);if(n.abortSignal.aborted)throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.Cancelled,o);return e}if(t.isArray(u[0])||t.isImmutableArray(u[0])){const e=t.autoCastArrayOfPointsToPolygon(u[0],n.spatialReference);return null===e?0:c.planarArea(e,r.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return c.planarArea(u[0],r.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.functions.areageodetic=function(n,o){return e.standardFunctionAsync(n,o,(async(e,a,u)=>{if(t.pcCheck(u,1,2,n,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isFeatureSet(u[0])){const e=await u[0].sumArea(r.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)),!0,n.abortSignal);if(n.abortSignal.aborted)throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.Cancelled,o);return e}if(t.isArray(u[0])||t.isImmutableArray(u[0])){const e=t.autoCastArrayOfPointsToPolygon(u[0],n.spatialReference);return null===e?0:c.geodesicArea(e,r.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return c.geodesicArea(u[0],r.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.functions.length=function(n,o){return e.standardFunctionAsync(n,o,(async(e,a,u)=>{if(t.pcCheck(u,1,2,n,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isFeatureSet(u[0])){const e=await u[0].sumLength(r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)),!1,n.abortSignal);if(n.abortSignal.aborted)throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.Cancelled,o);return e}if(t.isArray(u[0])||t.isImmutableArray(u[0])){const e=t.autoCastArrayOfPointsToPolyline(u[0],n.spatialReference);return null===e?0:c.planarLength(e,r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return c.planarLength(u[0],r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.functions.length3d=function(n,o){return e.standardFunctionAsync(n,o,((e,a,u)=>{if(t.pcCheck(u,1,2,n,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isArray(u[0])||t.isImmutableArray(u[0])){const e=t.autoCastArrayOfPointsToPolyline(u[0],n.spatialReference);return null===e?0:!0===e.hasZ?p(e,r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1))):c.planarLength(e,r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return!0===u[0].hasZ?p(u[0],r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1))):c.planarLength(u[0],r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.functions.lengthgeodetic=function(n,o){return e.standardFunctionAsync(n,o,(async(e,a,u)=>{if(t.pcCheck(u,1,2,n,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isFeatureSet(u[0])){const e=await u[0].sumLength(r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)),!0,n.abortSignal);if(n.abortSignal.aborted)throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.Cancelled,o);return e}if(t.isArray(u[0])||t.isImmutableArray(u[0])){const e=t.autoCastArrayOfPointsToPolyline(u[0],n.spatialReference);return null===e?0:c.geodesicLength(e,r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return c.geodesicLength(u[0],r.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.functions.distance=function(n,o){return e.standardFunctionAsync(n,o,((e,a,u)=>{u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,3,n,o);let s=u[0];(t.isArray(u[0])||t.isImmutableArray(u[0]))&&(s=t.autoCastArrayOfPointsToMultiPoint(u[0],n.spatialReference));let l=u[1];if((t.isArray(u[1])||t.isImmutableArray(u[1]))&&(l=t.autoCastArrayOfPointsToMultiPoint(u[1],n.spatialReference)),!(s instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);if(!(l instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return c.distance(s,l,r.convertLinearUnitsToCode(t.defaultUndefined(u[2],-1)))}))},e.functions.distancegeodetic=function(n,o){return e.standardFunctionAsync(n,o,((e,a,i)=>{i=t.autoCastFeatureToGeometry(i),t.pcCheck(i,2,3,n,o);const u=i[0],l=i[1];if(!(u instanceof s))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);if(!(l instanceof s))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const f=new d({paths:[],spatialReference:u.spatialReference});return f.addPath([u,l]),c.geodesicLength(f,r.convertLinearUnitsToCode(t.defaultUndefined(i[2],-1)))}))},e.functions.densify=function(n,o){return e.standardFunctionAsync(n,o,((e,u,s)=>{if(s=t.autoCastFeatureToGeometry(s),t.pcCheck(s,2,3,n,o),null===s[0])return null;if(!(s[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const f=t.toNumber(s[1]);if(isNaN(f))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);if(f<=0)throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return s[0]instanceof l||s[0]instanceof d?c.densify(s[0],f,r.convertLinearUnitsToCode(t.defaultUndefined(s[2],-1))):s[0]instanceof a?c.densify(A(s[0]),f,r.convertLinearUnitsToCode(t.defaultUndefined(s[2],-1))):s[0]}))},e.functions.densifygeodetic=function(n,o){return e.standardFunctionAsync(n,o,((e,u,s)=>{if(s=t.autoCastFeatureToGeometry(s),t.pcCheck(s,2,3,n,o),null===s[0])return null;if(!(s[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const f=t.toNumber(s[1]);if(isNaN(f))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);if(f<=0)throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return s[0]instanceof l||s[0]instanceof d?c.geodesicDensify(s[0],f,r.convertLinearUnitsToCode(t.defaultUndefined(s[2],-1))):s[0]instanceof a?c.geodesicDensify(A(s[0]),f,r.convertLinearUnitsToCode(t.defaultUndefined(s[2],-1))):s[0]}))},e.functions.generalize=function(n,o){return e.standardFunctionAsync(n,o,((e,a,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,4,n,o),null===u[0])return null;if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const s=t.toNumber(u[1]);if(isNaN(s))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return c.generalize(u[0],s,t.toBoolean(t.defaultUndefined(u[2],!0)),r.convertLinearUnitsToCode(t.defaultUndefined(u[3],-1)))}))},e.functions.buffer=function(n,o){return e.standardFunctionAsync(n,o,((e,a,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,3,n,o),null===u[0])return null;if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const s=t.toNumber(u[1]);if(isNaN(s))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return 0===s?r.cloneGeometry(u[0]):c.buffer(u[0],s,r.convertLinearUnitsToCode(t.defaultUndefined(u[2],-1)))}))},e.functions.buffergeodetic=function(n,o){return e.standardFunctionAsync(n,o,((e,a,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,3,n,o),null===u[0])return null;if(!(u[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const s=t.toNumber(u[1]);if(isNaN(s))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return 0===s?r.cloneGeometry(u[0]):c.geodesicBuffer(u[0],s,r.convertLinearUnitsToCode(t.defaultUndefined(u[2],-1)))}))},e.functions.offset=function(n,o){return e.standardFunctionAsync(n,o,((e,a,i)=>{if(i=t.autoCastFeatureToGeometry(i),t.pcCheck(i,2,6,n,o),null===i[0])return null;if(!(i[0]instanceof l||i[0]instanceof d))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const u=t.toNumber(i[1]);if(isNaN(u))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const s=t.toNumber(t.defaultUndefined(i[4],10));if(isNaN(s))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);const f=t.toNumber(t.defaultUndefined(i[5],0));if(isNaN(f))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);return c.offset(i[0],u,r.convertLinearUnitsToCode(t.defaultUndefined(i[2],-1)),t.toString(t.defaultUndefined(i[3],"round")).toLowerCase(),s,f)}))},e.functions.rotate=function(n,r){return e.standardFunctionAsync(n,r,((e,o,u)=>{u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,3,n,r);let d=u[0];if(null===d)return null;if(!(d instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);d instanceof a&&(d=l.fromExtent(d));const f=t.toNumber(u[1]);if(isNaN(f))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);const m=t.defaultUndefined(u[2],null);if(null===m)return c.rotate(d,f);if(m instanceof s)return c.rotate(d,f,m);throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r)}))},e.functions.centroid=function(n,c){return e.standardFunctionAsync(n,c,((e,f,m)=>{if(m=t.autoCastFeatureToGeometry(m),t.pcCheck(m,1,1,n,c),null===m[0])return null;let y=m[0];if((t.isArray(m[0])||t.isImmutableArray(m[0]))&&(y=t.autoCastArrayOfPointsToMultiPoint(m[0],n.spatialReference)),null===y)return null;if(!(y instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,c);return y instanceof s?t.fixSpatialReference(r.cloneGeometry(m[0]),n.spatialReference):y instanceof l?y.centroid:y instanceof d?o.centroidPolyline(y):y instanceof u?o.centroidMultiPoint(y):y instanceof a?y.center:null}))},e.functions.multiparttosinglepart=function(n,o){return e.standardFunctionAsync(n,o,(async(e,m,y)=>{y=t.autoCastFeatureToGeometry(y),t.pcCheck(y,1,1,n,o);const C=[];if(null===y[0])return null;if(!(y[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,o);if(y[0]instanceof s)return[t.fixSpatialReference(r.cloneGeometry(y[0]),n.spatialReference)];if(y[0]instanceof a)return[t.fixSpatialReference(r.cloneGeometry(y[0]),n.spatialReference)];const h=await c.simplify(y[0]);if(h instanceof l){const e=[],n=[];for(let r=0;r<h.rings.length;r++)if(h.isClockwise(h.rings[r])){const n=f.fromJSON({rings:[h.rings[r]],hasZ:!0===h.hasZ,hazM:!0===h.hasM,spatialReference:h.spatialReference.toJSON()});e.push(n)}else n.push({ring:h.rings[r],pt:h.getPoint(r,0)});for(let r=0;r<n.length;r++)for(let t=0;t<e.length;t++)if(e[t].contains(n[r].pt)){e[t].addRing(n[r].ring);break}return e}if(h instanceof d){const e=[];for(let n=0;n<h.paths.length;n++){const r=f.fromJSON({paths:[h.paths[n]],hasZ:!0===h.hasZ,hazM:!0===h.hasM,spatialReference:h.spatialReference.toJSON()});e.push(r)}return e}if(y[0]instanceof u){const e=t.fixSpatialReference(r.cloneGeometry(y[0]),n.spatialReference);for(let n=0;n<e.points.length;n++)C.push(e.getPoint(n));return C}return null}))},e.functions.issimple=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>{if(a=t.autoCastFeatureToGeometry(a),t.pcCheck(a,1,1,n,r),null===a[0])return!0;if(!(a[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);return c.isSimple(a[0])}))},e.functions.simplify=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>{if(a=t.autoCastFeatureToGeometry(a),t.pcCheck(a,1,1,n,r),null===a[0])return null;if(!(a[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);return c.simplify(a[0])}))},e.functions.convexhull=function(n,r){return e.standardFunctionAsync(n,r,((e,o,a)=>{if(a=t.autoCastFeatureToGeometry(a),t.pcCheck(a,1,1,n,r),null===a[0])return null;if(!(a[0]instanceof i))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);return c.convexHull(a[0])}))},e.functions.getuser=function(n,r){return e.standardFunctionAsync(n,r,(async(e,o,a)=>{t.pcCheck(a,0,2,n,r);let i=t.defaultUndefined(a[1],""),c=!0===i;if(i=!0===i||!1===i?"":t.toString(i),0===a.length||a[0]instanceof y){let e=null;e=n.services&&n.services.portal?n.services.portal:x.getDefault(),a.length>0&&(e=C.getPortal(a[0],e));const r=await C.lookupUser(e,i,c);if(r){const e=JSON.parse(JSON.stringify(r));for(const n of["lastLogin","created","modified"])void 0!==e[n]&&null!==e[n]&&(e[n]=new Date(e[n]));return m.convertObjectToArcadeDictionary(e,t.defaultTimeZone(n))}return null}let u=null;if(t.isFeatureSet(a[0])&&(u=a[0]),u){if(c=!1,i)return null;await u.load();const e=await u.getOwningSystemUrl();if(!e){if(!i){const e=await u.getIdentityUser();return e?m.convertObjectToArcadeDictionary({username:e},t.defaultTimeZone(n)):null}return null}let r=null;r=n.services&&n.services.portal?n.services.portal:x.getDefault(),r=C.getPortal(new y(e),r);const o=await C.lookupUser(r,i,c);if(o){const e=JSON.parse(JSON.stringify(o));for(const n of["lastLogin","created","modified"])void 0!==e[n]&&null!==e[n]&&(e[n]=new Date(e[n]));return m.convertObjectToArcadeDictionary(e,t.defaultTimeZone(n))}return null}throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r)}))}),e.functions.nearestcoordinate=function(n,r){return e.standardFunctionAsync(n,r,(async(e,o,a)=>{if(a=t.autoCastFeatureToGeometry(a),t.pcCheck(a,2,2,n,r),!(a[0]instanceof i||null===a[0]))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);if(!(a[1]instanceof s||null===a[1]))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);if(null===a[0]||null===a[1])return null;const u=await c.nearestCoordinate(a[0],a[1]);return null===u?null:m.convertObjectToArcadeDictionary({coordinate:u.coordinate,distance:u.distance},t.defaultTimeZone(n),!1,!0)}))},e.functions.nearestvertex=function(n,r){return e.standardFunctionAsync(n,r,(async(e,o,a)=>{if(a=t.autoCastFeatureToGeometry(a),t.pcCheck(a,2,2,n,r),!(a[0]instanceof i||null===a[0]))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);if(!(a[1]instanceof s||null===a[1]))throw new E.ArcadeExecutionError(n,E.ExecutionErrorCodes.InvalidParameter,r);if(null===a[0]||null===a[1])return null;const u=await c.nearestVertex(a[0],a[1]);return null===u?null:m.convertObjectToArcadeDictionary({coordinate:u.coordinate,distance:u.distance},t.defaultTimeZone(n),!1,!0)}))}}e.registerFunctions=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
