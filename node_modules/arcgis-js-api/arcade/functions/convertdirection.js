/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../Dictionary","../executionError","../../chunks/languageUtils","../../core/maybe"],(function(e,r,n,t,o,s){"use strict";const i=e=>(r,n,t)=>(t=t||14,+e(r,n).toFixed(t)),c=(e,r)=>e+r,a=(e,r)=>e-r,u=(e,r)=>e*r,d=(e,r)=>e/r,l=(e,r,n)=>i(c)(e,r,n),h=(e,r,n)=>i(a)(e,r,n),g=(e,r,n)=>i(u)(e,r,n),m=(e,r,n)=>i(d)(e,r,n),E=360,f=400,_=2*Math.PI,A=3600,w=3240,p=60,x=60,D=180*A/Math.PI,S=E*p*x,T=90*A,R=180*A,C=270*A,M=String.fromCharCode(7501),v="Â°";function F(e){if(!1===o.isString(e))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.InvalidParameter,null);return e}function L(e,r){const n=10**r;return Math.round(e*n)/n}function U(e,r){return e%r}function N(e){const r=parseFloat(e.toString().replace(Math.trunc(e).toString(),"0"))*Math.sign(e);if(e<0){return{fraction:r,integer:Math.ceil(e)}}return{fraction:r,integer:Math.floor(e)}}var b,y,I,O;function z(e,r){switch(e){case b.north:return"SHORT"===r?"N":"North";case b.east:return"SHORT"===r?"E":"East";case b.south:return"SHORT"===r?"S":"South";case b.west:return"SHORT"===r?"W":"West"}}function G(e,r,n){for(;e.length<n;)e=r+e;return e}function H(e,r){return e-Math.floor(e/r)*r}function k(e){switch(e){case y.truncated_degrees:case y.decimal_degrees:return E;case y.radians:return _;case y.gradians:return f;case y.seconds:return S;case y.fractional_degree_minutes:return p;case y.fractional_minute_seconds:return x;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unsupported evaluations"})}}function q(e){switch(e.toUpperCase().trim()){case"NORTH":case"NORTHAZIMUTH":case"NORTH AZIMUTH":return I.north_azimuth;case"POLAR":return I.polar;case"QUADRANT":return I.quadrant;case"SOUTH":case"SOUTHAZIMUTH":case"SOUTH AZIMUTH":return I.south_azimuth}throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unsupported directionType"})}function P(e){switch(e.toUpperCase().trim()){case"D":case"DD":case"DECIMALDEGREE":case"DECIMAL DEGREE":case"DEGREE":case"DECIMALDEGREES":case"DECIMAL DEGREES":case"DEGREES":return y.decimal_degrees;case"DMS":case"DEGREESMINUTESSECONDS":case"DEGREES MINUTES SECONDS":return y.degrees_minutes_seconds;case"R":case"RAD":case"RADS":case"RADIAN":case"RADIANS":return y.radians;case"G":case"GON":case"GONS":case"GRAD":case"GRADS":case"GRADIAN":case"GRADIANS":return y.gradians}throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unsupported units"})}!function(e){e[e.north=0]="north",e[e.east=1]="east",e[e.south=2]="south",e[e.west=3]="west"}(b||(b={})),function(e){e[e.decimal_degrees=1]="decimal_degrees",e[e.seconds=2]="seconds",e[e.degrees_minutes_seconds=3]="degrees_minutes_seconds",e[e.radians=4]="radians",e[e.gradians=5]="gradians",e[e.truncated_degrees=6]="truncated_degrees",e[e.fractional_degree_minutes=7]="fractional_degree_minutes",e[e.fractional_minute_seconds=8]="fractional_minute_seconds"}(y||(y={})),function(e){e[e.north_azimuth=1]="north_azimuth",e[e.polar=2]="polar",e[e.quadrant=3]="quadrant",e[e.south_azimuth=4]="south_azimuth"}(I||(I={})),function(e){e[e.meridian=0]="meridian",e[e.direction=1]="direction"}(O||(O={}));let Q=function(){function e(e,r,n){this.m_degrees=e,this.m_minutes=r,this.m_seconds=n}var n=e.prototype;return n.getField=function(e){switch(e){case y.decimal_degrees:case y.truncated_degrees:return this.m_degrees;case y.fractional_degree_minutes:return this.m_minutes;case y.seconds:case y.fractional_minute_seconds:return this.m_seconds;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}},e.secondsToDMS=function(r){const n=N(r).fraction;let t=N(r).integer;const o=Math.floor(t/A);t-=o*A;const s=Math.floor(t/x);return t-=s*x,new e(o,s,t+n)},e.numberToDms=function(r){const n=N(r).fraction,t=N(r).integer,o=g(N(100*n).fraction,100);return new e(t,N(100*n).integer,o)},n.format=function(r,n){let t=L(this.m_seconds,n),o=this.m_minutes,s=this.m_degrees;if(r===y.seconds||r===y.fractional_minute_seconds)x<=t&&(t-=x,++o),p<=o&&(o=0,++s),E<=s&&(s=0);else if(r===y.fractional_degree_minutes)t=0,o=30<=this.m_seconds?this.m_minutes+1:this.m_minutes,s=this.m_degrees,p<=o&&(o=0,++s),E<=s&&(s=0);else if(r===y.decimal_degrees||r===y.truncated_degrees){const e=m(this.m_seconds,A),r=m(this.m_minutes,p);s=Math.round(this.m_degrees+r+e),o=0,t=0}return new e(s,o,t)},e.dmsToSeconds=function(e,r,n){return e*A+r*x+n},r._createClass(e)}(),B=function(){function e(e,r,n){this.meridian=e,this.angle=r,this.direction=n}return e.prototype.fetchAzimuth=function(e){return e===O.meridian?this.meridian:this.direction},r._createClass(e)}(),W=function(){function e(e){this._angle=e}e.createFromAngleAndDirection=function(r,n){return new e(new V(e._convertDirectionFormat(r.extractAngularUnits(y.seconds),n,I.north_azimuth)))};var n=e.prototype;return n.getAngle=function(r){const n=this._angle.extractAngularUnits(y.seconds);switch(r){case I.north_azimuth:case I.south_azimuth:case I.polar:return new V(e._convertDirectionFormat(n,I.north_azimuth,r));case I.quadrant:{const r=e.secondsNorthAzimuthToQuadrant(n);return new V(r.angle)}}},n.getMeridian=function(r){const n=this._angle.extractAngularUnits(y.seconds);switch(r){case I.north_azimuth:return b.north;case I.south_azimuth:return b.south;case I.polar:return b.east;case I.quadrant:return e.secondsNorthAzimuthToQuadrant(n).meridian}},n.getDirection=function(r){const n=this._angle.extractAngularUnits(y.seconds);switch(r){case I.north_azimuth:return b.east;case I.south_azimuth:return b.west;case I.polar:return b.north;case I.quadrant:return e.secondsNorthAzimuthToQuadrant(n).direction}},e.secondsNorthAzimuthToQuadrant=function(e){const r=e<=T||e>=C?b.north:b.south,n=r===b.north?Math.min(S-e,e):Math.abs(e-R),t=e>R?b.west:b.east;return new B(r,n,t)},e.createFromAngleMeridianAndDirection=function(r,n,t){return new e(new V(e.secondsQuadrantToNorthAzimuth(r.extractAngularUnits(y.seconds),n,t)))},e.secondsQuadrantToNorthAzimuth=function(e,r,n){return r===b.north?n===b.east?e:S-e:n===b.east?R-e:R+e},e._convertDirectionFormat=function(e,r,n){let o=0;switch(r){case I.north_azimuth:o=e;break;case I.polar:o=T-e;break;case I.quadrant:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"});case I.south_azimuth:o=e+R}let s=0;switch(n){case I.north_azimuth:s=o;break;case I.polar:s=T-o;break;case I.quadrant:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"});case I.south_azimuth:s=o-R}return s=U(s,S),s<0?S+s:s},r._createClass(e)}();function Z(e,r,n){let o=null;switch(r){case y.decimal_degrees:o=g(e,A);break;case y.seconds:o=e;break;case y.gradians:o=g(e,w);break;case y.radians:o=g(e,D);break;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}switch(n){case y.decimal_degrees:return m(o,A);case y.seconds:return o;case y.gradians:return m(o,w);case y.radians:return o/D;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}}let V=function(){function e(e){this._seconds=e}return e.createFromAngleAndUnits=function(r,n){return new e(Z(r,n,y.seconds))},e.prototype.extractAngularUnits=function(e){return Z(this._seconds,y.seconds,X(e))},e.createFromDegreesMinutesSeconds=function(r,n,t){return new e(l(l(g(r,A),g(n,x)),t))},r._createClass(e)}();function X(e){switch(s.assertIsSome(e),e){case y.decimal_degrees:case y.truncated_degrees:case y.degrees_minutes_seconds:return y.decimal_degrees;case y.gradians:return y.gradians;case y.fractional_degree_minutes:return y.fractional_degree_minutes;case y.radians:return y.radians;case y.seconds:case y.fractional_minute_seconds:return y.seconds}}let j=function(){function e(e,r,n,t){this.view=e,this.angle=r,this.merdian=n,this.direction=t,this._dms=null,this._formattedDms=null}e.createFromStringAndBearing=function(r,n,t){return new e(r,n.getAngle(t),n.getMeridian(t),n.getDirection(t))};var n=e.prototype;return n.fetchAngle=function(){return this.angle},n.fetchMeridian=function(){return this.merdian},n.fetchDirection=function(){return this.direction},n.fetchView=function(){return this.view},n.fetchDms=function(){return null===this._dms&&this._calculateDms(),this._dms},n.fetchFormattedDms=function(){return null===this._formattedDms&&this._calculateDms(),this._formattedDms},n._calculateDms=function(){let e=null,r=y.truncated_degrees,n=0;for(let t=0;t<this.view.length;t++){const o=this.view[t];switch(o){case"m":e=ce(this.view,t,o),r=r===y.truncated_degrees?y.fractional_degree_minutes:r,t=e.newpos;continue;case"s":e=ce(this.view,t,o),r=y.fractional_minute_seconds,n=n<e.rounding?e.rounding:n,t=e.newpos;continue;default:continue}}this._dms=Q.secondsToDMS(this.angle.extractAngularUnits(y.seconds)),this._formattedDms=Q.secondsToDMS(this.angle.extractAngularUnits(y.seconds)).format(r,n)},r._createClass(e)}();function J(e,r,n,o,s){let i=null;switch(r){case y.decimal_degrees:case y.radians:case y.gradians:return i=H(L(e.extractAngularUnits(r),o),k(r)),G(i.toFixed(o),"0",n+o+(o>0?1:0));case y.truncated_degrees:case y.fractional_degree_minutes:return i=H(s.fetchFormattedDms().getField(r),k(r)),G(i.toFixed(o),"0",n+o+(o>0?1:0));case y.fractional_minute_seconds:return i=H(L(s.fetchDms().getField(r),o),k(r)),G(i.toFixed(o),"0",n+o+(o>0?1:0));default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}}function K(e,r,n){if(n===I.quadrant)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});if(r===y.degrees_minutes_seconds){const r=Q.numberToDms(e);return W.createFromAngleAndDirection(V.createFromDegreesMinutesSeconds(r.m_degrees,r.m_minutes,r.m_seconds),n)}return W.createFromAngleAndDirection(V.createFromAngleAndUnits(e,X(r)),n)}function Y(e){switch(o.toNumber(e)){case 1:return{first:b.north,second:b.east};case 2:return{first:b.south,second:b.east};case 3:return{first:b.south,second:b.west};case 4:return{first:b.north,second:b.west}}return null}function $(e){switch(e.toUpperCase().trim()){case"N":case"NORTH":return b.north;case"E":case"EAST":return b.east;case"S":case"SOUTH":return b.south;case"W":case"WEST":return b.west}return null}function ee(e){const r=parseFloat(e);if(o.isNumber(r)){if(isNaN(r))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"});return r}throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}function re(e,r,n){const s=n===I.quadrant;let i=null,c=null,a=0,u=0,d=0;if(s){if(e.length<2)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});d=1;const r=Y(o.toString(e[e.length-1]));if(r?(i=r.first,c=r.second):(a=1,i=$(o.toString(e[0])),c=$(o.toString(e[e.length-1]))),null===i||null===c)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}switch(r){case y.decimal_degrees:case y.radians:case y.gradians:if(0===e.length)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"});return s?W.createFromAngleMeridianAndDirection(V.createFromAngleAndUnits(ee(e[a]),X(r)),i,c):W.createFromAngleAndDirection(V.createFromAngleAndUnits(ee(e[a]),X(r)),n);case y.degrees_minutes_seconds:if(u=e.length-d-a,3===u){const r=V.createFromDegreesMinutesSeconds(ee(e[a]),ee(e[a+1]),ee(e[a+2]));return s?W.createFromAngleMeridianAndDirection(r,i,c):W.createFromAngleAndDirection(r,n)}if(1===u){const r=ee(e[a]),t=Q.numberToDms(r),o=V.createFromDegreesMinutesSeconds(t.m_degrees,t.m_minutes,t.m_seconds);return s?W.createFromAngleMeridianAndDirection(o,i,c):W.createFromAngleAndDirection(o,n)}}throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}function ne(e){const r=[" ","-","/","'",'"',"\\","^",v,M,"\t","\r","\n","*"];let n="";for(let t=0;t<e.length;t++){const o=e.charAt(t);r.includes(o)?n+="RRSPLITRRSPLITRR":n+=o}return n.split("RRSPLITRRSPLITRR").filter((e=>""!==e))}function te(e,r,n){if(o.isNumber(e))return K(o.toNumber(e),r,n);if(o.isString(e))return re(ne(e),r,n);if(o.isArray(e))return re(e,r,n);if(o.isImmutableArray(e))return re(e.toArray(),r,n);throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}function oe(e,r,n){const o=X(n);if(o&&n!==y.degrees_minutes_seconds){return e.getAngle(r).extractAngularUnits(o)}throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}function se(e,r,n){const t=e.getAngle(r);if(r===I.quadrant&&n===y.degrees_minutes_seconds){const n=Q.secondsToDMS(t.extractAngularUnits(y.seconds));return[z(e.getMeridian(r),"SHORT"),n.m_degrees,n.m_minutes,n.m_seconds,z(e.getDirection(r),"SHORT")]}if(n===y.degrees_minutes_seconds){const e=Q.secondsToDMS(t.extractAngularUnits(y.seconds));return[e.m_degrees,e.m_minutes,e.m_seconds]}return r===I.quadrant?[z(e.getMeridian(r),"SHORT"),t.extractAngularUnits(n),z(e.getDirection(r),"SHORT")]:[t.extractAngularUnits(n)]}function ie(e,r){let n="";switch(e){case y.decimal_degrees:n=r===I.quadrant?"DD.DD"+v:"DDD.DD"+v;break;case y.degrees_minutes_seconds:n=r===I.quadrant?"dd"+v+" mm' ss\"":"ddd"+v+" mm' ss.ss\"";break;case y.radians:n="R.RR";break;case y.gradians:n="GGG.GG"+M;break;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}return r===I.quadrant&&(n="p "+n+" b"),n}function ce(e,r,n){const t={padding:0,rounding:0,newpos:r};let o=!1;for(;r<e.length;){const s=e[r];if(s===n)o?t.rounding++:t.padding++,r++;else{if("."!==s)break;o=!0,r++}}return t.newpos=r-1,t}function ae(e,r,n){const t={escaped:"",newpos:r};for(r++;r<e.length;){const n=e[r];if(r++,"]"===n)break;t.escaped+=n}return t.newpos=r-1,t}function ue(e,r,n){let t="",o=null,s=null;const i=j.createFromStringAndBearing(r,e,n),c={D:y.decimal_degrees,d:y.truncated_degrees,m:y.fractional_degree_minutes,s:y.fractional_minute_seconds,R:y.radians,G:y.gradians};for(let a=0;a<r.length;a++){const u=r[a];switch(u){case"[":o=ae(r,a),t+=o.escaped,a=o.newpos;continue;case"D":case"d":case"m":case"s":case"R":case"G":o=ce(r,a,u),s=e.getAngle(n),t+=J(s,c[u],o.padding,o.rounding,i),a=o.newpos;continue;case"P":case"p":t+=z(i.fetchMeridian(),"p"===u?"SHORT":"LONG");continue;case"B":case"b":t+=z(i.fetchDirection(),"b"===u?"SHORT":"LONG");continue;default:t+=u}}return t}function de(e,r,s){if(!(r instanceof n))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.InvalidParameter,null);if(!1===r.hasField("directionType"))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"missing directionType"});if(!1===r.hasField("angleType"))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"missing angleType"});const i=q(F(r.field("directiontype"))),c=te(e,P(F(r.field("angletype"))),i);if(!(s instanceof n))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.InvalidParameter,null);if(!1===s.hasField("directionType"))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"missing directionType"});if(!1===s.hasField("outputType"))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"missing angleType"});const a=q(F(s.field("directiontype"))),u=s.hasField("angleType")?P(F(s.field("angletype"))):null,d=F(s.field("outputType")).toUpperCase().trim();if(!a||!d)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});if(!(u||"TEXT"===d&&s.hasField("format")))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid unit"});switch(d){case"VALUE":return a===I.quadrant||u===y.degrees_minutes_seconds?se(c,a,u):oe(c,a,u);case"TEXT":{let e="";return s.hasField("format")&&(e=o.toString(s.field("format"))),null!==e&&""!==e||(e=ie(u,a)),ue(c,e,a)}default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.InvalidParameter,null)}}e.convertDirection=de,e.preciseAdd=l,e.preciseDivide=m,e.preciseMinus=h,e.preciseMultiply=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
