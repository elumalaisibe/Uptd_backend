/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../executionError","../../chunks/languageUtils","./fieldStats","../../core/sql/WhereClause"],(function(n,t,e,a,r){"use strict";async function i(n,t,i,c,s,o){if(1===c.length){if(e.isArray(c[0]))return a.calculateStat(n,c[0],e.defaultUndefined(c[1],-1));if(e.isImmutableArray(c[0]))return a.calculateStat(n,c[0].toArray(),e.defaultUndefined(c[1],-1))}else if(2===c.length){if(e.isArray(c[0]))return a.calculateStat(n,c[0],e.defaultUndefined(c[1],-1));if(e.isImmutableArray(c[0]))return a.calculateStat(n,c[0].toArray(),e.defaultUndefined(c[1],-1));if(e.isFeatureSet(c[0])){const a=await c[0].load(),i=await u(r.WhereClause.create(c[1],a.getFieldsIndex()),o,s);return c[0].calculateStatistic(n,i,e.defaultUndefined(c[2],1e3),t.abortSignal)}}else if(3===c.length&&e.isFeatureSet(c[0])){const a=await c[0].load(),i=await u(r.WhereClause.create(c[1],a.getFieldsIndex()),o,s);return c[0].calculateStatistic(n,i,e.defaultUndefined(c[2],1e3),t.abortSignal)}return a.calculateStat(n,c,-1)}async function u(n,t,e){const a=n.getVariables();if(a.length>0){const r=[];for(let n=0;n<a.length;n++){const i={name:a[n]};r.push(await t.evaluateIdentifier(e,i))}const i={};for(let n=0;n<a.length;n++)i[a[n]]=r[n];return n.parameters=i,n}return n}function c(n){"async"===n.mode&&(n.functions.stdev=function(t,e){return n.standardFunctionAsync(t,e,((e,a,r)=>i("stdev",e,a,r,t,n)))},n.functions.variance=function(t,e){return n.standardFunctionAsync(t,e,((e,a,r)=>i("variance",e,a,r,t,n)))},n.functions.average=function(t,e){return n.standardFunctionAsync(t,e,((e,a,r)=>i("mean",e,a,r,t,n)))},n.functions.mean=function(t,e){return n.standardFunctionAsync(t,e,((e,a,r)=>i("mean",e,a,r,t,n)))},n.functions.sum=function(t,e){return n.standardFunctionAsync(t,e,((e,a,r)=>i("sum",e,a,r,t,n)))},n.functions.min=function(t,e){return n.standardFunctionAsync(t,e,((e,a,r)=>i("min",e,a,r,t,n)))},n.functions.max=function(t,e){return n.standardFunctionAsync(t,e,((e,a,r)=>i("max",e,a,r,t,n)))},n.functions.count=function(a,r){return n.standardFunctionAsync(a,r,((n,i,u)=>{if(e.pcCheck(u,1,1,a,r),e.isFeatureSet(u[0]))return u[0].count(n.abortSignal);if(e.isArray(u[0])||e.isString(u[0]))return u[0].length;if(e.isImmutableArray(u[0]))return u[0].length();throw new t.ArcadeExecutionError(a,t.ExecutionErrorCodes.InvalidParameter,r)}))})}n.registerFunctions=c,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})}));
