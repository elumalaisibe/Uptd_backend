/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../Feature","../ImmutablePointArray","../../chunks/languageUtils","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","./centroid","../../geometry/support/jsonUtils","../executionError","../ImmutablePathArray","../../geometry/support/coordsUtils"],(function(e,r,t,n,a,o,i,c,s,l,u,f,d,m,E,h){"use strict";function p(e){return e&&"esri.arcade.Feature"===e.arcadeDeclaredClass}function x(e,E){e.ringisclockwise=function(e,r){return E(e,r,((t,o,i)=>{a.pcCheck(i,1,1,e,r);let c=[],l=!1,u=!1;if(null===i[0])return!1;if(a.isArray(i[0])){for(const t of i[0]){if(!(t instanceof s))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);c.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}c.length>0&&(l=i[0][0].hasZ,u=i[0][0].hasM)}else if(i[0]instanceof n)c=i[0]._elements,c.length>0&&(l=i[0]._hasZ,u=i[0]._hasM);else{if(!a.isImmutableArray(i[0]))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);for(const t of i[0].toArray()){if(!(t instanceof s))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);c.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}c.length>0&&(l=i[0].get(0).hasZ,u=i[0].get(0).hasM)}return!(c.length<3)&&h.isClockwise(c,u,l)}))},e.polygon=function(e,n){return E(e,n,((o,i,c)=>{a.pcCheck(c,1,1,e,n);let s=null;if(c[0]instanceof r){if(s=a.fixSpatialReference(t.parseGeometryFromDictionary(c[0]),e.spatialReference),s instanceof l==!1)throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n)}else s=c[0]instanceof l?d.fromJSON(c[0].toJSON()):a.fixSpatialReference(new l(JSON.parse(c[0])),e.spatialReference);if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(s)}))},e.polyline=function(e,n){return E(e,n,((o,i,c)=>{a.pcCheck(c,1,1,e,n);let s=null;if(c[0]instanceof r){if(s=a.fixSpatialReference(t.parseGeometryFromDictionary(c[0]),e.spatialReference),s instanceof u==!1)throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n)}else s=c[0]instanceof u?d.fromJSON(c[0].toJSON()):a.fixSpatialReference(new u(JSON.parse(c[0])),e.spatialReference);if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(s)}))},e.point=function(e,n){return E(e,n,((o,i,c)=>{a.pcCheck(c,1,1,e,n);let l=null;if(c[0]instanceof r){if(l=a.fixSpatialReference(t.parseGeometryFromDictionary(c[0]),e.spatialReference),l instanceof s==!1)throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n)}else l=c[0]instanceof s?d.fromJSON(c[0].toJSON()):a.fixSpatialReference(new s(JSON.parse(c[0])),e.spatialReference);if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(l)}))},e.multipoint=function(e,n){return E(e,n,((o,i,s)=>{a.pcCheck(s,1,1,e,n);let l=null;if(s[0]instanceof r){if(l=a.fixSpatialReference(t.parseGeometryFromDictionary(s[0]),e.spatialReference),l instanceof c==!1)throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n)}else l=s[0]instanceof c?d.fromJSON(s[0].toJSON()):a.fixSpatialReference(new c(JSON.parse(s[0])),e.spatialReference);if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(l)}))},e.extent=function(e,n){return E(e,n,((i,f,E)=>{E=a.autoCastFeatureToGeometry(E),a.pcCheck(E,1,1,e,n);let h=null;if(E[0]instanceof r)h=a.fixSpatialReference(t.parseGeometryFromDictionary(E[0]),e.spatialReference);else if(E[0]instanceof s){const e={xmin:E[0].x,ymin:E[0].y,xmax:E[0].x,ymax:E[0].y,spatialReference:E[0].spatialReference.toJSON()},r=E[0];r.hasZ?(e.zmin=r.z,e.zmax=r.z):r.hasM&&(e.mmin=r.m,e.mmax=r.m),h=d.fromJSON(e)}else h=E[0]instanceof l||E[0]instanceof u||E[0]instanceof c?d.fromJSON(E[0].extent?.toJSON()):E[0]instanceof o?d.fromJSON(E[0].toJSON()):a.fixSpatialReference(new o(JSON.parse(E[0])),e.spatialReference);if(null!==h&&!1===h.spatialReference.equals(e.spatialReference))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(h)}))},e.geometry=function(e,n){return E(e,n,((o,i,c)=>{a.pcCheck(c,1,1,e,n);let s=null;if(null===c[0])return null;if(s=p(c[0])?a.fixSpatialReference(c[0].geometry(),e.spatialReference):c[0]instanceof r?a.fixSpatialReference(t.parseGeometryFromDictionary(c[0]),e.spatialReference):a.fixSpatialReference(d.fromJSON(JSON.parse(c[0])),e.spatialReference),null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(s)}))},e.setgeometry=function(e,r){return E(e,r,((t,n,o)=>{if(a.pcCheck(o,2,2,e,r),!p(o[0]))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);if(!0===o[0].immutable)throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.Immutable,r);if(!(o[1]instanceof i||null===o[1]))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);return o[0]._geometry=o[1],a.voidOperation}))},e.feature=function(e,n){return E(e,n,((o,c,s)=>{if(0===s.length)throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.WrongNumberOfParameters,n);let l=null;if(1===s.length)if(a.isString(s[0]))l=t.fromJson(JSON.parse(s[0]),e.timeReference);else if(p(s[0]))l=t.createFromArcadeFeature(s[0]);else if(s[0]instanceof i)l=t.createFromGraphicLikeObject(s[0],null,null,e.timeReference);else{if(!(s[0]instanceof r))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n);{let n=s[0].hasField("geometry")?s[0].field("geometry"):null,a=s[0].hasField("attributes")?s[0].field("attributes"):null;null!==n&&n instanceof r&&(n=t.parseGeometryFromDictionary(n)),null!==a&&(a=t.parseAttributesFromDictionary(a)),l=t.createFromGraphicLikeObject(n,a,null,e.timeReference)}}else if(2===s.length){let a=null,o=null;if(null!==s[0])if(s[0]instanceof i)a=s[0];else{if(!(a instanceof r))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n);a=t.parseGeometryFromDictionary(s[0])}if(null!==s[1]){if(!(s[1]instanceof r))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n);o=t.parseAttributesFromDictionary(s[1])}l=t.createFromGraphicLikeObject(a,o,null,e.timeReference)}else{let o=null;const c={};if(null!==s[0])if(s[0]instanceof i)o=s[0];else{if(!(o instanceof r))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n);o=t.parseGeometryFromDictionary(s[0])}for(let r=1;r<s.length;r+=2){const t=a.toString(s[r]),o=s[r+1];if(!(null==o||a.isString(o)||isNaN(o)||a.isDate(o)||a.isNumber(o)||a.isBoolean(o)))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n);if(a.isFunctionParameter(o)||!1===a.isSimpleType(o))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,n);o===a.voidOperation?c[t]=null:c[t]=o}l=t.createFromGraphicLikeObject(o,c,null,e.timeReference)}return l._geometry=a.fixSpatialReference(l.geometry(),e.spatialReference),l.immutable=!1,l}))},e.dictionary=function(e,t){return E(e,t,((n,o,c)=>{if(0===c.length||1===c.length&&null===c[0]){const e=new r;return e.immutable=!1,e}if(1===c.length&&a.isString(c[0]))try{const t=JSON.parse(c[0]),n=r.convertObjectToArcadeDictionary(t,a.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(u){throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,t)}if(1===c.length&&c[0]instanceof i)try{const t=c[0].toJSON();t.hasZ=!0===c[0].hasZ,t.hasM=!0===c[0].hasM;const n=r.convertObjectToArcadeDictionary(t,a.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(u){throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,t)}if(1===c.length&&a.isFeature(c[0]))try{const e=new r;e.immutable=!1,e.setField("geometry",c[0].geometry());const t=new r;t.immutable=!1,e.setField("attributes",t);for(const r of c[0].keys())t.setField(r,c[0].field(r));return e}catch(u){throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,t)}if(1===c.length&&c[0]instanceof r)try{const e=new r;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}catch(u){throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,t)}if(2===c.length&&c[0]instanceof r&&a.isBoolean(c[1]))try{if(!(!0===c[1])){const e=new r;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}return c[0].deepClone()}catch(u){throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,t)}if(c.length%2!=0)throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.WrongNumberOfParameters,t);const s={};for(let r=0;r<c.length;r+=2){const n=a.toString(c[r]),o=c[r+1];if(!(null==o||a.isString(o)||isNaN(o)||a.isDate(o)||a.isNumber(o)||a.isBoolean(o)||a.isArray(o)||a.isImmutableArray(o)))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,t);if(a.isFunctionParameter(o))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,t);o===a.voidOperation?s[n]=null:s[n]=o}const l=new r(s);return l.immutable=!1,l}))},e.haskey=function(e,t){return E(e,t,((n,o,c)=>{a.pcCheck(c,2,2,e,t);const s=a.toString(c[1]);if(p(c[0]))return c[0].hasField(s);if(c[0]instanceof r)return c[0].hasField(s);if(c[0]instanceof i){const e=y(c[0],s,null,null,2);return!e||"notfound"!==e.keystate}throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,t)}))},e.hasvalue=function(e,t){return E(e,t,((n,o,c)=>{if(a.pcCheck(c,2,2,e,t),null===c[0]||null===c[1])return!1;const s=a.toString(c[1]);if(a.isFeature(c[0]))return!!c[0].hasField(s)&&null!==c[0].field(s);if(c[0]instanceof r)return!!c[0].hasField(s)&&null!==c[0].field(s);if(c[0]instanceof i){return null!==y(c[0],s,null,null,0)}return!1}))},e.indexof=function(e,r){return E(e,r,((t,n,o)=>{a.pcCheck(o,2,2,e,r);const i=o[1];if(a.isArray(o[0])){for(let e=0;e<o[0].length;e++)if(a.equalityTest(i,o[0][e]))return e;return-1}if(a.isImmutableArray(o[0])){const e=o[0].length();for(let r=0;r<e;r++)if(a.equalityTest(i,o[0].get(r)))return r;return-1}throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r)}))},e.angle=function(e,r){return E(e,r,((t,n,o)=>{if(o=a.autoCastFeatureToGeometry(o),a.pcCheck(o,2,3,e,r),!(o[0]instanceof s))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);if(!(o[1]instanceof s))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);if(o.length>2&&!(o[2]instanceof s))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);return 2===o.length?f.angle2D(o[0],o[1]):f.angleBetween2D(o[0],o[1],o[2])}))},e.bearing=function(e,r){return E(e,r,((t,n,o)=>{if(o=a.autoCastFeatureToGeometry(o),a.pcCheck(o,2,3,e,r),!(o[0]instanceof s))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);if(!(o[1]instanceof s))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);if(o.length>2&&!(o[2]instanceof s))throw new m.ArcadeExecutionError(e,m.ExecutionErrorCodes.InvalidParameter,r);return 2===o.length?f.bearing2D(o[0],o[1]):f.bearingBetween2D(o[0],o[1],o[2])}))},e.isselfintersecting=function(e,r){return E(e,r,((t,n,o)=>{o=a.autoCastFeatureToGeometry(o),a.pcCheck(o,1,1,e,r);let i=o[0];if(i instanceof l)return i.isSelfIntersecting;if(i instanceof u)return i=i.paths,f.pathsSelfIntersecting(i);if(i instanceof c){const e=i.points;for(let r=0;r<e.length;r++)for(let t=0;t<e.length;t++)if(t!==r){let n=!0;for(let a=0;a<e[r].length;a++)if(e[r][a]!==e[t][a]){n=!1;break}if(!0===n)return!0}}return!(!a.isArray(i)&&!a.isImmutableArray(i))&&(i=a.autoCastArrayOfPointsToPolyline(i,e.spatialReference),null!==i&&(i=i.paths),f.pathsSelfIntersecting(i))}))}}let w=0;function y(e,t,a,o,i=1){let c;switch(t=t.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let t=e.spatialReference._arcadeCacheId;if(void 0===t){let r=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(r=!1),r&&(w++,e.spatialReference._arcadeCacheId=w,t=w)}const n=new r({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(e.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const r=e[t];return void 0!==r?r:null}case"type":return"Extent"}break;case"polygon":switch(t){case"rings":c=e.cache._arcadeCacheId,void 0===c&&(w++,c=w,e.cache._arcadeCacheId=c);return new E(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,c);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==e[t]?e[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":c=e.cache._arcadeCacheId,void 0===c&&(w++,c=w,e.cache._arcadeCacheId=c);return new E(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,c);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":c=e.cache._arcadeCacheId,void 0===c&&(w++,c=w,e.cache._arcadeCacheId=c);return new n(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,c,1);case"type":return"Multipoint"}}if(1===i)throw new m.ArcadeExecutionError(a,m.ExecutionErrorCodes.InvalidIdentifier,o);return 2===i?{keystate:"notfound"}:null}e.geometryMember=y,e.registerFunctions=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
