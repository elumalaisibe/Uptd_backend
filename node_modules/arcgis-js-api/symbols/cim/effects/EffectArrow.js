/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../CurveHelper","../enums"],(function(t,e,r,n,o,s,i){"use strict";const c=1.7320508075688772,u=5,h=i.GeometricEffectArrowType.OpenEnded;let f=function(){function t(){}return t.local=function(){return null===t.instance&&(t.instance=new t),t.instance},t.prototype.execute=function(t,e,r,n,o){return new l(t,e,r)},e._createClass(t)}();f.instance=null;let l=function(t){function o(e,r,n){var o;return(o=t.call(this,e,!1,!0)||this)._curveHelper=new s.CurveHelper,o._width=(void 0!==r.width?r.width:u)*n,o._arrowType=void 0!==r.geometricEffectArrowType?r.geometricEffectArrowType:void 0!==r.arrowType?r.arrowType:h,o._offsetFlattenError=s.PIXEL_TOLERANCE*n,o}e._inherits(o,t);var f=o.prototype;return f.processPath=function(t){const e=r.GeometryCursor.createEmptyOptimizedCIM(t.geometryType);switch(this._arrowType){case i.GeometricEffectArrowType.OpenEnded:default:this._constructSimpleArrow(e,t,!0);break;case i.GeometricEffectArrowType.Block:this._constructSimpleArrow(e,t,!1);break;case i.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(e,t)}return e},f._constructSimpleArrow=function(t,e,r){const o=e.pathLength();let s=this._width;o<2*s&&(s=o/2);const i=this._curveHelper.getSubCurve(e,0,o-s);if(!i||!i.nextPath())return;i.seekPathStart();const c=s/2;if(this._curveHelper.isEmpty(i))return;const u=n.collectPath(i),h=this._constructOffset(u,-c);if(!h)return;const f=this._constructOffset(u,c);if(!f)return;const l=this._constructArrowBasePoint(h,-c/2);if(!l)return;const P=this._constructArrowBasePoint(f,c/2);if(!P)return;e.seekInPath(e.numPoints-1);const p=[e.x,e.y];t.pushPath(f),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(P),t.nextPoint(),t.setControlPoint(),t.pushPoint(p),t.nextPoint(),t.setControlPoint(),t.pushPoint(l),t.nextPoint(),t.setControlPoint(),t.pushPoints(h.reverse()),t.setControlPoint(),r||(t.setControlPointAt(0),t.setControlPointAt(t.numPoints-1),t.pushPoint(f[0])),t.reset()},f._constructCrossedArrow=function(t,e){const r=e.pathLength();let o=this._width;r<o*(1+c+1)&&(o=r/(1+c+1)),e.seekPathStart();const s=this._curveHelper.getSubCurve(e,0,r-o*(1+c));if(!s)return;s.nextPath();const i=o/2;if(this._curveHelper.isEmpty(s))return;const u=n.collectPath(s),h=this._constructOffset(u,i);if(!h)return;const f=this._constructOffset(u,-i);if(!f)return;const l=this._curveHelper.getSubCurve(e,0,r-o);if(!l)return;if(l.nextPath(),this._curveHelper.isEmpty(l))return;const P=n.collectPath(l),p=this._constructOffset(P,i);if(!p)return;const a=this._constructOffset(P,-i);if(!a)return;const _=p[p.length-1],C=this._constructArrowBasePoint(p,i/2);if(!C)return;const w=a[a.length-1],m=this._constructArrowBasePoint(a,-i/2);if(!m)return;e.seekInPath(e.numPoints-1);const y=[e.x,e.y];t.pushPath(h),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(w),t.nextPoint(),t.setControlPoint(),t.pushPoint(m),t.nextPoint(),t.setControlPoint(),t.pushPoint(y),t.nextPoint(),t.setControlPoint(),t.pushPoint(C),t.nextPoint(),t.setControlPoint(),t.pushPoint(_),t.nextPoint(),t.setControlPoint(),t.pushPoints(f.reverse()),t.nextPoint(),t.setControlPoint(),t.reset()},f._constructOffset=function(t,e){return this._curveHelper.offset(t,e,i.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)},f._constructArrowBasePoint=function(t,e){if(!t||t.length<2)return null;const r=t[t.length-2],n=t[t.length-1],o=[n[0]-r[0],n[1]-r[1]];return this._curveHelper.normalize(o),[n[0]+o[1]*e,n[1]-o[0]*e]},e._createClass(o)}(o.PathEffectCursor);t.EffectArrow=f,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
