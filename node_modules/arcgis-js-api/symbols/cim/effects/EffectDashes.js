/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../enums","../GeometryWalker"],(function(t,e,s,n,i,a,r){"use strict";let h=function(){function t(){}return t.local=function(){return null===t.instance&&(t.instance=new t),t.instance},t.prototype.execute=function(t,e,s,n,i){return new l(t,e,s)},e._createClass(t)}();h.instance=null;let l=function(t){function i(e,s,n){var i;return(i=t.call(this,e,!0,!0)||this)._firstCurve=null,i._walker=new r.GeometryWalker,i._walker.updateTolerance(n),i._endings=s.lineDashEnding,i._customDashPos=-(s.offsetAlongLine??0)*n,i._offsetAtEnd=(s.customEndingOffset??0)*n,i._pattern=new r.DashPattern,i._pattern.init(s.dashTemplate,!0),i._pattern.scale(n),i}return e._inherits(i,t),i.prototype.processPath=function(t){if(0===this._pattern.length()){this.iteratePath=!1;const e=n.collectPath(t);return s.GeometryCursor.fromJSONCIM({paths:[e]})}if(!this.iteratePath){let e=!0;switch(this._endings){case a.LineDashEnding.HalfPattern:case a.LineDashEnding.HalfGap:default:this._pattern.extPtGap=0;break;case a.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case a.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case a.LineDashEnding.NoConstraint:this.isClosed||(e=!1);break;case a.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const i=t.pathLength();if(this._pattern.isEmpty()||i<.1*this._pattern.length()){const e=n.collectPath(t);return s.GeometryCursor.fromJSONCIM({paths:[e]})}if(!this._walker.init(t,this._pattern,e)){const e=n.collectPath(t);return s.GeometryCursor.fromJSONCIM({paths:[e]})}}let e;if(this.iteratePath)e=this._pattern.nextValue();else{let t;switch(this._endings){case a.LineDashEnding.HalfPattern:default:t=.5*this._pattern.firstValue();break;case a.LineDashEnding.HalfGap:t=.5*-this._pattern.lastValue();break;case a.LineDashEnding.FullGap:t=-this._pattern.lastValue();break;case a.LineDashEnding.FullPattern:t=0;break;case a.LineDashEnding.NoConstraint:case a.LineDashEnding.Custom:t=-this._customDashPos}let s=t/this._pattern.length();s-=Math.floor(s),t=s*this._pattern.length(),this._pattern.reset(),e=this._pattern.nextValue();let n=!1;for(;t>=e;)t-=e,e=this._pattern.nextValue(),n=!n;e-=t,n?(this._walker.nextPosition(e),e=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(e),e=this._pattern.nextValue(),this._walker.nextPosition(e),e=this._pattern.nextValue())}let i=this._walker.nextCurve(e);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else e=this._pattern.nextValue(),!this._walker.nextPosition(e)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i=this._firstCurve,this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i?.reset(),i},e._createClass(i)}(i.PathEffectCursor);t.EffectDashes=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
