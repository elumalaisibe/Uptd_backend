/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/RandomLCG","../CIMPlacements","../enums"],(function(t,i,s,e,n){"use strict";const h=512,_=10,r=24,o=1e-6;let a=function(){function t(){}return t.local=function(){return null===t.instance&&(t.instance=new t),t.instance},t.prototype.execute=function(t,i,s,e,n){return new l(t,i,s,e,n)},i._createClass(t)}();a.instance=null;let l=function(){function t(t,i,_,r,o){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(i.stepX??16)*_,this._stepY=Math.abs(i.stepY??16)*_,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=i.gridType??n.PlacementGridType.Fixed,this._gridType===n.PlacementGridType.Random){const t=i.seed??13,e=1;this._randomLCG=new s(t*e),this._randomness=(i.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=i.gridAngle??0,this._shiftOddRows=i.shiftOddRows??!1,this._offsetX=(i.offsetX??0)*_,this._offsetY=(i.offsetY??0)*_,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=r){const[t,i,s,e]=r.split("/"),n=parseFloat(t),_=parseFloat(i),o=parseFloat(s),a=parseFloat(e);this._graphicOriginX=-(a*2**n+o)*h,this._graphicOriginY=_*h,this._testInsidePolygon=!0}this._internalPlacement=new e.Placement,this._calculateMinMax(t),this._geometryCursor=t}}var a=t.prototype;return a.next=function(){return this._geometryCursor?this._nextInside():null},a._buildRandomValues=function(){if(!t._randValues){t._randValues=[];for(let i=0;i<r;i++)for(let s=0;s<r;s++)t._randValues.push(this._randomLCG.getFloat()),t._randValues.push(this._randomLCG.getFloat())}},a._calculateMinMax=function(t){let i,s,e,n,_,r,o,a,l,f,c,u,p,M;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,o=a=p=c=Number.MAX_VALUE,l=f=M=u=-Number.MAX_VALUE;const g=1!==this._cosAngle;for(t.reset();t.nextPath();)for(;t.nextPoint();)r=t.x,_=t.y,i=r-this._graphicOriginX-this._offsetX,s=_-this._graphicOriginY-this._offsetY,g?(e=this._cosAngle*i-this._sinAngle*s,n=this._sinAngle*i+this._cosAngle*s):(e=i,n=s),o=Math.min(o,e),l=Math.max(l,e),a=Math.min(a,n),f=Math.max(f,n),c=Math.min(c,_),u=Math.max(u,_),p=Math.min(p,r),M=Math.max(M,r);c=c!==Number.MAX_VALUE?c:-h-this._stepY,u=u!==-Number.MAX_VALUE?u:this._stepY,p=p!==Number.MAX_VALUE?p:-this._stepX,M=M!==-Number.MAX_VALUE?M:h+this._stepX;const d=u-c,m=M-p;if(this._verticalSubdivision=d>=m,this._polygonMin=this._verticalSubdivision?c:p,this._testInsidePolygon){let t=0-this._graphicOriginX-this._offsetX-this._stepX,i=h-this._graphicOriginX-this._offsetX+this._stepX,s=-h-this._graphicOriginY-this._offsetY-this._stepY,e=0-this._graphicOriginY-this._offsetY+this._stepY;if(g){const n=[[t,s],[t,e],[i,s],[i,e]];t=s=Number.MAX_VALUE,i=e=-Number.MAX_VALUE;for(const h of n){const n=this._cosAngle*h[0]-this._sinAngle*h[1],_=this._sinAngle*h[0]+this._cosAngle*h[1];t=Math.min(t,n),i=Math.max(i,n),s=Math.min(s,_),e=Math.max(e,_)}}o=o!==Number.MAX_VALUE?Math.max(o,t):t,a=a!==Number.MAX_VALUE?Math.max(a,s):s,l=l!==-Number.MAX_VALUE?Math.min(l,i):i,f=f!==-Number.MAX_VALUE?Math.min(f,e):e}this._xMin=Math.round(o/this._stepX),this._xMax=Math.round(l/this._stepX),this._yMin=Math.round(a/this._stepY),this._yMax=Math.round(f/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(t,p,M,c,u)},a._buildAccelerationMap=function(t,i,s,e,n){t.reset();const r=new Map,o=this._verticalSubdivision,a=o?n-e:s-i;let l=Math.ceil(a/_);if(l<=1)return;const f=Math.floor(a/l);let u,p,M,g,d,m,X,x,A,Y,y;for(l++,this._delta=f,o?(A=-h-this._stepY,Y=this._stepY,y=e):(A=-this._stepX,Y=h+this._stepX,y=i);t.nextPath();)if(!(t.numPoints<2)&&t.nextPoint())for(u=t.x,p=t.y;t.nextPoint();u=M,p=g){if(M=t.x,g=t.y,o){if(p===g||p<A&&g<A||p>Y&&g>Y)continue;d=Math.min(p,g),m=Math.max(p,g)}else{if(u===M||u<A&&M<A||u>Y&&M>Y)continue;d=Math.min(u,M),m=Math.max(u,M)}for(;d<m;)X=Math.floor((d-y)/f),c(X,u,p,M,g,r),d+=f;x=Math.floor((m-y)/f),x>X&&c(x,u,p,M,g,r)}this._accelerationMap=r},a._nextInside=function(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let i=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(i+=.5*this._stepX);const s=this._currentY*this._stepY+this._offsetY;let e,h;if(this._currentX++,this._gridType===n.PlacementGridType.Random){const n=(this._currentX%r+r)%r,_=(this._currentY%r+r)%r;e=this._graphicOriginX+i+this._stepX*this._randomness*(.5-t._randValues[_*r+n])*2/3,h=this._graphicOriginY+s+this._stepY*this._randomness*(.5-t._randValues[_*r+n+1])*2/3}else e=this._graphicOriginX+this._cosAngle*i+this._sinAngle*s,h=this._graphicOriginY-this._sinAngle*i+this._cosAngle*s;if(!this._testInsidePolygon||this._isInsidePolygon(e,h,this._geometryCursor))return this._internalPlacement.setTranslate(e,h),this._internalPlacement}},a._isInsidePolygon=function(t,i,s){if(null==this._accelerationMap)return f(t,i,s);t+=o,i+=o;const e=this._verticalSubdivision,n=e?i:t,h=Math.floor((n-this._polygonMin)/this._delta),_=this._accelerationMap.get(h);if(!_)return!1;let r,a,l,c=0;for(const o of _){if(r=o[0],a=o[1],e){if(r[1]>i==a[1]>i)continue;l=(a[0]-r[0])*(i-r[1])-(a[1]-r[1])*(t-r[0])}else{if(r[0]>t==a[0]>t)continue;l=(a[1]-r[1])*(t-r[0])-(a[0]-r[0])*(i-r[1])}l>0?c++:c--}return 0!==c},i._createClass(t)}();function f(t,i,s){let e,n,h,_,r=0;for(t+=o,i+=o,s.reset();s.nextPath();)if(s.nextPoint())for(e=s.x,n=s.y;s.nextPoint();e=h,n=_){if(h=s.x,_=s.y,n>i==_>i)continue;(h-e)*(i-n)-(_-n)*(t-e)>0?r++:r--}return 0!==r}function c(t,i,s,e,n,h){let _=h.get(t);_||(_=[],h.set(t,_)),_.push([[i,s],[e,n]])}t.PlacementInsidePolygon=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
