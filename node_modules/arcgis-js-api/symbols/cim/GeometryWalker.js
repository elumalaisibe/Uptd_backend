/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../geometry/GeometryCursor","./CurveHelper"],(function(t,e,n,s){"use strict";const i=1e-7;let r=function(){function t(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}var n=t.prototype;return n.isEmpty=function(){return 0===this._values.length},n.size=function(){return this._values.length},n.init=function(t,e,n=!0){if(this._setEmpty(),!t||0===t.length)return!1;for(let s=0;s<t.length;s++){let e=Math.abs(t[s]);n&&e<i&&(e=i),this._values.push(e),this._length+=e}return e&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)},n.scale=function(t){const e=this._values?this._values.length:0;for(let n=0;n<e;++n)this._values[n]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t},n.addValue=function(t){this._length+=t,this._values.push(t)},n.firstValue=function(){return this._values[0]},n.lastValue=function(){return this._values[this._values.length-1]},n.nextValue=function(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]},n.reset=function(){this._currentValue=-1},n.length=function(){return this._length},n._setEmpty=function(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0},e._createClass(t)}(),h=e._createClass((function(){this.pt=null,this.ca=0,this.sa=0}));var o;t.EndType=void 0,(o=t.EndType||(t.EndType={}))[o.FAIL=0]="FAIL",o[o.END=1]="END",o[o.CONTINUE=2]="CONTINUE";let a=function(){function t(){this.reset()}var n=t.prototype;return n.reset=function(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1},n.isValid=function(){return null!==this.segment},n.copyTo=function(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd},e._createClass(t)}(),u=function(i){function r(t=0,e=!1){var n;return(n=i.call(this,t,e)||this)._tolerance=s.PIXEL_TOLERANCE,n._currentPosition=new a,n}e._inherits(r,i);var h=r.prototype;return h.updateTolerance=function(t){this._tolerance=s.PIXEL_TOLERANCE*t},h.init=function(t,e,n=!0){return n?(this._patternLength=e.length(),this._partExtPtGap=e.extPtGap,this._partCtrlPtGap=e.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=t,this._seg=-1,this._setPosAtNextPart()},h.curPositionIsValid=function(){return this._currentPosition.isValid()},h.nextPosition=function(e,n=t.EndType.FAIL){const s=new a;return!!this._nextPosition(e,s,null,n)&&(s.copyTo(this._currentPosition),!0)},h.curPointAndAngle=function(t){t.pt=this._getPoint(this._currentPosition);const[e,n]=this._getAngleCS(this._currentPosition);t.ca=e,t.sa=n},h.nextPointAndAngle=function(e,n,s=t.EndType.FAIL){const i=new a;if(!this._nextPosition(e,i,null,s))return!1;i.copyTo(this._currentPosition),n.pt=this._getPoint(i);const[r,h]=this._getAngleCS(i);return n.ca=r,n.sa=h,!0},h.nextCurve=function(e){if(0===e)return null;const s=n.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");s.startPath(),s.nextPath();const i=new a;return this._nextPosition(e,i,s,t.EndType.END)?(i.copyTo(this._currentPosition),s):null},h.isPathEnd=function(){return this._currentPosition.isPathEnd},h.getPathEnd=function(){return this._currentPosition.segment[1]},h.getPt=function(t){return this._pathCursor.seekInPath(t),[this._pathCursor.x,this._pathCursor.y]},h.getSeg=function(t){return[this.getPt(t),this.getPt(t+1)]},h._nextPosition=function(e,n,s,i){if(this._currentPosition.isPathEnd)return!1;let r=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(r/=this._currentPosition.segmentLength),this._currentPosition.copyTo(n);n.abscissa+e*this._partLengthRatio>n.segmentLength+this._tolerance;){if(s){if(0===s.numPoints)if(0===r){const t=n.segment[0];s.pushXY(t[0],t[1])}else s.pushPoint(this.getSegCoord2D(n.segment,r));const t=n.segment[1];s.pushXY(t[0],t[1])}if(r=0,e-=(n.segmentLength-n.abscissa)/this._partLengthRatio,this._partSegCount)n.segment=this._nextSegment(),n.segmentLength=this.getSegLength(n.segment),n.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return i!==t.EndType.FAIL&&(n.segmentLength=this.getSegLength(n.segment),n.isPartEnd=!0,i===t.EndType.END?(n.abscissa=n.segmentLength,n.isPathEnd=!0):n.abscissa=n.segmentLength+e,!0);this._currentPosition.copyTo(n)}}if(n.abscissa+=e*this._partLengthRatio,s){0===s.numPoints&&(0===r?s.pushPoint(n.segment[0]):s.pushPoint(this.getSegCoord2D(n.segment,r)));const t=n.abscissa/n.segmentLength;1===t?s.pushPoint(n.segment[1]):s.pushPoint(this.getSegCoord2D(n.segment,t))}return this._partSegCount||Math.abs(n.abscissa-n.segmentLength)<this._tolerance&&(n.isPathEnd=this._partIsLast,n.isPartEnd=!0),!0},h._getPoint=function(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,e)},h._getAngleCS=function(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,e)},h._setPosAtNextPart=function(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let t=this._partSegCount;for(;t;)this._previousSegment(),--t;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(e);let n=e+this._partSegCount+1;if(n>=this._pathCursor.numPoints&&(n=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(n),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,e=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let n=Math.round((this._partLength-(t+e))/this._patternLength);n<=0&&(n=t+e>0?0:1),this._partLengthRatio=this._partLength/(t+e+n*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0},h._hasNextSegment=function(){return this._seg<this._pathCursor.numPoints-2},h._previousSegment=function(){return this.getSeg(--this._seg)},h._nextSegment=function(){return this.getSeg(++this._seg)},h._getStartPointIndex=function(){return this._seg},h._getEndPointIndex=function(){return this._seg+1},e._createClass(r)}(s.CurveHelper);t.DashPattern=r,t.GeometryWalker=u,t.Pos=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
