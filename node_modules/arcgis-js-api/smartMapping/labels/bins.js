/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../intl","../../core/Error","./support/utils","../support/binningUtils","../../intl/messages"],(function(e,n,t,r,a,i){"use strict";async function o(e){const{layer:n,renderer:r}=e;if(await n.load(),"binning"!==n.featureReduction?.type)throw new t("bins-label-schemes:invalid-parameters","featureReduction type of the layer is not valid");const a=r||n.featureReduction.renderer;if(!a)throw new t("bins-label-schemes:invalid-parameters","'renderer' is not valid");return{layer:n,renderer:a}}function s(e,n){const t=n.featureReduction;if("fields"in t)for(const r of t.fields)if(r.name.toLowerCase()===e.toLowerCase())return r;return null}async function l(e,n,t,a){const i=s(e,n);if(!i)return null;const o=r.createLabelExpressionForAggregateField(n,t,i,a);return{name:`binning-${e}`,labelingInfo:[r.createLabelClass(o,!0)],fieldName:e}}function c(e){let n=[];const t=e.featureReduction;return"fields"in t&&(n=t.fields.map((e=>e.name))),n}async function u(e){const[{renderer:n,layer:t},r]=await Promise.all([o(e),i.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]),s=await l(a.aggregateCountField,t),u=[],f=c(t).filter((e=>e.toLowerCase()!==a.aggregateCountField.toLowerCase()));for(const a of f){const e=await l(a,t,n,r.clusters.predominantNoneValue);e&&u.push(e)}return{primaryScheme:s,secondarySchemes:u}}e.getLabelSchemes=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
