/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../core/Error","../../intl/messages","../heuristics/clusterMinSize","./support/utils","../support/clusterUtils","../../views/2d/layers/support/clusterUtils"],(function(e,t,s,r,n,i,a){"use strict";async function l(e){const{layer:s,renderer:r,view:n}=e;await Promise.all([s.load(),n.when()]);const i=r||s.renderer;if(!a.isClusterCompatibleRenderer(i))throw new t("clusters-label-schemes:invalid-parameters","'renderer' is not valid");return{layer:s,renderer:i,view:n}}function o(e,t,s){const r="unique-value"===e.type?e.uniqueValueInfos??[]:[];return i.getPredominantTypeExpression(r,t,s)}async function u(e){const{renderer:t,view:s,statInfo:a}=e,l=a?.statisticType,u=a?i.getClusterField(a.attributeInfo,l):i.clusterCountField,c="type"===l?o(t,u,e.noneValueLabel):n.createNumericLabelExpression(u),p=n.createLabelClass(c);return{name:a?`clusters-${l}-${i.getClusterFieldHash(u,l)}`:"clusters-count",labelingInfo:[p],clusterMinSize:await r(p.symbol,s),fieldName:u}}function c(e){const t=new Map;for(const s of e)"size"===s.attributeInfo.vvType?t.set(s.statisticHash,s):t.has(s.statisticHash)||t.set(s.statisticHash,s);return[...t.values()]}async function p(e){const[{renderer:t,layer:r,view:n},a]=await Promise.all([l(e),s.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]);if(!t)return null;let o=null;const p=[],f=c(i.getStatisticInfos(r,t,!1));for(const s of f){const e=await u({renderer:t,view:n,statInfo:s,noneValueLabel:a.clusters.predominantNoneValue});"size"===s.attributeInfo.vvType?o=e:p.push(e)}const d=await u({renderer:t,view:n});return o?p.unshift(d):o=d,{primaryScheme:o,secondarySchemes:p}}e.getLabelSchemes=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
