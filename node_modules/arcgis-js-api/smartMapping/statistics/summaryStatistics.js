/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../core/Error","../../layers/support/fieldUtils","./support/utils","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(i,s,e,a,r,t){"use strict";const n=[...s.numericTypes,"date","string"];async function l(l){if(!(l&&l.layer&&(l.field||l.valueExpression||l.sqlExpression)))throw new i("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(l.valueExpression&&!l.sqlExpression&&!l.view)throw new i("summary-statistics:missing-parameters","View is required when 'valueExpression' is specified");l.forBinning&&a.verifyBinningParams(l,"summary-statistics");const{layer:o,...p}=l,u=l.forBinning?t.binningCapableLayerTypes:t.defaultSupportedLayerTypes,m=t.createLayerAdapter(o,u,l.forBinning);if(!m)throw new i("summary-statistics:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(u).join(", "));const d={layerAdapter:m,...p};d.normalizationType=r.getNormalizationType(d);const y=null!=d.signal?{signal:d.signal}:null;await m.load(y);const f=d.field,c=d.normalizationType,w=d.valueExpression||d.sqlExpression,v=f?m.getField(f):null,g=await r.getFieldsList({field:d.field,normalizationField:d.normalizationField,valueExpression:d.valueExpression}),E=e.verifyBasicFieldValidity(m,g,"summary-statistics:invalid-parameters");if(E)throw E;if(v){const a=e.verifyFieldType(m,v,"summary-statistics:invalid-parameters",n);if(a)throw a;if(s.isDateField(v)&&c)throw new i("summary-statistics:invalid-parameters","Normalization is not allowed for date fields")}else if(w&&c)throw new i("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");const x=e.verifyFilterValidty(d.filter,"summary-statistics:invalid-parameters");if(x)throw x;return d}async function o(i){const{layerAdapter:s,...e}=await l(i);return s.summaryStatistics(e)}return o}));
