/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/Error","../../../../../core/accessorSupport/decorators/subclass","../../../../../renderers/support/heatmapUtils","../../../engine/BitmapTileContainer","./BaseTileRenderer","./support/HeatmapSource"],(function(e,t,i,n,r,s,o,a,c,l,u,p,d){"use strict";e.HeatmapTileRenderer=function(e){function i(t){var i;return(i=e.call(this,t)||this)._intensityInfo={minDensity:0,maxDensity:0},i.type="heatmap",i.featuresView={attributeView:{initialize:()=>{},requestUpdate:()=>{}},requestRender:()=>{}},i._container=new u.BitmapTileContainer(t.tileInfoView),i}t._inherits(i,e);var n=i.prototype;return n.createTile=function(e){const t=this._container.createTile(e);return this.tileInfoView.getTileCoords(t.bitmap,e),t.bitmap.resolution=this.tileInfoView.getTileResolution(e),t},n.onConfigUpdate=function(){const e=this.layer.renderer;if("heatmap"===e.type){const{minDensity:t,maxDensity:i,colorStops:n}=e;this._intensityInfo.minDensity=t,this._intensityInfo.maxDensity=i,this._gradient=l.generateGradient(n),this.tiles.forEach((e=>{const n=e.bitmap.source;n&&(n.minDensity=t,n.maxDensity=i,n.gradient=this._gradient,e.bitmap.invalidateTexture(),e.bitmap.requestRender())}))}},n.hitTest=function(){return Promise.resolve([])},n.install=function(e){e.addChild(this._container)},n.uninstall=function(e){this._container.removeAllChildren(),e.removeChild(this._container)},n.disposeTile=function(e){this._container.removeChild(e),e.destroy()},n.supportsRenderer=function(e){return e&&"heatmap"===e.type},n.onTileData=function(e){const t=this.tiles.get(e.tileKey);if(!t)return;const i=e.intensityInfo,{minDensity:n,maxDensity:r}=this._intensityInfo,s=t.bitmap.source||new d.HeatmapSource;s.intensities=i&&i.matrix||null,s.minDensity=n,s.maxDensity=r,s.gradient=this._gradient,t.bitmap.source=s,this._container.addChild(t),this._container.requestRender(),this.requestUpdate()},n.onTileError=function(e){console.error(e)},n.lockGPUUploads=function(){},n.unlockGPUUploads=function(){},n.fetchResource=function(e,t){return console.error(e),Promise.reject()},t._createClass(i)}(p),e.HeatmapTileRenderer=i.__decorate([c.subclass("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],e.HeatmapTileRenderer),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
