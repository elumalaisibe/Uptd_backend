/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Promise","../../../../core/promiseUtils","../../../../core/workers/workers","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass"],(function(t,e,r,o,n,s,i,a,c,u){"use strict";function l(t){return Array.isArray(t)}let p=function(e){function r(t){var r;return(r=e.call(this,t)||this)._startupResolver=o.createResolver(),r.isReady=!1,r}t._inherits(r,e);var s=r.prototype;return s.initialize=function(){this._controller=new AbortController,this.addResolvingPromise(this._startWorker(this._controller.signal))},s.destroy=function(){this._controller.abort(),this._connection&&this._connection.close()},s.startup=async function(t,e,r,o){await this.when();const n=this._controller.signal,s=l(r.source)?{transferList:r.source,signal:n}:void 0,i={service:r,config:e,tileInfo:t.tileInfo.toJSON(),tiles:o};await this._connection.invoke("startup",i,s),this._startupResolver.resolve(),this._set("isReady",!0)},s.updateTiles=async function(t){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("updateTiles",t))},s.update=async function(t){const e={config:t};return await this._startupResolver.promise,this._connection.invoke("update",e)},s.applyUpdate=async function(t){return await this._startupResolver.promise,this._connection.invoke("applyUpdate",t)},s.setHighlight=async function(t){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",t))},s.stop=async function(){if(await this._startupResolver.promise,!this.closed)return o.ignoreAbortErrors(this._connection.invoke("stop"))},s.refresh=async function(t){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.refresh",t))},s.querySummaryStatistics=async function(t,e,r){return await this._startupResolver.promise,this._connection.invoke("controller.querySummaryStatistics",{query:t.toJSON(),params:e},r)},s.queryAggregateSummaryStatistics=async function(t,e,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryAggregateSummaryStatistics",{query:t.toJSON(),params:e},r)},s.queryUniqueValues=async function(t,e,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryUniqueValues",{query:t.toJSON(),params:e},r)},s.queryAggregateUniqueValues=async function(t,e,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryAggregateUniqueValues",{query:t.toJSON(),params:e},r)},s.queryClassBreaks=async function(t,e,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryClassBreaks",{query:t.toJSON(),params:e},r)},s.queryAggregateClassBreaks=async function(t,e,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryAggregateClassBreaks",{query:t.toJSON(),params:e},r)},s.queryHistogram=async function(t,e,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryHistogram",{query:t.toJSON(),params:e},r)},s.queryAggregateHistogram=async function(t,e,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryAggregateHistogram",{query:t.toJSON(),params:e},r)},s.queryFeatures=async function(t,e){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatures",t?.toJSON(),e)},s.queryVisibleFeatures=async function(t,e){return await this._startupResolver.promise,this._connection.invoke("controller.queryVisibleFeatures",t?.toJSON(),e)},s.queryObjectIds=async function(t,e){return await this._startupResolver.promise,this._connection.invoke("controller.queryObjectIds",t?.toJSON(),e)},s.queryFeatureCount=async function(t,e){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatureCount",t?.toJSON(),e)},s.queryExtent=async function(t,e){return this._connection.invoke("controller.queryExtent",t.toJSON(),e)},s.queryLatestObservations=async function(t,e){return await this._startupResolver.promise,this._connection.invoke("controller.queryLatestObservations",t.toJSON(),e)},s.queryStatistics=async function(t){return await this._startupResolver.promise,this._connection.invoke("controller.queryStatistics",t)},s.queryAggregates=async function(t,e){return await this._startupResolver.promise,this._connection.invoke("controller.queryAggregates",t?.toJSON(),e)},s.queryAggregateCount=async function(t,e){return await this._startupResolver.promise,this._connection.invoke("controller.queryAggregateCount",t?.toJSON(),e)},s.queryAggregateIds=async function(t,e){return await this._startupResolver.promise,this._connection.invoke("controller.queryAggregateIds",t?.toJSON(),e)},s.getObjectId=async function(t){return await this._startupResolver.promise,this._connection.invoke("controller.getObjectId",t)},s.getDisplayId=async function(t){return await this._startupResolver.promise,this._connection.invoke("controller.getDisplayId",t)},s.getFeatures=async function(t){return await this._startupResolver.promise,this._connection.invoke("controller.getFeatures",t)},s.getAggregates=async function(){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregates")},s.getAggregateValueRanges=async function(){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregateValueRanges")},s.mapValidDisplayIds=async function(t){return await this._startupResolver.promise,this._connection.invoke("controller.mapValidDisplayIds",t)},s.onEdits=async function(t){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.onEdits",t))},s.enableEvent=async function(t,e){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:t,value:e}))},s.pauseStream=async function(){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.pauseStream"))},s.resumeStream=async function(){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.resumeStream"))},s.sendMessageToSocket=async function(t){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.sendMessageToSocket",t))},s.sendMessageToClient=async function(t){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.sendMessageToClient",t))},s.updateCustomParameters=async function(t){return await this._startupResolver.promise,o.ignoreAbortErrors(this._connection.invoke("controller.updateCustomParameters",t))},s._startWorker=async function(t){try{this._connection=await n.open("Pipeline",{client:this.client,strategy:"dedicated",signal:t})}catch(e){o.throwIfNotAbortError(e)}},t._createClass(r,[{key:"tileRenderer",set:function(t){this.client.tileRenderer=t}},{key:"closed",get:function(){return this._connection.closed}}]),r}(r.EsriPromise);e.__decorate([s.property()],p.prototype,"isReady",void 0),e.__decorate([s.property({constructOnly:!0})],p.prototype,"client",void 0),e.__decorate([s.property()],p.prototype,"tileRenderer",null),p=e.__decorate([u.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],p);return p}));
