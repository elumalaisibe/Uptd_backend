/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../layers/support/TileInfo","./TileInfoView","./TileKey"],(function(e,l,t,s){"use strict";let n=function(t){function n(){var e;return(e=t.apply(this,arguments)||this)._fullCacheLodInfos=null,e._levelByScale={},e}e._inherits(n,t);var o=n.prototype;return o.getTileParentId=function(e){const l=s.pool.acquire(e),t=0===l.level?null:s.getId(l.level-1,l.row>>1,l.col>>1,l.world);return s.pool.release(l),t},o.getTileCoverage=function(l,t,s=!0,o){const i=e._get(e._getPrototypeOf(n.prototype),"getTileCoverage",this).call(this,l,t,s,o);if(!i)return i;const r=1<<i.lodInfo.level;return i.spans=i.spans.filter((e=>e.row>=0&&e.row<r)),i},o.scaleToLevel=function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];{const l=this._fullCacheLodInfos;if(e>l[0].scale)return l[0].level;let t,s;for(let n=0;n<l.length-1;n++)if(s=l[n+1],e>s.scale)return t=l[n],t.level+(t.scale-e)/(t.scale-s.scale);return l[l.length-1].level}},o._initializeFullCacheLODs=function(e){let t;if(0===e[0].level)t=e.map((e=>({level:e.level,resolution:e.resolution,scale:e.scale})));else{const e=this.tileInfo.size[0],s=this.tileInfo.spatialReference;t=l.create({size:e,spatialReference:s}).lods.map((e=>({level:e.level,resolution:e.resolution,scale:e.scale})))}for(let l=0;l<t.length;l++)this._levelByScale[t[l].scale]=t[l].level;this._fullCacheLodInfos=t},e._createClass(n)}(t);return n}));
