/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./ScriptUtils","../webgl/Rect"],(function(t,e,i,o){"use strict";const c=24,n=17;let s=function(){function t(t,e,i,o,c,n,s){this._glyphItems=t,this._maxWidth=e,this._lineHeight=i,this._letterSpacing=o,this._hAnchor=c,this._vAnchor=n,this._justify=s}var s=t.prototype;return s.getShaping=function(t,e,o){const c=this._letterSpacing,n=this._lineHeight,s=this._justify,l=this._maxWidth,a=[];let h=0,r=0;for(const M of t){const t=M.codePointAt(0);if(null==t)continue;const e=o&&i.hasVerticalOrientation(t);let n;for(const i of this._glyphItems)if(n=i[t],n)break;a.push({codePoint:t,x:h,y:r,vertical:e,glyphMosaicItem:n}),n&&(h+=n.metrics.advance+c)}let f=h;if(l>0){f=h/Math.max(1,Math.ceil(h/l))}const p=t.includes("â€‹"),m=[],u=a.length;for(let M=0;M<u-1;M++){const t=a[M].codePoint,e=i.allowsIdeographicBreak(t);if(i.isLineBreak(t)||e){let i=0;if(10===t)i-=1e4;else if(e&&p)i+=150;else{40!==t&&65288!==t||(i+=50);const e=a[M+1].codePoint;41!==e&&65289!==e||(i+=50)}m.push(this._buildBreak(M+1,a[M].x,f,m,i,!1))}}const g=this._optimalBreaks(this._buildBreak(u,h,f,m,0,!0));let y=0;const d=e?-n:n;let x=0;for(let M=0;M<g.length;M++){const t=g[M];let e=x;for(;e<t&&i.isWhiteSpace(a[e].codePoint);)a[e].glyphMosaicItem=null,++e;let o=t-1;for(;o>e&&i.isWhiteSpace(a[o].codePoint);)a[o].glyphMosaicItem=null,--o;if(e<=o){const t=a[e].x;for(let c=e;c<=o;c++)a[c].x-=t,a[c].y=r;let i=a[o].x;a[o].glyphMosaicItem&&(i+=a[o].glyphMosaicItem.metrics.advance),y=Math.max(i,y),s&&this._applyJustification(a,e,o)}x=t,r+=d}if(a.length>0){const t=g.length-1,i=(s-this._hAnchor)*y;let o=(-this._vAnchor*(t+1)+.5)*n;e&&t&&(o+=t*n);for(const e of a)e.x+=i,e.y+=o}return a.filter((t=>t.glyphMosaicItem))},t.getTextBox=function(t,e){if(!t.length)return null;let i=1/0,o=1/0,c=0,s=0;for(const l of t){const t=l.glyphMosaicItem.metrics.advance,a=l.x,h=l.y-n,r=a+t,f=h+e;i=Math.min(i,a),c=Math.max(c,r),o=Math.min(o,h),s=Math.max(s,f)}return{x:i,y:o,width:c-i,height:s-o}},t.getBox=function(t){if(!t.length)return null;let e=1/0,i=1/0,o=0,c=0;for(const n of t){const{height:t,left:s,top:l,width:a}=n.glyphMosaicItem.metrics,h=n.x,r=n.y-(t-Math.abs(l)),f=h+a+s,p=r+t;e=Math.min(e,h),o=Math.max(o,f),i=Math.min(i,r),c=Math.max(c,p)}return{x:e,y:i,width:o-e,height:c-i}},t.addDecoration=function(t,e){const i=t.length;if(0===i)return;const c=3;let n=t[0].x+t[0].glyphMosaicItem.metrics.left,s=t[0].y;for(let a=1;a<i;a++){const i=t[a];if(i.y!==s){const l=t[a-1].x+t[a-1].glyphMosaicItem.metrics.left+t[a-1].glyphMosaicItem.metrics.width;t.push({codePoint:0,x:n,y:s+e-c,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new o(4,0,4,8),metrics:{width:l-n,height:2+2*c,left:0,top:0,advance:0},page:0,code:0}}),s=i.y,n=i.x+i.glyphMosaicItem.metrics.left}}const l=t[i-1].x+t[i-1].glyphMosaicItem.metrics.left+t[i-1].glyphMosaicItem.metrics.width;t.push({codePoint:0,x:n,y:s+e-c,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new o(4,0,4,8),metrics:{width:l-n,height:2+2*c,left:0,top:0,advance:0},page:0,code:0}})},s._breakScore=function(t,e,i,o){const c=(t-e)*(t-e);return o?t<e?c/2:2*c:c+Math.abs(i)*i},s._buildBreak=function(t,e,i,o,c,n){let s=null,l=this._breakScore(e,i,c,n);for(const a of o){const t=e-a.x,o=this._breakScore(t,i,c,n)+a.score;o<=l&&(s=a,l=o)}return{index:t,x:e,score:l,previousBreak:s}},s._optimalBreaks=function(t){return t?this._optimalBreaks(t.previousBreak).concat(t.index):[]},s._applyJustification=function(t,e,i){const o=t[i],n=o.vertical?c:o.glyphMosaicItem?o.glyphMosaicItem.metrics.advance:0,s=(o.x+n)*this._justify;for(let c=e;c<=i;c++)t[c].x-=s},e._createClass(t)}();t.SDF_GLYPH_BASELINE=n,t.SDF_GLYPH_SIZE=c,t.TextShaping=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
