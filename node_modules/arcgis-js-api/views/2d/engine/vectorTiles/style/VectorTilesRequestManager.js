/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../request","../../../../../core/lang","../../../../../core/MapUtils","../../../../../core/promiseUtils","../../../../../core/urlUtils"],(function(t,e,r,o,n,i,s){"use strict";let l=function(){function t(t){this._tileUrl=t,this._promise=null,this._abortController=null,this._abortOptions=[]}var n=t.prototype;return n.getData=function(t){null===this._promise&&(this._abortController=new AbortController,this._promise=this._makeRequest(this._tileUrl,this._abortController.signal));const e=this._abortOptions;return e.push(t),i.onAbort(t,(()=>{e.every((t=>i.isAborted(t)))&&this._abortController.abort()})),this._promise.then((t=>o.clone(t)))},n._makeRequest=async function(t,e){const{data:o}=await r(t,{responseType:"array-buffer",signal:e});return o},e._createClass(t)}();const a=new Map;function c(t,e,r,o,n){const i=s.urlToObject(t),l=i.query;if(l)for(const[s,c]of Object.entries(l))switch(c){case"{x}":l[s]=o.toString();break;case"{y}":l[s]=r.toString();break;case"{z}":l[s]=e.toString()}const a=i.path;return u(s.addQueryParameters(a.replaceAll(/\{z\}/gi,e.toString()).replaceAll(/\{y\}/gi,r.toString()).replaceAll(/\{x\}/gi,o.toString()),{...i.query}),n)}function u(t,e){return n.getOrCreateMapValue(a,t,(()=>new l(t))).getData(e).then((e=>(a.delete(t),e))).catch((e=>{throw a.delete(t),e}))}t.request=c,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
