/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","./StyleDefinition","./StyleLayer"],(function(e,t,r){"use strict";return function(){function i(e){if(this._style=e,this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,e.layers||(e.layers=[]),this.version=parseFloat(e.version),this.layers=e.layers.map(((e,t,r)=>this._create(e,t,r))).filter((e=>!!e)),this.layers){let e;for(let r=0;r<this.layers.length;r++)e=this.layers[r],this._layerByName[e.id]=e,this._uidToLayer.set(e.uid,e),e.type===t.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(e.id)}this._identifyRefLayers()}var a=i.prototype;return a.isPainterDataDriven=function(e){const t=this._layerByName[e];return!!t&&t.isPainterDataDriven()},a.getStyleLayerId=function(e){return e>=this.layers.length?null:this.layers[e].id},a.getStyleLayerByUID=function(e){return this._uidToLayer.get(e)??null},a.getStyleLayerIndex=function(e){const t=this._layerByName[e];return t?this.layers.indexOf(t):-1},a.setStyleLayer=function(e,t){if(!e||!e.id)return;const r=this._style;null!=t&&t>=this.layers.length&&(t=this.layers.length-1);let a,s=!0;const y=this._layerByName[e.id];if(y){const l=this.layers.indexOf(y);t||(t=l),t===l?(s=!1,a=i._recreateLayer(e,y),this.layers[t]=a,r.layers[t]=e):(this.layers.splice(l,1),r.layers.splice(l,1),a=this._create(e,t,this.layers),this.layers.splice(t,0,a),r.layers.splice(t,0,e))}else a=this._create(e,t,this.layers),!t||t>=this.layers.length?(this.layers.push(a),r.layers.push(e)):(this.layers.splice(t,0,a),r.layers.splice(t,0,e));this._layerByName[e.id]=a,this._uidToLayer.set(a.uid,a),s&&this._recomputeZValues(),this._identifyRefLayers()},a.getStyleLayer=function(e){const t=this._layerByName[e];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null},a.deleteStyleLayer=function(e){const t=this._layerByName[e];if(t){delete this._layerByName[e],this._uidToLayer.delete(t.uid);const r=this.layers.indexOf(t);this.layers.splice(r,1),this._style.layers.splice(r,1),this._recomputeZValues(),this._identifyRefLayers()}},a.getLayerById=function(e){return this._layerByName[e]},a.getLayoutProperties=function(e){const t=this._layerByName[e];return t?t.layout:null},a.getPaintProperties=function(e){const t=this._layerByName[e];return t?t.paint:null},a.setPaintProperties=function(e,t){const r=this._layerByName[e];if(!r)return;const a={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:t},s=i._recreateLayer(a,r),y=this.layers.indexOf(r);this.layers[y]=s,this._style.layers[y].paint=t,this._layerByName[r.id]=s,this._uidToLayer.set(r.uid,s)},a.setLayoutProperties=function(e,t){const r=this._layerByName[e];if(!r)return;const a={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:t,paint:r.paint},s=i._recreateLayer(a,r),y=this.layers.indexOf(r);this.layers[y]=s,this._style.layers[y].layout=t,this._layerByName[r.id]=s,this._uidToLayer.set(r.uid,s)},a.setStyleLayerVisibility=function(e,t){const r=this._layerByName[e];if(!r)return;const a=r.layout||{};a.visibility=t;const s={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:a,paint:r.paint},y=i._recreateLayer(s,r),l=this.layers.indexOf(r);this.layers[l]=y,this._style.layers[l].layout=a,this._layerByName[r.id]=y,this._uidToLayer.set(r.uid,y)},a.getStyleLayerVisibility=function(e){const t=this._layerByName[e];if(!t)return"none";const r=t.layout;return r?.visibility??"visible"},a._recomputeZValues=function(){const e=this.layers,t=1/(e.length+1);for(let r=0;r<e.length;r++)e[r].z=1-(1+r)*t},a._identifyRefLayers=function(){const e=[],r=[];let i=0;for(const a of this.layers){const s=a.layout;if(a.type===t.StyleLayerType.FILL){const t=a;let r=a.source+"|"+a.sourceLayer;r+="|"+(s?.visibility??""),r+="|"+a.minzoom,r+="|"+a.maxzoom,r+="|"+JSON.stringify(a.filter),(t.hasDataDrivenFill||t.hasDataDrivenOutline)&&(r+="|"+i),e.push({key:r,layer:a})}else if(a.type===t.StyleLayerType.LINE){const e=a,t=a.paint,y=null!=t&&(null!=t["line-pattern"]||null!=t["line-dasharray"]);let l=a.source+"|"+a.sourceLayer;l+="|"+(s?.visibility??""),l+="|"+a.minzoom,l+="|"+a.maxzoom,l+="|"+JSON.stringify(a.filter),l+="|"+(void 0!==s?s["line-cap"]:""),l+="|"+(void 0!==s?s["line-join"]:""),(e.hasDataDrivenLine||y)&&(l+="|"+i),r.push({key:l,layer:a})}++i}this._assignRefLayers(e),this._assignRefLayers(r)},a._assignRefLayers=function(e){let r,i;e.sort(((e,t)=>e.key<t.key?-1:e.key>t.key?1:0));const a=e.length;for(let s=0;s<a;s++){const y=e[s];if(y.key===r)y.layer.refLayerId=i;else if(r=y.key,i=y.layer.id,y.layer.type===t.StyleLayerType.FILL){if(!y.layer.getPaintProperty("fill-outline-color"))for(let t=s+1;t<a;t++){const a=e[t];if(a.key!==r)break;if(a.layer.getPaintProperty("fill-outline-color")){e[s]=a,e[t]=y,i=a.layer.id;break}}}else if(y.layer.type===t.StyleLayerType.LINE){let t=y.layer;for(let l=s+1;l<a;l++){const a=e[l];if(a.key!==r)break;const n=a.layer;(t.canUseThinTessellation&&!n.canUseThinTessellation||!t.canUseThinTessellation&&(n.getPaintProperty("line-pattern")||n.getPaintProperty("line-dasharray")))&&(t=n,e[s]=a,e[l]=y,i=a.layer.id)}}}},a._create=function(e,i,a){const s=1-(1+i)*(1/(a.length+1)),y=this._runningId++;switch(e.type){case"background":return new r.BackgroundStyleLayer(t.StyleLayerType.BACKGROUND,e,s,y);case"fill":return new r.FillStyleLayer(t.StyleLayerType.FILL,e,s,y);case"line":return new r.LineStyleLayer(t.StyleLayerType.LINE,e,s,y);case"symbol":return new r.SymbolStyleLayer(t.StyleLayerType.SYMBOL,e,s,y);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new r.CircleStyleLayer(t.StyleLayerType.CIRCLE,e,s,y)}return null},i._recreateLayer=function(e,i){switch(e.type){case"background":return new r.BackgroundStyleLayer(t.StyleLayerType.BACKGROUND,e,i.z,i.uid);case"fill":return new r.FillStyleLayer(t.StyleLayerType.FILL,e,i.z,i.uid);case"line":return new r.LineStyleLayer(t.StyleLayerType.LINE,e,i.z,i.uid);case"symbol":return new r.SymbolStyleLayer(t.StyleLayerType.SYMBOL,e,i.z,i.uid);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new r.CircleStyleLayer(t.StyleLayerType.CIRCLE,e,i.z,i.uid)}return null},e._createClass(i)}()}));
