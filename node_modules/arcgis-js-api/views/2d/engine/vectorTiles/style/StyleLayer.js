/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../enums","../shaders/VTLBackgroundMaterial","../shaders/VTLCircleMaterial","../shaders/VTLFillMaterial","../shaders/VTLLineMaterial","../shaders/VTLSymbolMaterial","./Filter","./StyleDefinition","./StyleProperty","../../webgl/definitions"],(function(t,e,i,a,r,n,o,s,l,u,h,p){"use strict";var y;t.CapType=void 0,(y=t.CapType||(t.CapType={}))[y.BUTT=0]="BUTT",y[y.ROUND=1]="ROUND",y[y.SQUARE=2]="SQUARE",y[y.UNKNOWN=4]="UNKNOWN";let g=function(){function t(t,e,i,a){switch(this.type=t,this.typeName=e.type,this.id=e.id,this.source=e.source,this.sourceLayer=e["source-layer"],this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.filter=e.filter,this.layout=e.layout,this.paint=e.paint,this.z=i,this.uid=a,t){case u.StyleLayerType.BACKGROUND:this._layoutDefinition=u.StyleDefinition.backgroundLayoutDefinition,this._paintDefinition=u.StyleDefinition.backgroundPaintDefinition;break;case u.StyleLayerType.FILL:this._layoutDefinition=u.StyleDefinition.fillLayoutDefinition,this._paintDefinition=u.StyleDefinition.fillPaintDefinition;break;case u.StyleLayerType.LINE:this._layoutDefinition=u.StyleDefinition.lineLayoutDefinition,this._paintDefinition=u.StyleDefinition.linePaintDefinition;break;case u.StyleLayerType.SYMBOL:this._layoutDefinition=u.StyleDefinition.symbolLayoutDefinition,this._paintDefinition=u.StyleDefinition.symbolPaintDefinition;break;case u.StyleLayerType.CIRCLE:this._layoutDefinition=u.StyleDefinition.circleLayoutDefinition,this._paintDefinition=u.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}var i=t.prototype;return i.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=l.createFilter(this.filter)},i.getLayoutProperty=function(t){return this._layoutProperties[t]},i.getPaintProperty=function(t){return this._paintProperties[t]},i.getLayoutValue=function(t,e,i){let a;const r=this._layoutProperties[t];return r&&(a=r.getValue(e,i)),void 0===a&&(a=this._layoutDefinition[t].default),a},i.getPaintValue=function(t,e,i){let a;const r=this._paintProperties[t];return r&&(a=r.getValue(e,i)),void 0===a&&(a=this._paintDefinition[t].default),a},i.isPainterDataDriven=function(){const t=this._paintProperties;if(t)for(const e in t)if(t[e].isDataDriven)return!0;return!1},i._parseLayout=function(t){const e={};for(const i in t){const a=this._layoutDefinition[i];a&&(e[i]=new h(a,t[i]))}return e},i._parsePaint=function(t){const e={};for(const i in t){const a=this._paintDefinition[i];a&&(e[i]=new h(a,t[i]))}return e},i.computeAttributesKey=function(t,e,i,a){let r=0,n=0;for(const o of e){let t=3;if(!o||o!==a){const e=i[o],{isLayout:a,isOptional:r}=e,n=a?this.getLayoutProperty(o):this.getPaintProperty(o);t=n?.interpolator?2:n?.isDataDriven?1:r&&!n?3:0}n|=t<<r,r+=2}return n<<3|t},e._createClass(t)}(),c=function(t){function r(e,r,n,o){var s;return(s=t.call(this,e,r,n,o)||this).backgroundMaterial=new a.VTLBackgroundMaterial(s.computeAttributesKey(i.ShaderProgramType.BACKGROUND,a.VTLBackgroundMaterial.ATTRIBUTES,a.VTLBackgroundMaterial.ATTRIBUTES_INFO)),s}return e._inherits(r,t),e._createClass(r)}(g),D=function(t){function a(e,a,r,o){var s;const l=(s=t.call(this,e,a,r,o)||this).getPaintProperty("fill-color"),u=s.getPaintProperty("fill-opacity"),h=s.getPaintProperty("fill-pattern");s.hasDataDrivenColor=l?.isDataDriven,s.hasDataDrivenOpacity=u?.isDataDriven,s.hasDataDrivenFill=s.hasDataDrivenColor||s.hasDataDrivenOpacity||h?.isDataDriven;const p=s.getPaintProperty("fill-outline-color");return s.outlineUsesFillColor=!p,s.hasDataDrivenOutlineColor=p?.isDataDriven,s.hasDataDrivenOutline=p?p.isDataDriven:!!l&&l.isDataDriven,s.hasDataDrivenOutline=(p?s.hasDataDrivenOutlineColor:s.hasDataDrivenColor)||s.hasDataDrivenOpacity,s.fillMaterial=new n.VTLFillMaterial(s.computeAttributesKey(i.ShaderProgramType.FILL,n.VTLFillMaterial.ATTRIBUTES,n.VTLFillMaterial.ATTRIBUTES_INFO)),s.outlineMaterial=new n.VTLOutlineMaterial(s.computeAttributesKey(i.ShaderProgramType.OUTLINE,s.outlineUsesFillColor?n.VTLOutlineMaterial.ATTRIBUTES_FILL:n.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,s.outlineUsesFillColor?n.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:n.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),s.outlineUsesFillColor),s}return e._inherits(a,t),e._createClass(a)}(g),P=function(a){function r(t,e,r,n){var s;const l=(s=a.call(this,t,e,r,n)||this).getPaintProperty("line-pattern");if(s.lineMaterial=new o.VTLLineMaterial(s.computeAttributesKey(i.ShaderProgramType.LINE,o.VTLLineMaterial.ATTRIBUTES,o.VTLLineMaterial.ATTRIBUTES_INFO,l?"line-dasharray":"")),s.hasDataDrivenLine=s.getPaintProperty("line-blur")?.isDataDriven||s.getPaintProperty("line-color")?.isDataDriven||s.getPaintProperty("line-gap-width")?.isDataDriven||s.getPaintProperty("line-offset")?.isDataDriven||s.getPaintProperty("line-opacity")?.isDataDriven||s.getPaintProperty("line-pattern")?.isDataDriven||s.getPaintProperty("line-dasharray")?.isDataDriven||s.getLayoutProperty("line-cap")?.isDataDriven||s.getPaintProperty("line-width")?.isDataDriven,s.canUseThinTessellation=!1,!s.hasDataDrivenLine){const t=s.getPaintProperty("line-width");if(!t||"number"==typeof t&&.5*t<p.THIN_LINE_HALF_WIDTH_THRESHOLD){const t=s.getPaintProperty("line-offset");(!t||"number"==typeof t&&0===t)&&(s.canUseThinTessellation=!0)}}return s}return e._inherits(r,a),r.prototype.getDashKey=function(e,i){let a;switch(i){case t.CapType.BUTT:a="Butt";break;case t.CapType.ROUND:a="Round";break;case t.CapType.SQUARE:a="Square";break;default:a="Butt"}return`dasharray-[${e.toString()}]-${a}`},e._createClass(r)}(g),f=function(t){function a(e,a,r,n){var o;return(o=t.call(this,e,a,r,n)||this).iconMaterial=new s.VTLIconMaterial(o.computeAttributesKey(i.ShaderProgramType.ICON,s.VTLIconMaterial.ATTRIBUTES,s.VTLIconMaterial.ATTRIBUTES_INFO)),o.textMaterial=new s.VTLTextMaterial(o.computeAttributesKey(i.ShaderProgramType.TEXT,s.VTLTextMaterial.ATTRIBUTES,s.VTLTextMaterial.ATTRIBUTES_INFO)),o.hasDataDrivenIcon=o.getPaintProperty("icon-color")?.isDataDriven||o.getPaintProperty("icon-halo-blur")?.isDataDriven||o.getPaintProperty("icon-halo-color")?.isDataDriven||o.getPaintProperty("icon-halo-width")?.isDataDriven||o.getPaintProperty("icon-opacity")?.isDataDriven||o.getLayoutProperty("icon-size")?.isDataDriven,o.hasDataDrivenText=o.getPaintProperty("text-color")?.isDataDriven||o.getPaintProperty("text-halo-blur")?.isDataDriven||o.getPaintProperty("text-halo-color")?.isDataDriven||o.getPaintProperty("text-halo-width")?.isDataDriven||o.getPaintProperty("text-opacity")?.isDataDriven||o.getLayoutProperty("text-size")?.isDataDriven,o}return e._inherits(a,t),e._createClass(a)}(g),L=function(t){function a(e,a,n,o){var s;return(s=t.call(this,e,a,n,o)||this).circleMaterial=new r.VTLCircleMaterial(s.computeAttributesKey(i.ShaderProgramType.CIRCLE,r.VTLCircleMaterial.ATTRIBUTES,r.VTLCircleMaterial.ATTRIBUTES_INFO)),s}return e._inherits(a,t),e._createClass(a)}(g),T=function(){function t(t,e,i){let a;this.allowOverlap=t.getLayoutValue("icon-allow-overlap",e),this.ignorePlacement=t.getLayoutValue("icon-ignore-placement",e),this.keepUpright=t.getLayoutValue("icon-keep-upright",e),this.optional=t.getLayoutValue("icon-optional",e),this.rotationAlignment=t.getLayoutValue("icon-rotation-alignment",e),this.rotationAlignment===u.RotationAlignment.AUTO&&(this.rotationAlignment=i?u.RotationAlignment.MAP:u.RotationAlignment.VIEWPORT),a=t.getLayoutProperty("icon-anchor"),a?.isDataDriven?this._anchorProp=a:this.anchor=t.getLayoutValue("icon-anchor",e),a=t.getLayoutProperty("icon-offset"),a?.isDataDriven?this._offsetProp=a:this.offset=t.getLayoutValue("icon-offset",e),a=t.getLayoutProperty("icon-padding"),a?.isDataDriven?this._paddingProp=a:this.padding=t.getLayoutValue("icon-padding",e),a=t.getLayoutProperty("icon-rotate"),a?.isDataDriven?this._rotateProp=a:this.rotate=t.getLayoutValue("icon-rotate",e),a=t.getLayoutProperty("icon-size"),a?.isDataDriven?this._sizeProp=a:this.size=t.getLayoutValue("icon-size",e)}return t.prototype.update=function(t,e){this._anchorProp&&(this.anchor=this._anchorProp.getValue(t,e)),this._offsetProp&&(this.offset=this._offsetProp.getValue(t,e)),this._paddingProp&&(this.padding=this._paddingProp.getValue(t,e)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(t,e)),this._sizeProp&&(this.size=this._sizeProp.getValue(t,e))},e._createClass(t)}(),_=function(){function t(t,e,i){let a;this.allowOverlap=t.getLayoutValue("text-allow-overlap",e),this.ignorePlacement=t.getLayoutValue("text-ignore-placement",e),this.keepUpright=t.getLayoutValue("text-keep-upright",e),this.optional=t.getLayoutValue("text-optional",e),this.rotationAlignment=t.getLayoutValue("text-rotation-alignment",e),this.rotationAlignment===u.RotationAlignment.AUTO&&(this.rotationAlignment=i?u.RotationAlignment.MAP:u.RotationAlignment.VIEWPORT),a=t.getLayoutProperty("text-anchor"),a?.isDataDriven?this._anchorProp=a:this.anchor=t.getLayoutValue("text-anchor",e),a=t.getLayoutProperty("text-justify"),a?.isDataDriven?this._justifyProp=a:this.justify=t.getLayoutValue("text-justify",e),a=t.getLayoutProperty("text-letter-spacing"),a?.isDataDriven?this._letterSpacingProp=a:this.letterSpacing=t.getLayoutValue("text-letter-spacing",e),a=t.getLayoutProperty("text-line-height"),a?.isDataDriven?this._lineHeightProp=a:this.lineHeight=t.getLayoutValue("text-line-height",e),a=t.getLayoutProperty("text-max-angle"),a?.isDataDriven?this._maxAngleProp=a:this.maxAngle=t.getLayoutValue("text-max-angle",e),a=t.getLayoutProperty("text-max-width"),a?.isDataDriven?this._maxWidthProp=a:this.maxWidth=t.getLayoutValue("text-max-width",e),a=t.getLayoutProperty("text-offset"),a?.isDataDriven?this._offsetProp=a:this.offset=t.getLayoutValue("text-offset",e),a=t.getLayoutProperty("text-padding"),a?.isDataDriven?this._paddingProp=a:this.padding=t.getLayoutValue("text-padding",e),a=t.getLayoutProperty("text-rotate"),a?.isDataDriven?this._rotateProp=a:this.rotate=t.getLayoutValue("text-rotate",e),a=t.getLayoutProperty("text-size"),a?.isDataDriven?this._sizeProp=a:this.size=t.getLayoutValue("text-size",e),a=t.getLayoutProperty("text-writing-mode"),a?.isDataDriven?this._writingModeProp=a:this.writingMode=t.getLayoutValue("text-writing-mode",e)}return t.prototype.update=function(t,e){this._anchorProp&&(this.anchor=this._anchorProp.getValue(t,e)),this._justifyProp&&(this.justify=this._justifyProp.getValue(t,e)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(t,e)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(t,e)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(t,e)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(t,e)),this._offsetProp&&(this.offset=this._offsetProp.getValue(t,e)),this._paddingProp&&(this.padding=this._paddingProp.getValue(t,e)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(t,e)),this._sizeProp&&(this.size=this._sizeProp.getValue(t,e)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(t,e))},e._createClass(t)}();t.BackgroundStyleLayer=c,t.CircleStyleLayer=L,t.FillStyleLayer=D,t.IconLayout=T,t.LineStyleLayer=P,t.StyleLayer=g,t.SymbolStyleLayer=f,t.TextLayout=_,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
