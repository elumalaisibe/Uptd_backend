/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../expression/expression","../expression/types"],(function(e,r,t){"use strict";return function(){function n(e){this._expression=e}return n.prototype.filter=function(e,r){if(!this._expression)return!0;try{return this._expression.evaluate(e,r)}catch(t){return console.log(t.message),!0}},n.createFilter=function(e){if(!e)return null;this.isLegacyFilter(e)&&(e=this.convertLegacyFilter(e));try{return new n(r.createExpression(e,null,t.BooleanType))}catch(s){return console.log(s.message),null}},n.isLegacyFilter=function(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(let r=1;r<e.length;r++)if(this.isLegacyFilter(e[r]))return!0;return!1;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);default:return!1}},n.convertLegacyFilter=function(e){if(!Array.isArray(e)||0===e.length)return!0;const r=e[0];if(1===e.length)return"any"!==r;switch(r){case"==":return n.convertComparison("==",e[1],e[2]);case"!=":return n.negate(n.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return n.convertComparison(r,e[1],e[2]);case"in":return n.convertIn(e[1],e.slice(2));case"!in":return n.negate(n.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return n.convertCombining(r,e.slice(1));case"has":return n.convertHas(e[1]);case"!has":return n.negate(n.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}},n.convertComparison=function(e,r,t){switch(r){case"$type":return[e,["geometry-type"],t];case"$id":return[e,["id"],t];default:return[e,["get",r],t]}},n.convertIn=function(e,r){switch(e){case"$type":return["in",["geometry-type"],["literal",r]];case"$id":return["in",["id"],["literal",r]];default:return["in",["get",e],["literal",r]]}},n.convertHas=function(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}},n.convertCombining=function(e,r){return[e].concat(r.map(this.convertLegacyFilter))},n.negate=function(e){return["!",e]},e._createClass(n)}()}));
