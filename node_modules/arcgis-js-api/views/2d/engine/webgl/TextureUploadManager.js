/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils","./definitions","../../../webgl/contextUtils"],(function(e,t,n,o,s){"use strict";let u=function(){function e(e,t){this._queue=[],this._context=e,this._refreshable=t}var u=e.prototype;return u.destroy=function(){this._queue=[]},u.enqueueTextureUpdate=function(e,t){const u=n.createResolver(),r=e,i=o.TEXTURE_UPLOAD_MANAGER_CHUNK_SIZE,h=Math.ceil(r.height/i);if(n.throwIfAborted(t),this._context.type===s.ContextType.WEBGL1)this._queue.push({type:"no-chunk",request:e,resolver:u,options:t});else for(let n=0;n<h;n++){const o=n*i,s=n===h-1,c=s?r.height-i*n:i;this._queue.push({type:"chunk",request:e,resolver:u,chunk:n,chunkOffset:o,destHeight:c,chunkIsLast:s,options:t})}return n.onAbortOrThrow(t,(e=>u.reject(e))),u.promise},u.upload=function(){let e=0;for(;this._queue.length;){const t=performance.now(),n=this._queue.shift();if(n){if(null!=n.options.signal&&n.options.signal.aborted)continue;switch(n.type){case"chunk":this._uploadChunk(n);break;case"no-chunk":this._uploadNoChunk(n)}const s=performance.now()-t;if(e+=s,e+s>=o.TEXTURE_UPLOAD_MANAGER_BUDGET)break}}this._queue.length&&this._refreshable.requestRender()},u._uploadChunk=function(e){const{request:t,resolver:n,chunkOffset:o,chunkIsLast:s,destHeight:u}=e,{data:r,texture:i,width:h}=t;null!=r&&(i.updateData(0,0,o,h,u,r,o),s&&n.resolve())},u._uploadNoChunk=function(e){const{request:t,resolver:n}=e,{data:o,texture:s}=t;s.setData(o),n.resolve()},t._createClass(e)}();e.TextureUploadManager=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
