/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../VertexStream","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],(function(e,t,r,i,s,n,o){"use strict";let a=function(){function e(){this._layerFBOTexture=null,this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}var a=e.prototype;return a.dispose=function(){this._layerFBOTexture=r.disposeMaybe(this._layerFBOTexture)},a.draw=function(e,t,r){const{width:i,height:n}=t;this._createOrResizeResources(e,i,n);const{context:o,painter:a}=e,{materialManager:u}=a,l=this._programDesc,c=this._quad,_=r.colorMatrix;c.bind();const h=this._layerFBOTexture;o.bindFramebuffer(t),t.copyToTexture(0,0,i,n,0,0,h),o.setBlendingEnabled(!1),o.setStencilTestEnabled(!1);const d=u.getProgram(l);o.useProgram(d),o.bindTexture(h,2),d.setUniformMatrix4fv("u_coefficients",_),d.setUniform1i("u_colorTexture",2),c.draw(),o.setBlendingEnabled(!0),o.setBlendFunction(s.BlendFactor.ONE,s.BlendFactor.ONE_MINUS_SRC_ALPHA),o.setStencilTestEnabled(!0),c.unbind()},a._createOrResizeResources=function(e,t,r){const{context:a}=e;if(!this._layerFBOTexture||this._size[0]!==t||this._size[1]!==r){if(this._size[0]=t,this._size[1]=r,this._layerFBOTexture)this._layerFBOTexture.resize(t,r);else{const e=new o.TextureDescriptor;e.internalFormat=s.PixelFormat.RGBA,e.wrapMode=s.TextureWrapMode.CLAMP_TO_EDGE,e.width=t,e.height=r,this._layerFBOTexture=new n.Texture(a,e)}this._quad||(this._quad=new i(a,[-1,-1,1,-1,-1,1,1,1]))}},t._createClass(e)}();e.Colorize=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
