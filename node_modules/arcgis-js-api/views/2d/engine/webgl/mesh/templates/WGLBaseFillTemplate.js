/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../enums","../../number","../../Utils","../../materialKey/MaterialKey","./templateUtils","./WGLLineTemplate"],(function(e,t,r,i,s,n,o){"use strict";const l=100,a=1;return y=>function(y){function u(...e){var r;return(r=y.call(this,...e)||this).forceLibtess=!1,r._bitset=0,r._lineTemplate=null,r.geometryType=t.WGLGeometryType.FILL,r}e._inherits(u,y);var m=u.prototype;return m._maybeAddLineTemplate=function(e){this._lineTemplate=o.fromFillOutline(e)},m._write=function(e,t,r,i){const n="esriGeometryPoint"===t.geometryType,o=s.FillMaterialKey.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,n),this._writeGeometry(e,t,o,i,n),s.hasOutlineFillSymbology(o)&&null!=this._lineTemplate&&this._lineTemplate.writeGeometry(e,t,i,n),e.recordEnd()},m._writeGeometry=function(e,t,r,i,s){const o=this._getGeometry(t,i,s);if(null==o)return;const a=[];if(!(o.maxLength>l)&&!this.forceLibtess&&n.triangulate(a,o))return void(a.length&&this._writeVertices(e,t,o.coords,o.lengths,r,a));const y=n.triangulateLibtess(o);this._writeVertices(e,t,y,[y.length/2],r)},m._writeVertex=function(e,i,n,o,l,y){const u=r.i1616to32(a*o,a*l);if(e.vertexBounds(o,l,0,0),e.vertexWrite(u),e.vertexWrite(i),n.symbologyType===t.WGLSymbologyType.DOT_DENSITY)e.vertexWriteF32(1/Math.abs(y.readGeometryArea()));else{e.vertexWrite(this.fillColor);const t=s.hasSimpleSymbology(n);t||(e.vertexWrite(this.tl),e.vertexWrite(this.br)),e.vertexWrite(this.aux21),e.vertexWrite(this.aux22),e.vertexWrite(this.aux3),t||e.vertexWrite(this._minMaxZoom)}},m._writeVertices=function(e,t,r,s,n,o){const l=t.getDisplayId(),a=this._bitset<<24|l,y=s.reduce(((e,t)=>e+t)),u=i.getStrides(n.geometryType,n.symbologyType).geometry/4,m=e.vertexCount();e.vertexEnsureSize(u*y);let c=0;if(o)for(const i of o){const s=r[2*i],o=r[2*i+1];this._writeVertex(e,a,n,s,o,t),c++}else for(let i=0;i<r.length;i+=2){const s=Math.round(r[i]),o=Math.round(r[i+1]);this._writeVertex(e,a,n,s,o,t),c++}e.indexEnsureSize(c);for(let i=0;i<c;i++)e.indexWrite(i+m)},m._getGeometry=function(e,t,r){const i=t?.asOptimized()||e.readGeometryForDisplay();if(!i)return null;const s=r?256:8;return n.clipMarshall(i,s)},e._createClass(u)}(y)}));
