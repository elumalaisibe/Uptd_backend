/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/screenUtils","../../color","../../definitions","../../GeometryUtils","../../number","../../materialKey/MaterialKey","./util","./WGLBaseFillTemplate","./WGLMeshTemplate"],(function(_,t,O,e,R,I,l,T,E,S){"use strict";return function(E){function S(_,t,O,R,T,S,i,n,A,o,C,r,F,M,a,N){var P;(P=E.call(this)||this)._effects=M||void 0;const s=l.FillMaterialKey.load(_);return t&&(s.sdf=t.sdf,s.pattern=!0,s.textureBinding=t.textureBinding),P.fillColor=O,P.tl=R,P.br=T,P.aux21=I.i1616to32(S,i),P.aux22=I.i1616to32(n,A),P.aux3=I.i8888to32(o,C,r,0),P._bitset=F,P._minMaxZoom=I.i1616to32(Math.round(a*e.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(N*e.MIN_MAX_ZOOM_PRECISION_FACTOR)),P._materialKey=s.data,P}return _._inherits(S,E),S.fromCIMFill=function(_,l,E){const i=_.color,n=i&&O.premultiplyAlphaRGBA(i)||0,A=_.materialKey,[o,C]=T.getMinMaxZoom(_.scaleInfo,E);let r=(_.colorLocked?e.BITSET_GENERIC_LOCK_COLOR:0)|(_.applyRandomOffset?e.BITSET_FILL_RANDOM_PATTERN_OFFSET:0)|(_.sampleAlphaOnly?e.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0)|(_.hasUnresolvedReplacementColor?e.BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR:0);if(!l)return new S(A,null,n,0,0,0,0,0,0,0,0,0,r,_.effects,o,C);const{rect:F,width:M,height:a}=l,N=_.scaleX||1,P=F.x+e.SPRITE_PADDING,s=F.y+e.SPRITE_PADDING,u=P+M,L=s+a,c=t.pt2px(_.height);let p=N*c;"CIMHatchFill"===_.cim.type&&(p*=M/a);let f=c;f<=0&&(f=L-s),f<e.MAX_SIZE_FOR_U16_COMPRESSION&&(f*=e.COMPRESSION_FACTOR_FOR_U16,r|=e.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR),f=Math.round(f);let h=p;h<=0&&(h=u-P),h<e.MAX_SIZE_FOR_U16_COMPRESSION&&(h*=e.COMPRESSION_FACTOR_FOR_U16,r|=e.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR),h=Math.round(h);const d=t.pt2px(_.offsetX||0),U=t.pt2px(-_.offsetY||0);return new S(A,l,n,I.i1616to32(P,s),I.i1616to32(u,L),h,f,d,U,e.COMPRESSION_FACTOR_FOR_U16,e.COMPRESSION_FACTOR_FOR_U16,R.degToByte(_.angle),r,_.effects,o,C)},S.fromSimpleFill=function(_,t,R=!1){const{color:l}=_,E=l&&"esriSFSNull"!==_.style&&O.premultiplyAlphaRGBAArray(l)||0;let i=R?e.BITSET_GENERIC_LOCK_COLOR:0;const n=_.materialKey;let A;if(t){const{rect:_,width:O,height:R,pixelRatio:l}=t,o=_.x+e.SPRITE_PADDING,C=_.y+e.SPRITE_PADDING,r=o+O,F=C+R,M=I.i1616to32(o,C),a=I.i1616to32(r,F);let N=O/l;N<e.MAX_SIZE_FOR_U16_COMPRESSION&&(N*=e.COMPRESSION_FACTOR_FOR_U16,i|=e.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR),N=Math.round(N);let P=R/l;P<e.MAX_SIZE_FOR_U16_COMPRESSION&&(P*=e.COMPRESSION_FACTOR_FOR_U16,i|=e.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR),P=Math.round(P),A=new S(n,t,E,M,a,N,P,0,0,e.COMPRESSION_FACTOR_FOR_U16,e.COMPRESSION_FACTOR_FOR_U16,0,i,null,T.DEFAULT_MIN_ZOOM,T.DEFAULT_MAX_ZOOM)}else A=new S(n,null,E,0,0,0,0,0,0,0,0,0,i,null,T.DEFAULT_MIN_ZOOM,T.DEFAULT_MAX_ZOOM);return A._maybeAddLineTemplate(_),A},S.fromPictureFill=function(_,O,R=!1){const l=e.PICTURE_FILL_COLOR,{rect:E,width:i,height:n}=O,A=E.x+e.SPRITE_PADDING,o=E.y+e.SPRITE_PADDING,C=A+i,r=o+n,F=I.i1616to32(A,o),M=I.i1616to32(C,r);let a=R?e.BITSET_GENERIC_LOCK_COLOR:0,N=t.pt2px(_.width);N<e.MAX_SIZE_FOR_U16_COMPRESSION&&(N*=e.COMPRESSION_FACTOR_FOR_U16,a|=e.BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR),N=Math.round(N);let P=t.pt2px(_.height);P<e.MAX_SIZE_FOR_U16_COMPRESSION&&(P*=e.COMPRESSION_FACTOR_FOR_U16,a|=e.BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR),P=Math.round(P);const s=t.pt2px(_.xoffset),u=t.pt2px(-_.yoffset),L=new S(_.materialKey,O,l,F,M,N,P,s,u,e.COMPRESSION_FACTOR_FOR_U16*_.xscale,e.COMPRESSION_FACTOR_FOR_U16*_.yscale,0,a,null,T.DEFAULT_MIN_ZOOM,T.DEFAULT_MAX_ZOOM);return L._maybeAddLineTemplate(_),L},_._createClass(S)}(E(S))}));
