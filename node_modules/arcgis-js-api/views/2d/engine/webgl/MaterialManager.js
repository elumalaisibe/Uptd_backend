/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","./enums","./shaders/MaterialPrograms"],(function(r,e,a){"use strict";const t=r=>r===e.WGLDrawPhase.HITTEST||r===e.WGLDrawPhase.LABEL_ALPHA,s=r=>(t(r)?1:0)|(r===e.WGLDrawPhase.HIGHLIGHT?2:0),o=({rendererInfo:r,drawPhase:e},a,t)=>`${a.getVariationHash()}-${s(e)}-${r.getVariationHash()}-${null!=t&&t.join(".")}`,i=(r,a,s,o={})=>{if(o={...o,...a.getVariation(),...r.rendererInfo.getVariation(),highlight:r.drawPhase===e.WGLDrawPhase.HIGHLIGHT,id:t(r.drawPhase)},null!=s)for(const e of s)o[e]=!0;return o};return function(){function e(r){this._rctx=r,this._programByKey=new Map}var t=e.prototype;return t.dispose=function(){this._programByKey.forEach((r=>r.dispose())),this._programByKey.clear()},t.getProgram=function(r,e=[]){const t=r.vsPath+"."+r.fsPath+JSON.stringify(e);if(this._programByKey.has(t))return this._programByKey.get(t);const s={...e.map((r=>"string"==typeof r?{name:r,value:!0}:r)).reduce(((r,e)=>({...r,[e.name]:e.value})),{})},{vsPath:o,fsPath:i,attributes:n}=r,h=a.createProgramTemplate(o,i,n,s),g=this._rctx.programCache.acquire(h.shaders.vertexShader,h.shaders.fragmentShader,h.attributes);if(!g)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(t,g),g},t.getMaterialProgram=function(r,e,t,s,n){const h=o(r,e,n);if(this._programByKey.has(h))return this._programByKey.get(h);const g=i(r,e,n,{ignoresSamplerPrecision:r.context.driverTest.ignoresSamplerPrecision.result}),c=a.createProgramTemplate(t,t,s,g),u=this._rctx.programCache.acquire(c.shaders.vertexShader,c.shaders.fragmentShader,c.attributes);if(!u)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(h,u),u},r._createClass(e)}()}));
