/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],(function(t,s,e,i){"use strict";const o=2,n=1,h=0,l=1,c=2;let r=function(){function t(t,s,e){this._debugMap=new Map,this._width=t*e,this._height=s*e,this._pixelRatio=e;const o=Math.ceil(this._width/n),h=Math.ceil(this._height/n);this._cols=o,this._rows=h,this._cells=i.StaticBitSet.create(o*h)}var r=t.prototype;return r.insertMetrics=function(t){const s=this._hasCollision(t);return s===h&&this._markMetrics(t),s},r.getCellId=function(t,s){return t+s*this._cols},r.has=function(t){return this._cells.has(t)},r.hasRange=function(t,s){return this._cells.hasRange(t,s)},r.set=function(t){this._cells.set(t)},r.setRange=function(t,s){this._cells.setRange(t,s)},r._collide=function(t,s,i,o){const r=t-i/2,a=s-o/2,u=r+i,_=a+o;if(u<0||_<0||r>this._width||a>this._height)return l;const d=e.clamp(Math.floor(r/n),0,this._cols),p=e.clamp(Math.floor(a/n),0,this._rows),f=e.clamp(Math.ceil(u/n),0,this._cols),m=e.clamp(Math.ceil(_/n),0,this._rows);for(let e=p;e<=m;e++)for(let t=d;t<=f;t++){const s=this.getCellId(t,e);if(this.has(s))return c}return h},r._mark=function(t,s,i,o,h){const l=t-i/2,c=s-o/2,r=l+i,a=c+o,u=e.clamp(Math.floor(l/n),0,this._cols),_=e.clamp(Math.floor(c/n),0,this._rows),d=e.clamp(Math.ceil(r/n),0,this._cols),p=e.clamp(Math.ceil(a/n),0,this._rows);for(let e=_;e<=p;e++)for(let t=u;t<=d;t++){const s=this.getCellId(t,e);this._debugMap.set(s,h),this.set(s)}return!1},r._hasCollision=function(t){const s=t.id;let e=0,i=0;t.save();do{const s=t.boundsCount;e+=s;for(let e=0;e<s;e++){const s=t.boundsComputedAnchorX(e),n=t.boundsComputedAnchorY(e),h=(t.boundsWidth(e)+o)*this._pixelRatio,r=(t.boundsHeight(e)+o)*this._pixelRatio;switch(this._collide(s,n,h,r)){case c:return c;case l:i++}}}while(t.peekId()===s&&t.next());return t.restore(),e===i?l:h},r._markMetrics=function(t){const s=t.id;t.save();do{const s=t.boundsCount;for(let e=0;e<s;e++){const s=t.boundsComputedAnchorX(e),i=t.boundsComputedAnchorY(e),n=(t.boundsWidth(e)+o)*this._pixelRatio,h=(t.boundsHeight(e)+o)*this._pixelRatio;this._mark(s,i,n,h,t.id)}}while(t.peekId()===s&&t.next());t.restore()},s._createClass(t)}();t.CollisionBitsetGrid=r,t.HAS_COLLISION=c,t.NONE=h,t.OUTSIDE_EXTENT=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
