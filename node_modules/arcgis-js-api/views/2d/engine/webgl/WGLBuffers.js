/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","./Utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],(function(e,t,r,n,f){"use strict";return function(){function a(e){this.geometryMap=t.createGeometryData((()=>({indexBuffer:r.BufferObject.createIndex(e,n.Usage.STATIC_DRAW),vao:null})),((n,f)=>({vertexBuffer:r.BufferObject.createVertex(e,t.C_VBO_INFO[f])})))}var i=a.prototype;return i.dispose=function(){for(let e=0;e<5;e++){const t=this.geometryMap[e];if(t){t.data.vao?.disposeVAOOnly(),t.data.indexBuffer?.dispose();for(const e in t.buffers)t.buffers[e]?.data.vertexBuffer.dispose()}}},i.get=function(e){const t=this.geometryMap[e];return{getVAO(e,r,n){if(!t.data.vao){const a={};for(const e in t.buffers)a[e]=t.buffers[e].data.vertexBuffer;t.data.vao=new f.VertexArrayObject(e,n,r,a,t.data.indexBuffer)}return t.data.vao}}},i.has=function(e){return null!=this.geometryMap[e]},i.upload=function(e,t){t.forEach(((t,r)=>{this._upload(t,r,e)}))},i._upload=function(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){const n=e.vertices;for(const e in n){const f=n[e];f.allDirty?this._uploadVertices(r,t,e):null!=f.from&&null!=f.count&&this._uploadVertices(r,t,e,f.from,f.count)}}},i._uploadVertices=function(e,t,r,n,f){const a=this.geometryMap[t];if(!a)return;const i=e.geometries[t].vertexBuffer[r];if(!i)return;const{data:s,stride:u}=i;if(a.buffers[r]&&s.length>0){const e=u/s.BYTES_PER_ELEMENT;null!=n&&null!=f?a.buffers[r].data.vertexBuffer.setSubData(s,n*e,n*e,(n+f)*e):a.buffers[r].data.vertexBuffer.setData(s)}},i._uploadIndices=function(e,t,r,n){const f=this.geometryMap[t];if(!f)return;const a=e.geometries[t].indexBuffer;f.data.indexBuffer&&a.length>0&&(null!=r&&null!=n?f.data.indexBuffer.setSubData(a,r,r,r+n):f.data.indexBuffer.setData(a))},e._createClass(a)}()}));
