/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Error","../../../../core/Logger","../../../../chunks/earcut","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../layers/graphics/featureConversionUtils","../../../../layers/graphics/OptimizedGeometry","./number","../../../webgl/BufferObject","../../../webgl/enums"],(function(e,t,r,n,i,o,c,s,a,f,u){"use strict";const h=e=>{switch(e.BYTES_PER_ELEMENT){case 1:return u.DataType.UNSIGNED_BYTE;case 2:return u.DataType.UNSIGNED_SHORT;case 4:return u.DataType.UNSIGNED_INT;default:throw new t("Cannot get DataType of array")}},y=(e,t,r,n)=>{let i=0;for(let o=1;o<r;o++){const r=e[2*(t+o-1)],n=e[2*(t+o-1)+1];i+=(e[2*(t+o)]-r)*(e[2*(t+o)+1]+n)}return n?i>0:i<0},m=({coords:e,lengths:t},r)=>{const i=[];for(let o=0,c=0;o<t.length;c+=t[o],o+=1){const s=c,a=[];for(;o<t.length-1&&y(e,c+t[o],t[o+1],r);o+=1,c+=t[o])a.push(c+t[o]-s);const f=e.slice(2*s,2*(c+t[o])),u=n.earcut(f,a,2);for(const e of u)i.push(e+s)}return i};return function(){function n(e,t,r,n=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=n}n.fromRect=function({x:e,y:t,width:r,height:i}){const o=e,c=t,s=o+r,a=c+i;return n.fromScreenExtent({xmin:o,ymin:c,xmax:s,ymax:a})},n.fromPath=function(e){const t=c.convertFromNestedArray(new s,e.path,!1,!1),r=t.coords,i=new Uint32Array(m(t,!0)),o=new Uint32Array(r.length/2);for(let n=0;n<o.length;n++)o[n]=a.i1616to32(Math.floor(r[2*n]),Math.floor(r[2*n+1]));return new n({geometry:o},i,u.PrimitiveType.TRIANGLES)},n.fromGeometry=function(e,i){const o=i.geometry?.type;switch(o){case"polygon":return n.fromPolygon(e,i.geometry);case"extent":return n.fromMapExtent(e,i.geometry);default:return r.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new t("mapview-bad-type",`Unable to create a mesh from type ${o}`,i)),n.fromRect({x:0,y:0,width:1,height:1})}},n.fromPolygon=function(e,t){const r=c.convertFromPolygon(new s,t,!1,!1),f=r.coords,h=new Uint32Array(m(r,!1)),y=new Uint32Array(f.length/2),l=o.create(),g=o.create();for(let n=0;n<y.length;n++)i.set(l,f[2*n],f[2*n+1]),e.toScreen(g,l),y[n]=a.i1616to32(Math.floor(g[0]),Math.floor(g[1]));return new n({geometry:y},h,u.PrimitiveType.TRIANGLES,!0)},n.fromScreenExtent=function({xmin:e,xmax:t,ymin:r,ymax:i}){return new n({geometry:new Uint32Array([a.i1616to32(e,r),a.i1616to32(t,r),a.i1616to32(e,i),a.i1616to32(e,i),a.i1616to32(t,r),a.i1616to32(t,i)])},new Uint32Array([0,1,2,3,4,5]),u.PrimitiveType.TRIANGLES)},n.fromMapExtent=function(e,t){const[r,i]=e.toScreen([0,0],[t.xmin,t.ymin]),[o,c]=e.toScreen([0,0],[t.xmax,t.ymax]);return new n({geometry:new Uint32Array([a.i1616to32(r,i),a.i1616to32(o,i),a.i1616to32(r,c),a.i1616to32(r,c),a.i1616to32(o,i),a.i1616to32(o,c)])},new Uint32Array([0,1,2,3,4,5]),u.PrimitiveType.TRIANGLES)};var y=n.prototype;return y.destroy=function(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)null!=this._cache.vertexBuffers[e]&&this._cache.vertexBuffers[e].dispose()},y.getIndexBuffer=function(e,t=u.Usage.STATIC_DRAW){return this._cache.indexBuffer||(this._cache.indexBuffer=f.BufferObject.createIndex(e,t,this.indices)),this._cache.indexBuffer},y.getVertexBuffers=function(e,t=u.Usage.STATIC_DRAW){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((r,n)=>({...r,[n]:f.BufferObject.createVertex(e,t,this.vertices[n])})),{})),this._cache.vertexBuffers},e._createClass(n,[{key:"elementType",get:function(){return h(this.indices)}}]),n}()}));
