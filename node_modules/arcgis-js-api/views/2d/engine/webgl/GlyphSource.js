/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../request","../../../../core/pbf"],(function(e,t,n){"use strict";let a=function(){function t(e){for(this._metrics=[],this._bitmaps=[];e.next();)switch(e.tag()){case 1:{const t=e.getMessage();for(;t.next();)switch(t.tag()){case 3:{const e=t.getMessage();let n,a,r,s,i,c,o;for(;e.next();)switch(e.tag()){case 1:n=e.getUInt32();break;case 2:a=e.getBytes();break;case 3:r=e.getUInt32();break;case 4:s=e.getUInt32();break;case 5:i=e.getSInt32();break;case 6:c=e.getSInt32();break;case 7:o=e.getUInt32();break;default:e.skip()}e.release(),n&&(this._metrics[n]={width:r,height:s,left:i,top:c,advance:o},this._bitmaps[n]=a);break}default:t.skip()}t.release();break}default:e.skip()}}var n=t.prototype;return n.getMetrics=function(e){return this._metrics[e]},n.getBitmap=function(e){return this._bitmaps[e]},e._createClass(t)}(),r=function(){function t(){this._ranges=[]}var n=t.prototype;return n.getRange=function(e){return this._ranges[e]},n.addRange=function(e,t){this._ranges[e]=t},e._createClass(t)}();return function(){function s(e){this._glyphInfo={},this._baseURL=e}var i=s.prototype;return i.getRange=function(e,r,s){const i=this._getFontStack(e);if(i.getRange(r))return Promise.resolve();const c=256*r,o=c+255,g=this._baseURL.replace("{fontstack}",e).replace("{range}",c+"-"+o);return t(g,{responseType:"array-buffer",...s}).then((e=>{i.addRange(r,new a(new n(new Uint8Array(e.data),new DataView(e.data))))}))},i.preloadASCIIRange=async function(e){const r=this._getFontStack(e),s=0,i=255,c=this._baseURL.replace("{fontstack}",e).replace("{range}",s+"-"+i),o=await t(c,{responseType:"array-buffer"}),g=new a(new n(new Uint8Array(o.data),new DataView(o.data)));for(let t=s;t<=i;t++)r.getRange(t)||r.addRange(t,g)},i.getGlyph=function(e,t){const n=this._getFontStack(e);if(!n)return;const a=Math.floor(t/256),r=n.getRange(a);return r?{metrics:r.getMetrics(t),bitmap:r.getBitmap(t)}:void 0},i._getFontStack=function(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new r),t},e._createClass(s)}()}));
