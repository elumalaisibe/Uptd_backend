/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../symbols/cim/enums","./definitions"],(function(t,e,i,n){"use strict";function r(t,e){return t.x===e.x&&t.y===e.y}function x(t){if(!t)return;const e=t.length;if(e<=1)return;let i=0;for(let n=1;n<e;n++)r(t[n],t[i])||++i===n||(t[i]=t[n]);t.length=i+1}function y(t,e){return t.x=e.y,t.y=-e.x,t}function s(t,e){return t.x=-e.y,t.y=e.x,t}function o(t,e){return t.x=e.x,t.y=e.y,t}function l(t,e){return t.x=-e.x,t.y=-e.y,t}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function a(t,e){return t.x*e.y-t.y*e.x}function _(t,e){return t.x*e.x+t.y*e.y}function c(t,e,i,n){return t.x=e.x*i+e.y*n,t.y=e.x*n-e.y*i,t}let u=function(){function t(t,e,i){this._writeVertex=t,this._writeTriangle=e,this._canUseThinTessellation=i,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}var u=t.prototype;return u.tessellate=function(t,e){x(t),this._canUseThinTessellation&&e.halfWidth<n.THIN_LINE_HALF_WIDTH_THRESHOLD&&!e.offset?this._tessellateThin(t,e):this._tessellate(t,e)},u._tessellateThin=function(t,e){if(t.length<2)return;const i=e.wrapDistance||65535;let n=e.initialDistance||0,r=!1,x=t[0].x,y=t[0].y;const s=t.length;for(let o=1;o<s;++o){r&&(r=!1,n=0);let e=t[o].x,s=t[o].y,l=e-x,h=s-y,a=Math.sqrt(l*l+h*h);if(l/=a,h/=a,n+a>i){r=!0;const t=(i-n)/a;a=i-n,e=(1-t)*x+t*e,s=(1-t)*y+t*s,--o}const _=this._writeVertex(x,y,0,0,l,h,h,-l,0,-1,n),c=this._writeVertex(x,y,0,0,l,h,-h,l,0,1,n);n+=a;const u=this._writeVertex(e,s,0,0,l,h,h,-l,0,-1,n),T=this._writeVertex(e,s,0,0,l,h,-h,l,0,1,n);this._writeTriangle(_,c,u),this._writeTriangle(c,u,T),x=e,y=s}},u._tessellate=function(t,e){const n=t[0],x=t[t.length-1],u=r(n,x),T=u?3:2;if(t.length<T)return;const d=e.pixelCoordRatio,f=null!=e.capType?e.capType:i.CapType.BUTT,v=null!=e.joinType?e.joinType:i.JoinType.MITER,p=null!=e.miterLimit?Math.min(e.miterLimit,4):2,w=null!=e.roundLimit?Math.min(e.roundLimit,1.05):1.05,g=null!=e.halfWidth?e.halfWidth:2,N=!!e.textured;let V,m,b,E=null;const R=this._prevNormal,k=this._nextNormal;let L=-1,M=-1;const U=this._joinNormal;let B,D;const C=this._textureNormalLeft,S=this._textureNormalRight,J=this._textureNormal;let I=-1,O=-1;const A=e.wrapDistance||65535;let P=e.initialDistance||0;const H=this._writeVertex,j=this._writeTriangle,W=(t,e,i,n,r,x)=>{const y=H(m,b,B,D,i,n,t,e,r,x,P);return I>=0&&O>=0&&y>=0&&j(I,O,y),I=O,O=y,y};u&&(V=t[t.length-2],k.x=x.x-V.x,k.y=x.y-V.y,M=h(k),k.x/=M,k.y/=M);let q=!1;for(let r=0;r<t.length;++r){if(q&&(q=!1,P=0),V&&(R.x=-k.x,R.y=-k.y,L=M,P+L>A&&(q=!0)),q){const e=(A-P)/L;L=A-P,V={x:(1-e)*V.x+e*t[r].x,y:(1-e)*V.y+e*t[r].y},--r}else V=t[r];m=V.x,b=V.y;const e=r<=0&&!q,n=r===t.length-1;if(e||(P+=L),E=n?u?t[1]:null:t[r+1],E?(k.x=E.x-m,k.y=E.y-b,M=h(k),k.x/=M,k.y/=M):(k.x=void 0,k.y=void 0),!u){if(e){s(U,k),B=U.x,D=U.y,f===i.CapType.SQUARE&&(W(-k.y-k.x,k.x-k.y,k.x,k.y,0,-1),W(k.y-k.x,-k.x-k.y,k.x,k.y,0,1)),f===i.CapType.ROUND&&(W(-k.y-k.x,k.x-k.y,k.x,k.y,-1,-1),W(k.y-k.x,-k.x-k.y,k.x,k.y,-1,1)),f!==i.CapType.ROUND&&f!==i.CapType.BUTT||(W(-k.y,k.x,k.x,k.y,0,-1),W(k.y,-k.x,k.x,k.y,0,1));continue}if(n){y(U,R),B=U.x,D=U.y,f!==i.CapType.ROUND&&f!==i.CapType.BUTT||(W(R.y,-R.x,-R.x,-R.y,0,-1),W(-R.y,R.x,-R.x,-R.y,0,1)),f===i.CapType.SQUARE&&(W(R.y-R.x,-R.x-R.y,-R.x,-R.y,0,-1),W(-R.y-R.x,R.x-R.y,-R.x,-R.y,0,1)),f===i.CapType.ROUND&&(W(R.y-R.x,-R.x-R.y,-R.x,-R.y,1,-1),W(-R.y-R.x,R.x-R.y,-R.x,-R.y,1,1));continue}}let x,T,H=-a(R,k);if(Math.abs(H)<.01)_(R,k)>0?(U.x=R.x,U.y=R.y,H=1,x=Number.MAX_VALUE,T=!0):(s(U,k),H=1,x=1,T=!1);else{U.x=(R.x+k.x)/H,U.y=(R.y+k.y)/H,x=h(U);const t=(x-1)*g*d;T=x>4||t>L&&t>M}B=U.x,D=U.y;let j=v;switch(v){case i.JoinType.BEVEL:x<1.05&&(j=i.JoinType.MITER);break;case i.JoinType.ROUND:x<w&&(j=i.JoinType.MITER);break;case i.JoinType.MITER:x>p&&(j=i.JoinType.BEVEL)}switch(j){case i.JoinType.MITER:if(W(U.x,U.y,-R.x,-R.y,0,-1),W(-U.x,-U.y,-R.x,-R.y,0,1),n)break;if(N){const t=q?0:P;I=this._writeVertex(m,b,B,D,k.x,k.y,U.x,U.y,0,-1,t),O=this._writeVertex(m,b,B,D,k.x,k.y,-U.x,-U.y,0,1,t)}break;case i.JoinType.BEVEL:{const t=H<0;let e,i,r,x;if(t){const t=I;I=O,O=t,e=C,i=S}else e=S,i=C;if(T)r=t?s(this._innerPrev,R):y(this._innerPrev,R),x=t?y(this._innerNext,k):s(this._innerNext,k);else{const e=t?l(this._inner,U):o(this._inner,U);r=e,x=e}const h=t?y(this._bevelStart,R):s(this._bevelStart,R);W(r.x,r.y,-R.x,-R.y,e.x,e.y);const a=W(h.x,h.y,-R.x,-R.y,i.x,i.y);if(n)break;const _=t?s(this._bevelEnd,k):y(this._bevelEnd,k);if(T){const t=this._writeVertex(m,b,B,D,-R.x,-R.y,0,0,0,0,P);I=this._writeVertex(m,b,B,D,k.x,k.y,x.x,x.y,e.x,e.y,P),O=this._writeVertex(m,b,B,D,k.x,k.y,_.x,_.y,i.x,i.y,P),this._writeTriangle(a,t,O)}else{if(N){const t=this._bevelMiddle;t.x=(h.x+_.x)/2,t.y=(h.y+_.y)/2,c(J,t,-R.x,-R.y),W(t.x,t.y,-R.x,-R.y,J.x,J.y),c(J,t,k.x,k.y),I=this._writeVertex(m,b,B,D,k.x,k.y,t.x,t.y,J.x,J.y,P),O=this._writeVertex(m,b,B,D,k.x,k.y,x.x,x.y,e.x,e.y,P)}else{const t=I;I=O,O=t}W(_.x,_.y,k.x,k.y,i.x,i.y)}if(t){const t=I;I=O,O=t}break}case i.JoinType.ROUND:{const t=H<0;let e,i;if(t){const t=I;I=O,O=t,e=C,i=S}else e=S,i=C;const r=t?l(this._inner,U):o(this._inner,U);let h,a;T?(h=t?s(this._innerPrev,R):y(this._innerPrev,R),a=t?y(this._innerNext,k):s(this._innerNext,k)):(h=r,a=r);const u=t?y(this._roundStart,R):s(this._roundStart,R),d=t?s(this._roundEnd,k):y(this._roundEnd,k),f=W(h.x,h.y,-R.x,-R.y,e.x,e.y),v=W(u.x,u.y,-R.x,-R.y,i.x,i.y);if(n)break;const p=this._writeVertex(m,b,B,D,-R.x,-R.y,0,0,0,0,P);T||this._writeTriangle(I,O,p);const w=l(this._outer,r),g=this._writeVertex(m,b,B,D,k.x,k.y,d.x,d.y,i.x,i.y,P);let V,E;const L=x>2;if(L){let e;x!==Number.MAX_VALUE?(w.x/=x,w.y/=x,e=_(R,w),e=(x*(e*e-1)+1)/e):e=-1,V=t?y(this._startBreak,R):s(this._startBreak,R),V.x+=R.x*e,V.y+=R.y*e,E=t?s(this._endBreak,k):y(this._endBreak,k),E.x+=k.x*e,E.y+=k.y*e}c(J,w,-R.x,-R.y);const M=this._writeVertex(m,b,B,D,-R.x,-R.y,w.x,w.y,J.x,J.y,P);c(J,w,k.x,k.y);const A=N?this._writeVertex(m,b,B,D,k.x,k.y,w.x,w.y,J.x,J.y,P):M,j=p,q=N?this._writeVertex(m,b,B,D,k.x,k.y,0,0,0,0,P):p;let Q=-1,X=-1;if(L&&(c(J,V,-R.x,-R.y),Q=this._writeVertex(m,b,B,D,-R.x,-R.y,V.x,V.y,J.x,J.y,P),c(J,E,k.x,k.y),X=this._writeVertex(m,b,B,D,k.x,k.y,E.x,E.y,J.x,J.y,P)),N?L?(this._writeTriangle(j,v,Q),this._writeTriangle(j,Q,M),this._writeTriangle(q,A,X),this._writeTriangle(q,X,g)):(this._writeTriangle(j,v,M),this._writeTriangle(q,A,g)):L?(this._writeTriangle(p,v,Q),this._writeTriangle(p,Q,X),this._writeTriangle(p,X,g)):(this._writeTriangle(p,v,M),this._writeTriangle(p,A,g)),T?(I=this._writeVertex(m,b,B,D,k.x,k.y,a.x,a.y,e.x,e.y,P),O=g):(I=N?this._writeVertex(m,b,B,D,k.x,k.y,a.x,a.y,e.x,e.y,P):f,this._writeTriangle(I,q,g),O=g),t){const t=I;I=O,O=t}break}}}},e._createClass(t)}();t.LineTessellation=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
