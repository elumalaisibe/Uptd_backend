/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/CircularArray","../../../../core/Evented","../../../../core/has","../../../webgl/capabilities/DisjointTimerQuery"],(function(e,t,n,s,r,i){"use strict";const o=r("esri-2d-profiler");let a=function(){function e(e,t){if(this._events=new s,this._entries=new Map,this._timings=new n(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!o)return;this._ext=i.createDisjointTimerQuery(e.gl,{}),this._debugOutput=t;const r=e.gl;if(!this.enableCommandLogging)return;let a;for(a in r)if("function"==typeof r[a]){const e=r[a],t=a.includes("draw");r[a]=(...n)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:a,args:n,isDrawCommand:t}),this._currentSummary&&(this._currentSummary.commands++,t&&this._currentSummary.drawCommands++),e.apply(r,n))}}var r=e.prototype;return r.recordContainerStart=function(e){o&&(this._currentContainer=e)},r.recordContainerEnd=function(){o&&(this._currentContainer=null)},r.recordPassStart=function(e){o&&(this._currentPass=e,this._initSummary())},r.recordPassEnd=function(){o&&(this._currentPass=null,this._emitSummary())},r.recordBrushStart=function(e){o&&(this._currentBrush=e)},r.recordBrushEnd=function(){o&&(this._currentBrush=null)},r.recordStart=function(e){if(o&&null!=this._ext){if(this._entries.has(e)){const t=this._entries.get(e),n=this._ext.resultAvailable(t.query),s=this._ext.disjoint();if(n&&!s){const n=this._ext.getResult(t.query)/1e6;let s=0;if(null!=this._timings.enqueue(n)){const e=this._timings.entries,t=e.length;let n=0;for(const s of e)n+=s;s=n/t}const r=n.toFixed(2),i=s?s.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${e}, ${r} ms (${i} last 10 avg)\n${t.commandsLen} Commands (${t.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(t.summaries),console.log("Commands: ",t.commands),console.groupEnd()):console.log(`Frame report for ${e}, ${r} ms (${i} last 10 avg)`),this._debugOutput.innerHTML=`${r} (${i})`}for(const e of t.handles)e.remove();this._ext.deleteQuery(t.query),this._entries.delete(e)}const t={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(t.handles.push(this._events.on("command",(e=>{t.commandsLen++,t.commands.push(e),e.isDrawCommand&&t.drawCommands++}))),t.handles.push(this._events.on("summary",(e=>{t.summaries.push(e)})))),this._ext.beginTimeElapsed(t.query),this._entries.set(e,t)}},r.recordEnd=function(e){o&&null!=this._ext&&this._entries.has(e)&&this._ext.endTimeElapsed()},r._initSummary=function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})},r._emitSummary=function(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)},t._createClass(e,[{key:"enableCommandLogging",get:function(){return!("object"==typeof o&&o.disableCommands)}}]),e}();e.Profiler=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
