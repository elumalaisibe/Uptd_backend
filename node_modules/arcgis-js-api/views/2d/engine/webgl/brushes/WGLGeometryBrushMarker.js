/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../techniques/utils","../../../../webgl/enums"],(function(t,e,a,n,o,r,i){"use strict";const s={shader:"materials/icon",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:i.DataType.SHORT},{location:1,name:"a_vertexOffset",count:2,type:i.DataType.SHORT},{location:2,name:"a_texCoords",count:2,type:i.DataType.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:i.DataType.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:i.DataType.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:i.DataType.UNSIGNED_BYTE,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:i.DataType.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:i.DataType.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:i.DataType.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};let l=function(n){function l(){return n.apply(this,arguments)||this}t._inherits(l,n);var y=l.prototype;return y.dispose=function(){},y.getGeometryType=function(){return e.WGLGeometryType.MARKER},y.supportsSymbology=function(t){return t!==e.WGLSymbologyType.HEATMAP&&t!==e.WGLSymbologyType.PIE_CHART},y.drawGeometry=function(t,e,n,l){const{context:y,painter:u,rendererInfo:p,state:c,passOptions:m,requestRender:d,allowDelayedRender:T}=t,_=o.MarkerMaterialKey.load(n.materialKey),f=r.getTechniqueFromMaterialKey(_.data),S=null!=m&&"hittest"===m.type,{shader:D,vertexLayout:E,hittestAttributes:g}=f.programSpec??s;let h=i.PrimitiveType.TRIANGLES,N=a.createProgramDescriptor(_.data,E);S&&(N=this._getTriangleDesc(n.materialKey,N,g),h=i.PrimitiveType.POINTS);const{attributes:G,bufferLayouts:M}=N,R=u.materialManager.getMaterialProgram(t,_,D,G,l);if(T&&null!=d&&!R.compiled)return void d();y.useProgram(R),_.textureBinding&&u.textureManager.bindTextures(y,R,_,!0),this._setSharedUniforms(R,t,e);const U=_.vvRotation?c.displayViewMat3:c.displayMat3;R.setUniformMatrix3fv("u_displayMat3",U),this._setSizeVVUniforms(_,R,p,e),this._setColorAndOpacityVVUniforms(_,R,p),this._setRotationVVUniforms(_,R,p);const x=n.target.getVAO(y,M,G,S);let A=n.indexCount,O=n.indexFrom*Uint32Array.BYTES_PER_ELEMENT;S&&(A/=3,O/=3),y.bindVAO(x),this._drawMarkers(t,e,R,h,A,O,S),y.bindVAO(null)},y._drawMarkers=function(t,e,a,n,o,r,s){t.context.drawElements(n,o,i.DataType.UNSIGNED_INT,r)},t._createClass(l)}(n);return l}));
