/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../vectorTiles/style/StyleDefinition","../enums","../number","./WGLBrush","../../../../webgl/enums"],(function(e,t,n,r,i,a,l){"use strict";let o=function(e){function a(){var t;return(t=e.apply(this,arguments)||this)._programOptions={id:!1},t}t._inherits(a,e);var o=a.prototype;return o.dispose=function(){},o.drawMany=function(e,t){const{context:a,displayLevel:o,requiredLevel:s,state:c,drawPhase:u,painter:d,spriteMosaic:f,styleLayerUID:p,requestRender:y,allowDelayedRender:m}=e;if(!t.some((e=>e.layerData.get(p)?.circleIndexCount??!1)))return;const v=e.styleLayer,g=v.circleMaterial,T=d.vectorTilesMaterialManager,h=1.2,M=v.getPaintValue("circle-translate",o),_=v.getPaintValue("circle-translate-anchor",o),E=u===r.WGLDrawPhase.HITTEST,I=this._programOptions;I.id=E;const L=T.getMaterialProgram(a,g,I);if(m&&null!=y&&!L.compiled)return void y();a.useProgram(L),L.setUniformMatrix3fv("u_displayMat3",_===n.TranslateAnchor.VIEWPORT?c.displayMat3:c.displayViewMat3),L.setUniform2fv("u_circleTranslation",M),L.setUniform1f("u_depth",v.z),L.setUniform1f("u_antialiasingWidth",h);let P=-1;if(E){const e=i.u32to4Xu8(p+1);L.setUniform4fv("u_id",e)}for(const n of t){if(!n.layerData.has(p))continue;n.key.level!==P&&(P=n.key.level,g.setDataUniforms(L,o,v,P,f));const e=n.layerData.get(p);if(!e.circleIndexCount)continue;e.prepareForRendering(a);const t=e.vao;null!=t&&(a.bindVAO(t),L.setUniformMatrix3fv("u_dvsMat3",n.transforms.dvs),s!==n.key.level?a.setStencilFunction(l.CompareFunction.EQUAL,n.stencilRef,255):a.setStencilFunction(l.CompareFunction.GREATER,255,255),a.drawElements(l.PrimitiveType.TRIANGLES,e.circleIndexCount,l.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),n.triangleCount+=e.circleIndexCount/3)}},t._createClass(a)}(a);e.WGLBrushVTLCircle=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
