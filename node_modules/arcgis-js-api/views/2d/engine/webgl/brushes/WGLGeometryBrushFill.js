/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../definitions","../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../techniques/utils","../../../../webgl/enums"],(function(e,t,a,o,n,r,i,s){"use strict";function l(e){const t={geometry:[{location:0,name:"a_pos",count:2,type:s.DataType.SHORT},{location:1,name:"a_id",count:3,type:s.DataType.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:s.DataType.UNSIGNED_BYTE},{location:3,name:"a_color",count:4,type:s.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_aux1",count:4,type:s.DataType.UNSIGNED_SHORT},{location:5,name:"a_aux2",count:4,type:s.DataType.SHORT},{location:6,name:"a_aux3",count:4,type:s.DataType.UNSIGNED_BYTE},{location:7,name:"a_zoomRange",count:2,type:s.DataType.UNSIGNED_SHORT}]};switch(e.symbologyType){case a.WGLSymbologyType.SIMPLE:case a.WGLSymbologyType.OUTLINE_FILL_SIMPLE:t.geometry.splice(7,1),t.geometry.splice(4,1)}return{shader:"materials/fill",vertexLayout:t}}let u=function(n){function u(){return n.apply(this,arguments)||this}e._inherits(u,n);var y=u.prototype;return y.dispose=function(){},y.getGeometryType=function(){return a.WGLGeometryType.FILL},y.supportsSymbology=function(e){return e!==a.WGLSymbologyType.DOT_DENSITY},y.drawGeometry=function(e,a,n,u){const{context:y,painter:c,rendererInfo:m,requiredLevel:p,passOptions:T,requestRender:_,allowDelayedRender:E}=e,f=r.FillMaterialKey.load(n.materialKey),S=i.getTechniqueFromMaterialKey(f.data),N=null!=T&&"hittest"===T.type,d=c.materialManager,{shader:g,vertexLayout:I,hittestAttributes:L}=S.programSpec??l(f);let D=s.PrimitiveType.TRIANGLES,h=o.createProgramDescriptor(f.data,I);N&&(h=this._getTriangleDesc(n.materialKey,h,L),D=s.PrimitiveType.POINTS);const{attributes:R,bufferLayouts:U}=h,G=d.getMaterialProgram(e,f,g,R,u);if(E&&null!=_&&!G.compiled)return void _();y.useProgram(G),this._setSharedUniforms(G,e,a);const{row:M,col:b}=a.key,x=b*t.TILE_SIZE,A=M*t.TILE_SIZE;if(G.setUniform2f("u_tileOffset",x%t.MAX_REPRESENTABLE_INT,A%t.MAX_REPRESENTABLE_INT),G.setUniform2f("u_maxIntNumOfCrossing",Math.floor(x/t.MAX_REPRESENTABLE_INT),Math.floor(A/t.MAX_REPRESENTABLE_INT)),f.textureBinding){c.textureManager.bindTextures(y,G,f);const e=1/2**(p-a.key.level);G.setUniform1f("u_zoomFactor",e)}const P=1/e.pixelRatio;G.setUniform1f("u_blur",P),G.setUniform1f("u_antialiasing",P),this._setSizeVVUniforms(f,G,m,a),this._setColorAndOpacityVVUniforms(f,G,m);const O=n.target.getVAO(y,U,R,N);let B=n.indexCount,v=n.indexFrom*Uint32Array.BYTES_PER_ELEMENT;N&&(B/=3,v/=3),y.bindVAO(O),this._drawFills(e,a,G,D,B,v)},y._drawFills=function(e,t,a,o,n,r){e.context.drawElements(o,n,s.DataType.UNSIGNED_INT,r)},e._createClass(u)}(n);return u}));
