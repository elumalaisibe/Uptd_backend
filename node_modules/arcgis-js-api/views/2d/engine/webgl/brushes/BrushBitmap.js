/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../definitions","../VertexStream","./WGLBrush","../../../../webgl/enums"],(function(e,t,n,i,a){"use strict";const r={nearest:{defines:[],samplingMode:a.TextureSamplingMode.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:a.TextureSamplingMode.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:a.TextureSamplingMode.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:a.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,mips:!0}},s=(e,t,n)=>{if("dynamic"===n.samplingMode){const{state:n}=e,i=t.resolution/t.pixelRatio/n.resolution,a=Math.round(e.pixelRatio)!==e.pixelRatio,s=i>1.05||i<.95;return n.rotation||s||a||t.isSourceScaled||t.rotation?r.bilinear:r.nearest}return r[n.samplingMode]};let o=function(i){function r(){var e;return(e=i.apply(this,arguments)||this)._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])},e}e._inherits(r,i);var o=r.prototype;return o.dispose=function(){this._quad&&this._quad.dispose()},o.prepareState=function({context:e}){e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0)},o.draw=function(e,i){const{context:r,renderingOptions:o,painter:d,requestRender:l,allowDelayedRender:c}=e;if(!i.source||!i.isReady)return;const u=s(e,i,o),p=d.materialManager.getProgram(this._desc,u.defines);if(c&&null!=l&&!p.compiled)return void l();e.timeline.begin(this.name),"additive"===i.blendFunction?r.setBlendFunctionSeparate(a.BlendFactor.ONE,a.BlendFactor.ONE,a.BlendFactor.ONE,a.BlendFactor.ONE):r.setBlendFunctionSeparate(a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA,a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA),r.setStencilFunction(a.CompareFunction.EQUAL,i.stencilRef,255),this._quad||(this._quad=new n(r,[0,0,1,0,0,1,1,1]));const{coordScale:m,computedOpacity:f,transforms:_}=i;i.setSamplingProfile(u),i.bind(e.context,t.TEXTURE_BINDING_BITMAP),r.useProgram(p),p.setUniformMatrix3fv("u_dvsMat3",_.dvs),p.setUniform1i("u_texture",t.TEXTURE_BINDING_BITMAP),p.setUniform2fv("u_coordScale",m),p.setUniform1f("u_opacity",f),this._quad.draw(),e.timeline.end(this.name)},e._createClass(r)}(i);return o}));
