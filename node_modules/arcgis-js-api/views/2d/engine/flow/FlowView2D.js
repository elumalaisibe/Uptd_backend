/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../Graphic","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","./createFlowStyle","./dataUtils","./FlowContainer","./FlowStrategy"],(function(t,e,r,o,a,i,n,s,c,l,p,d,y,u){"use strict";let h=function(e){function o(){var t;return(t=e.apply(this,arguments)||this)._loadImagery=(e,r,o,a,i)=>d.loadImagery(t.layer,e,r,o,a,i),t._createFlowMesh=(e,r,o,a)=>t.layer.createFlowMesh({meshType:e,flowData:o,simulationSettings:r},{signal:a}),t.attached=!1,t.type="flow",t.timeExtent=null,t.redrawOrRefetch=async()=>{t._updateVisualization()},t}t._inherits(o,e);var i=o.prototype;return i.attach=function(){const{layer:t}=this,e=()=>{this._loadImagery=(e,r,o,a,i)=>d.loadImagery(t,e,r,o,a,i),this._updateVisualization()};"multidimensionalDefinition"in t?this.addHandles(a.watch((()=>t.multidimensionalDefinition),e)):this.addHandles([a.watch((()=>t.mosaicRule),e),a.watch((()=>t.rasterFunction),e),a.watch((()=>t.definitionExpression),e)]),this.container=new y,this._strategy=new u({flowContainer:this.container}),this._updateVisualization()},i.detach=function(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()},i.update=function(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()},i.hitTest=function(t){return new r({attributes:{},geometry:t.clone(),layer:this.layer})},i.moveEnd=function(){},i.doRefresh=async function(){},i._updateVisualization=function(){const t=this.layer.renderer;if(null==t||"flow"!==t.type)return;const e=p(t,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=e,this.layerView.requestUpdate()},t._createClass(o,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}}]),o}(o);e.__decorate([i.property()],h.prototype,"_strategy",void 0),e.__decorate([i.property()],h.prototype,"attached",void 0),e.__decorate([i.property()],h.prototype,"container",void 0),e.__decorate([i.property()],h.prototype,"layer",void 0),e.__decorate([i.property()],h.prototype,"layerView",void 0),e.__decorate([i.property()],h.prototype,"type",void 0),e.__decorate([i.property()],h.prototype,"updating",null),e.__decorate([i.property()],h.prototype,"timeExtent",void 0),h=e.__decorate([l.subclass("esri.views.2d.engine.flow.FlowView2D")],h);return h}));
