/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../geometry","../../../../core/Accessor","../../../../core/Logger","../../../../core/mathUtils","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Point","./FlowDisplayData","./FlowDisplayObject","../../../../geometry/Extent"],(function(t,e,i,o,a,n,l,r,s,c,d,p,u,h,y,_){"use strict";const f=1.15;let g=function(e){function i(t){var i;return(i=e.call(this,t)||this)._flowDisplayObject=new y.FlowDisplayObject,i._loading=null,i}t._inherits(i,e);var o=i.prototype;return o.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)},o.destroy=function(){this._clear(),this.flowContainer.removeAllChildren()},o.update=function(t){const{flowStyle:e}=this.flowContainer;if(null==e)return void this._clear();const{extent:i,rotation:o,resolution:n,pixelRatio:r}=t.state,s=x(i,o);s.expand(f);const c=[Math.round((s.xmax-s.xmin)/n),Math.round((s.ymax-s.ymin)/n)],d=new h(e,s,c,r);if(null!=this._loading){if(this._loading.update(d))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(d)||(d.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(t=>{l.isAbortError(t)||(a.getLogger(this).error("A resource failed to load.",t),this._loading=null)})),this._loading=d)},o._clear=function(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)},t._createClass(i,[{key:"updating",get:function(){return null!=this._loading}}]),i}(o);e.__decorate([r.property()],g.prototype,"_loading",void 0),e.__decorate([r.property()],g.prototype,"flowContainer",void 0),e.__decorate([r.property()],g.prototype,"updating",null),g=e.__decorate([p.subclass("esri.views.2d.engine.flow.FlowStrategy")],g);function x(t,e){const i=new u({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),o=t.xmax-t.xmin,a=t.ymax-t.ymin,l=Math.abs(Math.cos(n.deg2rad(e))),r=Math.abs(Math.sin(n.deg2rad(e))),s=l*o+r*a,c=r*o+l*a,d=new _({xmin:i.x-s/2,ymin:i.y-c/2,xmax:i.x+s/2,ymax:i.y+c/2,spatialReference:t.spatialReference});return d.centerAt(i),d}return g}));
