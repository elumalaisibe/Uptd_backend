/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/aaBoundingRect","../../viewpointUtils","./BrushRasterBitmap","./RasterTile","../webgl/enums","../webgl/TileContainer"],(function(e,t,i,r,s,n,o,a){"use strict";let l=function(e){function a(){var t;return(t=e.apply(this,arguments)||this).isCustomTilingScheme=!1,t}t._inherits(a,e);var l=a.prototype;return l.createTile=function(e){const t=this._getTileBounds(e),[i,r]=this._tileInfoView.tileInfo.size,s=this._tileInfoView.getTileResolution(e.level);return new n.RasterTile(e,s,t[0],t[3],i,r)},l.prepareRenderPasses=function(e){const i=e.registerRenderPass({name:"imagery (tile)",brushes:[s],target:()=>this.children.map((e=>e.bitmap)),drawPhase:o.WGLDrawPhase.MAP});return[...t._get(t._getPrototypeOf(a.prototype),"prepareRenderPasses",this).call(this,e),i]},l.doRender=function(e){if(!this.visible||e.drawPhase!==o.WGLDrawPhase.MAP)return;const{rasterFunctionChain:i}=this;if(!i)return e.renderPass="raster-bitmap",void t._get(t._getPrototypeOf(a.prototype),"doRender",this).call(this,e);const[r,s]=this._tileInfoView.tileInfo.size;if(e.renderPass="raster",e.rasterFunction={name:"Reproject",parameters:{targetImageSize:[r,s],requireBilinear:i.hasSurfaceFunction},pixelType:"f32",id:0,isNoopProcess:!1},t._get(t._getPrototypeOf(a.prototype),"doRender",this).call(this,e),i?.functions.length){const{functions:r,hasBranches:s}=i;for(let i=0;i<r.length;i++){const n=r[i];"Constant"!==n.name&&"Identity"!==n.name&&(e.renderPass="raster",e.rasterFunction=n,e.hasBranches=s,t._get(t._getPrototypeOf(a.prototype),"doRender",this).call(this,e))}}e.rasterFunction=null,e.renderPass="bitmap",t._get(t._getPrototypeOf(a.prototype),"doRender",this).call(this,e)},l._getTileBounds=function(e){const t=this._tileInfoView.getTileBounds(i.create(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this._tileInfoView,s=r.getWorldWidth(i.spatialReference);if(s){const r=i.lodAt(e.level);if(!r)return t;const{resolution:n}=r,o=s/n%i.size[0],a=o?(i.size[0]-o)*n:0;t[0]-=a*e.world,t[2]-=a*e.world}}return t},t._createClass(a)}(a);e.RasterTileContainer=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
