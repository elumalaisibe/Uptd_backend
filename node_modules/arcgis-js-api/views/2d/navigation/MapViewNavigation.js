/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../Viewpoint","../../../core/Accessor","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../../geometry/Point","../viewpointUtils","./ZoomBox","./actions/Pan","./actions/Pinch","./actions/Rotate"],(function(t,n,i,o,e,s,a,r,c,h,p,u,l,m,_,v){"use strict";const d=10,w=1,y=new i({targetGeometry:new p}),g=[0,0],f=250;let T=function(n){function i(t){var i;return(i=n.call(this,t)||this)._endTimer=null,i._lastEventTimestamp=null,i.animationManager=null,i.interacting=!1,i}t._inherits(i,n);var o=i.prototype;return o.initialize=function(){this.pan=new m({navigation:this}),this.rotate=new v({navigation:this}),this.pinch=new _({navigation:this}),this.zoomBox=new l({view:this.view,navigation:this})},o.destroy=function(){this.pan=e.destroyMaybe(this.pan),this.rotate=e.destroyMaybe(this.rotate),this.pinch=e.destroyMaybe(this.pinch),this.zoomBox=e.destroyMaybe(this.zoomBox),this.animationManager=null},o.begin=function(){this._set("interacting",!0)},o.end=function(){this._lastEventTimestamp=performance.now(),this._startTimer(f)},o.zoom=async function(t,n=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(n):this.zoomOut(n);this.setViewpoint(n,t,0,[0,0])},o.zoomIn=async function(t){const n=this.view,i=n.constraints.snapToNextScale(n.scale);return this._zoomToScale(i,t)},o.zoomOut=async function(t){const n=this.view,i=n.constraints.snapToPreviousScale(n.scale);return this._zoomToScale(i,t)},o.setViewpoint=function(t,n,i,o){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,n,i,o),this.end()},o.setViewpointImmediate=function(t,n=0,i=[0,0],o=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,o,t,n,i)},o.continousRotateClockwise=function(){const t=this.get("view.viewpoint");this.animationManager?.animateContinous(t,(t=>{u.rotateBy(t,t,-w)}))},o.continousRotateCounterclockwise=function(){const t=this.get("view.viewpoint");this.animationManager?.animateContinous(t,(t=>{u.rotateBy(t,t,w)}))},o.resetRotation=function(){this.view.rotation=0},o.continousPanLeft=function(){this._continuousPan([-d,0])},o.continousPanRight=function(){this._continuousPan([d,0])},o.continousPanUp=function(){this._continuousPan([0,d])},o.continousPanDown=function(){this._continuousPan([0,-d])},o.stop=function(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))},o._continuousPan=function(t){const n=this.view.viewpoint;this.animationManager?.animateContinous(n,(n=>{u.translateBy(n,n,t),this.view.constraints.constrainByGeometry(n)}))},o._startTimer=function(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<f?this._endTimer=this._startTimer(t):this._set("interacting",!1)}),t)),this._endTimer},o._getDefaultAnchor=function(){const{size:t,padding:{left:n,right:i,top:o,bottom:e}}=this.view;return g[0]=.5*(t[0]-i+n),g[1]=.5*(t[1]-e+o),g},o._zoomToScale=async function(t,n=this._getDefaultAnchor()){const{view:i}=this,{constraints:o,scale:e,viewpoint:s,size:a,padding:r}=i,c=o.canZoomInTo(t),h=o.canZoomOutTo(t);if(!(t<e&&!c||t>e&&!h))return u.padAndScaleAndRotateBy(y,s,t/e,0,n,a,r),o.constrainByGeometry(y),i.goTo(y,{animate:!0})},o._scaleRotateTranslateViewpoint=function(t,n,i,o,e){const{view:s}=this,{size:a,padding:r,constraints:c,scale:h,viewpoint:p}=s,l=h*i,m=c.canZoomInTo(l),_=c.canZoomOutTo(l);return(i<1&&!m||i>1&&!_)&&(i=1),u.translateBy(p,p,e),u.padAndScaleAndRotateBy(t,p,i,o,n,a,r),c.constrainByGeometry(t)},t._createClass(i)}(o);n.__decorate([s.property()],T.prototype,"animationManager",void 0),n.__decorate([s.property({type:Boolean,readOnly:!0})],T.prototype,"interacting",void 0),n.__decorate([s.property()],T.prototype,"pan",void 0),n.__decorate([s.property()],T.prototype,"pinch",void 0),n.__decorate([s.property()],T.prototype,"rotate",void 0),n.__decorate([s.property()],T.prototype,"view",void 0),n.__decorate([s.property()],T.prototype,"zoomBox",void 0),T=n.__decorate([h.subclass("esri.views.2d.navigation.MapViewNavigation")],T);return T}));
