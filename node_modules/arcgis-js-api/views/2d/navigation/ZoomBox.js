/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/screenUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../input/InputManager"],(function(t,e,i,n,r,o,s,a,h,c){"use strict";const l="esri-zoom-box",u={container:`${l}__container`,overlay:`${l}__overlay`,background:`${l}__overlay-background`,box:`${l}__outline`},_={zoom:"Shift",counter:"Ctrl"};let d=function(e){function i(i){var n;return(n=e.call(this,i)||this)._container=null,n._overlay=null,n._backgroundShape=null,n._boxShape=null,n._box={x:0,y:0,width:0,height:0},n._rafId=null,n._handles=null,n._redraw=n._redraw.bind(t._assertThisInitialized(n)),n}t._inherits(i,e);var r=i.prototype;return r.destroy=function(){this.view=null},r._start=function(){this._createContainer(),this._createOverlay(),this.navigation.begin()},r._update=function(t,e,i,n){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=n,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))},r._end=function(t,e,i,r,o){const s=this.view,a=s.toMap(n.createScreenPoint(t+.5*i,e+.5*r));let h=Math.max(i/s.width,r/s.height);-1===o&&(h=1/h),this._destroyOverlay(),this.navigation.end(),s.goTo({center:a,scale:s.scale*h})},r._updateBox=function(t,e,i,n){const r=this._boxShape;r.setAttributeNS(null,"x",""+t),r.setAttributeNS(null,"y",""+e),r.setAttributeNS(null,"width",""+i),r.setAttributeNS(null,"height",""+n),r.setAttributeNS(null,"class",u.box)},r._updateBackground=function(t,e,i,n){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,n,this.view.width,this.view.height))},r._createContainer=function(){const t=document.createElement("div");t.className=u.container,this.view.root.appendChild(t),this._container=t},r._createOverlay=function(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",u.background);const n=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"class",u.overlay),r.appendChild(i),r.appendChild(n),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=n,this._overlay=r},r._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null},r._toSVGPath=function(t,e,i,n,r,o){const s=t+i,a=e+n;return"M 0 0 L "+r+" 0 L "+r+" "+o+" L 0 "+o+" ZM "+t+" "+e+" L "+t+" "+a+" L "+s+" "+a+" L "+s+" "+e+" Z"},r._handleDrag=function(t,e){const i=t.x,n=t.y,r=t.origin.x,o=t.origin.y;let s,a,h,c;switch(i>r?(s=r,h=i-r):(s=i,h=r-i),n>o?(a=o,c=n-o):(a=n,c=o-n),t.action){case"start":this._start();break;case"update":this._update(s,a,h,c);break;case"end":this._end(s,a,h,c,e)}t.stopPropagation()},r._redraw=function(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:i,height:n}=this._box;this._updateBox(t,e,i,n),this._updateBackground(t,e,i,n),this._rafId=requestAnimationFrame(this._redraw)},t._createClass(i,[{key:"view",set:function(t){this._handles&&this._handles.forEach((t=>{t.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[_.zoom],(t=>this._handleDrag(t,1)),c.ViewEventPriorities.INTERNAL),t.on("drag",[_.zoom,_.counter],(t=>this._handleDrag(t,-1)),c.ViewEventPriorities.INTERNAL))}}]),i}(i);e.__decorate([r.property()],d.prototype,"navigation",void 0),e.__decorate([r.property()],d.prototype,"view",null),d=e.__decorate([h.subclass("esri.views.2d.navigation.ZoomBox")],d);return d}));
