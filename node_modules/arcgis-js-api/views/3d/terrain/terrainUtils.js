/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../core/Collection","../../../geometry/support/spatialReferenceUtils","../../../layers/support/layerUtils","../../ViewingMode","../support/StreamDataLoader","./ITile","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical"],(function(e,n,t,r,i,o,l,a,u){"use strict";const s={[i.ViewingMode.Global]:u.terrainUtilsSpherical,[i.ViewingMode.Local]:a.terrainUtilsPlanar};function T(e,n){e||console.warn("Terrain: "+n)}function c(n){e.ENABLE_WATERPROOFNESS_TESTS=n,e.ENABLE_TERRAIN_INTERNAL_CHECKS=e.ENABLE_TERRAIN_INTERNAL_CHECKS||n}function f(n){e.ENABLE_TERRAIN_INTERNAL_CHECKS=n}function E(n,t){if(e.ENABLE_TERRAIN_INTERNAL_CHECKS&&!n){const e=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+e),new Error("Assertion failed"+(t?": "+t:""))}}function I(e){return S(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function N(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function S(e){return"imagery-tile-3d"===e?.type}function d(e){return"tile-3d"===e?.type}function g(e){return"vector-tile-3d"===e?.type}function h(e){return"wmts-3d"===e?.type}function x(e){return"elevation-3d"===e?.type}function b(e){return"group"===e?.type}function y(e){return e&&(d(e)||h(e)||S(e)||g(e))}function p(e){return e&&(d(e)||S(e)||g(e)||h(e))}function R(e){return p(e)||x(e)}function _(e){const n=e?.sourceLayerInfo?.data;return null!=n&&"type"in n&&"raster-tile"===n.type}function A(e){return O(e?.sourceLayerInfo)}function L(e){const n=e?.sourceLayerInfo?.data;return null!=n&&"type"in n&&"tile-texture"===n.type}function H(e){const n=e?.sourceLayerInfo?.data;return n instanceof HTMLImageElement||n instanceof o.ImageWithType||n instanceof HTMLCanvasElement||n instanceof ImageData}function O(e){return null!=e?.data&&"type"in e.data&&"vector-tile"===e.data.type}function W(e){return null!=e&&"release"in e&&e.release(),null}function m(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function C(e,n,t,r){return s[r].checkIfTileInfoSupportedForViewSR(e,t,n)}function w(e,n,t){let r=null,o=null;if("wmts"===e?.type){const i=U(e,n,t);r=i.tileInfo,o=i.fullExtent}else{o=N(e)?e.getCompatibleFullExtent(n):e.fullExtent;const l=t===i.ViewingMode.Local;if(N(e))r=e.getCompatibleTileInfo(n,o,l);else if("vector-tile"===e?.type){const t=l&&!V(n)||M.force512VTL,i=e.tileInfo.spatialReference.isGeographic;r=t?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,i?1:2)}else r=e.tileInfo}return null!=r&&null!=o&&null==C(r,o,n,t)?{tileInfo:r,fullExtent:o}:null}function U(e,t,i){const o=r.getTileMaxtrixSetFromActiveLayer(e);if(null!=o){if(!n.isCollection(o))return{tileInfo:o.tileInfo,fullExtent:o.fullExtent};{const e=o.find((e=>null==C(e.tileInfo,e.fullExtent,t,i)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function V(e){return e.isWGS84||e.isWebMercator||t.isCGCS2000(e)||!t.isEarth(e)}e.ENABLE_TERRAIN_INTERNAL_CHECKS=!1,e.ENABLE_WATERPROOFNESS_TESTS=!1;const M={force512VTL:!1};function v(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function F(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function k(e,n,t=X){return Math.abs(e-n)<t}function B(e){return e===l.NeighborIndex.NORTH_EAST?l.NeighborIndex.SOUTH_WEST:e===l.NeighborIndex.NORTH_WEST?l.NeighborIndex.SOUTH_EAST:e===l.NeighborIndex.SOUTH_WEST?l.NeighborIndex.NORTH_EAST:l.NeighborIndex.NORTH_WEST}function P(e){return e===l.NeighborIndex.NORTH?l.NeighborIndex.SOUTH:e===l.NeighborIndex.EAST?l.NeighborIndex.WEST:e===l.NeighborIndex.SOUTH?l.NeighborIndex.NORTH:l.NeighborIndex.EAST}function G(e){return e===l.NeighborIndex.NORTH_WEST||e===l.NeighborIndex.SOUTH_WEST}function K(e){return e===l.NeighborIndex.NORTH_WEST||e===l.NeighborIndex.NORTH_EAST}function D(e){return e===l.NeighborIndex.NORTH_WEST||e===l.NeighborIndex.WEST||e===l.NeighborIndex.SOUTH_WEST}function j(e){return e===l.NeighborIndex.NORTH_EAST||e===l.NeighborIndex.EAST||e===l.NeighborIndex.SOUTH_EAST}function q(e){return e===l.NeighborIndex.SOUTH_EAST||e===l.NeighborIndex.SOUTH||e===l.NeighborIndex.SOUTH_WEST}function z(e){return e===l.NeighborIndex.NORTH_EAST||e===l.NeighborIndex.NORTH||e===l.NeighborIndex.NORTH_WEST}const J=[l.NeighborIndex.NORTH,l.NeighborIndex.EAST,l.NeighborIndex.SOUTH,l.NeighborIndex.WEST],Q=[l.NeighborIndex.NORTH_EAST,l.NeighborIndex.SOUTH_EAST,l.NeighborIndex.SOUTH_WEST,l.NeighborIndex.NORTH_WEST],X=1e-5;e.almostEquals=k,e.checkIfTileInfoSupportedForView=C,e.enableTerrainInternalChecks=f,e.enableTerrainWaterproofnessChecks=c,e.eps=X,e.getLayerWithExtentRange=I,e.getTileInfoAndExtentFromWMTSLayer=U,e.getTiledLayerInfo=w,e.internalAssert=E,e.isBlendableLayerView=y,e.isEast=j,e.isElevationLayerView=x,e.isGroupLayerView=b,e.isImageryTileLayerView=S,e.isImageryTileRenderInfo=_,e.isMapTileLayerView=p,e.isNorth=z,e.isNorthCorner=K,e.isProjectableRasterLayer=N,e.isRasterTileRenderInfo=H,e.isSouth=q,e.isSurfaceLayerView=R,e.isTextureTileRenderInfo=L,e.isTileLayerView=d,e.isVectorTileLayerView=g,e.isVectorTilePerLayerInfo=O,e.isVectorTileRenderInfo=A,e.isWMTSLayerView=h,e.isWest=D,e.isWestCorner=G,e.lij2s=v,e.neighborCornerIndices=Q,e.neighborEdgeIndices=J,e.oppositeCorner=B,e.oppositeEdge=P,e.releaseTileData=W,e.test=M,e.useFetchTileForLayer=m,e.v32s=F,e.vtlAssumes256PixelSizeAsDefault=V,e.weakAssert=T,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
