/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3f64","../../../geometry/projection","../../../geometry/SpatialReference","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/spatialReferenceUtils","./ITile","./PatchGeometryFactory","./Tile","../webgl-engine/materials/internal/MaterialUtil"],(function(e,t,r,i,n,a,o,s,l,c,u,h){"use strict";let d=function(e){function d(t,r,i){var n;return(n=e.call(this)||this)._horizontalScaleFactor=1,n._extentInRenderSR=o.create(),void 0!==t&&n.init(t,r,i),n}t._inherits(d,e);var f=d.prototype;return f.init=function(e,a,o){t._get(t._getPrototypeOf(d.prototype),"init",this).call(this,e,a,o);const l=o.view.renderSpatialReference,c=o.spatialReference,u=null!=l&&s.isPlateCarree(l)&&null!=c&&c.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=u;const h=this.surface.isWebMercatorOnPlateeCarree,p=this._extentInRenderSR,f=this.extent;if(h){const e=r.fromValues(f[0],f[1],0);i.projectVectorToVector(e,n.WebMercator,e,n.PlateCarree);const t=r.fromValues(f[2],f[3],0);i.projectVectorToVector(t,n.WebMercator,t,n.PlateCarree),p[0]=e[0],p[1]=e[1],p[2]=t[0],p[3]=t[1]}else for(let t=0;t<4;++t)p[t]=f[t]*u;this.centerAtSeaLevel[0]=.5*(p[0]+p[2]),this.centerAtSeaLevel[1]=.5*(p[1]+p[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(p[2]-p[0],p[3]-p[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()},f.updateRadiusAndCenter=function(){this._updateCenter();const e=this._extentInRenderSR,t=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),i=Math.sqrt(t*t+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),a=Math.max(i,n);this._center[u.CenterPosition.MIDDLE][3]=a},f._calculateFrustumVisibilityStatus=function(e){const t=this._aabb(),r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5];let c=!0;for(let u=0;u<6;u++){const t=e[u],h=t[0],d=t[1],p=t[2],f=t[3];if(h*(h>0?r:a)+d*(d>0?i:o)+p*(p>0?n:s)+f>=0)return l.TileFrustumVisibility.OUTSIDE;c=c&&h*(h<0?r:a)+d*(d<0?i:o)+p*(p<0?n:s)+f<=0}return c?l.TileFrustumVisibility.INSIDE:l.TileFrustumVisibility.INTERSECTS},f._aabb=function(){const e=this._extentInRenderSR;return a.wrap(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])},f.intersectsRay=function(e,t,r,i){return p[0]=1/t[0],p[1]=1/t[1],p[2]=1/t[2],h.intersectAabbInvDirBefore(this._aabb(),e,p,r,i)},f.createGeometry=function(){c.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()},f.getDefaultVerticesPerSide=function(){return this.level<9?3:2},f.updateCornerElevations=function(){c.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)},f.updateEdgeElevations=function(){c.updateEdgesAndCornersPlanar(this.renderData,this._horizontalScaleFactor)},t._createClass(d,[{key:"horizontalScale",get:function(){return this._horizontalScaleFactor}}]),d}(u.Tile);const p=r.create();e.PlanarPatch=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
