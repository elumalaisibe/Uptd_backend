/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],(function(t,e,i,n){"use strict";let a=function(){function a(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}var r=a.prototype;return r.clear=function(){this._current=i.destroyMaybe(this._current),this._next=i.destroyMaybe(this._next),this._waiting=i.destroyMaybe(this._waiting),this._delayed=i.destroyMaybe(this._delayed)},r.push=function(e,n=t.ActivationTime.Immediate){this._delayed=i.destroyMaybe(this._delayed),this._push(e,n)},r._push=function(e,n){if(this._isFadingEnabled||this.clear(),null==this._current)return void(this._current=e);const r=a.test.fadeMoment||performance.now();return n!==t.ActivationTime.Immediate?(this._delayed=e,void(this._delayedTime=r+n)):null==this._next?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(null!=e&&(i.destroyMaybe(this._waiting),this._waiting=e))},r._alignFadeStart=function(t){const e=this._getFadeDuration();return t+e-t%e},e._createClass(a,[{key:"current",get:function(){if(null==this._current)return null;if(!this._isFadingEnabled){const t=this._delayed||this._waiting||this._next||this._current;t!==this._current&&(this._current=null,this.clear(),this._current=t)}let e=a.test.fadeMoment;if(null!=this._delayed&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,t.ActivationTime.Immediate),this._delayed=null)),null!=this._next){e=e||performance.now();const t=this._fadeDuration,a=null!=this._current&&this._next.texture===this._current.texture,r=this._next.type!==n.TextureUpdate.FADING,s=e-this._fadeStart>=t;(a||r||s)&&(i.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(null==this._next)return 1;const t=a.test.fadeMoment||performance.now(),e=Math.max(0,t-this._fadeStart),i=this._fadeDuration;return e>i?0:1-e/i}},{key:"isFading",get:function(){return null!=this._next||null!=this._delayed}},{key:"_fadeDuration",get:function(){return null==this._waiting?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return this._getFadeDuration()>0}}]),a}();var r;a.test={fadeMoment:0},t.ActivationTime=void 0,(r=t.ActivationTime||(t.ActivationTime={}))[r.Immediate=0]="Immediate",r[r.Delayed=5e3]="Delayed",t.TextureFader=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
