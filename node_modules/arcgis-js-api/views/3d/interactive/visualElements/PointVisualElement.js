/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4","../../../../chunks/vec4f64","../../../../geometry/projection","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/vectorStacks","./VisualElementResources","../../layers/graphics/elevationAlignmentUtils","../../layers/graphics/ElevationContext","../../support/engineContent/sdfPrimitives","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/materials/HUDMaterial"],(function(e,t,r,i,s,o,n,u,l,c,a,h,_,p,f,d,g){"use strict";let m=function(){function e(e){this.view=null,this._geometry=null,this._size=3,this._color=n.fromValues(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=n.fromValues(1,1,1,1),this._elevationInfo=null,this._resources=new a.VisualElementResources({view:e.view,createResources:e=>this._createResources(e),destroyResources:e=>this._destroyResources(e),recreateGeometry:(e,t)=>{e.geometry=this._recreateGeometry(t,e.material)}});let t=!0;for(const r in e)r in this?"attached"===r?t=e[r]??!1:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=t}var s=e.prototype;return s.destroy=function(){this._resources.destroy()},s._updateMaterial=function(){const e=this._resources.resources;null!=e&&e.material.setParameters(this._materialParameters(e.texture.id))},s._updateSizeAttribute=function(){const e=this._resources.resources,t=this._resources.object;if(null==e||null==t)return;const r=e.geometry;if(null==r)return;const i=r.getMutableAttribute(d.VertexAttribute.SIZE).data,s=this._geometrySize;i[0]=s,i[1]=s,t.geometryVertexAttrsUpdated(t.geometries[0])},s._materialParameters=function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:v,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}},s._recreateGeometry=function(e,t){const r=this._createRenderGeometry(t);return null!=r&&e.addGeometry(r),r},s._createResources=function(e){const t=p.createTexture(this._primitive,this._preferredTextureSize),r=new g.HUDMaterial(this._materialParameters(t.id)),i=this._recreateGeometry(e,r);return{material:r,texture:t,geometry:i,forEach(e){e(t),e(r),null!=this.geometry&&e(this.geometry)}}},s._destroyResources=function(e){e.geometry=null,e.material.dispose(),e.texture.dispose()},s.calculateMapBounds=function(e){if(null==this._resources.resources||null==this._resources.resources.geometry)return!1;const t=this._resources.resources.geometry.vertexAttributes.get(d.VertexAttribute.POSITION);return u.projectVectorToVector(t.data,this.view.renderCoordsHelper.spatialReference,S,this.view.spatialReference),l.expandWithBuffer(e,S),!0},s._createRenderGeometry=function(e){const t=this.geometry;if(null==t)return null;const{renderCoordsHelper:r,elevationProvider:s}=this.view,o=h.evaluateElevationAlignmentAtPoint(t,s,_.ElevationContext.fromElevationInfo(this.elevationInfo),r),n=i.set(c.sv3d.get(),t.x,t.y,o),l=c.sv3d.get();u.projectVectorToVector(n,t.spatialReference,l,r.spatialReference);const a=this._geometrySize;return f.createPointGeometry(e,null,l,null,[a,a],[0,0,0,1])},t._createClass(e,[{key:"visible",get:function(){return this._resources.visible},set:function(e){this._resources.visible=e}},{key:"attached",get:function(){return this._resources.attached},set:function(e){this._resources.attached=e}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this._resources.recreateGeometry()}},{key:"size",get:function(){return this._size},set:function(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?null!=this._resources&&this._resources.recreate():this._updateSizeAttribute()}}},{key:"color",get:function(){return this._color},set:function(e){o.exactEquals(e,this._color)||(o.copy(this._color,e),this._updateMaterial())}},{key:"pixelSnappingEnabled",get:function(){return this._pixelSnappingEnabled},set:function(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}},{key:"primitive",get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,null!=this._resources&&this._resources.recreate())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){o.exactEquals(e,this._outlineColor)||(o.copy(this._outlineColor,e),this._updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._resources&&this._resources.recreateGeometry()}},{key:"_geometrySize",get:function(){return this._size/y}},{key:"_preferredTextureSize",get:function(){return r.clamp(r.nextHighestPowerOfTwo(2*this._geometrySize),16,128)}}]),e}();const y=p.DEFAULT_SYMBOL_SIZE_RATIO,v=[y/2,y/2,1-y/2,1-y/2],S=s.create();e.PointVisualElement=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
