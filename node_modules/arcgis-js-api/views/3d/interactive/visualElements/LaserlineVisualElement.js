/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/lineSegment","./VisualElement","../../support/LaserLineRenderer","../../../../chunks/Laserlines.glsl"],(function(e,n,t,i,s,r,l,a){"use strict";let h=function(e){function r(n){var t;return(t=e.call(this,n.view)||this)._angleCutoff=a.defaultAngleCutoff,t._style={},t._heightManifoldTarget=i.create(),t._heightManifoldEnabled=!1,t._intersectsLine=s.create(),t._intersectsLineEnabled=!1,t._intersectsLineInfinite=!1,t._lineVerticalPlaneSegment=null,t._pathVerticalPlaneBuffers=null,t._pointDistanceLine=null,t.applyProps(n),t}n._inherits(r,e);var h=r.prototype;return h.createResources=function(){this._ensureRenderer()},h.destroyResources=function(){this._disposeRenderer()},h.updateVisibility=function(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()},h._syncRenderer=function(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()},h._ensureRenderer=function(){null==this._renderer&&(this._renderer=new l.LaserLineRenderer({renderCoordsHelper:this.view.renderCoordsHelper},{contrastControlEnabled:!0}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer.renderSlots,this._renderer))},h._syncStyle=function(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))},h._syncAngleCutoff=function(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})},h._syncHeightManifold=function(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))},h._syncIntersectsLine=function(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))},h._syncIntersectsLineInfinite=function(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)},h._syncPathVerticalPlane=function(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))},h._syncLineVerticalPlane=function(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))},h._syncPointDistance=function(){if(null==this._renderer)return;const e=this._pointDistanceLine,n=null!=e;this._renderer.pointDistanceEnabled=n&&null!=e.target&&this.visible,n&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))},h._disposeRenderer=function(){null!=this._renderer&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)},n._createClass(r,[{key:"testData",get:function(){return this._renderer}},{key:"angleCutoff",get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}},{key:"style",get:function(){return this._style},set:function(e){this._style=e,this._syncStyle()}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){null!=e?(t.copy(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}},{key:"intersectsWorldUpAtLocation",set:function(e){if(null==e)return void(this.intersectsLine=null);const n=this.view.renderCoordsHelper.worldUpAtPosition(e,c);this.intersectsLine=s.fromValues(e,n),this.intersectsLineInfinite=!0}},{key:"intersectsLine",get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){null!=e?(s.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){this._lineVerticalPlaneSegment=null!=e?s.copy(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}},{key:"pathVerticalPlane",get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}},{key:"pointDistanceLine",get:function(){return this._pointDistanceLine},set:function(e){this._pointDistanceLine=null!=e?{origin:i.clone(e.origin),target:e.target?i.clone(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}}]),r}(r.VisualElement);const c=i.create();e.LaserlineVisualElement=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
