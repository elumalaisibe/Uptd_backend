/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../Color","../../../core/analysisThemeUtils","../../../core/has","../../../core/handleUtils","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/projection","../../../support/elevationInfoUtils","./visualElements/ExtendedLineVisualElement","./visualElements/ParallelLineVisualElement","./visualElements/PointVisualElement","./visualElements/RightAngleQuadVisualElement","../layers/interfaces","../webgl-engine/lib/Material","../../interactive/snapping/Settings","../../interactive/snapping/SnappingDomain","../../interactive/snapping/SnappingPoint","../../interactive/snapping/snappingUtils","../../interactive/snapping/SnappingVisualizer","../../interactive/snapping/hints/LineSnappingHint","../../interactive/support/viewUtils"],(function(e,n,i,t,l,r,a,o,s,d,u,c,p,g,f,v,h,E,m,S,R,H,O){"use strict";let C=function(e){function i(){return e.apply(this,arguments)||this}n._inherits(i,e);var t=i.prototype;return t.sortUniqueHints=function(e){return e.sort(((e,n)=>(n instanceof H.LineSnappingHint?n.length:0)-(e instanceof H.LineSnappingHint?e.length:0)))},t.visualizeIntersectionPoint=function(e,n){const{spatialReference:i,view:t}=n,l=y();return r.destroyHandle(new p.PointVisualElement({view:t,primitive:"circle",geometry:m.snappingPointToDehydratedPoint(e.intersectionPoint,i),elevationInfo:e.isDraped?d.onTheGroundElevationInfo:d.absoluteHeightElevationInfo,size:20,outlineSize:2,color:l.intersectionPointColor,outlineColor:l.intersectionPointOutlineColor,pixelSnappingEnabled:!1}))},t.visualizePoint=function(e,n){const{view:i,spatialReference:t}=n,l=y(),a=T(e.point,e.domain,n);return r.destroyHandle(new p.PointVisualElement({view:i,primitive:"circle",geometry:m.snappingPointToDehydratedPoint(a,t),elevationInfo:w(e,n),size:20,outlineSize:2,color:l.pointColor,outlineColor:l.pointOutlineColor,pixelSnappingEnabled:!1}))},t.visualizeLine=function(e,n){const{view:i,spatialReference:t}=n,l=y(),a=T(e.lineStart,e.domain,n),o=T(e.lineEnd,e.domain,n);return r.destroyHandle(this._createLineSegmentHint(e.type,a,o,t,w(e,n),i,l,e.isDraped,e.fadeLeft,e.fadeRight))},t.visualizeParallelSign=function(e,n){const{view:i,spatialReference:t}=n,l=y(),{isDraped:o}=e,s=w(e,n),d=T(e.lineStart,e.domain,n),u=T(e.lineEnd,e.domain,n),p=A(d,t,s,i,o),g=A(u,t,s,i,o),E=a.lerp(g,p,g,.5),m=new c.ParallelLineVisualElement({view:i,attached:!1,offset:h.defaults.parallelLineHintOffset,length:h.defaults.parallelLineHintLength,width:h.defaults.parallelLineHintWidth,color:l.parallelSignColor,location:E,renderOccluded:o?v.RenderOccludedFlag.OccludeAndTransparent:v.RenderOccludedFlag.Opaque,isDraped:o,renderGroup:f.DrapedRenderGroup.SnappingHint});return m.setDirectionFromPoints(p,E),m.attached=!0,r.destroyHandle(m)},t.visualizeRightAngleQuad=function(e,n){const{view:i,spatialReference:t}=n,l=y(),a=w(e,n),{isDraped:o}=e,s=T(e.previousVertex,e.domain,n),d=T(e.centerVertex,e.domain,n),u=T(e.nextVertex,e.domain,n),c=A(s,t,a,i,o),p=A(d,t,a,i,o),E=A(u,t,a,i,o);return r.destroyHandle(new g.RightAngleQuadVisualElement({view:i,attached:!0,color:o?l.rightAngleColorDraped:l.rightAngleColor,renderOccluded:o?v.RenderOccludedFlag.OccludeAndTransparent:v.RenderOccludedFlag.Transparent,outlineRenderOccluded:o?v.RenderOccludedFlag.OccludeAndTransparent:v.RenderOccludedFlag.Opaque,outlineColor:l.rightAngleOutlineColor,outlineSize:h.defaults.rightAngleHintOutlineSize,size:h.defaults.rightAngleHintSize,isDraped:o,geometry:{previous:c,center:p,next:E},renderGroup:f.DrapedRenderGroup.SnappingHint}))},t._createLineSegmentHint=function(e,n,i,t,l,r,a,o=!1,s=!0,d=!0){const c=A(n,t,l,r,o),p=A(i,t,l,r,o),g=new u.ExtendedLineVisualElement({view:r,extensionType:u.ExtensionType.FADED,start:c,end:p,isDraped:o,color:a.lineColor,renderOccluded:o?v.RenderOccludedFlag.OccludeAndTransparent:v.RenderOccludedFlag.Opaque,renderGroup:f.DrapedRenderGroup.SnappingHint});switch(e){case S.LineSegmentHintType.TARGET:g.width=h.defaults.lineHintWidthTarget,g.fadedExtensions={start:0,end:h.defaults.lineHintFadedExtensions};break;case S.LineSegmentHintType.REFERENCE_EXTENSION:g.width=h.defaults.lineHintWidthReference,g.fadedExtensions={start:0,end:0};break;case S.LineSegmentHintType.REFERENCE:g.width=h.defaults.lineHintWidthReference,g.fadedExtensions={start:s?h.defaults.lineHintFadedExtensions:0,end:d?h.defaults.lineHintFadedExtensions:0}}return g.attached=!0,g},n._createClass(i)}(R.SnappingVisualizer);function y(e){const n=i.toUnitRGBA(t.getAccentColor()),l=[0,0,0,0];return{intersectionPointColor:l,intersectionPointOutlineColor:n,pointColor:l,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:i.toUnitRGBA(t.getAccentColor(.5)),rightAngleOutlineColor:n}}function T(e,n,i){const t=P(n,i);return null==t?e:m.createSnappingPoint(e[0],e[1],t)}function w(e,n){return null!=P(e.domain,n)?n.selfSnappingZ.elevationInfo:e.isDraped?d.onTheGroundElevationInfo:d.absoluteHeightElevationInfo}function P(e,{selfSnappingZ:n}){return e===E.SnappingDomain.SELF&&null!=n?n.value:null}function A(e,n,i,t,l,r=o.create()){if(l){const i=t.basemapTerrain.overlayManager.renderer.spatialReference;s.projectVectorToVector(e,n,r,i)}else O.vectorToRender(e,n,i,t,r);return r}e.SnappingVisualizer3D=C,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
