/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/HandleOwner","../../../../../core/mathUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass"],(function(e,t,o,i,r,l,n,a,c,s,p,y){"use strict";function h(e){return-l.deg2rad(e)}e.ScaleRotateObjectSymbol3DAdapter=function(e){function o(t){var o;return(o=e.call(this,t)||this).sizeAxis=null,o._interactionState=null,o}t._inherits(o,e);var i=o.prototype;return i.initialize=function(){this.addHandles(n.when((()=>null!=this._interactionState?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),n.sync))},i.startInteraction=function(){const e=this._graphicSymbol,t=this.findLayerView();if(null!=this._interactionState||null==e||null==t)return d;const o=e.symbolLayers.map((o=>"object"===o.type?t.getSymbolLayerSize(e,o):null)).toArray(),i=e.clone(),r=this.angle,l=new u({originalSymbol:i,angle:r,initialSizes:o});this._interactionState=l;const n=()=>{this._interactionState=null};return{state:l,done:n,cancel:()=>{this._graphicSymbol=i,n()}}},i.createUndoRecord=function(){let e=this.graphic.symbol,t=null;return{undo:o=>{t=o.symbol,o.symbol=e},redo:o=>{e=o.symbol,o.symbol=t}}},i._updateSymbol=function({scale:e,angle:t,originalSymbol:o,initialSizes:i}){const r=this._graphicSymbol;if(null==r||"point-3d"!==r.type)return;const n=r.clone(),a=-l.rad2deg(t-this.initialAngle);let c=!1;this._forEachObjectSymbolLayerPair(o,n,((t,o,r)=>{const l=(t.heading??0)+a;o.heading!==l&&(o.heading=l,c=!0);const n=i[r];if(null!=n&&"width"in n){n.width=this.sizeFilter(n.width),n.height=this.sizeFilter(n.height),n.depth=this.sizeFilter(n.depth);const t=n.width*e;o.width!==t&&(o.width=t,c=!0);const i=n.depth*e;o.depth!==i&&(o.depth=i,c=!0);const r=n.height*e;o.height!==r&&(o.height=r,c=!0)}})),c&&(this._graphicSymbol=n)},i._forEachObjectSymbolLayerPair=function(e,t,o){e.symbolLayers.forEach(((e,i)=>{const r=t.symbolLayers.at(i);"object"===e.type&&"object"===r.type&&o(e,r,i)}))},t._createClass(o,[{key:"initialAngle",get:function(){return this._interactionState?.initialAngle??0}},{key:"angle",get:function(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?h(this._orientationReferenceSymbolLayer.heading??0):0}},{key:"angleClockwise",get:function(){return-this.angle}},{key:"orientation",get:function(){return this.angle}},{key:"orientationClockwise",get:function(){return this.angleClockwise}},{key:"relativeAngle",get:function(){return this.angle-this.initialAngle}},{key:"relativeAngleClockwise",get:function(){return-this.relativeAngle}},{key:"scale",get:function(){return this._interactionState?.scale??1}},{key:"size",get:function(){const e=this._sizeReferenceSymbolLayer;if(null==e)return null;const t=this.findLayerView(),o=this._graphicSymbol;if(null==t||null==o||"point-3d"!==o.type)return null;const i=t.getSymbolLayerSize(o,e);if("size"in i&&null!=i.size)return i.size;const r=this.sizeAxis;return!("width"in i)||null==i.width||null!=r&&"width"!==r&&"all"!==r&&"width-and-depth"!==r?!("depth"in i)||null==e.depth||null!=r&&"depth"!==r&&"all"!==r&&"width-and-depth"!==r?!("height"in i)||null==e.height||null!=r&&"height"!==r&&"all"!==r?null:i.height:i.depth:i.width}},{key:"_sizeReferenceSymbolLayer",get:function(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}},{key:"_orientationReferenceSymbolLayer",get:function(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&null!=e.heading))}},{key:"_graphicSymbol",get:function(){return null!=this.graphic&&null!=this.graphic.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null},set:function(e){this.graphic.symbol=e}}]),o}(r.HandleOwner),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"initialAngle",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"angle",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"angleClockwise",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"orientation",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"orientationClockwise",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"relativeAngle",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"relativeAngleClockwise",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"scale",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"size",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeAxis",void 0),o.__decorate([a.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"graphic",void 0),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_interactionState",void 0),o.__decorate([a.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"findLayerView",void 0),o.__decorate([a.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeFilter",void 0),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_sizeReferenceSymbolLayer",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_orientationReferenceSymbolLayer",null),o.__decorate([a.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_graphicSymbol",null),e.ScaleRotateObjectSymbol3DAdapter=o.__decorate([y.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],e.ScaleRotateObjectSymbol3DAdapter);const d={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let u=function(e){function o(t){var o;return(o=e.call(this,t)||this).angle=0,o.initialAngle=0,o.scale=1,o.initialAngle=t.angle,o}return t._inherits(o,e),t._createClass(o,[{key:"state",get:function(){const{originalSymbol:e,angle:t,initialAngle:o,scale:i,initialSizes:r}=this;return{originalSymbol:e,angle:t,initialAngle:o,scale:i,initialSizes:r}}}]),o}(i);o.__decorate([a.property()],u.prototype,"originalSymbol",void 0),o.__decorate([a.property()],u.prototype,"angle",void 0),o.__decorate([a.property()],u.prototype,"initialAngle",void 0),o.__decorate([a.property()],u.prototype,"initialSizes",void 0),o.__decorate([a.property()],u.prototype,"scale",void 0),o.__decorate([a.property()],u.prototype,"state",null),u=o.__decorate([y.subclass("InteractionState")],u),e.headingToAngle=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
