/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/HandleOwner","../../../../../core/mathUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec3","../../../../../geometry/support/axisAngleDegrees","../../../../../geometry/support/MeshTransform","../../../../ViewingMode","./undoRecords"],(function(e,t,r,o,a,n,i,s,c,l,p,g,h,u,d,y,_){"use strict";e.ScaleRotateMeshAdapter=function(e){function r(t){var r;return(r=e.call(this,t)||this)._interactionState=null,r}t._inherits(r,e);var o=r.prototype;return o.initialize=function(){this.addHandles([i.when((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(({interactionState:e})=>{this._updateMeshRotation(e)}),i.sync),i.when((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(({interactionState:e})=>{this._updateMeshSize(e)}),i.sync)])},o.startInteraction=function(){const e=new S({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}},o.createUndoRecord=function(){return _.createGraphicGeometryUndoRecord(this.graphic)},o._updateMeshRotation=function(e){const{angle:t,previousAngle:r}=e;e.previousAngle=t;const{geometry:o}=this,{vertexSpace:a}=o,i=n.rad2deg(t-r);if(a.isGeoreferenced){const e=!a.isRelative&&this.viewingMode===y.ViewingMode.Global,t=this.geometry.anchor;this.geometry.rotate(0,0,i,{origin:t,geographic:e}),this.graphic.notifyGeometryChanged()}else{o.transform??(o.transform=new d);const{transform:e}=o,t=u.composeAxes(0,0,i,f);e.rotation=u.compose(e.rotation,t,e.rotation),this.graphic.notifyMeshTransformChanged()}},o._updateMeshSize=function(e){const{scale:t,previousScale:r}=e;e.previousScale=t;const{geometry:o}=this,{vertexSpace:a}=o,n=t/r;if(a.isGeoreferenced){const e=!a.isRelative&&this.viewingMode===y.ViewingMode.Global,t=this.geometry.anchor;this.geometry.scale(n,{origin:t,geographic:e}),this.graphic.notifyGeometryChanged()}else{o.transform??(o.transform=new d);const{transform:e}=o;e.scale=h.scale(e.scale,e.scale,n),this.graphic.notifyMeshTransformChanged()}},t._createClass(r,[{key:"initialAngle",get:function(){return this._interactionState?.initialAngle??0}},{key:"angle",get:function(){const e=this.geometry.transform;if(null==e)return this._interactionState?.angle??0;const t=u.axis(e.rotation)[2];return Math.abs(t)>.999999?n.deg2rad(u.angle(e.rotation))*Math.sign(t):0}},{key:"angleClockwise",get:function(){return-this.angle}},{key:"relativeAngle",get:function(){return this.angle-this.initialAngle}},{key:"relativeAngleClockwise",get:function(){return-this.relativeAngle}},{key:"scale",get:function(){return this._interactionState?.scale??1}}]),r}(a.HandleOwner),r.__decorate([s.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"graphic",void 0),r.__decorate([s.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"geometry",void 0),r.__decorate([s.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"viewingMode",void 0),r.__decorate([s.property()],e.ScaleRotateMeshAdapter.prototype,"initialAngle",null),r.__decorate([s.property()],e.ScaleRotateMeshAdapter.prototype,"angle",null),r.__decorate([s.property()],e.ScaleRotateMeshAdapter.prototype,"angleClockwise",null),r.__decorate([s.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngle",null),r.__decorate([s.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngleClockwise",null),r.__decorate([s.property()],e.ScaleRotateMeshAdapter.prototype,"scale",null),r.__decorate([s.property()],e.ScaleRotateMeshAdapter.prototype,"_interactionState",void 0),e.ScaleRotateMeshAdapter=r.__decorate([g.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],e.ScaleRotateMeshAdapter);let S=function(e){function r(t){var r;return(r=e.call(this,t)||this).angle=0,r.initialAngle=0,r.previousAngle=0,r.previousScale=1,r.scale=1,r.initialAngle=t.angle,r.previousAngle=t.angle,r}return t._inherits(r,e),r.prototype.cancel=function(){this.angle=this.initialAngle,this.scale=1},t._createClass(r,[{key:"state",get:function(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}}]),r}(o);r.__decorate([s.property()],S.prototype,"angle",void 0),r.__decorate([s.property()],S.prototype,"initialAngle",void 0),r.__decorate([s.property()],S.prototype,"previousAngle",void 0),r.__decorate([s.property()],S.prototype,"previousScale",void 0),r.__decorate([s.property()],S.prototype,"scale",void 0),r.__decorate([s.property()],S.prototype,"state",null),S=r.__decorate([g.subclass("InteractionState")],S);const f=u.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
