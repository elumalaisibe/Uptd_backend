/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../chunks/mat3","../../../../chunks/mat3f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../ViewingMode","../../support/mathUtils"],(function(t,e,i,n,o,s,a,c){"use strict";const r=s.create(),h=s.create(),p=s.create(),l=s.create(),u=s.create(),d=s.create(),m={upward:s.fromValues(0,0,1),forward:s.fromValues(0,1,0),sideway:s.fromValues(1,0,0)},w=n.create();return function(){function y(t=a.ViewingMode.Global){this.viewingMode=t,this.center=s.create(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=s.clone(m.forward)}var f=y.prototype;return f.pixelsPerPanAtZoom=function(t){return this.size/2/(this._zoomToPanScale*t)},f.zoomAtPixelsPerPan=function(t){return this.size/2/(this._zoomToPanScale*t)},f.pixelsPerRotateAtZoom=function(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t},f.compareTo=function(t,e){if(e||(e={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===a.ViewingMode.Global){const i=(o.length(this.center)+o.length(t.center))/2;e.pan=c.angle(this.center,t.center)*i}else e.pan=o.distance(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const n=Math.abs(t.pitch-this.pitch);return e.rotate=Math.max(i,n),e.sourceZoom=this.distance,e.targetZoom=t.distance,e},f.interpolate=function(t,i,n){this.viewingMode===a.ViewingMode.Global?c.slerp(t.center,i.center,n.pan,this.center):o.lerp(this.center,t.center,i.center,n.pan),this.distance=isFinite(i.distance)?e.lerp(t.distance,i.distance,n.zoom):t.distance,this.pitch=e.lerp(t.pitch,i.pitch,n.rotate);let s=t.yaw;const r=i.yaw;Math.abs(r-s)>=Math.PI&&(s+=2*(s<r?1:-1)*Math.PI),this.yaw=e.lerp(s,r,n.rotate)},f.copyFrom=function(t){o.copy(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,o.copy(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode},f.copyFromRenderCamera=function(t){const e=this._lookAtOrientation(t.center,w);o.copy(this.center,t.center),o.subtract(l,t.center,t.eye),o.transformMat3(l,l,e),o.transformMat3(u,t.up,e),this.distance=o.length(l),0!==this.distance&&(l[0]/=this.distance,l[1]/=this.distance,l[2]/=this.distance),this.pitch=this._eyeUpToPitch(l),this.yaw=this._eyeUpToYaw(l,u),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)},f.copyFromCommon=function(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)},f.copyToRenderCamera=function(t){const e=this._lookAtOrientation(this.center,w);i.transpose(e,e),this._axisAngleVec3(m.sideway,this.pitch-Math.PI/2,m.forward,l),this._axisAngleVec3(m.upward,this.yaw,l),this._axisAngleVec3(m.sideway,this.pitch-Math.PI/2,m.upward,u),this._axisAngleVec3(m.upward,this.yaw,u),o.scale(l,l,this.distance),o.transformMat3(l,l,e),o.transformMat3(u,u,e),t.center=this.center,t.eye=o.subtract(l,this.center,l),t.up=u},f._axisAngleVec3=function(t,e,i,n=i){const s=Math.cos(e),a=Math.sin(e);return o.scale(r,i,s),o.cross(h,t,i),o.scale(h,h,a),o.scale(p,t,(1-s)*o.dot(t,i)),o.add(n,o.add(n,r,h),p)},f._lookAtOrientation=function(t,e=n.create()){return this._upAtLookAt(t,p),o.cross(r,this.lookAtDirection,p),o.normalize(r,r),0===r[0]&&0===r[1]&&0===r[2]&&o.copy(r,m.sideway),o.cross(h,p,r),o.normalize(h,h),e[0]=r[0],e[1]=h[0],e[2]=p[0],e[3]=r[1],e[4]=h[1],e[5]=p[1],e[6]=r[2],e[7]=h[2],e[8]=p[2],e},f._upAtLookAt=function(t,e){return this.viewingMode===a.ViewingMode.Local?o.copy(e,m.upward):o.normalize(e,t)},f._eyeUpToPitch=function(t){return Math.PI-c.angle(m.upward,t)},f._eyeUpToYaw=function(t,e){const i=d;return Math.abs(e[2])<.5?(o.copy(i,e),t[2]>0&&o.scale(i,i,-1)):o.copy(i,t),o.cross(h,i,m.upward),o.normalize(h,h),c.angle(m.sideway,h,m.upward)},t._createClass(y)}()}));
