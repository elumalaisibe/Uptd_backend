/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/VertexAttribute"],(function(t,e,r,i,n,o,u,h){"use strict";function a(t,r,i){const n=e.width(t)/e.height(t),o={width:i,height:i};return n>1.0001?o.height=i/n:n<.9999&&(o.width=i*n),o.width=Math.round(o.width/(e.width(t)/e.width(r))),o.height=Math.round(o.height/(e.height(t)/e.height(r))),o}function g(t,e){return u.createSquareGeometry(t,[[e[0],e[1],-1],[e[2],e[1],-1],[e[2],e[3],-1],[e[0],e[3],-1]])}function b(t,u,a){if(!e.intersects(u,a))return g(t,a);const b=[u[1]-a[1],Math.min(u[3],a[3])-Math.max(u[1],a[1]),a[3]-u[3],123456],c=[u[0]-a[0],Math.min(u[2],a[2])-Math.max(u[0],a[0]),a[2]-u[2],123456],w=a[2]-a[0],A=a[3]-a[1],m=c[0]>0&&c[2]>0?3:2,y=b[0]>0&&b[2]>0?3:2,s=(y+1)*(m+1),d=r.newDoubleArray(3*s),x=i.newFloatArray(2*s),f=new Array(6*(y*m-1));let p=0,M=0,V=0,O=0,G=0;for(let e=0;e<4;e++){const t=b[e];if(t<=0)continue;let r=0;for(let i=0;i<4;i++){const t=c[i];t<=0||(d[M++]=a[0]+r,d[M++]=a[1]+p,d[M++]=-1,x[V++]=r/w,x[V++]=p/A,i<3&&e<3&&(1!==i||1!==e)&&(f[G++]=O,f[G++]=O+1,f[G++]=O+m+1,f[G++]=O+1,f[G++]=O+m+2,f[G++]=O+m+1),O++,r+=t)}p+=t}const I=new Array(f.length);return new o.Geometry(t,[[h.VertexAttribute.POSITION,new n.Attribute(d,3,!0)],[h.VertexAttribute.NORMAL,new n.Attribute(l,3,!0)],[h.VertexAttribute.UV0,new n.Attribute(x,2,!0)]],[[h.VertexAttribute.POSITION,f],[h.VertexAttribute.NORMAL,I],[h.VertexAttribute.UV0,f]])}const l=[0,0,1];t.computeImageExportSize=a,t.createGeometryForExtent=g,t.createOuterImageGeometry=b,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
