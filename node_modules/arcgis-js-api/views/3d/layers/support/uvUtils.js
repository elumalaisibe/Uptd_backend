/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection","../../../../geometry/support/DoubleArray","../../../../geometry/support/plane","../../../ViewingMode"],(function(e,t,o,r,a,c,n,s,l,i,u){"use strict";function d(e,t,r,a,c=1){if(r.isGeographic&&a===u.ViewingMode.Global){const e=l.newDoubleArray(t.length),o=t.length,a=n.getReferenceEllipsoid(r);for(let r=0;r<o;r+=3)s.lonLatToWebMercatorComparable(t,r,e,r,a);t=e}o.set(b,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<t.length;o+=3)b[0]=Math.min(b[0],t[o]),b[1]=Math.min(b[1],t[o+1]);const i=b[0]%c,d=b[1]%c,I=b[0]-i,m=b[1]-d;for(let o=0;o<t.length;o+=3){const r=o/3*4;e[r]=(t[o]-I)/c,e[r+1]=(t[o+1]-m)/c,e[r+2]=I/c,e[r+3]=m/c}}function I(e,t,r,c,n=1){a.set(N,1,0,0),a.set(g,0,1,0),a.set(p,0,0,1),_(m,r),V(r,f)&&E(f,N,g,p,c,m),o.set(b,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o.set(M,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let o=0;o<r.length;o+=3){a.set(h,r[o],r[o+1],r[o+2]);const e=a.dot(N,h),t=a.dot(g,h);b[0]=Math.min(b[0],e),b[1]=Math.min(b[1],t),M[0]=Math.max(M[0],e),M[1]=Math.max(M[1],t)}const s=a.dot(p,m);v(T,b[0],b[1],s,N,g,p),v(y,M[0],b[1],s,N,g,p),v(A,b[0],M[1],s,N,g,p),a.subtract(y,y,T),a.scale(y,y,.5),a.subtract(A,A,T),a.scale(A,A,.5),a.add(T,T,y),a.add(T,T,A);const l=b[0]%n,i=b[1]%n,u=b[0]-l,d=b[1]-i;for(let o=0;o<r.length;o+=3){a.set(h,r[o],r[o+1],r[o+2]);const c=o/3,s=4*c;e[s]=(a.dot(N,h)-u)/n,e[s+1]=(a.dot(g,h)-d)/n,e[s+2]=u/n,e[s+3]=d/n;const l=9*c;for(let e=0;e<3;e++)t[l+e]=T[e],t[l+e+3]=y[e],t[l+e+6]=A[e]}}const m=c.create(),h=c.create(),f=i.create(),N=c.create(),g=c.create(),p=c.create(),b=r.create(),M=r.create(),T=c.create(),y=c.create(),A=c.create();function V(e,t){const o=e.length/3-1;return i.fromManyPointsSampleAt(e,t,0,Math.floor(o/3),Math.floor(o*(2/3)))}function E(e,t,o,r,c,n){null!=c?(c.basisMatrixAtPosition(n,S),a.set(P,S[0],S[1],S[2]),a.set(F,S[4],S[5],S[6]),a.set(Y,S[8],S[9],S[10])):(a.set(P,1,0,0),a.set(F,0,1,0),a.set(Y,0,0,1));const s=i.normal(e);a.dot(s,Y)<0&&a.scale(s,s,-1),a.copy(r,s);const l=a.dot(s,F),u=a.dot(s,P);Math.abs(l)<Math.abs(u)?(a.scaleAndAdd(t,P,s,-u),a.normalize(t,t),a.cross(o,t,s),a.normalize(o,o),a.scale(o,o,-1)):(a.scaleAndAdd(o,F,s,-l),a.normalize(o,o),a.cross(t,o,s),a.normalize(t,t))}const S=t.create(),P=c.create(),F=c.create(),Y=c.create();function _(e,t){a.set(k,0,0,0);for(let o=0;o<t.length-3;o+=3)k[0]+=t[o],k[1]+=t[o+1],k[2]+=t[o+2];a.scale(e,k,1/(t.length/3-1))}const k=c.create();function v(e,t,o,r,c,n,s){a.set(e,t*c[0]+o*n[0]+r*s[0],t*c[1]+o*n[1]+r*s[1],t*c[2]+o*n[2]+r*s[2])}e.createMapSpaceUVCoords=I,e.createMapSpaceUVCoordsDraped=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
