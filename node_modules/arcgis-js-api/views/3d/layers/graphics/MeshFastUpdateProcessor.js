/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/materials/DefaultMaterial"],(function(a,t,e){"use strict";let r=function(){function a(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}var r=a.prototype;return r.enable=function(a,t,r){a.enableFastTransformUpdates((a=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(a))return a;const e=t.byMaterial(a);return this._fastTransformOriginalMaterials.set(a,e),t.delete(a),a}const i=new e.DefaultMaterial(a.parameters);return r.stage.add(i),this._fastTransformClonedMaterials.set(i,a),i}),r.localOriginFactory)},r.disable=function(a,t,e){const r=new Set,i=new Set;a.disableFastTransformUpdates((a=>{if(!this._fastTransformClonedMaterials.has(a)){const e=a,s=this._fastTransformOriginalMaterials.get(e);return t.has(s.uid)?(r.add(e),t.byUid(s.uid).material):(i.add(e),s.material)}const s=a,n=this._fastTransformClonedMaterials.get(s);return this._fastTransformClonedMaterials.delete(s),e.stage.remove(s),s.dispose(),n}));for(const s of r)this._fastTransformOriginalMaterials.delete(s),e.stage.remove(s),s.dispose();for(const s of i){const a=this._fastTransformOriginalMaterials.get(s);this._fastTransformOriginalMaterials.delete(s),t.set(a.uid,a)}},r.onAddGraphic=function(){this._graphicReferenceCount++},r.onRemoveGraphic=function(a,t,e){this._graphicReferenceCount--,this.disable(a,t,e)},r.forEachMaterialInfo=function(a){this._fastTransformOriginalMaterials.forEach(a)},r.forEachClonedMaterial=function(a){this._fastTransformClonedMaterials.forEach(a)},r.destroy=function(a){a.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),a.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),(({material:a})=>a))),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()},t._createClass(a)}(),i=function(){function a(){this._byUid=new Map,this._byMaterial=new Map}var e=a.prototype;return e.byUid=function(a){return this._byUid.get(a)},e.byMaterial=function(a){return this._byMaterial.get(a)},e.set=function(a,t){this._byUid.set(a,t),this._byMaterial.set(t.material,t)},e.delete=function(a){const t=this._byMaterial.get(a)?.uid;t&&(this._byUid.delete(t),this._byMaterial.delete(a))},e.has=function(a){return this._byUid.has(a)},e.forEachMaterialInfo=function(a){this._byUid.forEach(a)},e.clear=function(){this._byUid.clear(),this._byMaterial.clear()},t._createClass(a,[{key:"materials",get:function(){return Array.from(this._byUid.values(),(a=>a.material))}}]),a}();a.MaterialInfoCache=i,a.MeshFastUpdateProcessor=r,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})}));
