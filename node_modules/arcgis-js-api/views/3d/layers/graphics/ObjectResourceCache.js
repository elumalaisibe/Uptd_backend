/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils","../../glTF/DefaultLoadingContext","../../glTF/loader","./wosrLoader"],(function(e,t,o,r,n,s,l){"use strict";let a=function(){function e(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",(()=>{})),this._wosrMemCache=e("wosr-resources",(()=>{}))}var a=e.prototype;return a.destroy=function(){this._gltfLoading.forEach((e=>e.abortController.abort())),this._wosrLoading.forEach((e=>e.abortController.abort())),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()},a.loadGLTF=function(e,t,o){const r=o?`gltfPBR:${e}`:`gltf:${e}`,l=this._gltfMemCache.get(r);return null!=l?Promise.resolve(l):this._loadOnce(this._gltfLoading,this._gltfMemCache,r,(t=>s.loadGLTF(new n.DefaultLoadingContext(t.streamDataRequester),e,t,o)),t)},a.loadWOSR=function(e,t){const o=`wosr:${e}:${t.disableTextures}`,r=this._wosrMemCache.get(o);return null!=r?Promise.resolve(r):this._loadOnce(this._wosrLoading,this._wosrMemCache,o,(t=>l.load(e,t)),t)},a._loadOnce=async function(e,t,n,s,l){r.throwIfAborted(l);const a=r.onAbort(l,(()=>this._abortLoad(e,n)));let i=e.get(n);if(i)i.refCount++;else{const t=new AbortController;i={refCount:1,abortController:t,promise:s({...l,signal:t.signal})},e.set(n,i)}try{const o=await i.promise;return t.put(n,o,o.size),e.delete(n),r.throwIfAborted(l),o}finally{o.removeMaybe(a)}},a._abortLoad=function(e,t){const o=e.get(t);if(null!=o){if(--o.refCount>0)return}e.delete(t),null!=o&&o.abortController.abort()},t._createClass(e)}();e.ObjectResourceCache=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
