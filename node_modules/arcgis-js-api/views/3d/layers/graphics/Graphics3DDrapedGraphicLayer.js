/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/aaBoundingRect","./graphicUtils","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/ModelDirtyTypes"],(function(e,t,i,r,n,o,s,d){"use strict";let a=function(){function n(e,t,i,r){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=i,this._drapeSourceRenderer=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}var a=n.prototype;return a.initialize=function(e){this.stage=e.stage},a.setVisibility=function(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,d.DirtyOperation.ADD);if(e||this._addedToStage){for(const e of this.renderGeometries)e.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,d.DirtyState.VISIBILITY)}}},a.destroy=function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,d.DirtyOperation.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null},a.getCenterObjectSpace=function(e=i.create()){return t.set(e,0,0,0)},a.getBoundingBoxObjectSpace=function(e=r.create()){return r.empty(e)},a.addObjectState=function(e,t){e===s.Object3DState.Highlight&&(this.renderGeometries.forEach((e=>{const i=e.geometry.addHighlight();t.addRenderGeometry(e,i,this)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,d.DirtyState.HIGHLIGHT))},a.removeObjectState=function(e){this.renderGeometries.forEach((t=>{e.removeRenderGeometry(t)}))},a.removeRenderGeometryObjectState=function(e,t){e.geometry.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,d.DirtyState.HIGHLIGHT)},a.computeAttachmentOrigin=function(e){for(const t of this.renderGeometries)t.geometry.computeAttachmentOrigin(u)&&(e.draped.origin[0]+=u[0],e.draped.origin[1]+=u[1],e.draped.num++)},a.getProjectedBoundingBox=async function(e,t,i,n,s){r.empty(s);for(let o=0;o<this.renderGeometries.length;o++){const t=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(t,e,c,i),r.expandWithRect(s,c)}if(t){let e;r.center(s,u);const i=o.demResolutionForBoundingBox(s,t.service.spatialReference,t);try{e=await t.service.queryElevation(u[0],u[1],n,i,"ground")}catch(d){}null!=e&&(s[2]=Math.min(s[2],e),s[5]=Math.max(s[5],e))}return s},a._getRenderGeometryProjectedBoundingRect=function(e,t,i,n){if(this.boundingBox)r.set(h,this.boundingBox);else{const t=e.boundingSphere,i=t[3];h[0]=t[0]-i,h[1]=t[1]-i,h[2]=t[2]-i,h[3]=t[0]+i,h[4]=t[1]+i,h[5]=t[2]+i}return t(h,0,2),this.calculateRelativeScreenBounds&&n.push({location:r.center(h),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),r.toRect(h,i)},e._createClass(n)}();const c=n.create(),h=r.create(),u=i.create();return a}));
