/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry","../../../../core/promiseUtils","../../../../layers/graphics/dehydratedFeatures","../../../../support/elevationInfoUtils","./elevationAlignmentUtils","./ElevationContext","./featureExpressionInfoUtils","../../../../geometry/SpatialReference"],(function(e,t,o,n,a,r,i,s,l){"use strict";async function f(e,t,n,i,l){const{elevationProvider:f,renderCoordsHelper:u,spatialReference:v}=e,{elevationInfo:I}=t,y=!0,g=s.extractExpressionInfo(I,y),x=await s.createContext(g,v,l);o.throwIfAborted(l);const m=[],E=new Set,h=new Set;for(const{objectId:o,points:s}of i){const i=n(o);if(null==i){for(const e of s)m.push(e.z??0);E.add(o);continue}i.isDraped&&h.add(o);const l=i.graphic.geometry;c.setFromElevationInfo(a.getGeometryEffectiveElevationInfo(l,I)),c.updateFeatureExpressionInfoContext(x,i.graphic,t),d.spatialReference=e.spatialReference;for(const{x:e,y:t,z:o}of s)d.x=e,d.y=t,d.z=o??0,r.evaluateElevationInfoAtPoint(d,f,c,u,p),m.push(p.z)}return{elevations:m,drapedObjectIds:h,failedObjectIds:E}}const c=new i.ElevationContext,d=n.makeDehydratedPoint(0,0,0,l.WGS84),p=new r.SampleElevationInfo;e.elevationAlignPointsInFeatures=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
