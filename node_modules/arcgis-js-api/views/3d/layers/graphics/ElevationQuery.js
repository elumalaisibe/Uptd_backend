/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry","../../../../core/arrayUtils","../../../../core/promiseUtils","../../../support/Scheduler","../../../../geometry/Multipoint"],(function(e,t,r,i,n,s,o){"use strict";let a=function(){function e(e,t){this.spatialReference=e,this._view=t}var r=e.prototype;return r.getElevation=function(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)},r.queryElevation=async function(e,t,r,i,n){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,i)},t._createClass(e)}(),l=function(){function e(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...i,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(s.TaskPriority.ELEVATION_QUERY,this)}var r=e.prototype;return r.destroy=function(){this._frameTask.remove()},r.queryElevation=function(e,t,r,s=0){const o=n.createResolver(),a={x:e,y:t,minDemResolution:s,result:o,signal:r};return this._queries.push(a),n.onAbort(r,(()=>{i.remove(this._queries,a),o.reject(n.createAbortError())})),o.promise},r.runTask=function(e){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return t.forEach((e=>e.result.reject())),void e.madeProgress();const i=t.map((e=>[e.x,e.y])),s=t.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),a=new o({points:i,spatialReference:this.spatialReference}),l=t.length>1&&t.some((e=>!!e.signal))?new AbortController:null,u=null!=l?l.signal:t[0].signal;if(null!=l){let e=0;t.forEach((r=>n.onAbort(r.signal,(()=>{e++,r.result.reject(n.createAbortError()),e===t.length&&l.abort()}))))}const c={...this._queryOptions,minDemResolution:s,signal:u};r.queryElevation(a,c).then((e=>{t.forEach(((t,r)=>{null!=t.signal&&t.signal.aborted?t.result.reject(n.createAbortError()):t.result.resolve(e.geometry.points[r][2])}))})).catch((e=>{t.forEach((t=>t.result.reject(e)))})),e.madeProgress()},t._createClass(e,[{key:"running",get:function(){return this._queries.length>0}},{key:"test",get:function(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(s.noBudget)}}}]),e}();e.ElevationQuery=l,e.ViewElevationProvider=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
