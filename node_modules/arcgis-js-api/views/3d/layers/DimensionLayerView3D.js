/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["require","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/asyncUtils","../../../core/Error","../../../core/maybe","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","./LayerView3D","../../layers/DimensionLayerView","../../layers/LayerView"],(function(e,s,i,a,t,n,r,l,o,y,c,w,u){"use strict";const h=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),d="analysis-view-handles";let _=function(i){function o(e){var s;return(s=i.call(this,e)||this).type="dimension-3d",s._analysisModule=null,s}s._inherits(o,i);var y=o.prototype;return y.initialize=function(){this.handles.add(l.watch((()=>this.layer.source),(e=>{this._destroyAnalysisView(),null!=e&&this._createAnalysisView(e)}),l.syncAndInitial),d)},y.destroy=function(){this.handles.remove(d),this._destroyAnalysisView()},y.isUpdating=function(){return null!=this._createAnalysisViewTask||null!=this.analysisView&&this.analysisView.updating},y.whenAnalysisView=async function(){if(null!=this.analysisView)return this.analysisView;if(null!=this._createAnalysisViewTask)return this._createAnalysisViewTask.promise;throw new t("layerview:no-analysisview-for-analysis","The analysis has not been set on the DimensionLayer of this layer view")},y._createAnalysisView=function(e){const s=a.createTask((async i=>(this.analysisView=await this._createAnalysisViewPromise(e,i),this._createAnalysisViewTask===s&&(this._createAnalysisViewTask=null),this.analysisView)));this.addResolvingPromise(s.promise),this._createAnalysisViewTask=s},y._destroyAnalysisView=function(){this.analysisView=n.destroyMaybe(this.analysisView),this._createAnalysisViewTask=n.abortMaybe(this._createAnalysisViewTask)},y._createAnalysisViewPromise=async function(e,s){let i=this._analysisModule;if(null==i){const e=await this._loadAnalysisModule();this._analysisModule=e,i=e}const a=new i.default({analysis:e,view:this.view,parent:this});if(await a.when(),r.isAborted(s))throw a.destroy(),r.createAbortError();return a},y._loadAnalysisModule=function(){return new Promise(((s,i)=>e(["../analysis/DimensionAnalysisView3D"],(e=>s(h(e))),i)))},s._createClass(o)}(c.LayerView3D(w(u)));i.__decorate([o.property()],_.prototype,"type",void 0),i.__decorate([o.property()],_.prototype,"analysisView",void 0),i.__decorate([o.property()],_.prototype,"_createAnalysisViewTask",void 0),_=i.__decorate([y.subclass("esri.views.3d.layers.DimensionLayerView3D")],_);return _}));
