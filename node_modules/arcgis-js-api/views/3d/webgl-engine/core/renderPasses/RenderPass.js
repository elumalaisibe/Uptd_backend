/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/PooledArray","../../lib/TransparencyPassType","../../../../webgl/enums"],(function(e,t,r,n,a){"use strict";var i;e.RenderPassSorting=void 0,(i=e.RenderPassSorting||(e.RenderPassSorting={}))[i.FrontToBack=0]="FrontToBack",i[i.BackToFront=1]="BackToFront";let s=function(){function a(t,n,a=e.RenderPassSorting.FrontToBack){this._rctx=t,this._techniqueRepository=n,this._sorting=a,this._draws=new r({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}var i=a.prototype;return i.submitDraw=function(e,t,r,n){const a=this._draws.pushNew();a.geometry=t,a.geometryRanges=r,a.material=e,a.depthSquaredHint=n,a.indexType=(t.indexed?t.vao.indexBuffer.indexType:null)??0},i.prepare=function(e,t){return this._draws.map((r=>r.material.prepareTechnique(this._techniqueRepository,e,t,r.geometry.parameters)))},i.dispatch=function(e,t,r){const a=this._rctx;this._previouslyBoundDraw.clear();let i=null;const s=this._draws.length;for(let l=0;l<s;l++){const s=r[l];s===i&&s.configuration.transparencyPassType===n.TransparencyPassType.NONE||(a.bindTechnique(s,e,t),i=s);const u=this._draws.data[l],d=u.geometry;a.bindVAO(d.vao),this._previouslyBoundDraw.get(s)!==u.material&&(s.program.bindDraw(u.material,t,e),this._previouslyBoundDraw.set(s,u.material));const p=u.geometryRanges,c=p.length;if(0!==u.indexType){const e=o.get(u.indexType);for(let t=0;t<c;t+=2){const r=p[t],n=p[t+1];a.drawElements(d.primitiveType,n,u.indexType,r*e)}}else for(let e=0;e<c;e+=2){const t=p[e],r=p[e+1];a.drawArrays(d.primitiveType,t,r)}}},i.prepareSubmit=function(){this._draws.clear()},i.finishSubmit=function(){const t=this._sorting===e.RenderPassSorting.FrontToBack?1:-1;this._draws.sort(((e,r)=>{const n=t*(e.depthSquaredHint-r.depthSquaredHint);return 0!==n?n:e.geometry.vao.byteSize-r.geometry.vao.byteSize}))},t._createClass(a,[{key:"count",get:function(){return this._draws.length}}]),a}();const o=new Map;o.set(a.DataType.UNSIGNED_BYTE,1),o.set(a.DataType.UNSIGNED_SHORT,2),o.set(a.DataType.UNSIGNED_INT,4),e.RenderPass=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
