/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],(function(e,t,n,r){"use strict";let o=function(){function e(e){this._context=e,this._perConstructorInstances=new n.NestedMap,this._frameCounter=0,this._keepAliveFrameCount=i}var r=e.prototype;return r.destroy=function(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()},r.acquire=function(e,t=c){const n=t.key;let r=this._perConstructorInstances.get(e,n);if(null==r){const o=new e(this._context,t,(()=>this.release(o)));r=new s(o),this._perConstructorInstances.set(e,n,r)}return++r.refCount,r.technique},r.releaseAndAcquire=function(e,t,n){if(null!=n){if(t.key===n.key)return n;this.release(n)}return this.acquire(e,t)},r.release=function(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))},r.frameUpdate=function(){this._frameCounter++,this._keepAliveFrameCount!==i&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,n)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,n))}))}))},r.reloadAll=async function(){const e=new Array;this._perConstructorInstances.forEach(((t,n)=>{const r=async(e,t)=>{const n=t.shader;n&&(await n.reload(),e.forEach((e=>e.technique.reload(this._context))))};e.push(r(t,n))})),await Promise.all(e)},t._createClass(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]),e}(),s=t._createClass((function(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}));const i=-1,c=new r.ShaderTechniqueConfiguration;e.ShaderTechniqueRepository=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
