/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],(function(t,s){"use strict";return function(){function i(t,s=0){this._capacity=0,this._count=0,this._emptySlots=[],this._emptySlotCount=0,this._id2slot=new Map,this._slot2id=[],this.layout=t,this._resize(s)}var e=i.prototype;return e.prepareAllocate=function(t){const s=this._count+t;s>this._capacity&&this._resize(s)},e.allocate=function(t){this._count>=this._capacity&&this._resize(this._count+1);const s=this._emptySlotCount>0?this._emptySlots[--this._emptySlotCount]:this._count;return this._id2slot.set(t,s),this._slot2id[s]=t,this._count++,s},e.prepareFree=function(t){this._emptySlots.length+=t},e.free=function(t){const s=this._id2slot.get(t);null!=s&&(this._emptySlots.length<=this._emptySlotCount&&(this._emptySlots.length=this._emptySlotCount+1),this._emptySlots[this._emptySlotCount++]=s,this._id2slot.delete(t),this._slot2id[s]=null,this._count--)},e.getCount=function(){return this._count},e.getSlot=function(t){return this._id2slot.get(t)},e.hasSlot=function(t){return this._id2slot.has(t)},e.getBuffer=function(){return this._buffer},e.compact=function(){if(this._emptySlotCount>0){const t=this._emptySlots;let s=this._emptySlotCount,i=this._count+s;for(t.length=s,t.sort(((t,s)=>t-s));s>0;){if(t[s-1]!==i-1){const e=i-1,o=t[s-1];this._buffer.copyFrom(this._buffer,e,o,1);const h=this._slot2id[e];this._slot2id[e]=null,this._slot2id[o]=h,this._id2slot.set(h,o)}s--,i--}}this._emptySlotCount=0,this._emptySlots.length=0,this._resize(this._count)},e._resize=function(t){const i=this._capacity;if((t=Math.max(0,t))>0&&(t=s.nextHighestPowerOfTwo(t)),t>i){const s=this.layout.createBuffer(t);this._buffer&&s.copyFrom(this._buffer,0,0,i),this._buffer=s}else if(t<i){const s=this.layout.createBuffer(t);s.copyFrom(this._buffer,0,0,t),this._buffer=s}this._buffer||(this._buffer=this.layout.createBuffer(0)),this._capacity=t,this._slot2id.length=t},t._createClass(i)}()}));
