/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView"],(function(e,r,t,o,i){"use strict";let d=function(){function e(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new i.BufferViewVec4u8(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}var d=e.prototype;return d.setUidToObjectAndLayerId=function(e,r,t,o,i,d=null,n=null,a=null){if(!(e&&r&&t&&o))return;if(this._layerUidToId.set(o,t),this._layerUidToPopupEnabled.set(o,i),!i)return;let l=this._layerUidToGraphicsUidToObjectId.get(o);l||(l=new Map,this._layerUidToGraphicsUidToObjectId.set(o,l)),l.set(r,{objectId:e,attributeNodeId:d,attributeIndex:n,subLayerId:a})},d.getObjectAndLayerIdColor=function(e){const r=this.getObjectAndLayerIdColorArray(e);return o.fromValues(r.get(0,1),r.get(0,2),r.get(0,3),255)},d.getObjectAndLayerIdColorArray=function(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(void 0===r)return t.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(!1===r)return this.colorZero;let o=this._uidToRenderColor.get(e.layerUid);o||(o=new Map,this._uidToRenderColor.set(e.layerUid,o));let d=o.get(e.graphicUid);if(!d){for(;!d;){const e=Math.floor(16777214*Math.random())+1;this._colorToUID.has(e)||(d=e)}if(d>16777215)throw new Error("Object ID Overflow");o.set(e.graphicUid,d),this._colorToUID.set(d,e)}const n=new ArrayBuffer(4);new DataView(n).setUint32(0,d,!1);return new i.BufferViewVec4u8(n)},d.getColorToObjectAndLayerIdMapping=function(){const e=new Map;for(const[r,o]of this._colorToUID.entries()){const i=this._layerUidToGraphicsUidToObjectId.get(o.layerUid);let d=null;i?(d=i.get(o.graphicUid),d||t.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+o.graphicUid)):t.getLogger(this).warn("getColorMapping: no entry found for layerUid "+o.layerUid);const n=this._layerUidToId.get(o.layerUid);n||t.getLogger(this).warn("no layerId found for uid "+o.layerUid),d&&n&&e.set(r,d.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:d.objectId,lid:n,attrId:d.attributeNodeId,attrIdx:d.attributeIndex,subLayerId:d.subLayerId}:{type:"object-and-layer-id",oid:d.objectId,lid:n})}return e},r._createClass(e)}();e.ObjectAndLayerIdRenderHelper=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
