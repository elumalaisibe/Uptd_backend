/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../support/buffer/glUtil","../DefaultVertexAttributeLocations","../GLMaterials","../Intersector","../IntersectorInterfaces","../VertexArrayObject","./Intersector","../../../../webgl/BufferObject","../../../../webgl/enums"],(function(e,t,r,s,n,o,a,i,l,u,f){"use strict";let m=function(){function e(e,t){const o=e.renderContext.rctx,a=t.geometry;this._materialRepository=e.materialRepository,a.material.setParameters({instancedDoublePrecision:!0});const l=a.material.createBufferWriter(),m=l.vertexBufferLayout,c=l.elementCount(a),d=m.createBuffer(c);l.write(null,null,a,d,0),this.geometry=a,this.material=a.material,this.glMaterials=new n.GLMaterials(a.material,this._materialRepository),this.vertexBufferLayout=m,this.vbo=u.BufferObject.createVertex(o,f.Usage.STATIC_DRAW,d.buffer),this.vao=new i.VertexArrayObject(o,s.Default3D,{geometry:r.glLayout(m)},{geometry:this.vbo}),this.vertexCount=c}var m=e.prototype;return m.destroy=function(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()},m.intersect=function(e,t,r,s,n,i,u,f){const m=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,((r,s,c,d,y)=>{if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;const d=new l.LodTarget(i.layerUid,i.graphicUid(n),m,c,u,f);if((null==e.results.min.drapedLayerOrder||y>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(a.IntersectorType.LOD,d,r,s,e.transform.transform,y),e.options.store!==a.StoreResults.MIN&&(null==e.results.max.drapedLayerOrder||y>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(a.IntersectorType.LOD,d,r,s,e.transform.transform,y),e.options.store===a.StoreResults.ALL){const t=o.newIntersectorResult(e.results.min.ray);t.set(a.IntersectorType.LOD,d,r,s,e.transform.transform,y),e.results.all.push(t)}}}))},t._createClass(e,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]),e}();e.LodComponentData=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
