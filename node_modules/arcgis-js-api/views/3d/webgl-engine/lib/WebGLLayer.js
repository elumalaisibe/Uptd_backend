/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../core/Handles","../../../../core/maybe","../../../../core/PooledArray","./ContentObject","./ContentObjectType","./DirtyEvents","./Octree","./UpdatePolicy"],(function(e,t,s,i,n,r,o,a,c,d,l){"use strict";let h=function(e){function o(n,o,d=""){var h;(h=e.call(this)||this).stage=n,h.apiLayerUid=d,h.type=a.ContentObjectType.Layer,h.events=new s,h.sliceable=!1,h._objects=new r,h._objectsAdded=new r,h._handles=new i,h.apiLayerUid=d,h.visible=o?.visible??!0,h.pickable=o?.pickable??!0,h.updatePolicy=o?.updatePolicy??l.UpdatePolicy.ASYNC,h._disableOctree=o?.disableOctree??!1,n.add(t._assertThisInitialized(h));for(const e of c.DirtyEventNames)h._handles.add(h.events.on(e,(t=>n.handleEvent(e,t))));return h}t._inherits(o,e);var h=o.prototype;return h.destroy=function(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())},h.add=function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)},h.remove=function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))},h.addMany=function(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)},h.removeMany=function(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}},h.sync=function(){this.updatePolicy!==l.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)},h.notifyObjectBBChanged=function(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)},h.getSpatialQueryAccelerator=function(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new d((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree},h.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)},h.invalidateSpatialQueryAccelerator=function(){this._octree=n.destroyMaybe(this._octree),this._objectsAdded.clear()},t._createClass(o,[{key:"objects",get:function(){return this._objects}}]),o}(o.ContentObject);function y(e){return null!=e&&e.type===a.ContentObjectType.Layer}e.WebGLLayer=h,e.isWebGLLayer=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
