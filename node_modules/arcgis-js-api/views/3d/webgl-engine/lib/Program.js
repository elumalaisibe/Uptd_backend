/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../core/shaderTechnique/BindType","../../../webgl/checkWebGLError"],(function(t,e,r,i,n){"use strict";let s=function(){function t(t,e,s){this._context=t,this._locations=s,this._textures=new Map,this._freeTextureUnits=new r({deallocator:null}),this._glProgram=t.programCache.acquire(e.generate("vertex"),e.generate("fragment"),s),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=e.generateBind(i.BindType.Pass,this),this.bindDraw=e.generateBind(i.BindType.Draw,this),this._fragmentUniforms=n.webglDebugEnabled()?e.fragmentUniforms:null}var s=t.prototype;return s.dispose=function(){this._glProgram.dispose()},s.setUniform1b=function(t,e){this._glProgram.setUniform1i(t,e?1:0)},s.setUniform1i=function(t,e){this._glProgram.setUniform1i(t,e)},s.setUniform1f=function(t,e){this._glProgram.setUniform1f(t,e)},s.setUniform2fv=function(t,e){this._glProgram.setUniform2fv(t,e)},s.setUniform3fv=function(t,e){this._glProgram.setUniform3fv(t,e)},s.setUniform4fv=function(t,e){this._glProgram.setUniform4fv(t,e)},s.setUniformMatrix3fv=function(t,e){this._glProgram.setUniformMatrix3fv(t,e)},s.setUniformMatrix4fv=function(t,e){this._glProgram.setUniformMatrix4fv(t,e)},s.setUniform1fv=function(t,e){this._glProgram.setUniform1fv(t,e)},s.setUniform1iv=function(t,e){this._glProgram.setUniform1iv(t,e)},s.setUniform2iv=function(t,e){this._glProgram.setUniform3iv(t,e)},s.setUniform3iv=function(t,e){this._glProgram.setUniform3iv(t,e)},s.setUniform4iv=function(t,e){this._glProgram.setUniform4iv(t,e)},s.assertCompatibleVertexAttributeLocations=function(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")},s.stop=function(){this._textures.clear(),this._freeTextureUnits.clear()},s.bindTexture=function(t,e){if(null==e||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let r=this._textures.get(t);return null==r?(r=this._allocTextureUnit(e),this._textures.set(t,r)):r.texture=e,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(e,r.unit),r.unit},s.rebindTextures=function(){this._context.useProgram(this),this._textures.forEach(((t,e)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(e,t.unit)})),null!=this._fragmentUniforms&&this._fragmentUniforms.forEach((t=>{"sampler2D"!==t.type&&"samplerCube"!==t.type||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)}))},s._allocTextureUnit=function(t){return{texture:t,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}},s._freeTextureUnit=function(t){this._freeTextureUnits.push(t.unit)},e._createClass(t,[{key:"glName",get:function(){return this._glProgram.glName}},{key:"compiled",get:function(){return this._glProgram.compiled}}]),t}();t.Program=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
