/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../geometry/support/Indices","./AttributeArray","./basicInterfaces","./BoundingInfo","./ContentObject","./ContentObjectType","./geometryDataUtils","./Object3DStateID","./Util","./VertexAttribute","../materials/renderers/utils"],(function(t,e,n,i,r,s,o,u,a,c,h,g,l,d,f){"use strict";let b=function(t){function a(e,n,i=[],s=null,o=c.ContentObjectType.Mesh,u=null,a=-1){var h;(h=t.call(this)||this).material=e,h.mapPositions=s,h.type=o,h.objectAndLayerIdColor=u,h.edgeIndicesLength=a,h.visible=!0,h._vertexAttributes=new Map,h._indices=new Map,h._boundingInfo=null;for(const[t,r]of n)r&&h._vertexAttributes.set(t,{...r});if(null==i||0===i.length){const t=m(h._vertexAttributes),e=r.getContinuousIndexArray(t);h.edgeIndicesLength=h.edgeIndicesLength<0?t:h.edgeIndicesLength;for(const n of h._vertexAttributes.keys())h._indices.set(n,e)}else for(const[t,c]of i)c&&(h._indices.set(t,r.compactIndices(c)),t===d.VertexAttribute.POSITION&&(h.edgeIndicesLength=h.edgeIndicesLength<0?h._indices.get(t).length:h.edgeIndicesLength));return h}e._inherits(a,t);var b=a.prototype;return b.instantiate=function(t={}){const e=new a(t.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach(((t,n)=>{t.exclusive=!1,e._vertexAttributes.set(n,t)})),this._indices.forEach(((t,n)=>e._indices.set(n,t))),e._boundingInfo=this._boundingInfo,e.transformation=t.transformation||this.transformation,e},b.getMutableAttribute=function(t){let e=this._vertexAttributes.get(t);return e&&!e.exclusive&&(e={...e,exclusive:!0,data:s.cloneAttributeData(e.data)},this._vertexAttributes.set(t,e)),e},b.setAttributeData=function(t,e){const n=this._vertexAttributes.get(t);n&&this._vertexAttributes.set(t,{...n,exclusive:!0,data:e})},b.computeAttachmentOrigin=function(t){return!!(this.type===c.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(t):this.type===c.ContentObjectType.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(null!=this._transformation&&i.transformMat4(t,t,this._transformation),!0)},b._computeAttachmentOriginTriangles=function(t){const e=this.indices.get(d.VertexAttribute.POSITION),n=this.vertexAttributes.get(d.VertexAttribute.POSITION);return h.computeAttachmentOriginTriangles(n,e,t)},b._computeAttachmentOriginLines=function(t){const e=this.vertexAttributes.get(d.VertexAttribute.POSITION),n=this.indices.get(d.VertexAttribute.POSITION);return h.computeAttachmentOriginLines(e,n,n&&I(this.material.parameters,e,n),t)},b._computeAttachmentOriginPoints=function(t){const e=this.indices.get(d.VertexAttribute.POSITION),n=this.vertexAttributes.get(d.VertexAttribute.POSITION);return h.computeAttachmentOriginPoints(n,e,t)},b.invalidateBoundingInfo=function(){this._boundingInfo=null},b._calculateBoundingInfo=function(){const t=this.indices.get(d.VertexAttribute.POSITION),e=this.vertexAttributes.get(d.VertexAttribute.POSITION);if(!t||0===t.length||!e)return null;const n=this.type===c.ContentObjectType.Mesh?3:1;l.assert(t.length%n==0,"Indexing error: "+t.length+" not divisible by "+n);const i=r.getContinuousIndexArray(t.length/n);return new u.BoundingInfo(i,n,t,e)},b.addHighlight=function(){const t=new g.Object3DStateID(o.Object3DState.Highlight);return this.highlights=f.addObject3DStateID(this.highlights,t),t},b.removeHighlight=function(t){this.highlights=f.removeObject3DStateID(this.highlights,t)},e._createClass(a,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const t=this._indices.values().next().value;return t?t.length:0}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}},{key:"transformation",get:function(){return this._transformation??n.IDENTITY},set:function(t){this._transformation=t&&t!==n.IDENTITY?n.clone(t):null}},{key:"shaderTransformation",get:function(){return null!=this._shaderTransformer?this._shaderTransformer(this.transformation):this.transformation}},{key:"shaderTransformer",get:function(){return this._shaderTransformer},set:function(t){this._shaderTransformer=t}},{key:"hasVolatileTransformation",get:function(){return null!=this._shaderTransformer}}]),a}(a.ContentObject);function m(t){const e=t.values().next().value;return null==e?0:e.data.length/e.size}function I(t,e,n){return!(!("isClosed"in t)||!t.isClosed)&&(n?n.length>2:e.data.length>6)}t.Geometry=b,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
