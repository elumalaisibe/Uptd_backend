/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],(function(i,t,e,n,s,r){"use strict";let h=function(){function i(i,t,e,h){this.primitiveIndices=i,this._numIndexPerPrimitive=t,this.indices=e,this.position=h,this._children=void 0,r.assert(i.length>=1),r.assert(e.length%this._numIndexPerPrimitive==0),r.assert(e.length>=i.length*this._numIndexPerPrimitive),r.assert(3===h.size||4===h.size);const{data:a,size:l}=h,c=i.length;let d=l*e[this._numIndexPerPrimitive*i[0]];o.clear(),o.push(d);const u=s.fromValues(a[d],a[d+1],a[d+2]),m=s.clone(u);for(let n=0;n<c;++n){const t=this._numIndexPerPrimitive*i[n];for(let i=0;i<this._numIndexPerPrimitive;++i){d=l*e[t+i],o.push(d);let n=a[d];u[0]=Math.min(n,u[0]),m[0]=Math.max(n,m[0]),n=a[d+1],u[1]=Math.min(n,u[1]),m[1]=Math.max(n,m[1]),n=a[d+2],u[2]=Math.min(n,u[2]),m[2]=Math.max(n,m[2])}}this.bbMin=u,this.bbMax=m;const f=n.lerp(s.create(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(m[0]-u[0],m[1]-u[1]),m[2]-u[2]);let P=this.radius*this.radius;for(let n=0;n<o.length;++n){d=o.at(n);const i=a[d]-f[0],t=a[d+1]-f[1],e=a[d+2]-f[2],s=i*i+t*t+e*e;if(s<=P)continue;const r=Math.sqrt(s),h=.5*(r-this.radius);this.radius=this.radius+h,P=this.radius*this.radius;const l=h/r;f[0]+=i*l,f[1]+=t*l,f[2]+=e*l}this.center=f,o.clear()}return i.prototype.getChildren=function(){if(this._children||n.squaredDistance(this.bbMin,this.bbMax)<=1)return this._children;const t=n.lerp(s.create(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,r=new Uint8Array(e),h=new Array(8);for(let i=0;i<8;++i)h[i]=0;const{data:o,size:a}=this.position;for(let i=0;i<e;++i){let e=0;const n=this._numIndexPerPrimitive*this.primitiveIndices[i];let s=a*this.indices[n],l=o[s],c=o[s+1],d=o[s+2];for(let i=1;i<this._numIndexPerPrimitive;++i){s=a*this.indices[n+i];const t=o[s],e=o[s+1],r=o[s+2];t<l&&(l=t),e<c&&(c=e),r<d&&(d=r)}l<t[0]&&(e|=1),c<t[1]&&(e|=2),d<t[2]&&(e|=4),r[i]=e,++h[e]}let l=0;for(let i=0;i<8;++i)h[i]>0&&++l;if(l<2)return;const c=new Array(8);for(let i=0;i<8;++i)c[i]=h[i]>0?new Uint32Array(h[i]):void 0;for(let i=0;i<8;++i)h[i]=0;for(let i=0;i<e;++i){const t=r[i];c[t][h[t]++]=this.primitiveIndices[i]}this._children=new Array;for(let n=0;n<8;++n)void 0!==c[n]&&this._children.push(new i(c[n],this._numIndexPerPrimitive,this.indices,this.position));return this._children},i.prune=function(){o.prune()},t._createClass(i)}();const o=new e({deallocator:null});i.BoundingInfo=h,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})}));
