/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../geometry/support/aaBoundingBox","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/shading/Normals.glsl","../lib/GLMaterial","../lib/Material","../lib/PathGeometry","../lib/RenderSlot","../lib/VertexAttribute","./DefaultBufferWriter","./PathTechnique","./internal/MaterialUtil"],(function(e,t,r,a,i,s,n,u,o,h,c,l,d,p,f){"use strict";let S=function(e){function u(t){var r;return(r=e.call(this,t,new m)||this).supportsEdges=!0,r._vertexAttributeLocations=p.vertexAttributeLocations,r._configuration=new p.PathTechniqueConfiguration,r._vertexBufferLayout=u.getVertexBufferLayout(),r}t._inherits(u,e);var o=u.prototype;return o.getConfiguration=function(e,t){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==s.ShaderOutput.Color&&e!==s.ShaderOutput.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?n.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?n.NormalsDoubleSidedMode.WindingOrder:n.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration},o.isVisibleForOutput=function(e){return e!==s.ShaderOutput.Shadow&&e!==s.ShaderOutput.ShadowExcludeHighlight&&e!==s.ShaderOutput.ShadowHighlight||this.parameters.castShadows},o.isVisible=function(){return t._get(t._getPrototypeOf(u.prototype),"isVisible",this).call(this)&&this.parameters.opacity>0},o.intersect=function(e,t,i,s,n,u){const o=e;if(!h.isPathGeometry(o))return;const c=o.path,l=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:e,factor:t,minSize:a,maxSize:i}=this.parameters.vvSize,s=c.sizeAttributeValue;l[0]*=r.clamp(e[0]+s*t[0],a[0],i[0]),l[1]*=r.clamp(e[2]+s*t[2],a[2],i[2])}const d=Math.max(l[0],l[1]),p=e.boundingInfo;if(null==p)return void this._intersectTriangles(c,l,s,n,u);const S=a.fromValues(p.bbMin[0]-d,p.bbMin[1]-d,p.bbMin[2]-d,p.bbMax[0]+d,p.bbMax[1]+d,p.bbMax[2]+d),b=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],m=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),g=[m/b[0],m/b[1],m/b[2]];f.intersectAabbInvDir(S,s,g,i.tolerance)&&this._intersectTriangles(c,l,s,n,u)},o._intersectTriangles=function(e,t,r,a,i){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,a,i)},o.createBufferWriter=function(){return new d.DefaultBufferWriter(this._vertexBufferLayout)},o.requiresSlot=function(e,t){switch(t){case s.ShaderOutput.Shadow:case s.ShaderOutput.ShadowHighlight:case s.ShaderOutput.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case s.ShaderOutput.Color:case s.ShaderOutput.Alpha:case s.ShaderOutput.Depth:case s.ShaderOutput.Normal:case s.ShaderOutput.Highlight:case s.ShaderOutput.ObjectAndLayerIdColor:return e===(this.parameters.transparent?c.RenderSlot.TRANSPARENT_MATERIAL:c.RenderSlot.OPAQUE_MATERIAL)||e===c.RenderSlot.DRAPED_MATERIAL;default:return!1}},o.createGLMaterial=function(e){return new b(e)},u.getVertexBufferLayout=function(){return i.newLayout().vec3f(l.VertexAttribute.POSITION).vec4f(l.VertexAttribute.PROFILERIGHT).vec4f(l.VertexAttribute.PROFILEUP).vec4f(l.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(l.VertexAttribute.FEATUREVALUE)},t._createClass(u)}(o.Material),b=function(e){function r(){return e.apply(this,arguments)||this}t._inherits(r,e);var a=r.prototype;return a._updateOccludeeState=function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})},a._updateShadowState=function(e){null!=this.technique&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})},a.beginSlot=function(e){return this._output!==s.ShaderOutput.Color&&this._output!==s.ShaderOutput.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(p.PathTechnique,e)},t._createClass(r)}(u),m=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).doubleSided=!1,t.doubleSidedType="normal",t.receiveSSAO=!0,t.receiveShadows=!1,t.castShadows=!0,t.hasSlicePlane=!1,t.transparent=!1,t.hasOccludees=!1,t}return t._inherits(r,e),t._createClass(r)}(p.PathPassParameters);e.PathMaterial=S,e.PathMaterialParameters=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
