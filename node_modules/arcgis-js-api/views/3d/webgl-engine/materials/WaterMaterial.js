/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/time","../../../../chunks/vec2f64","../../../../chunks/vec3f64","../../../../chunks/vec4f64","../core/shaderLibrary/ShaderOutput","../lib/AnimationTimer","../lib/Material","../lib/OrderIndependentTransparency","../lib/RenderSlot","./DefaultBufferWriter","./DefaultLayouts","./TriangleMaterial","./WaterGLMaterial","./WaterTechnique"],(function(e,t,a,r,i,n,s,o,l,u,c,h,f,p,d,m,S){"use strict";let A=function(e){function i(t){var a;return(a=e.call(this,t,new R)||this)._configuration=new S.WaterTechniqueConfiguration,a.animation=new l.AnimationTimer,a}t._inherits(i,e);var n=i.prototype;return n.getConfiguration=function(e,t){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.OITPolygonOffsetLimit,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration},n.update=function(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<g;const a=this.animation.advance(e);return this.setParameters({timeElapsed:r.secondsFromMilliseconds(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&a},n.requiresSlot=function(e,t){switch(t){case o.ShaderOutput.Normal:return e===h.RenderSlot.DRAPED_WATER;case o.ShaderOutput.Color:if(this.parameters.isDraped)return e===h.RenderSlot.DRAPED_MATERIAL;break;case o.ShaderOutput.Alpha:break;case o.ShaderOutput.Highlight:case o.ShaderOutput.ObjectAndLayerIdColor:return e===h.RenderSlot.OPAQUE_MATERIAL||e===h.RenderSlot.DRAPED_MATERIAL;default:return!1}let a=h.RenderSlot.OPAQUE_MATERIAL;return this.parameters.transparent&&(a=this.parameters.writeDepth?h.RenderSlot.TRANSPARENT_MATERIAL:h.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===a},n.createGLMaterial=function(e){return new m.WaterGLMaterial(e)},n.createBufferWriter=function(){return new f.DefaultBufferWriter(a("enable-feature:objectAndLayerId-rendering")?p.PositionUVLayoutObjectAndLayerId:p.PositionUVLayout)},t._createClass(i)}(d.TriangleMaterial),R=function(e){function a(){var t;return(t=e.apply(this,arguments)||this).waveStrength=.06,t.waveTextureRepeat=32,t.waveDirection=i.fromValues(1,0),t.waveVelocity=.05,t.flowStrength=.015,t.flowOffset=-.5,t.animationSpeed=.35,t.timeElapsed=0,t.color=s.fromValues(0,0,0,0),t.transparent=!0,t.writeDepth=!0,t.hasSlicePlane=!1,t.isDraped=!1,t.receiveShadows=!0,t.hasScreenSpaceReflections=!1,t.hasCloudsReflections=!1,t.origin=n.create(),t.modelTransformation=null,t}return t._inherits(a,e),t._createClass(a)}(u.MaterialParameters);const g=35e3;e.WaterMaterial=A,e.WaterMaterialParameters=R,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
