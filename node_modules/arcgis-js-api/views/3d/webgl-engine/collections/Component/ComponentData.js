/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","./IndexRange/ComponentRangeRunLengthEncoded"],(function(t,e){"use strict";function h(t,e,h){const i=[],n=[];let s=h.length,a=h.length;return e.forEachComponent((e=>(t[e]>0?(s!==e-1&&(i.length&&i.push(h[s+1]-i[i.length-1]),i.push(h[e])),s=e):(a!==e-1&&(n.length&&n.push(h[a+1]-n[n.length-1]),n.push(h[e])),a=e),!0))),i.length&&i.push(h[s+1]-i[i.length-1]),n.length&&n.push(h[a+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}return function(){function i(t,h){this.offsets=h,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new e.ComponentRangeRunLengthEncoded(i),this.materialDataBuffer=t.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let e=0;e<i;e++)this.materialDataIndices[e]=this.materialDataBuffer.acquireIndex()}var n=i.prototype;return n.destroy=function(){for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])},n.highlightsDirty=function(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null},n.visibilityDirty=function(){this.cachedGeometryRanges=null,this.highlightsDirty()},n._updateCachedHighlightRanges=function(){if((null==this.cachedHighlightRanges||null==this.cachedDefaultRanges)&&null!=this.highlightCounts){const{highlightRanges:t,defaultRanges:e}=h(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=e}},t._createClass(i,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){return null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){return null==this.highlightCounts?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}},{key:"defaultShadowMapRanges",get:function(){return null==this.highlightCounts?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}}]),i}()}));
