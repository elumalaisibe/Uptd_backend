/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../Graphic","../../../core/typedArrayUtil","../../../core/workers/WorkerHandle","../../../geometry/SpatialReference","../../../layers/support/Field"],(function(e,r,t,n,s,o,a){"use strict";let l=function(){function e(e){this._controller=e,this._handle=new c((r=>e.schedule(r)))}var n=e.prototype;return n.destroy=function(){this._handle.destroy()},n.invoke=function(e,r){return e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof o&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()}),this._handle.invoke(e,r).then((e=>{let r=0,n=0;const s=async l=>{if(e.spatialReference=o.fromJSON(e.spatialReference),e.fields)for(;r<e.fields.length;)if(e.fields[r]=a.fromJSON(e.fields[r]),r++,l.madeProgress())return this._controller.reschedule((e=>s(e)));const c=e.spatialReference;for(;n<e.features.length;){const r=e.features[n];if(++n,r.uid=t.generateUID(),null!=r.geometry&&(r.geometry.spatialReference=c,i(r.geometry),l.madeProgress()))return this._controller.reschedule((e=>s(e)))}return e};return this._controller.schedule((e=>s(e)))}))):Promise.resolve(null)},r._createClass(e)}();function i(e){switch(e.type){case"polyline":e.paths.reduce(((e,r)=>e+r.length),0)<n.NATIVE_ARRAY_MAX_SIZE&&(e.paths=e.hasZ||e.hasM?e.paths.map((e=>e.map((e=>[e[0],e[1],e[2]])))):e.paths.map((e=>e.map((e=>[e[0],e[1]])))));break;case"polygon":e.rings.reduce(((e,r)=>e+r.length),0)<n.NATIVE_ARRAY_MAX_SIZE&&(e.rings=e.hasZ||e.hasM?e.rings.map((e=>e.map((e=>[e[0],e[1],e[2]])))):e.rings.map((e=>e.map((e=>[e[0],e[1]])))))}}let c=function(e){function t(r){return e.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:e=>[e.buffer]},r)||this}return r._inherits(t,e),r._createClass(t)}(s.WorkerHandle);e.PBFDecoder=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
