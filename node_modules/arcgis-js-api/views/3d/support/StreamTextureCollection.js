/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/promiseUtils","../../../core/urlUtils","./TextureCollection","../webgl-engine/lib/Texture","../../webgl/enums"],(function(e,t,r,i,n,s,l){"use strict";let o=function(e){function o(t,r,i){var n;return(n=e.call(this,r,i)||this)._streamDataRequester=t,n}t._inherits(o,e);var u=o.prototype;return u.fromUrl=async function(e,t,i){r.throwIfAborted(i);const s=null!=i?i.signal:null,l=this.makeUid(e,t);let o=this._textureRequests.get(l);if(!o){const r=new AbortController,i=this._streamDataRequester.request(e,"image",{uid:l,signal:r.signal});o=new n.TextureRequest,o.abortController=r;const s=o;this._textureRequests.set(l,o),o.textureAsync=i.then((async r=>{const i=this._createTexture(e,r,t);return s.texture=i,s.abortController=null,this._stage.add(i),await this._stage.load(i),{uid:l,texture:i,release:()=>this._release(l)}}),(e=>{throw s.abortController=null,e}))}o.referenceCount++;try{return await r.whenOrAbort(o.textureAsync,s)}catch(u){throw this._release(l),u}},u._createTexture=function(e,t,r){const n={width:t.width,height:t.height,wrap:{s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(i.isSVG(e)){if(r||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;r=r||64,e>1?(t.width=Math.round(r/e),t.height=r):(t.width=r,t.height=Math.round(r*e))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new s.Texture(t,n)},t._createClass(o)}(n.TextureCollection);e.StreamTextureCollection=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
