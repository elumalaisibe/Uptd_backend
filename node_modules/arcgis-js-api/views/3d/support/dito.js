/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Attribute"],(function(t,n,i){"use strict";const r=1e-6,o=[0,0,0],e=[0,0,0];function s(t,n){const{data:r,size:s}=t,c=r.length/s;if(c<=0)return;const u=new L(t);U(o,u.minProj,u.maxProj),X(o,o,.5),W(e,u.maxProj,u.minProj);const h=R(e),f=new Q;f.quality=h,c<14&&(t=new i.Attribute(new Float64Array(u.buffer,112,42),3));const m=[0,0,0],l=[0,0,0],P=[0,0,0],j=[0,0,0],x=[0,0,0],I=[0,0,0],y=[0,0,0];switch(a(u,t,y,m,l,P,j,x,I,f)){case 1:return void v(o,e,n);case 2:return void G(t,j,n)}b(t,y,m,l,P,j,x,I,f),C(t,f.b0,f.b1,f.b2,Y,B);const N=[0,0,0];W(N,B,Y),f.quality=R(N),f.quality<h?J(f.b0,f.b1,f.b2,Y,B,N,n):v(o,e,n)}function a(t,n,i,o,e,s,a,c,u,h){if(x(t,o,e),it(o,e)<r)return 1;W(a,o,e),tt(a,a);return y(n,o,a,s)<r?2:(W(c,e,s),tt(c,c),W(u,s,o),tt(u,u),$(i,c,a),tt(i,i),g(n,i,a,c,u,h),0)}const c=[0,0,0],u=[0,0,0],h=[0,0,0],f=[0,0,0],m=[0,0,0],l=[0,0,0],P=[0,0,0],j=[0,0,0];function b(t,n,i,r,o,e,s,a,b){V(t,n,i,c,u),void 0!==c[0]&&(W(h,c,i),tt(h,h),W(f,c,r),tt(f,f),W(m,c,o),tt(m,m),$(l,f,e),tt(l,l),$(P,m,s),tt(P,P),$(j,h,a),tt(j,j),g(t,l,e,f,h,b),g(t,P,s,m,f,b),g(t,j,a,h,m,b)),void 0!==u[0]&&(W(h,u,i),tt(h,h),W(f,u,r),tt(f,f),W(m,u,o),tt(m,m),$(l,f,e),tt(l,l),$(P,m,s),tt(P,P),$(j,h,a),tt(j,j),g(t,l,e,f,h,b),g(t,P,s,m,f,b),g(t,j,a,h,m,b))}function x(t,n,i){let r=it(t.maxVert[0],t.minVert[0]),o=0;for(let e=1;e<7;++e){const n=it(t.maxVert[e],t.minVert[e]);n>r&&(r=n,o=e)}Z(n,t.minVert[o]),Z(i,t.maxVert[o])}const I=[0,0,0];function y(t,n,i,r){const{data:o,size:e}=t;let s=Number.NEGATIVE_INFINITY,a=0;for(let c=0;c<o.length;c+=e){I[0]=o[c]-n[0],I[1]=o[c+1]-n[1],I[2]=o[c+2]-n[2];const t=i[0]*I[0]+i[1]*I[1]+i[2]*I[2],r=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],e=I[0]*I[0]+I[1]*I[1]+I[2]*I[2]-t*t/r;e>s&&(s=e,a=c)}return Z(r,o,a),s}const N=[0,0];function V(t,n,i,o,e){_(t,n,N,e,o);const s=rt(i,n);N[1]-r<=s&&(o[0]=void 0),N[0]+r>=s&&(e[0]=void 0)}const w=[0,0,0],A=[0,0,0],d=[0,0,0],q=[0,0,0],M=[0,0,0],T=[0,0,0];function g(t,n,i,o,e,s){if(nt(n)<r)return;$(w,i,n),$(A,o,n),$(d,e,n),E(t,n,N),M[1]=N[0],q[1]=N[1],T[1]=q[1]-M[1];const a=[i,o,e],c=[w,A,d];for(let r=0;r<3;++r){E(t,a[r],N),M[0]=N[0],q[0]=N[1],E(t,c[r],N),M[2]=N[0],q[2]=N[1],T[0]=q[0]-M[0],T[2]=q[2]-M[2];const i=R(T);i<s.quality&&(Z(s.b0,a[r]),Z(s.b1,n),Z(s.b2,c[r]),s.quality=i)}}const F=[0,0,0];function E(t,n,i){const{data:r,size:o}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<r.length;e+=o){const t=r[e]*n[0]+r[e+1]*n[1]+r[e+2]*n[2];i[0]=Math.min(i[0],t),i[1]=Math.max(i[1],t)}}function _(t,n,i,r,o){const{data:e,size:s}=t;Z(r,e),Z(o,r),i[0]=rt(F,n),i[1]=i[0];for(let a=s;a<e.length;a+=s){const t=e[a]*n[0]+e[a+1]*n[1]+e[a+2]*n[2];t<i[0]&&(i[0]=t,Z(r,e,a)),t>i[1]&&(i[1]=t,Z(o,e,a))}}function v(t,n,i){Z(i.center,t),X(i.halfSize,n,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const z=[0,0,0],S=[0,0,0],p=[0,0,0],Y=[0,0,0],B=[0,0,0],O=[0,0,0];function G(t,n,i){Z(z,n),Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>Math.abs(n[2])?z[0]=0:Math.abs(n[1])>Math.abs(n[2])?z[1]=0:z[2]=0,nt(z)<r&&(z[0]=z[1]=z[2]=1),$(S,n,z),tt(S,S),$(p,n,S),tt(p,p),C(t,n,S,p,Y,B),W(O,B,Y),J(n,S,p,Y,B,O,i)}function C(t,n,i,r,o,e){E(t,n,N),o[0]=N[0],e[0]=N[1],E(t,i,N),o[1]=N[0],e[1]=N[1],E(t,r,N),o[2]=N[0],e[2]=N[1]}const k=[0,0,0],H=[1,0,0,0,1,0,0,0,1],D=[0,0,0];function J(t,n,i,r,o,e,s){H[0]=t[0],H[1]=t[1],H[2]=t[2],H[3]=n[0],H[4]=n[1],H[5]=n[2],H[6]=i[0],H[7]=i[1],H[8]=i[2],ot(s.quaternion,H),U(D,r,o),X(D,D,.5),X(s.center,t,D[0]),X(k,n,D[1]),U(s.center,s.center,k),X(k,i,D[2]),U(s.center,s.center,k),X(s.halfSize,e,.5)}const K=7;let L=n._createClass((function(t){this.minVert=new Array(K),this.maxVert=new Array(K);const n=64*K;this.buffer=new ArrayBuffer(n);let i=0;this.minProj=new Float64Array(this.buffer,i,K),i+=8*K,this.maxProj=new Float64Array(this.buffer,i,K),i+=8*K;for(let a=0;a<K;++a)this.minVert[a]=new Float64Array(this.buffer,i,3),i+=24;for(let a=0;a<K;++a)this.maxVert[a]=new Float64Array(this.buffer,i,3),i+=24;for(let a=0;a<K;++a)this.minProj[a]=Number.POSITIVE_INFINITY,this.maxProj[a]=Number.NEGATIVE_INFINITY;const r=new Array(K),o=new Array(K),{data:e,size:s}=t;for(let a=0;a<e.length;a+=s){let t=e[a];t<this.minProj[0]&&(this.minProj[0]=t,r[0]=a),t>this.maxProj[0]&&(this.maxProj[0]=t,o[0]=a),t=e[a+1],t<this.minProj[1]&&(this.minProj[1]=t,r[1]=a),t>this.maxProj[1]&&(this.maxProj[1]=t,o[1]=a),t=e[a+2],t<this.minProj[2]&&(this.minProj[2]=t,r[2]=a),t>this.maxProj[2]&&(this.maxProj[2]=t,o[2]=a),t=e[a]+e[a+1]+e[a+2],t<this.minProj[3]&&(this.minProj[3]=t,r[3]=a),t>this.maxProj[3]&&(this.maxProj[3]=t,o[3]=a),t=e[a]+e[a+1]-e[a+2],t<this.minProj[4]&&(this.minProj[4]=t,r[4]=a),t>this.maxProj[4]&&(this.maxProj[4]=t,o[4]=a),t=e[a]-e[a+1]+e[a+2],t<this.minProj[5]&&(this.minProj[5]=t,r[5]=a),t>this.maxProj[5]&&(this.maxProj[5]=t,o[5]=a),t=e[a]-e[a+1]-e[a+2],t<this.minProj[6]&&(this.minProj[6]=t,r[6]=a),t>this.maxProj[6]&&(this.maxProj[6]=t,o[6]=a)}for(let a=0;a<K;++a){let t=r[a];Z(this.minVert[a],e,t),t=o[a],Z(this.maxVert[a],e,t)}})),Q=n._createClass((function(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}));function R(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function U(t,n,i){t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2]}function W(t,n,i){t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2]}function X(t,n,i){t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i}function Z(t,n,i=0){t[0]=n[i],t[1]=n[i+1],t[2]=n[i+2]}function $(t,n,i){const r=n[0],o=n[1],e=n[2],s=i[0],a=i[1],c=i[2];t[0]=o*c-e*a,t[1]=e*s-r*c,t[2]=r*a-o*s}function tt(t,n){const i=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(i>0){const r=1/Math.sqrt(i);t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r}}function nt(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function it(t,n){const i=n[0]-t[0],r=n[1]-t[1],o=n[2]-t[2];return i*i+r*r+o*o}function rt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function ot(t,n){const i=n[0]+n[4]+n[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(n[5]-n[7])*r,t[1]=(n[6]-n[2])*r,t[2]=(n[1]-n[3])*r}else{let i=0;n[4]>n[0]&&(i=1),n[8]>n[3*i+i]&&(i=2);const r=(i+1)%3,o=(i+2)%3;let e=Math.sqrt(n[3*i+i]-n[3*r+r]-n[3*o+o]+1);t[i]=.5*e,e=.5/e,t[3]=(n[3*r+o]-n[3*o+r])*e,t[r]=(n[3*r+i]+n[3*i+r])*e,t[o]=(n[3*o+i]+n[3*i+o])*e}}t.computeOBB=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
