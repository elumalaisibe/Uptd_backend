/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/arrayUtils","../../../core/Handles","../../../core/handleUtils","../../../core/maybe","../../../core/reactiveUtils","../../../geometry/ellipsoidUtils","../layers/graphics/ObjectResourceCache","./index","./StreamTextureCollection","../webgl-engine/lib/screenSizePerspectiveUtils"],(function(e,t,s,i,r,n,c,a,o,l,h,u){"use strict";let d=function(){function e(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(l.ClientType.SYMBOLOGY),this.objectResourceCache=new o.ObjectResourceCache(((t,s)=>e.resourceController.memoryController.newCache(t,s))),this.textures=new h.StreamTextureCollection(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const t=a.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=u.getSettings(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=u.getLabelSettings(e.viewingMode,t)}var d=e.prototype;return d.destroy=function(){this.textures.destroy(),this.streamDataRequester=null},d.addGraphicsOwner=function(e){if(!e)return r.makeHandle();this._graphicsOwners.push(e);const t=c.watch((()=>e.layer?.screenSizePerspectiveEnabled),(()=>this._updateScreenSizePerspectiveEnabled()));return this._updateScreenSizePerspectiveEnabled(),r.makeHandle((()=>{t.remove(),s.removeUnordered(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()}))},d._updateScreenSizePerspectiveEnabled=function(){const e=this._graphicsOwners.some((e=>!0===e.layer?.screenSizePerspectiveEnabled));if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new i;const e=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([c.watch((()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance),e,c.sync),this._viewState.events.on("camera-projection-changed",e)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=n.destroyMaybe(this._screenSizePerspectiveHandles))},d._updateScreenSizePerspectiveSettings=function(){const e=this._pointsOfInterest;p.distance=e.centerOnSurfaceInfrequent.distance,p.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(p),this.screenSizePerspectiveSettingsLabels.update(p),this._view._stage.renderView.requestRender()},t._createClass(e,[{key:"test",get:function(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}]),e}();const p={distance:0,fovY:0};e.SharedSymbolResources=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
