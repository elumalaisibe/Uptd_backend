/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/mathUtils","../../../core/unitUtils","../../../chunks/mat4","../../../chunks/vec3","../../../core/libs/gl-matrix-2/types/vec3","../../../geometry/projection","../../../geometry/support/Axis","../../../geometry/support/coordinateSystem","../../../geometry/support/plane","../../../geometry/support/vector","../../../geometry/support/vectorStacks","../../../layers/graphics/dehydratedFeatureUtils","../../ViewingMode"],(function(t,e,i,o,n,s,r,a,c,l,d,u,h,p,m){"use strict";let y=function(){function t(t,e,i,o){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=i,this._coordinateSystem=o,this._tmpCoordinateSystem=l.create(o)}var y=t.prototype;return y.getAltitude=function(t){return l.altitudeAt(this._coordinateSystem,t)},y.setAltitude=function(t,e,i=t){return l.setAltitudeAt(this._coordinateSystem,i,e,t)},y.setAltitudeOfTransformation=function(t,e){l.setAltitudeOfTransformation(this._coordinateSystem,e,t,e)},y.worldUpAtPosition=function(t,e){return l.normalAt(this._coordinateSystem,t,e)},y.worldBasisAtPosition=function(t,e,i){return l.axisAt(this._coordinateSystem,t,e,i)},y.basisMatrixAtPosition=function(t,e){const i=this.worldBasisAtPosition(t,c.Axis.X,h.sv3d.get()),o=this.worldBasisAtPosition(t,c.Axis.Y,h.sv3d.get()),s=this.worldBasisAtPosition(t,c.Axis.Z,h.sv3d.get());return n.set(e,i[0],i[1],i[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,0,0,0,1),e},y.headingAtPosition=function(t,e){const o=this.worldUpAtPosition(t,h.sv3d.get()),n=this.worldBasisAtPosition(t,c.Axis.Y,h.sv3d.get()),s=u.angleAroundAxis(e,n,o);return i.rad2deg(s)},y.intersectManifoldClosestSilhouette=function(t,e,i){return l.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem),l.intersectRayClosestSilhouette(this._tmpCoordinateSystem,t,i),i},y.intersectManifold=function(t,e,i){l.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem);const o=h.sv3d.get();return l.intersectRay(this._tmpCoordinateSystem,t,o)?s.copy(i,o):null},y.intersectInfiniteManifold=function(t,e,i){if(this.viewingMode===m.ViewingMode.Global)return this.intersectManifold(t,e,i);l.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem);const o=this._tmpCoordinateSystem.value,n=h.sv3d.get();return d.intersectRay(o.plane,t,n)?s.copy(i,n):null},y.toRenderCoords=function(t,e,i){return p.isDehydratedPoint(t)?a.projectPointToVector(t,e,this.spatialReference):a.projectVectorToVector(t,e,i,this.spatialReference)},y.fromRenderCoords=function(t,e,i=null){return p.isDehydratedPoint(e)?(null!=i&&(e.spatialReference=i),a.projectVectorToDehydratedPoint(t,this.spatialReference,e)):r.isVec3(e)?a.projectVectorToVector(t,this.spatialReference,e,i)?e:null:a.projectVectorToPoint(t,this.spatialReference,e)},t.create=function(e,i){switch(e){case m.ViewingMode.Local:return new t(m.ViewingMode.Local,i,o.getMetersPerUnitForSR(i),l.createLocal());case m.ViewingMode.Global:return new t(m.ViewingMode.Global,i,1,l.createGlobal(i))}},t.renderUnitScaleFactor=function(t,e){return o.getMetersPerCartesianUnitForSR(t)/o.getMetersPerCartesianUnitForSR(e)},e._createClass(t,[{key:"extent",set:function(t){t&&l.setExtent(this._coordinateSystem,t,this._coordinateSystem)}}]),t}();t.RenderCoordsHelper=y,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
