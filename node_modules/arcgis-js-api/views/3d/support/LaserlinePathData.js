/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/DoubleArray","./buffer/glUtil","./buffer/InterleavedLayout","../webgl-engine/lib/VertexArrayObject","../webgl-engine/lib/VertexAttribute","../webgl-engine/shaders/LaserlinePathTechnique","../../webgl/BufferObject","../../webgl/enums"],(function(e,t,r,s,i,n,u,o,f,a,c,l){"use strict";let h=function(){function e(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=s.create(),this._dirty=!1,this._count=0,this._vao=null}var u=e.prototype;return u.draw=function(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(l.PrimitiveType.TRIANGLES,0,this._count))},u.dispose=function(){null!=this._vao&&this._vao.dispose()},u._ensureVAO=function(e){return null==this._buffers?null:(null==this._vao&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)},u._createVAO=function(e,t){const r=this._createDataBuffer(t);return this._dirty=!1,new o.VertexArrayObject(e,a.attributeLocations,{data:n.glLayout(b)},{data:c.BufferObject.createVertex(e,l.Usage.STATIC_DRAW,r)})},u._ensureVertexData=function(e,t){if(!this._dirty)return;const r=this._createDataBuffer(t);e.vertexBuffers.data?.setData(r),this._dirty=!1},u._numberOfRenderVertices=function(e){return 3*(2*(e.length/3-1))},u._createDataBuffer=function(e){const t=e.reduce(((e,t)=>e+this._numberOfRenderVertices(t)),0);this._count=t;const s=b.createBuffer(t),i=this._origin;let n=0,u=0;for(const o of e){for(let e=0;e<o.length;e+=3){const t=r.set(d,o[e],o[e+1],o[e+2]);0===e?u=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,u);const f=this._renderCoordsHelper.worldUpAtPosition(t,_),a=n+2*e,c=r.subtract(d,t,i);if(e<o.length-3){s.up.setVec(a,f),s.up.setVec(a+3,f),s.up.setVec(a+5,f);for(let e=0;e<6;e++)s.start.setVec(a+e,c);s.extrude.setValues(a,0,-1),s.extrude.setValues(a+1,1,-1),s.extrude.setValues(a+2,1,1),s.extrude.setValues(a+3,0,-1),s.extrude.setValues(a+4,1,1),s.extrude.setValues(a+5,0,1)}if(e>0){s.up.setVec(a-2,f),s.up.setVec(a-4,f),s.up.setVec(a-5,f);for(let e=-6;e<0;e++)s.end.setVec(a+e,c)}}n+=this._numberOfRenderVertices(o)}return s.buffer},t._createClass(e,[{key:"vertices",set:function(e){const t=i.newDoubleArray(3*e.length);let r=0;for(const s of e)t[r++]=s[0],t[r++]=s[1],t[r++]=s[2];this.buffers=[t]}},{key:"buffers",set:function(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);r.set(this._origin,e[t],e[t+1],e[t+2])}else r.set(this._origin,0,0,0);this._dirty=!0}},{key:"origin",get:function(){return this._origin}}]),e}();const _=s.create(),d=s.create(),b=u.newLayout().vec3f(f.VertexAttribute.START).vec3f(f.VertexAttribute.END).vec3f(f.VertexAttribute.UP).vec2f(f.VertexAttribute.EXTRUDE);e.LaserlinePathData=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
