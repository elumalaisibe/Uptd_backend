/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/mat3","../../../chunks/mat3f64","../../../chunks/quat","../../../chunks/quatf32","../../../chunks/quatf64","../../../chunks/vec3","../../../chunks/vec3f32","../../../chunks/vec3f64","../../../chunks/vec4","../../../chunks/vec4f64","../../../geometry/support/aaBoundingBox","../../../geometry/support/plane","../../ViewingMode","./dito"],(function(e,t,n,a,r,c,i,o,s,u,f,l,h,S,z,b){"use strict";const m=i.create(),d=u.create(),M=u.create(),g=l.create(),p=a.create();let q=t._createClass((function(e){const t=56,n=0,a=24,r=36,i=e*t;this.buffer=new ArrayBuffer(i),this.obbs=new Array(e);for(let o=0;o<e;o++)this.obbs[o]={center:u.createView(this.buffer,t*o+n),halfSize:s.createView(this.buffer,t*o+a),quaternion:c.createView(this.buffer,t*o+r)}}));function y(e=[0,0,0],t=[-1,-1,-1],n=i.create()){return{center:u.clone(e),halfSize:s.clone(t),quaternion:c.clone(n)}}function A(e){return y(e.center,e.halfSize,e.quaternion)}function k(e,t){o.copy(t.center,e.center),o.copy(t.halfSize,e.halfSize),r.copy(t.quaternion,e.quaternion)}function Q(e,t){return t=t||y(),b.computeOBB(e,t),t}function j(e,t){const n=S.signedDistance(t,e.center),a=C(e,S.normal(t));return n>a?1:n<-a?-1:0}function w(e,t){return d[0]=e.center[0]-t[0],d[1]=e.center[1]-t[1],d[2]=e.center[2]-t[2],r.conjugate(m,e.quaternion),o.transformQuat(d,d,m),o.abs(d,d),o.min(M,d,e.halfSize),o.sqrDist(M,d)<t[3]*t[3]}function B(e,t){t||(t=h.create());const a=n.fromQuat(p,e.quaternion),r=e.halfSize[0]*Math.abs(a[0])+e.halfSize[1]*Math.abs(a[3])+e.halfSize[2]*Math.abs(a[6]),c=e.halfSize[0]*Math.abs(a[1])+e.halfSize[1]*Math.abs(a[4])+e.halfSize[2]*Math.abs(a[7]),i=e.halfSize[0]*Math.abs(a[2])+e.halfSize[1]*Math.abs(a[5])+e.halfSize[2]*Math.abs(a[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-c,t[2]=e.center[2]-i,t[3]=e.center[0]+r,t[4]=e.center[1]+c,t[5]=e.center[2]+i,t}function x(e,t){return S.signedDistance(t,e.center)-C(e,S.normal(t))}function v(e,t){return S.signedDistance(t,e.center)+C(e,S.normal(t))}function D(e,t){return j(e,t[0])<=0&&j(e,t[1])<=0&&j(e,t[2])<=0&&j(e,t[3])<=0&&j(e,t[4])<=0&&j(e,t[5])<=0}function V(e,t,n,a=0){r.conjugate(m,e.quaternion),o.subtract(d,t,e.center);const c=o.transformQuat(d,d,m),i=o.transformQuat(M,n,m);let s=-1/0,u=1/0;for(let r=0;r<3;r++)if(Math.abs(i[r])>1e-6){const t=(a+e.halfSize[r]-c[r])/i[r],n=(-a-e.halfSize[r]-c[r])/i[r];s=Math.max(s,Math.min(t,n)),u=Math.min(u,Math.max(t,n))}else if(c[r]>e.halfSize[r]+a||c[r]<-e.halfSize[r]-a)return!1;return s<=u}function O(e,t,a,c,i){r.conjugate(m,e.quaternion),o.sub(d,t,e.center),o.transformQuat(d,d,m);const s=d[0]<-e.halfSize[0]?-1:d[0]>e.halfSize[0]?1:0,u=d[1]<-e.halfSize[1]?-1:d[1]>e.halfSize[1]?1:0,l=d[2]<-e.halfSize[2]?-1:d[2]>e.halfSize[2]?1:0,h=Math.abs(s)+Math.abs(u)+Math.abs(l);if(0===h)return 1/0;const S=1===h?4:6,z=6*(s+3*u+9*l+13);n.fromQuat(p,e.quaternion),n.scale(p,p,e.halfSize);for(let n=0;n<S;n++){const t=_[z+n];o.set(d,((1&t)<<1)-1,(2&t)-1,((4&t)>>1)-1),o.transformMat3(d,d,p),o.add(g,e.center,d),g[3]=1,f.transformMat4(g,g,a);const r=1/Math.max(1e-6,g[3]);P[2*n]=g[0]*r,P[2*n+1]=g[1]*r}const b=2*S-2;let M=P[0]*(P[3]-P[b+1])+P[b]*(P[1]-P[b-1]);for(let n=2;n<b;n+=2)M+=P[n]*(P[n+3]-P[n-1]);return Math.abs(M)*c*i*.125}const P=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],_=(()=>{const e=new Int8Array(162);let t=0;const n=n=>{for(let a=0;a<n.length;a++)e[t+a]=n[a];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function C(e,t){r.conjugate(m,e.quaternion),o.transformQuat(d,t,m);const n=e.halfSize;return Math.abs(d[0]*n[0])+Math.abs(d[1]*n[1])+Math.abs(d[2]*n[2])}function G(e,t){for(let n=0;n<8;++n){const a=t[n];a[0]=1&n?-e.halfSize[0]:e.halfSize[0],a[1]=2&n?-e.halfSize[1]:e.halfSize[1],a[2]=4&n?-e.halfSize[2]:e.halfSize[2],o.transformQuat(a,a,e.quaternion),o.add(a,a,e.center)}}function H(e){return o.len(e.halfSize)}function I(e,t,n,a,c){if(r.copy(c.quaternion,e.quaternion),a===z.ViewingMode.Global){r.conjugate(E,e.quaternion),o.transformQuat(L,e.center,E),o.abs(R,L),o.min(T,R,e.halfSize),o.sub(T,R,T);const a=o.length(T);o.add(T,R,e.halfSize);const i=o.length(T);if(a<n)o.copy(c.center,e.center),o.set(L,n,n,n),o.add(c.halfSize,e.halfSize,L);else{const r=i>0?1+t/i:1,s=a>0?1+n/a:1,u=(s+r)/2,f=(s-r)/2;o.scale(c.halfSize,R,f),o.scaleAndAdd(c.halfSize,c.halfSize,e.halfSize,u),o.scale(c.center,R,u),o.scaleAndAdd(c.center,c.center,e.halfSize,f),o.sign(L,L),o.multiply(c.center,c.center,L),o.transformQuat(c.center,c.center,c.quaternion)}}else{const a=o.set(L,0,0,1);o.scaleAndAdd(c.center,e.center,a,(n+t)/2),r.conjugate(E,e.quaternion),o.transformQuat(a,a,E),o.abs(a,a),o.scaleAndAdd(c.halfSize,e.halfSize,a,(n-t)/2)}return c}const L=u.create(),R=u.create(),T=u.create(),E=i.create();e.ObbArray=q,e.clone=A,e.compute=Q,e.computeOffsetObb=I,e.corners=G,e.create=y,e.intersectLine=V,e.intersectPlane=j,e.intersectSphere=w,e.isVisible=D,e.maximumDistancePlane=v,e.minimumDistancePlane=x,e.projectedArea=O,e.projectedRadius=C,e.radius=H,e.set=k,e.toAaBoundingBox=B,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
