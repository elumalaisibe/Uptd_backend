/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/vec2","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices","../../../ViewingMode","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/ContentObjectType","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/VertexAttribute"],(function(t,e,r,n,u,i,o,a,l,s,b,c,A,p,T){"use strict";function h(t,e,r=null){const n=[],u=[],i=e.mapPositions;f(e,u,n);const o=u[0][1].data,a=n[0][1].length,l=s.getZeroIndexArray(a);return g(e,u,n,l),I(e,u,n,l),E(e,u,n,l),y(e,u,n,l),O(e,u,n,l),R(e,u,n,l),w(e,u,n,o),new p.Geometry(t,u,n,i,A.ContentObjectType.Line,r)}function f(t,e,r){const{attributeData:{position:n},removeDuplicateStartEnd:u}=t,i=D(n)&&u,o=n.length/3-(i?1:0),a=new Array(2*(o-1)),l=i?n.slice(0,n.length-3):n;let s=0;for(let b=0;b<o-1;b++)a[s++]=b,a[s++]=b+1;e.push([T.VertexAttribute.POSITION,new c.Attribute(l,3,i)]),r.push([T.VertexAttribute.POSITION,a])}function g(t,e,r,n){if(null!=t.attributeData.colorFeature)return;const i=t.attributeData.color;e.push([T.VertexAttribute.COLOR,new c.Attribute(i??u.ONES,4)]),r.push([T.VertexAttribute.COLOR,n])}function E(t,e,r,n){if(null==t.attributeData.normal)return;const u=t.attributeData.normal;e.push([T.VertexAttribute.NORMAL,new c.Attribute(u,3)]),r.push([T.VertexAttribute.NORMAL,n])}function y(t,e,r,n){null!=t.attributeData.colorFeature&&(e.push([T.VertexAttribute.COLORFEATUREATTRIBUTE,new c.Attribute([t.attributeData.colorFeature],1,!0)]),r.push([T.VertexAttribute.COLOR,n]))}function I(t,e,r,n){null==t.attributeData.sizeFeature&&(e.push([T.VertexAttribute.SIZE,new c.Attribute([t.attributeData.size??1],1,!0)]),r.push([T.VertexAttribute.SIZE,n]))}function O(t,e,r,n){null!=t.attributeData.sizeFeature&&(e.push([T.VertexAttribute.SIZEFEATUREATTRIBUTE,new c.Attribute([t.attributeData.sizeFeature],1,!0)]),r.push([T.VertexAttribute.SIZEFEATUREATTRIBUTE,n]))}function R(t,e,r,n){const u=t.attributeData.opacityFeature;null!=u&&(e.push([T.VertexAttribute.OPACITYFEATUREATTRIBUTE,new c.Attribute([u],1,!0)]),r.push([T.VertexAttribute.OPACITYFEATUREATTRIBUTE,n]))}function w(t,n,u,s){if(null==t.overlayInfo||t.overlayInfo.renderCoordsHelper.viewingMode!==b.ViewingMode.Global||!t.overlayInfo.spatialReference.isGeographic)return;const A=a.newDoubleArray(s.length),p=i.getReferenceEllipsoid(t.overlayInfo.spatialReference);for(let e=0;e<A.length;e+=3)o.lonLatToWebMercatorComparable(s,e,A,e,p);const h=s.length/3,f=l.newFloatArray(h+1);let g=x,E=V,y=0,I=0;r.set(g,A[I++],A[I++],A[I++]),f[0]=0;for(let i=1;i<h+1;++i)i===h&&(I=0),r.set(E,A[I++],A[I++],A[I++]),y+=e.dist(g,E),f[i]=y,[g,E]=[E,g];n.push([T.VertexAttribute.DISTANCETOSTART,new c.Attribute(f,1,!0)]),u.push([T.VertexAttribute.DISTANCETOSTART,u[0][1]])}function D(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const x=n.create(),V=n.create();function m(t,e){if(null==t||0===t.length)return[];const r=[];return t.forEach((t=>{const n=t.length,u=a.newDoubleArray(3*n);t.forEach(((t,e)=>{u[3*e]=t[0],u[3*e+1]=t[1],u[3*e+2]=t[2]}));const i={attributeData:{position:u,normal:e},removeDuplicateStartEnd:!1};r.push(i)})),r}t.createGeometry=h,t.lineStripsToParameters=m,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
