/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types","../../webgl-engine/lib/Util"],(function(e,t,i,f,r){"use strict";let n=function(){function e(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const i of e.fields.keys()){const t=e.fields.get(i);this[i]=new t.constructor(this.buffer,t.offset,this.stride)}}var i=e.prototype;return i.getField=function(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null},i.slice=function(t,i){return new e(this.layout,this.buffer.slice(t*this.stride,i*this.stride))},i.copyFrom=function(e,t=0,i=0,f=e.count){const r=this.stride;if(r%4==0){const n=new Uint32Array(e.buffer,t*r,f*r/4);new Uint32Array(this.buffer,i*r,f*r/4).set(n)}else{const n=new Uint8Array(e.buffer,t*r,f*r);new Uint8Array(this.buffer,i*r,f*r).set(n)}return this},t._createClass(e,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]),e}(),u=function(){function e(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:d(e[1].constructor)}))))}var u=e.prototype;return u.vec2f=function(e,t){return this._appendField(e,i.BufferViewVec2f,t),this},u.vec2f64=function(e,t){return this._appendField(e,i.BufferViewVec2f64,t),this},u.vec3f=function(e,t){return this._appendField(e,i.BufferViewVec3f,t),this},u.vec3f64=function(e,t){return this._appendField(e,i.BufferViewVec3f64,t),this},u.vec4f=function(e,t){return this._appendField(e,i.BufferViewVec4f,t),this},u.vec4f64=function(e,t){return this._appendField(e,i.BufferViewVec4f64,t),this},u.mat3f=function(e,t){return this._appendField(e,i.BufferViewMat3f,t),this},u.mat3f64=function(e,t){return this._appendField(e,i.BufferViewMat3f64,t),this},u.mat4f=function(e,t){return this._appendField(e,i.BufferViewMat4f,t),this},u.mat4f64=function(e,t){return this._appendField(e,i.BufferViewMat4f64,t),this},u.vec4u8=function(e,t){return this._appendField(e,i.BufferViewVec4u8,t),this},u.f32=function(e,t){return this._appendField(e,i.BufferViewFloat,t),this},u.f64=function(e,t){return this._appendField(e,i.BufferViewFloat64,t),this},u.u8=function(e,t){return this._appendField(e,i.BufferViewUint8,t),this},u.u16=function(e,t){return this._appendField(e,i.BufferViewUint16,t),this},u.i8=function(e,t){return this._appendField(e,i.BufferViewInt8,t),this},u.vec2i8=function(e,t){return this._appendField(e,i.BufferViewVec2i8,t),this},u.vec2i16=function(e,t){return this._appendField(e,i.BufferViewVec2i16,t),this},u.vec2u8=function(e,t){return this._appendField(e,i.BufferViewVec2u8,t),this},u.vec4u16=function(e,t){return this._appendField(e,i.BufferViewVec4u16,t),this},u.u32=function(e,t){return this._appendField(e,i.BufferViewUint32,t),this},u._appendField=function(e,t,i){if(this._fields.has(e))return void r.assert(!1,`${e} already added to vertex buffer layout`);const n=t.ElementCount*f.elementTypeSize(t.ElementType),u=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:t,offset:u,optional:i})},u.createBuffer=function(e){return new n(this,e)},u.createView=function(e){return new n(this,e)},u.clone=function(){const t=new e;return t._stride=this._stride,t._fields=new Map,this._fields.forEach(((e,i)=>t._fields.set(i,e))),t.BufferType=this.BufferType,t},t._createClass(e,[{key:"stride",get:function(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,f.elementTypeSize(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}},{key:"fields",get:function(){return this._fields}}]),e}();function s(){return new u}let c=t._createClass((function(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const i={...e,constructor:h(e.constructor)};this.fields.push([t,i])})),this.stride=e.stride}));const o=[i.BufferViewFloat,i.BufferViewVec2f,i.BufferViewVec3f,i.BufferViewVec4f,i.BufferViewMat3f,i.BufferViewMat4f,i.BufferViewFloat64,i.BufferViewVec2f64,i.BufferViewVec3f64,i.BufferViewVec4f64,i.BufferViewMat3f64,i.BufferViewMat4f64,i.BufferViewUint8,i.BufferViewVec2u8,i.BufferViewVec3u8,i.BufferViewVec4u8,i.BufferViewUint16,i.BufferViewVec2u16,i.BufferViewVec3u16,i.BufferViewVec4u16,i.BufferViewUint32,i.BufferViewVec2u32,i.BufferViewVec3u32,i.BufferViewVec4u32,i.BufferViewInt8,i.BufferViewVec2i8,i.BufferViewVec3i8,i.BufferViewVec4i8,i.BufferViewInt16,i.BufferViewVec2i16,i.BufferViewVec3i16,i.BufferViewVec4i16,i.BufferViewInt32,i.BufferViewVec2i32,i.BufferViewVec3i32,i.BufferViewVec4i32];function h(e){return`${e.ElementType}_${e.ElementCount}`}function d(e){return l.get(e)}const l=new Map;o.forEach((e=>l.set(h(e),e))),e.InterleavedBuffer=n,e.InterleavedLayout=u,e.PackedLayout=c,e.newLayout=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
