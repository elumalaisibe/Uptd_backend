/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../intl","../../core/arrayUtils","../../core/domUtils","../../core/Evented","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/accessorSupport/decorators/subclass","../../support/themeUtils","./Component","../../widgets/support/widgetUtils","../../intl/locale"],(function(t,n,o,e,i,r,s,a,c,p,d,l,u,h,f){"use strict";const m={left:0,top:0,bottom:0,right:0},_={bottom:30,top:15,right:15,left:15},g="esri-ui",y={ui:g,corner:`${g}-corner`,innerContainer:`${g}-inner-container`,manualContainer:`${g}-manual-container`,cornerContainer:`${g}-corner-container`,topLeft:`${g}-top-left`,topRight:`${g}-top-right`,bottomLeft:`${g}-bottom-left`,bottomRight:`${g}-bottom-right`};function C(t){return t&&!t._started&&"function"==typeof t.postMixInProperties&&"function"==typeof t.buildRendering&&"function"==typeof t.postCreate&&"function"==typeof t.startup}function v(t){return 0===t?"0":`${t}px`}function b(t){const n="object"==typeof t&&null!==t&&Object.getPrototypeOf(t);return(null===n||n===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function w(t,{top:n,bottom:o,left:e,right:i}){t.style.top=n,t.style.bottom=o,t.style.left=e,t.style.right=i}let L=function(n){function o(t){var o;return(o=n.call(this,t)||this)._cornerNameToContainerLookup={},o._positionNameToContainerLookup={},o._components=new Array,o._componentMap=new Map,o._locale=f.getLocale(),o.view=null,o._applyViewPadding=()=>{const t=o.container;t&&w(t,o._toPixelPosition(o._getViewPadding()))},o._applyUIPadding=()=>{const t=o._innerContainer;t&&w(t,o._toPixelPosition(o.padding))},o._initContainers(),o}t._inherits(o,n);var r=o.prototype;return r.initialize=function(){this.addHandles([s.watch((()=>[this.view?.padding,this.container]),this._applyViewPadding,s.initial),s.watch((()=>this.padding),this._applyUIPadding,s.initial),s.watch((()=>[this.container,this._locale]),(([t,n])=>{t&&t.setAttribute("lang",n)}),s.initial),f.onLocaleChange((t=>{this._locale=t}))])},r.destroy=function(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()},r.castPadding=function(t){return"number"==typeof t?{bottom:t,top:t,right:t,left:t}:{..._,...t}},r.add=function(t,n){let o,e,i;if(Array.isArray(t))return void t.forEach((t=>this.add(t,n)));const r=b(t);r&&({index:o,position:n,component:t,key:e}=r),n&&"object"==typeof n&&({index:o,key:e,position:n,internal:i}=n),!t||n&&!this._isValidPosition(n)||this._add(t,n,o,e,i)},r.remove=function(t,n){if(!t)return;if(Array.isArray(t))return t.map((t=>this.remove(t,n)));const o=this._find(t);if(o){if(this._componentMap.has(t)&&this._componentMap.get(t)?.key!==n)return;const e=this._components.indexOf(o),i=o.node.parentNode;return i?.removeChild(o.node),this._componentMap.delete(t),this._components.splice(e,1)[0]}},r.empty=function(t,n={removeInternal:!1}){if(Array.isArray(t)){for(const o of t)this.empty(o,n);return}const o=this._positionNameToContainerLookup[t??"manual"],e=Array.prototype.slice.call(o.children).map((t=>this._findByNode(t))).filter((t=>{if(null==t)return!1;return!(this._componentMap.get(t)?.internal??!1)||n.removeInternal}));for(const i of e)this.remove(i)},r.move=function(t,n){if(Array.isArray(t)&&t.forEach((t=>this.move(t,n))),!t)return;let o;const e=b(t)||b(n);if(e&&(o=e.index,n=e.position,t=e.component||t),n&&!this._isValidPosition(n))return;const i=this.remove(t);i&&this.add(i,{position:n,index:o})},r.find=function(t){if(!t)return null;const n=this._findById(t);return n&&(n.widget||n.node)},r.getComponents=function(t,n={includeInternal:!1}){return t?Array.isArray(t)?t.map((t=>this._getComponentsAtPosition(t,n))).flat():this._getComponentsAtPosition(t,n):this._components.filter((t=>n.includeInternal||!this._componentMap.get(t)?.internal)).map((({widget:t,node:n})=>t??n))},r.getPosition=function(t){for(const n in this._positionNameToContainerLookup){if(this._positionNameToContainerLookup[n].contains(t))return n}return null},r._add=function(t,n,o,e,i){t instanceof u||(t=new u({node:t})),this._place({component:t,position:n,index:o}),this._components.push(t),this._componentMap.set(t,{key:e,internal:i})},r._find=function(t){return t?t instanceof u?this._findByComponent(t):"string"==typeof t?this._findById(t):this._findByNode(t.domNode||t):null},r._getViewPadding=function(){return this.view?.padding??m},r._attachContainers=function(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)},r._initContainers=function(){const t=document.createElement("div");t.classList.add(y.innerContainer,y.cornerContainer);const n=document.createElement("div");n.classList.add(y.innerContainer,y.manualContainer);const o=document.createElement("div");o.classList.add(y.topLeft,y.corner),t.appendChild(o);const e=document.createElement("div");e.classList.add(y.topRight,y.corner),t.appendChild(e);const i=document.createElement("div");i.classList.add(y.bottomLeft,y.corner),t.appendChild(i);const r=document.createElement("div");r.classList.add(y.bottomRight,y.corner),t.appendChild(r),this._innerContainer=t,this._manualContainer=n;const s=h.isRTL();this._cornerNameToContainerLookup={"top-left":o,"top-right":e,"bottom-left":i,"bottom-right":r,"top-leading":s?e:o,"top-trailing":s?o:e,"bottom-leading":s?r:i,"bottom-trailing":s?i:r},this._positionNameToContainerLookup={manual:n,...this._cornerNameToContainerLookup}},r._isValidPosition=function(t){return!!this._positionNameToContainerLookup[t]},r._place=function(t){const n=t.position??"manual",{component:o,index:e}=t,r=this._positionNameToContainerLookup[n],s=null!=e&&e>-1;if(C(o.widget)&&o.widget.startup(),!s)return void r.appendChild(o.node);const a=Array.from(r.children);if(0===e)return void(r.firstChild?i.insertBefore(o.node,r.firstChild):r.appendChild(o.node));e>=a.length?r.appendChild(o.node):i.insertBefore(o.node,a[e])},r._toPixelPosition=function(t){return{top:v(t.top),left:v(t.left),right:v(t.right),bottom:v(t.bottom)}},r._findByComponent=function(t){return this._components.find((n=>n===t))??null},r._findById=function(t){return this._components.find((({id:n})=>n===t))??null},r._findByNode=function(t){return this._components.find((({node:n})=>n===t))??null},r._getComponentsAtPosition=function(t,n){const o=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(o.children).map((t=>this._findByNode(t))).filter(e.isSome).filter((t=>n.includeInternal||!this._componentMap.get(t)?.internal)).map((({widget:t,node:n})=>t??n))},t._createClass(o,[{key:"container",set:function(t){const n=this._get("container");t!==n&&(t&&(t.classList.add(y.ui),l.setCalciteThemeClass(t),this._attachContainers(t)),n&&(n.classList.remove(y.ui),w(n,{top:"",bottom:"",left:"",right:""}),i.empty(n)),this._set("container",t))}},{key:"height",get:function(){const t=this.view?.height??0;if(0===t)return t;const n=this._getViewPadding(),{top:o,bottom:e}=n;return Math.max(t-o-e,0)}},{key:"padding",get:function(){return this._get("padding")},set:function(t){this._overrideIfSome("padding",t)}},{key:"width",get:function(){const t=this.view?.width??0;if(0===t)return t;const n=this._getViewPadding(),{left:o,right:e}=n;return Math.max(t-o-e,0)}}]),o}(r.EventedAccessor);n.__decorate([a.property()],L.prototype,"_locale",void 0),n.__decorate([a.property()],L.prototype,"container",null),n.__decorate([a.property()],L.prototype,"height",null),n.__decorate([a.property({value:_})],L.prototype,"padding",null),n.__decorate([c.cast("padding")],L.prototype,"castPadding",null),n.__decorate([a.property()],L.prototype,"view",void 0),n.__decorate([a.property()],L.prototype,"width",null),L=n.__decorate([d.subclass("esri.views.ui.UI")],L);return L}));
