/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/domUtils","../core/Logger","../core/maybe","../core/reactiveUtils","../core/scheduling","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/subclass","./overlay/ViewOverlay"],(function(e,t,i,s,r,n,o,a,d,c,u,l,h,p){"use strict";const _=[0,0];function y(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return _[0]=i.left+(t?.pageXOffset??0),_[1]=i.top+(t?.pageYOffset??0),_}function f(e){e&&(s.empty(e),e.parentNode&&e.parentNode.removeChild(e))}function v(e){const t=document.createElement("div");return e.appendChild(t),t}const g=16,m=750,w=512,C=2,H=e=>{let c=function(e){function i(...i){var s;return(s=e.call(this,...i)||this)._freqInfo={freq:g,time:m},s._overlayRenderTaskHandle=null,s.height=0,s.overlay=null,s.position=null,s.resizing=!1,s.root=null,s.surface=null,s.suspended=!0,s.ui=null,s.userContent=null,s.width=0,s.widthBreakpoint=null,s.addHandles([o.watch((()=>s.cursor),(e=>{const{surface:i}=t._assertThisInitialized(s);i&&i.setAttribute("data-cursor",e)})),o.watch((()=>s.navigating),(e=>{const{surface:i}=t._assertThisInitialized(s);i&&i.setAttribute("data-navigating",e.toString())}))]),s}t._inherits(i,e);var d=i.prototype;return d.initialize=function(){this.addHandles([o.watch((()=>this.ui),((e,t)=>this._handleUIChange(e,t)),o.initial),this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])},d.destroy=function(){this.destroyed||(this.ui=n.destroyMaybe(this.ui),this.container=null)},d.blur=function(){this.surface?.blur()},d.focus=function(){this.surface?.focus()},d.pageToContainer=function(e,t,i){const s=this.position;return e-=s?s[0]:0,t-=s?s[1]:0,i?(i[0]=e,i[1]=t):i=[e,t],i},d.containerToPage=function(e,t,i){const s=this.position;return e+=s?s[0]:0,t+=s?s[1]:0,i?(i[0]=e,i[1]=t):i=[e,t],i},d._handleUIChange=function(e,t){this.removeHandles("ui"),t&&t!==e&&t.destroy(),e&&(e.view=this,this.addHandles(o.watch((()=>this.root),(t=>{e.container=t?v(t):null}),o.initial),"ui")),this._set("ui",e)},d._stopMeasuring=function(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)},d._startMeasuring=function(){const e=this._freqInfo;e.freq=g,e.time=m,this.addHandles([(()=>{const t=()=>{e.freq=g,e.time=m};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),a.addFrameTask({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=g,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const s=this._position();i.freq=s||t?g:Math.min(m,i.freq*C),!t&&i.freq>=w&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()},d._measure=function(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const s=this.width,r=this.height;return t===s&&i===r?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:r,width:t,height:i}),!0)},d._position=function(){const e=this.container,t=this.position,i=e&&y(e);return!!i&&((!t||i[0]!==t[0]||i[1]!==t[1])&&(this._set("position",[i[0],i[1]]),!0))},d.forceDOMReadyCycle=function(){},t._createClass(i,[{key:"container",get:function(){return this._get("container")??null},set:function(e){const t=this._get("container"),i=s.byId(e);if(i||"string"!=typeof e||r.getLogger(this).error("#container",`element with id '${e}' not found`),t===i)return;if(this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(f(this.root),this._set("root",null)),this.userContent&&(s.reparent(this.userContent,t),f(this.userContent),this._set("userContent",null))),!i)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);i.classList.add("esri-view");const d=document.createElement("div");d.className="esri-view-user-storage",s.reparent(i,d),i.appendChild(d),this._set("userContent",d);const c=document.createElement("div");c.className="esri-view-root",i.insertBefore(c,i.firstChild),this._set("root",c);const u=document.createElement("div");u.className="esri-view-surface",u.setAttribute("role","application"),u.tabIndex=0,c.appendChild(u),this._set("surface",u);const l=new p;c.appendChild(l.surface),this._set("overlay",l),this.addHandles(o.watch((()=>l.needsRender),(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=a.addFrameTask({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=n.removeMaybe(this._overlayRenderTaskHandle)}))),this.forceDOMReadyCycle(),this._set("container",i),this._startMeasuring()}},{key:"focused",get:function(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}},{key:"size",get:function(){return[this.width,this.height]}}]),i}(e);return i.__decorate([d.property()],c.prototype,"container",null),i.__decorate([d.property({readOnly:!0})],c.prototype,"focused",null),i.__decorate([d.property({readOnly:!0})],c.prototype,"height",void 0),i.__decorate([d.property({type:p})],c.prototype,"overlay",void 0),i.__decorate([d.property({readOnly:!0})],c.prototype,"position",void 0),i.__decorate([d.property({readOnly:!0})],c.prototype,"resizing",void 0),i.__decorate([d.property({readOnly:!0})],c.prototype,"root",void 0),i.__decorate([d.property({value:null,readOnly:!0})],c.prototype,"size",null),i.__decorate([d.property({readOnly:!0})],c.prototype,"surface",void 0),i.__decorate([d.property({readOnly:!0})],c.prototype,"suspended",void 0),i.__decorate([d.property()],c.prototype,"ui",void 0),i.__decorate([d.property({readOnly:!0})],c.prototype,"userContent",void 0),i.__decorate([d.property({readOnly:!0})],c.prototype,"width",void 0),i.__decorate([d.property()],c.prototype,"widthBreakpoint",void 0),c=i.__decorate([h.subclass("esri.views.DOMContainer")],c),c};e.DOMContainer=H,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
