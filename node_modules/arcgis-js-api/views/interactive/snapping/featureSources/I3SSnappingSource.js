/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/HandleOwner","../../../../core/handleUtils","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","../../../3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle","./sceneLayerSource/SceneLayerSnappingSourceWorkerHandle"],(function(e,r,t,o,n,i,a,s,d,c,l,p,u,h){"use strict";function S(e){return r=>e.immediate.schedule(r)}e.I3SSnappingSource=function(e){function t(r){var t;return(t=e.call(this,r)||this).availability=1,t._abortController=new AbortController,t}r._inherits(t,e);var o=t.prototype;return o.destroy=function(){this._tracker=i.removeMaybe(this._tracker),this._abortController=i.abortMaybe(this._abortController)},o.initialize=function(){const{view:e}=this,r=e.resourceController;this._edgeWorker=new u.EdgeWorkerHandle(S(r)),this._workerHandle=new h.SceneLayerSnappingSourceWorkerHandle({renderCoordsHelper:this.view.renderCoordsHelper,schedule:S(r),fetchEdgeLocations:async(e,r)=>{if(null==this._tracker)throw new Error("tracker-not-initialized");return this._tracker.fetchEdgeLocations(e,this._edgeWorker,r)}}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([n.destroyHandle(this._workerHandle),n.destroyHandle(this._edgeWorker)])},o.fetchCandidates=async function(e,r){return this._workerHandle.fetchCandidates(e,r)},o.refresh=function(){},o._setupLayerView=async function(){if(this.destroyed)return;const e=i.applySome(this._abortController,(e=>e.signal)),r=await this.getLayerView();null==r||a.isAborted(e)||(this._tracker=r.trackSnappingSources({add:(r,t)=>{this.updatingHandles.addPromise(this._workerHandle.add({id:r,bounds:t},e))},remove:r=>{this.updatingHandles.addPromise(this._workerHandle.remove({id:r},e))}}))},r._createClass(t,[{key:"updating",get:function(){return this.updatingHandles.updating}}]),t}(o.HandleOwner),t.__decorate([s.property({constructOnly:!0})],e.I3SSnappingSource.prototype,"getLayerView",void 0),t.__decorate([s.property({constructOnly:!0})],e.I3SSnappingSource.prototype,"view",void 0),t.__decorate([s.property({readOnly:!0})],e.I3SSnappingSource.prototype,"updating",null),t.__decorate([s.property({readOnly:!0})],e.I3SSnappingSource.prototype,"availability",void 0),e.I3SSnappingSource=t.__decorate([p.subclass("esri.views.interactive.snapping.featureSources.I3SSnappingSource")],e.I3SSnappingSource),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
