/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/arrayUtils","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/has","../../../../core/accessorSupport/decorators/subclass","./I3SSnappingSource"],(function(e,r,t,n,o,i,c,a,s,u,p){"use strict";e.SceneLayerSnappingSource=function(e){function t(r){var t;return(t=e.call(this,r)||this).availability=1,t._i3sSources=[],t}r._inherits(t,e);var n=t.prototype;return n.destroy=function(){this._i3sSources.forEach((e=>e.destroy())),this._i3sSources.length=0},n.initialize=function(){const{view:e}=this,r=this.layerSource.layer;this._i3sSources="building-scene"===r.type?this._getBuildingSceneI3SSources(e,r):[this._getSceneLayerI3SSource(e,r)]},n.fetchCandidates=async function(e,r){const t=await Promise.all(this._i3sSources.map((t=>t.fetchCandidates(e,r))));return i.throwIfAborted(r),t.flat()},n.refresh=function(){this._i3sSources.forEach((e=>e.refresh()))},n._getBuildingSceneI3SSources=function(e,r){return r.allSublayers.toArray().map((t=>"building-component"===t.type?new p.I3SSnappingSource({getLayerView:async()=>(await e.whenLayerView(r)).whenSublayerView(t),view:e}):null)).filter(o.isSome)},n._getSceneLayerI3SSource=function(e,r){return new p.I3SSnappingSource({getLayerView:async()=>{const t=await e.whenLayerView(r);return"scene-layer-graphics-3d"===t.type?void 0:t},view:e})},r._createClass(t,[{key:"updating",get:function(){return this._i3sSources.some((e=>e.updating))}}]),t}(n),t.__decorate([c.property({constructOnly:!0})],e.SceneLayerSnappingSource.prototype,"layerSource",void 0),t.__decorate([c.property({constructOnly:!0})],e.SceneLayerSnappingSource.prototype,"view",void 0),t.__decorate([c.property({readOnly:!0})],e.SceneLayerSnappingSource.prototype,"updating",null),t.__decorate([c.property({readOnly:!0})],e.SceneLayerSnappingSource.prototype,"availability",void 0),e.SceneLayerSnappingSource=t.__decorate([u.subclass("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],e.SceneLayerSnappingSource),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
