/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/asyncUtils","../../../../../geometry/support/aaBoundingRect"],(function(t,e,s,a){"use strict";let r=function(){function r(e,s){this.data=e,this.resolution=s,this.state={type:t.StateType.CREATED},this.alive=!0}var T=r.prototype;return T.process=function(e){switch(this.state.type){case t.StateType.CREATED:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case t.StateType.FETCH_COUNT:break;case t.StateType.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case t.StateType.FETCH_FEATURES:break;case t.StateType.FETCHED_FEATURES:this.state=this._goToDone(this.state,e);case t.StateType.DONE:}return null},T._gotoFetchCount=function(e,a){return{type:t.StateType.FETCH_COUNT,previous:e,task:s.createTask((async e=>{const r=await s.resultOrAbort(a.fetchCount(this,e));this.state.type===t.StateType.FETCH_COUNT&&(this.state=this._gotoFetchedCount(this.state,r.ok?r.value:1/0))}))}},T._gotoFetchedCount=function(e,s){return{type:t.StateType.FETCHED_COUNT,featureCount:s,previous:e}},T._gotoFetchFeatures=function(e,a){return{type:t.StateType.FETCH_FEATURES,previous:e,task:s.createTask((async r=>{const T=await s.resultOrAbort(a.fetchFeatures(this,e.featureCount,r));this.state.type===t.StateType.FETCH_FEATURES&&(this.state=this._gotoFetchedFeatures(this.state,T.ok?T.value:[]))}))}},T._gotoFetchedFeatures=function(e,s){return{type:t.StateType.FETCHED_FEATURES,previous:e,features:s}},T._goToDone=function(e,s){return s.finish(this,e.features),{type:t.StateType.DONE,previous:e}},T.reset=function(){const e=this.state;switch(this.state={type:t.StateType.CREATED},e.type){case t.StateType.CREATED:case t.StateType.FETCHED_COUNT:case t.StateType.FETCHED_FEATURES:case t.StateType.DONE:break;case t.StateType.FETCH_COUNT:case t.StateType.FETCH_FEATURES:e.task.abort()}},T.intersects=function(t){return null==t||!this.data.extent||(a.fromExtent(t,n),a.intersects(this.data.extent,n))},e._createClass(r,[{key:"debugInfo",get:function(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}},{key:"_featureCount",get:function(){switch(this.state.type){case t.StateType.CREATED:case t.StateType.FETCH_COUNT:return 0;case t.StateType.FETCHED_COUNT:return this.state.featureCount;case t.StateType.FETCH_FEATURES:return this.state.previous.featureCount;case t.StateType.FETCHED_FEATURES:return this.state.features.length;case t.StateType.DONE:return this.state.previous.features.length}}},{key:"_stateToString",get:function(){switch(this.state.type){case t.StateType.CREATED:return"created";case t.StateType.FETCH_COUNT:return"fetch-count";case t.StateType.FETCHED_COUNT:return"fetched-count";case t.StateType.FETCH_FEATURES:return"fetch-features";case t.StateType.FETCHED_FEATURES:return"fetched-features";case t.StateType.DONE:return"done"}}}]),r}();var T;t.StateType=void 0,(T=t.StateType||(t.StateType={}))[T.CREATED=0]="CREATED",T[T.FETCH_COUNT=1]="FETCH_COUNT",T[T.FETCHED_COUNT=2]="FETCHED_COUNT",T[T.FETCH_FEATURES=3]="FETCH_FEATURES",T[T.FETCHED_FEATURES=4]="FETCHED_FEATURES",T[T.DONE=5]="DONE";const n=a.create();t.PendingFeatureTile=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
