/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/maybe","../../../core/promiseUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../support/Scheduler"],(function(t,n,e,o,s,r,i,a,p,l,c,u){"use strict";t.SnappingOperation=function(t){function e(n){var e;return(e=t.call(this,n)||this).constrainResult=t=>t,e._snapPoints=null,e._frameTask=null,e._abortController=null,e._stagedPoint=null,e._snap=r.debounce((async(t,n,o,s)=>{const r=e._frameTask;if(null==r)return;const i=await r.schedule((()=>n.snap({...t,context:o,signal:s})),s);i.valid&&await r.schedule((()=>{e.stagedPoint=i.apply(),t!==e._snapPoints&&null!=e._snapPoints&&(e.stagedPoint=n.update({...e._snapPoints,context:o}))}),s)})),e}n._inherits(e,t);var o=e.prototype;return o.initialize=function(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=t?t.registerTask(u.TaskPriority.SNAPPING):u.ImmediateTask},o.destroy=function(){this._abortController=s.abortMaybe(this._abortController),this._frameTask=s.removeMaybe(this._frameTask)},o.update=function(t,n,e){this._snapPoints=t;const{point:o,scenePoint:s}=t,r=n.update({point:o,scenePoint:s,context:e});return this.stagedPoint=r,r},o.snap=async function(t,n,e){const{point:o,scenePoint:s}=t;return this.stagedPoint=n.update({point:o,scenePoint:s,context:e}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,n,e,this._abortController.signal)},o.resnap=async function(t,n){null!=this._snapPoints&&await this.snap(this._snapPoints,t,n)},o.abort=function(){this._abortController=s.abortMaybe(this._abortController),this._snapPoints=null},n._createClass(e,[{key:"stagedPoint",get:function(){return this._stagedPoint},set:function(t){this._stagedPoint=this.constrainResult(t)}}]),e}(o),e.__decorate([i.property({constructOnly:!0})],t.SnappingOperation.prototype,"view",void 0),e.__decorate([i.property()],t.SnappingOperation.prototype,"stagedPoint",null),e.__decorate([i.property()],t.SnappingOperation.prototype,"constrainResult",void 0),e.__decorate([i.property()],t.SnappingOperation.prototype,"_stagedPoint",void 0),t.SnappingOperation=e.__decorate([c.subclass("esri.views.interactive.snapping.SnappingOperation")],t.SnappingOperation),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
