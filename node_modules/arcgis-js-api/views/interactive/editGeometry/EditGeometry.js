/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/arrayUtils","../../../core/Evented","../../../geometry/Polygon","../../../geometry/Polyline","../coordinateHelper","./unnormalizationHelper"],(function(e,t,n,i,s,r,o,c){"use strict";let h=function(){function e(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}return t._createClass(e,[{key:"pos",get:function(){return this._pos},set:function(e){this._pos=e,this.component.unnormalizeVertexPositions()}}]),e}(),l=t._createClass((function(e,t,n){this.component=e,this.leftVertex=t,this.rightVertex=n,this.type="edge",t.rightEdge=this,n.leftEdge=this})),a=function(){function e(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}var n=e.prototype;return n.unnormalizeVertexPositions=function(){this.vertices.length<=1||c.unnormalize(this.vertices,c.getUnnormalizationInfo(this._spatialReference,this._viewingMode))},n.updateVertexIndex=function(e,t){if(0===this.vertices.length)return;const n=this.vertices[0];let i=null,s=e,r=t;do{i=s,i.index=r++,s=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=s&&s!==n);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)},n.getFirstVertex=function(){return 0===this.vertices.length?null:this.vertices[0]},n.getLastVertex=function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]},n.isClosed=function(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge},n.swapVertices=function(e,t){const n=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=n},n.iterateVertices=function(e){if(0===this.vertices.length)return;const t=this.vertices[0];let n=t;do{e(n,n.index),n=null!=n.rightEdge?n.rightEdge.rightVertex:null}while(n!==t&&null!=n)},t._createClass(e)}(),g=function(e){function i(t,n){var i;return(i=e.call(this)||this).type=t,i.coordinateHelper=n,i._geometry=null,i._dirty=!0,i.components=[],i}t._inherits(i,e);var c=i.prototype;return c.notifyChanges=function(e){this._dirty=!0,this.emit("change",e)},c._toPoint=function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)},c._toPolyline=function(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[];let s=n.vertices.find((e=>null==e.leftEdge));const r=s;do{i.push(t(s.pos)),s=s.rightEdge?s.rightEdge.rightVertex:null}while(s&&s!==r);e.push(i)}return new r({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})},c._toPolygon=function(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[],s=n.vertices[0];let r=s;const o=r;do{i.push(t(r.pos)),r=null!=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==o);n.isClosed()&&i.push(t(s.pos)),e.push(i)}return new s({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})},i.fromGeometry=function(e,t){const s=e.spatialReference,r=o.createCoordinateHelper(e.hasZ,e.hasM,s),c=new i(e.type,r);switch(e.type){case"polygon":{const i=e.rings;for(let e=0;e<i.length;++e){const o=i[e],g=new a(s,t);g.index=e;const u=o.length>2&&n.equals(o[0],o[o.length-1]),p=u?o.length-1:o.length;for(let e=0;e<p;++e){const t=r.arrayToVector(o[e]),n=new h(g);g.vertices.push(n),n.pos=t,n.index=e}const d=g.vertices.length-1;for(let e=0;e<d;++e){const t=g.vertices[e],n=g.vertices[e+1],i=new l(g,t,n);g.edges.push(i)}if(u){const e=new l(g,g.vertices[g.vertices.length-1],g.vertices[0]);g.edges.push(e)}c.components.push(g)}break}case"polyline":{const n=e.paths;for(let e=0;e<n.length;++e){const i=n[e],o=new a(s,t);o.index=e;const g=i.length;for(let e=0;e<g;++e){const t=r.arrayToVector(i[e]),n=new h(o);o.vertices.push(n),n.pos=t,n.index=e}const u=o.vertices.length-1;for(let e=0;e<u;++e){const t=o.vertices[e],n=o.vertices[e+1],i=new l(o,t,n);o.edges.push(i)}c.components.push(o)}break}case"point":{const n=new a(s,t);n.index=0;const i=new h(n);i.index=0,i.pos=r.pointToVector(e),n.vertices.push(i),c.components.push(n);break}}return c},t._createClass(i,[{key:"geometry",get:function(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon()}this._dirty=!1}return this._geometry}},{key:"spatialReference",get:function(){return this.coordinateHelper.spatialReference}}]),i}(i);e.Component=a,e.Edge=l,e.EditGeometry=g,e.Vertex=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
