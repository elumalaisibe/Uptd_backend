/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../../core/quantityUtils","../../../../chunks/vec2","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/boundedPlane","../../../../geometry/support/vectorStacks","../operations/MoveVertex","../operations/RotateVertex","../operations/ScaleVertex","../operations/UpdateVertices","../../../support/automaticLengthMeasurementUtils"],(function(s,t,e,o,n,a,i,r,c,d,u,b){"use strict";function l(s,t){return p(s,t,!1)}function g(s,t){return p(s,t,!0)}function p(s,t,e){if(s instanceof u.UpdateVertices){if(s.operation instanceof r.MoveVertex)return v(s.operation,t,e),!0;if(s.operation instanceof c.RotateVertex)return f(s.operation,t,e),!0;if(s.operation instanceof d.ScaleVertex)return I(s.operation,t,e),!0}return!1}function v(s,t,e=!1){const a=e?-1:1,i=n.fromValues(a*s.dx,a*s.dy,a*s.dz);o.add(t.origin,t.origin,i)}function f(s,t,e=!1){const a=e?-s.angle:s.angle;o.rotateZ(t.basis1,t.basis1,n.ZEROS,a),o.rotateZ(t.basis2,t.basis2,n.ZEROS,a)}function I(s,t,n=!1){const a=n?1/s.factor1:s.factor1,i=n?1/s.factor2:s.factor2;o.scale(t.basis1,t.basis1,a),o.scale(t.basis2,t.basis2,i),e.projectAndScale(t.origin,t.origin,s.origin,s.axis1,a),e.projectAndScale(t.origin,t.origin,s.origin,s.axis2,i)}function m(s,t,o,n){n||(n=a.create());const r=e.set(i.sv2d.get(),s[1],-s[0]),c=e.set(i.sv2d.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),d=e.set(i.sv2d.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=i.sv2d.get();t.components.forEach((t=>t.vertices.forEach((t=>{const o=t.pos;e.set(u,e.dot(s,o),e.dot(r,o)),e.min(c,c,u),e.max(d,d,u)}))));const b=1e-6,l=e.set(i.sv2d.get(),d[0]-c[0]<b?o/2:0,d[1]-c[1]<b?o/2:0);return e.subtract(c,c,l),e.add(d,d,l),e.scale(n.basis1,s,(d[0]-c[0])/2),e.scale(n.basis2,r,(d[1]-c[1])/2),e.set(n.origin,c[0]*s[0]+c[1]*r[0],c[0]*s[1]+c[1]*r[1]),e.add(n.origin,n.origin,n.basis1),e.add(n.origin,n.origin,n.basis2),n}function E(s,t,e,n=0,r){r||(r=a.create()),t.toRenderCoords(s.origin,e,r.origin);const c=i.sv3d.get();o.add(c,s.origin,s.basis1),o.add(c,c,s.basis2),t.toRenderCoords(c,e,c);const d=i.sv3d.get();o.add(d,s.origin,s.basis1),o.subtract(d,d,s.basis2),t.toRenderCoords(d,e,d);const u=i.sv3d.get();o.subtract(u,s.origin,s.basis1),o.subtract(u,u,s.basis2),t.toRenderCoords(u,e,u);const b=i.sv3d.get();o.subtract(b,s.origin,s.basis1),o.add(b,b,s.basis2),t.toRenderCoords(b,e,b);const l=o.lerp(i.sv3d.get(),c,d,.5);o.subtract(l,l,r.origin);const g=o.lerp(i.sv3d.get(),u,b,.5);o.subtract(g,r.origin,g),o.lerp(r.basis1,l,g,.5);const p=o.lerp(i.sv3d.get(),b,c,.5);o.subtract(p,p,r.origin);const v=o.lerp(i.sv3d.get(),d,u,.5);o.subtract(v,r.origin,v),o.lerp(r.basis2,p,v,.5);const f=o.cross(i.sv3d.get(),r.basis1,r.basis2),I=o.cross(f,f,r.basis1);return o.normalize(I,I),o.scale(r.basis2,I,o.dot(r.basis2,I)),o.scale(r.basis1,r.basis1,1+n/o.length(r.basis1)),o.scale(r.basis2,r.basis2,1+n/o.length(r.basis2)),a.updateUnboundedPlane(r),r}function N(s,e,n,a){const r=i.sv3d.get();o.subtract(r,o.subtract(r,s.origin,s.basis1),s.basis2);const c=i.sv3d.get();o.scaleAndAdd(c,r,s.basis1,2);const d=i.sv3d.get();o.scaleAndAdd(d,c,s.basis2,2);const u=i.sv3d.get();o.scaleAndAdd(u,r,s.basis2,2),r[2]=c[2]=d[2]=u[2]=e;const l=a?"on-the-ground":"absolute-height",g=t.max(b.autoHorizontalDistanceByElevationMode(r,c,n,l),b.autoHorizontalDistanceByElevationMode(u,d,n,l)),p=t.max(b.autoHorizontalDistanceByElevationMode(c,d,n,l),b.autoHorizontalDistanceByElevationMode(r,u,n,l));return null==p||null==g?null:[g,p]}s.apply=l,s.calculateOrientedBounds=m,s.mapPlaneAutoHorizontalSizeByElevationMode=N,s.mapPlaneToRenderPlane=E,s.unapply=g,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})}));
