/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/Logger","../../core/maybe","../../core/typedArrayUtil","./enums","./Util"],(function(t,e,i,n,r,s,o){"use strict";const u=i.getLogger("esri.views.webgl.VertexArrayObject");let f=function(){function t(t,e,i,n,r=null){this._context=t,this._locations=e,this._layout=i,this._buffers=n,this._indexBuffer=r,this._glName=null,this._initialized=!1,t.instanceCounter.increment(s.ResourceType.VertexArrayObject,this)}var i=t.prototype;return i.dispose=function(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const t in this._buffers)this._buffers[t]?.dispose(),delete this._buffers[t];this._indexBuffer=n.disposeMaybe(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&u.warn("Leaked WebGL VAO")},i.disposeVAOOnly=function(){if(this._glName){const t=this._context?.capabilities?.vao;t.deleteVertexArray(this._glName),this._glName=null}this._context.instanceCounter.decrement(s.ResourceType.VertexArrayObject,this),this._context=n.nullifyNonNullableForDispose(this._context)},i.initialize=function(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e}this._initialized=!0},i.bind=function(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())},i._bindLayout=function(){const{_buffers:t,_layout:e,_indexBuffer:i}=this;t||u.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const r in t){const i=t[r];i||u.error("Vertex buffer is uninitialized!");const n=e[r];n||u.error("Vertex element descriptor is empty!"),o.bindVertexBufferLayout(this._context,this._locations,i,n)}if(null!=i){!!this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i)}},i.unbind=function(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()},i._unbindLayout=function(){const{_buffers:t,_layout:e}=this;t||u.error("Vertex buffer dictionary is empty!");for(const i in t){const n=t[i];n||u.error("Vertex buffer is uninitialized!");const r=e[i];o.unbindVertexBufferLayout(this._context,this._locations,n,r)}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)},e._createClass(t,[{key:"glName",get:function(){return this._glName}},{key:"context",get:function(){return this._context}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"byteSize",get:function(){return Object.keys(this._buffers).reduce(((t,e)=>t+this._buffers[e].byteLength),null!=this._indexBuffer?this._indexBuffer.byteLength:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}},{key:"memoryEstimate",get:function(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*r.typedArrayStaticSize}}]),t}();t.VertexArrayObject=f,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
