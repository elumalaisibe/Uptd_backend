/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/clock","../../../core/MapUtils","../../../core/maybe","../../../core/screenUtils","../DragEventSeparator","../InputHandler","./SingleAndDoubleClick","./support"],(function(e,t,a,r,o,i,n,u,s,l){"use strict";let c=function(e){function u(t=s.DefaultParameters.maximumDoubleClickDelay,r=s.DefaultParameters.maximumDoubleClickDistance,o=s.DefaultParameters.maximumDoubleTouchDelay,u=s.DefaultParameters.maximumDoubleTouchDistance,l=a.clock){var c;return(c=e.call(this,!1)||this)._maximumDoubleClickDelay=t,c._maximumDoubleClickDistance=r,c._maximumDoubleTouchDelay=o,c._maximumDoubleTouchDistance=u,c._clock=l,c._doubleTapDragReady=!1,c._doubleTapDragActive=!1,c._dragStartCenter=i.createScreenPoint(0,0),c._pointerState=new Map,c._doubleTapDrag=c.registerOutgoing("double-tap-drag"),c._dragEventSeparator=new n.DragEventSeparator({start:(e,t)=>c._dragStart(e,t),update:(e,t)=>c._dragUpdate(t),end:(e,t)=>c._dragEnd(t)}),c.registerIncoming("drag",(e=>c._dragEventSeparator.handle(e))),c.registerIncoming("pointer-down",(e=>c._handlePointerDown(e))),c.registerIncoming("pointer-up",(()=>c._handlePointerUp())),c}t._inherits(u,e);var c=u.prototype;return c.onUninstall=function(){this._pointerState.forEach((e=>{e.doubleTapTimeout=o.removeMaybe(e.doubleTapTimeout)}))},c._clearPointerDown=function(e){const t=this._pointerState.get(e);t&&(t.doubleTapTimeout=o.removeMaybe(t.doubleTapTimeout),this._pointerState.delete(e),this.refreshHasPendingInputs())},c._createDoubleTapDragData=function(e,t,a){const{button:r,buttons:o,pointer:i,pointers:n,pointerType:u,timestamp:s}=a;return{action:e,delta:t,button:r,buttons:o,pointer:i,pointers:n,pointerType:u,timestamp:s}},c._dragStart=function(e,t){if(!this._doubleTapDragReady||1!==e)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:a,modifiers:r}=t,{center:o}=a;this._dragStartCenter=o;const n=this._createDoubleTapDragData("begin",i.createScreenPoint(0,0),a);this._doubleTapDrag.emit(n,void 0,r),t.stopPropagation()},c._dragUpdate=function(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:a}=e,{center:r}=t,o=i.createScreenPoint(r.x-this._dragStartCenter.x,r.y-this._dragStartCenter.y),n=this._createDoubleTapDragData("update",o,t);this._doubleTapDrag.emit(n,void 0,a),e.stopPropagation()},c._dragEnd=function(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:a}=e,{center:r}=t,o=i.createScreenPoint(r.x-this._dragStartCenter.x,r.y-this._dragStartCenter.y),n=this._createDoubleTapDragData("end",o,t);this._doubleTapDrag.emit(n,void 0,a),this._doubleTapDragActive=!1,e.stopPropagation()},c._handlePointerDown=function(e){const{data:t}=e,a=l.getPointerId(t),r=this._pointerState.get(a),{pointerType:o}=t.native;if(r){const i="touch"===o?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(a),l.manhattanDistance(r.event.data,t)>i?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)},c._handlePointerUp=function(){this._doubleTapDragReady=!1},c._storePointerDown=function(e){const{data:t}=e,{pointerType:a}=t.native,r=l.getPointerId(t),o="touch"===a?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,i=this._clock.setTimeout((()=>this._clearPointerDown(r)),o);this._pointerState.set(r,{event:e,doubleTapTimeout:i}),this.refreshHasPendingInputs()},t._createClass(u,[{key:"hasPendingInputs",get:function(){return r.someMap(this._pointerState,(e=>null!=e.doubleTapTimeout))}}]),u}(u.InputHandler);e.DoubleTapDrag=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
