/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Accessor","../../core/Collection","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../core/support/WatchUpdatingTracking","../../libs/maquette/projection","../../libs/maquette/projector"],(function(t,e,r,o,i,n,s,c,a,d,h,l){"use strict";let p=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).items=new o,t._watchUpdatingTracking=new d.WatchUpdatingTracking,t._callbacks=new Map,t._projector=l.createProjector(),t._hiddenProjector=l.createProjector(),t}t._inherits(r,e);var i=r.prototype;return i.initialize=function(){const t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((()=>this.items),(t=>{for(const e of t.added){const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)}for(const e of t.removed){const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}}))},i.addItem=function(t){this.items.add(t)},i.removeItem=function(t){this.items.remove(t)},i.destroy=function(){this.items.removeAll(),this._callbacks.forEach((t=>this._projector.detach(t))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()},i.render=function(){this._projector.renderNow()},i.computeBoundingRect=function(t){const e=this._hiddenSurface,r=this._hiddenProjector;let o;const i=()=>(o=t.render(),o);r.append(e,i),r.renderNow();const n={left:0,top:0,right:0,bottom:0};if(o&&o.domNode){const t=o.domNode.getBoundingClientRect();n.left=t.left,n.top=t.top,n.right=t.right,n.bottom=t.bottom}for(r.detach(i);e.firstChild;)e.removeChild(e.firstChild);return n},i.overlaps=function(t,e){const r=this.computeBoundingRect(t),o=this.computeBoundingRect(e);return Math.max(r.left,o.left)<=Math.min(r.right,o.right)&&Math.max(r.top,o.top)<=Math.min(r.bottom,o.bottom)},i.prepare=async function(){await document.fonts.load(this._fontString()).catch((()=>{}))},i.renderCanvas=function(t){if(!this.items.some((t=>t.visible)))return;const e=t.getContext("2d");e.save(),e.font=this._fontString(),this.items.forEach((t=>{e.save(),t.renderCanvas(e),e.restore()})),e.restore()},i._fontString=function(){return`10px ${getComputedStyle(this.surface).fontFamily}`},t._createClass(r,[{key:"needsRender",get:function(){return this.items.length>0}},{key:"updating",get:function(){return this._watchUpdatingTracking?.updating??!1}},{key:"hasVisibleItems",get:function(){return this.items.some((t=>t.visible))}}]),r}(r);e.__decorate([i.property({readOnly:!0})],p.prototype,"surface",void 0),e.__decorate([i.property({readOnly:!0})],p.prototype,"items",void 0),e.__decorate([i.property({readOnly:!0})],p.prototype,"needsRender",null),e.__decorate([i.property({readOnly:!0})],p.prototype,"_watchUpdatingTracking",void 0),e.__decorate([i.property({readOnly:!0})],p.prototype,"updating",null),p=e.__decorate([a.subclass("esri.views.overlay.ViewOverlay")],p);return p}));
