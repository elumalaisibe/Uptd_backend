/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Collection","../../core/collectionUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","./LayerView"],(function(i,e,s,r,t,l,a,n,y,o,h){"use strict";let c=function(e){function l(i){var r;return(r=e.call(this,i)||this).type="group",r.layerViews=new s,r}i._inherits(l,e);var a=l.prototype;return a.destroy=function(){this.handles.removeAll(),this.layerViews.length=0},a._allLayerViewVisibility=function(i){this.layerViews.forEach((e=>{e.visible=i}))},a.initialize=function(){this.handles.add([this.layerViews.on("change",(i=>this._layerViewsChangeHandler(i))),t.watch((()=>this.layer?.visibilityMode),(()=>{this.layer&&this._applyVisibility((()=>this._allLayerViewVisibility(this.visible)),(()=>this._applyExclusiveVisibility(null)))}),t.sync),t.watch((()=>this.visible),(i=>{this._applyVisibility((()=>this._allLayerViewVisibility(i)),(()=>{}))}),t.sync)],"grouplayerview"),this._layerViewsChangeHandler({target:null,added:this.layerViews.toArray(),removed:[],moved:[]})},a.isUpdating=function(){return this.layerViews.some((i=>i.updating))},a._hasLayerViewVisibleOverrides=function(){return this.layerViews.some((i=>i._isOverridden("visible")))},a._findLayerViewForLayer=function(i){return i&&this.layerViews.find((e=>e.layer===i))},a._firstVisibleOnLayerOrder=function(){const i=this.layer.layers.find((i=>{const e=this._findLayerViewForLayer(i);return!!e?.visible}));return i&&this._findLayerViewForLayer(i)},a._applyExclusiveVisibility=function(i){null==i&&null==(i=this._firstVisibleOnLayerOrder())&&this.layerViews.length>0&&(i=this._findLayerViewForLayer(this.layer.layers.at(0))),this.layerViews.forEach((e=>{e.visible=e===i}))},a._layerViewsChangeHandler=function(i){this.handles.remove("grouplayerview:visible"),this.handles.add(this.layerViews.map((i=>t.watch((()=>i.visible),(e=>this._applyVisibility((()=>{e!==this.visible&&(i.visible=this.visible)}),(()=>this._applyExclusiveVisibility(e?i:null)))),t.sync))).toArray(),"grouplayerview:visible");const e=i.added[i.added.length-1];this._applyVisibility((()=>this._allLayerViewVisibility(this.visible)),(()=>this._applyExclusiveVisibility(e?.visible?e:null)))},a._applyVisibility=function(i,e){this._hasLayerViewVisibleOverrides()&&("inherited"===this.layer?.visibilityMode?i():"exclusive"===this.layer?.visibilityMode&&e())},i._createClass(l,[{key:"layerViews",set:function(i){this._set("layerViews",r.referenceSetter(i,this._get("layerViews")))}},{key:"updatingProgress",get:function(){return 0===this.layerViews.length?1:this.layerViews.reduce(((i,e)=>i+e.updatingProgress),0)/this.layerViews.length}}]),l}(h);e.__decorate([l.property({cast:r.castForReferenceSetter})],c.prototype,"layerViews",null),e.__decorate([l.property({readOnly:!0})],c.prototype,"updatingProgress",null),e.__decorate([l.property()],c.prototype,"view",void 0),c=e.__decorate([o.subclass("esri.views.layers.GroupLayerView")],c);return c}));
