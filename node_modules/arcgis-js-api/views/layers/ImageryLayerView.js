/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.27/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Error","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/subclass","../../geometry/Point","../../layers/support/commonProperties","../../rest/support/Query","./support/popupUtils"],(function(e,t,r,o,s,p,a,i,n,u,c,l){"use strict";const y=s=>{let p=function(t){function o(){var e;return(e=t.apply(this,arguments)||this).view=null,e}e._inherits(o,t);var s=o.prototype;return s.fetchPopupFeatures=async function(e,t){const{layer:o}=this;if(!e)throw new r("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:o});const{popupEnabled:s}=o,p=l.getFetchPopupTemplate(o,t);if(!s||null==p)throw new r("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:s,popupTemplate:p});const a=await p.getRequiredFields(),i=new c;i.timeExtent=this.timeExtent,i.geometry=e,i.outFields=a,i.outSpatialReference=e.spatialReference;const{resolution:u,spatialReference:y}=this.view,d="2d"===this.view.type?new n(u,u,y):new n(.5*u,.5*u,y),{returnTopmostRaster:h,showNoDataRecords:m}=p.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},w={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:d,showNoDataRecords:m,signal:null!=t?t.signal:null};return o.queryVisibleRasters(i,w).then((e=>e))},s.canResume=function(){return!!e._get(e._getPrototypeOf(o.prototype),"canResume",this).call(this)&&!this.timeExtent?.isEmpty},e._createClass(o)}(s);return t.__decorate([o.property()],p.prototype,"layer",void 0),t.__decorate([o.property()],p.prototype,"suspended",void 0),t.__decorate([o.property(u.combinedViewLayerTimeExtentProperty)],p.prototype,"timeExtent",void 0),t.__decorate([o.property()],p.prototype,"view",void 0),p=t.__decorate([i.subclass("esri.views.layers.ImageryLayerView")],p),p};return y}));
